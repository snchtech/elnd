–î—è–∫—É—é –∑–∞ –¥–µ—Ç–∞–ª—å–Ω–∏–π SQL-–∑–∞–ø–∏—Ç! –í—ñ–Ω –≤–∏–≥–ª—è–¥–∞—î —è–∫ —á–∞—Å—Ç–∏–Ω–∞ –∑–≤—ñ—Ç—É –≤ Oracle APEX, –ø–æ–≤‚Äô—è–∑–∞–Ω–∞ –∑ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è–º outfit‚Äô—ñ–≤, –∫–æ–º–∞–Ω–¥–∞–º–∏ —Ç–∞ —Å—Ç–∞—Ç—É—Å–∞–º–∏, –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —á–∞—Å–æ–≤–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤.

–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –±—É–¥–µ —Å—Ñ–æ–∫—É—Å–æ–≤–∞–Ω–∞ –Ω–∞:

1. **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—ñ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫.**
2. **–°–ø—Ä–æ—â–µ–Ω–Ω—ñ –≤–∫–ª–∞–¥–µ–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤.**
3. **–£–Ω–∏–∫–Ω–µ–Ω–Ω—ñ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –∫–æ–¥—É.**
4. **–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—ñ —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ.**

---

## üîß –ü—Ä–æ–±–ª–µ–º–∏ —Ç–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:

### ‚ùå 1. **–°–∏–Ω—Ç–∞–∫—Å–∏—á–Ω—ñ –ø–æ–º–∏–ª–∫–∏:**
- `fcom` –∑–∞–º—ñ—Å—Ç—å `from`
- –ó–∞–π–≤–∞ `–≥—Ä—É–ø–∏—Ä–æ–≤–∫–∞` –ø—ñ—Å–ª—è `ORDER BY`
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ –∫–æ–º–∞ –≤ `oo.id_outfitÔºå`
- –ü—Ä–æ–ø—É—â–µ–Ω–∏–π `join` —É –ø—ñ–¥–∑–∞–ø–∏—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `JOIN`-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å)
- `tl.id _outfit` –º–∞—î –ø—Ä–æ–±—ñ–ª

---

## ‚úÖ –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç:

```sql
WITH team_data AS (
  SELECT 
    tt.id_outfit, 
    COUNT(tt.id) AS count_team
  FROM tw_wp_team_v tt
  JOIN tw.wp_outfit_v k ON tt.id_outfit = k.id_outfit
  WHERE (tt.data_end >= SYSDATE - INTERVAL '92' DAY OR tt.data_end IS NULL)
  GROUP BY tt.id_outfit
),
g_data AS (
  SELECT 
    k.id_outfit,
    NVL(team.count_team, 0) + DECODE(k.performer, NULL, 0, 1) AS team_count
  FROM tw.wp_outfit_v k
  LEFT JOIN team_data team ON team.id_outfit = k.id_outfit
),
outfit_open_status AS (
  SELECT 
    tl.id_outfit,
    COUNT(tl.id_status) AS outfit_open
  FROM tw_wp_status_v tl
  WHERE tl.data BETWEEN SYSDATE - INTERVAL '92' DAY AND SYSDATE - INTERVAL '90' DAY
    AND tl.id_status = 6
  GROUP BY tl.id_outfit
)

-- –ü–µ—Ä—à–∏–π –±–ª–æ–∫
SELECT 
  o.id_outfit,
  DECODE(o.id_org, NULL, 0, 1) AS org,
  o.org_txt,
  o.department,
  o.tseh_outfit_txt,
  g.team_count
FROM g_data g
LEFT JOIN outfit_open_status r ON r.id_outfit = g.id_outfit
LEFT JOIN tw.wp_outfit@to_asics10 o ON o.id_outfit = g.id_outfit
WHERE (
    (o.data_start <= SYSDATE - INTERVAL '90' DAY AND o.data_finish >= SYSDATE - INTERVAL '92' DAY)
    OR TRUNC(o.data_prolongation, 'dd') >= TRUNC(SYSDATE - INTERVAL '92' DAY, 'dd')
)
AND r.outfit_open IS NOT NULL

UNION

-- –î—Ä—É–≥–∏–π –±–ª–æ–∫
SELECT 
  oo.id_outfit,
  DECODE(oo.id_org, NULL, 0, 1) AS org,
  oo.org_txt,
  oo.department,
  oo.tseh_outfit_txt,
  rr.outfit_open,
  0 AS team_count
FROM outfit_open_status rr
LEFT JOIN tw.wp_outfit@to_asics10 oo ON oo.id_outfit = rr.id_outfit
WHERE (
    (oo.data_start <= SYSDATE - INTERVAL '90' DAY AND oo.data_finish >= SYSDATE - INTERVAL '92' DAY)
    OR TRUNC(oo.data_prolongation, 'dd') >= TRUNC(SYSDATE - INTERVAL '92' DAY, 'dd')
)
AND oo.team IS NULL
AND rr.outfit_open IS NOT NULL
```

---

## üß† –ö–ª—é—á–æ–≤—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è:

| –©–æ | –ü–æ—è—Å–Ω–µ–Ω–Ω—è |
|----|-----------|
| **CTE (WITH)** | –î–∞—î –∫—Ä–∞—â—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞ —á–∏—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—É. |
| **JOIN –∑–∞–º—ñ—Å—Ç—å WHERE x=y** | –ü–æ–∫—Ä–∞—â—É—î —á–∏—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å —ñ —á–∞—Å—Ç–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —à–≤–∏–¥—à–µ. |
| **–£—Å—É–Ω–µ–Ω–æ –¥—É–±–ª—é–≤–∞–Ω–Ω—è** | –ü—ñ–¥–∑–∞–ø–∏—Ç–∏ –¥–ª—è `outfit_open_status` —Ç–∞ `team_data` –æ–±‚Äô—î–¥–Ω–∞–Ω—ñ. |
| **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ñ—Å—Ç—å** | –ö–æ–∂–µ–Ω –ø—ñ–¥–∑–∞–ø–∏—Ç –≤–∏—Ä—ñ—à—É—î –æ–¥–Ω—É –∑–∞–¥–∞—á—É (SRP). |
| **–¢–∏–ø–∏ JOIN** | `LEFT JOIN` –∑–±–µ—Ä–µ–∂–µ–Ω–æ –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ `null`-–ø–µ—Ä–µ–≤—ñ—Ä–æ–∫. |

---

## üèÅ –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ—Ä–∞–¥–∏:

1. **–Ü–Ω–¥–µ–∫—Å–∏:** –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ —î —ñ–Ω–¥–µ–∫—Å–∏ –ø–æ:
   - `id_outfit`
   - `id_status`
   - `data`, `data_start`, `data_finish`, `data_prolongation`

2. **–ú–∞—Ç–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è (MV):** –Ø–∫—â–æ —Ü–µ–π –∑–∞–ø–∏—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —á–∞—Å—Ç–æ, MV –∑ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º —Ä–∞–∑ –Ω–∞ –¥–µ–Ω—å/–≥–æ–¥–∏–Ω—É –º–æ–∂–µ –∑–Ω–∞—á–Ω–æ –ø—Ä–∏—Å–∫–æ—Ä–∏—Ç–∏ APEX.

3. **–ü—Ä–æ—Ñ—ñ–ª—é–≤–∞–Ω–Ω—è:** –ó–∞–ø—É—Å—Ç—ñ—Ç—å `EXPLAIN PLAN` –∞–±–æ `SQL Monitor` —É SQL Developer –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.

4. **–ü–∞–≥—ñ–Ω–∞—Ü—ñ—è —É APEX:** –Ø–∫—â–æ —Ü–µ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π –∑–≤—ñ—Ç, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `Row Limiting` —É APEX, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –æ–±—Ä–æ–±–∫–∏ –≤–µ–ª–∏–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Ä—è–¥–∫—ñ–≤.

---

–•–æ—á–µ—à, —è –¥–æ–ø–æ–º–æ–∂—É –≤—Å—Ç–∞–≤–∏—Ç–∏ —Ü–µ–π –∑–∞–ø–∏—Ç —É APEX —è–∫ SQL-–∑–≤—ñ—Ç –∞–±–æ –¥–∏–Ω–∞–º—ñ—á–Ω—É –¥—ñ–ª—è–Ω–∫—É?