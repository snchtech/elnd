–û–∫–µ–π, –∑—Ä–æ–±–∏–º–æ —Ñ—É–Ω–∫—Ü—ñ—é, —è–∫–∞ –ø–æ–≤–µ—Ä—Ç–∞—î **–¥–≤—ñ –≤–µ–ª–∏—á–∏–Ω–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ** ‚Äî –∫—ñ–ª—å–∫—ñ—Å—Ç—å:

- **–±—Ä–∏–≥–∞–¥** (outfit‚Äô—ñ–≤),
- **–ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤** (sum team_count)

...–≤ –æ–¥–Ω–æ–º—É –≤–∏–∫–ª–∏–∫—É, **–¥–ª—è –∑–∞–¥–∞–Ω–æ–≥–æ —Ç–∏–ø—É –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó** (`1` ‚Äî —Ñ—ñ—Ä–º–∞, `0` ‚Äî –ø—ñ–¥—Ä—è–¥–Ω–∏–∫) —ñ –≤ **–¥—ñ–∞–ø–∞–∑–æ–Ω—ñ –¥–∞—Ç**.

---

## ‚úÖ –§—É–Ω–∫—Ü—ñ—è `get_outfit_stats_combo`

### üîÅ –ü–æ–≤–µ—Ä—Ç–∞—î `SYS.ODCIVARCHAR2LIST` (–º–∞—Å–∏–≤ —ñ–∑ –¥–≤–æ—Ö –∑–Ω–∞—á–µ–Ω—å: –±—Ä–∏–≥–∞–¥, –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤)

```sql
CREATE OR REPLACE FUNCTION get_outfit_stats_combo (
    p_date_start IN DATE,
    p_date_end   IN DATE DEFAULT NULL,
    p_org_type   IN NUMBER -- 1 = —Ñ—ñ—Ä–º–∞, 0 = –ø—ñ–¥—Ä—è–¥–Ω–∏–∫
) RETURN SYS.ODCIVARCHAR2LIST IS
    v_team_count     NUMBER := 0;
    v_worker_count   NUMBER := 0;
BEGIN
    SELECT
        COUNT(*),         -- –∫-—Å—Ç—å outfit'—ñ–≤ (—Ç–æ–±—Ç–æ –±—Ä–∏–≥–∞–¥)
        SUM(team_count)   -- –∫-—Å—Ç—å –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤
    INTO
        v_team_count,
        v_worker_count
    FROM (
        SELECT 
            o.id_outfit,
            DECODE(o.id_org, NULL, 0, 1) AS org,
            g.team_count
        FROM (
            SELECT 
                k.id_outfit,
                team.count_team + DECODE(k.performer, NULL, 0, 1) AS team_count
            FROM (
                SELECT 
                    tt.id_outfit, 
                    COUNT(tt.id) AS count_team 
                FROM tw_wp_team_v tt, tw.wp_outfit_v k
                WHERE tt.id_outfit = k.id_outfit
                  AND (tt.data_end >= p_date_start OR tt.data_end IS NULL)
                GROUP BY tt.id_outfit
            ) team,
            tw.wp_outfit_v k
            WHERE team.id_outfit = k.id_outfit
        ) g
        LEFT JOIN (
            SELECT
                tl.id_outfit,
                COUNT(id_status) AS outfit_open 
            FROM tw_wp_status_v tl
            WHERE tl.data >= p_date_start
              AND (p_date_end IS NULL OR tl.data <= p_date_end)
              AND tl.id_status = 6
            GROUP BY tl.id_outfit
        ) r ON r.id_outfit = g.id_outfit
        LEFT JOIN tw.wp_outfit@to_asics10 o ON o.id_outfit = g.id_outfit 
        WHERE (
            (o.data_start <= NVL(p_date_end, o.data_start) 
             AND o.data_finish >= p_date_start)
            OR TRUNC(o.data_prolongation, 'dd') >= TRUNC(p_date_start, 'dd')
        )
        AND r.outfit_open IS NOT NULL

        UNION ALL

        SELECT 
            oo.id_outfit,
            DECODE(oo.id_org, NULL, 0, 1) AS org,
            0 AS team_count
        FROM (
            SELECT
                tl.id_outfit,
                COUNT(id_status) AS outfit_open
            FROM tw_wp_status_v tl
            WHERE tl.data >= p_date_start
              AND (p_date_end IS NULL OR tl.data <= p_date_end)
              AND tl.id_status = 6
            GROUP BY tl.id_outfit
        ) rr
        LEFT JOIN tw.wp_outfit@to_asics10 oo ON oo.id_outfit = rr.id_outfit
        WHERE (
            (oo.data_start <= NVL(p_date_end, oo.data_start) 
             AND oo.data_finish >= p_date_start)
            OR TRUNC(oo.data_prolongation, 'dd') >= TRUNC(p_date_start, 'dd')
        )
        AND oo.team IS NULL
        AND rr.outfit_open IS NOT NULL
    )
    WHERE org = p_org_type;

    RETURN SYS.ODCIVARCHAR2LIST(
        TO_CHAR(NVL(v_team_count, 0)), 
        TO_CHAR(NVL(v_worker_count, 0))
    );
EXCEPTION
    WHEN OTHERS THEN
        RETURN SYS.ODCIVARCHAR2LIST('ERR', SQLERRM);
END;
/
```

---

## üß™ –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:

### 1. üìÜ –§—ñ—Ä–º–∞ ‚Äì –ø–æ—Ç–æ—á–Ω–∏–π –º–æ–º–µ–Ω—Ç —ñ –¥–∞–ª—ñ:
```sql
SELECT column_value
FROM TABLE(get_outfit_stats_combo(SYSDATE, NULL, 1));
```

### 2. ‚è∞ –ü—ñ–¥—Ä—è–¥–Ω–∏–∫ ‚Äì 12:00 –¥–æ 18:00:
```sql
SELECT column_value
FROM TABLE(get_outfit_stats_combo(TRUNC(SYSDATE) + 12/24, TRUNC(SYSDATE) + 18/24, 0));
```

### 3. üìÖ –§—ñ—Ä–º–∞ ‚Äì –≤–µ—Å—å –¥–µ–Ω—å:
```sql
SELECT column_value
FROM TABLE(get_outfit_stats_combo(TRUNC(SYSDATE), TRUNC(SYSDATE + 1) - INTERVAL '1' SECOND, 1));
```

---

## ‚úÖ –Ø–∫ –¥—ñ—Å—Ç–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –æ–∫—Ä–µ–º–æ —É PL/SQL:

```plsql
DECLARE
  v_stats SYS.ODCIVARCHAR2LIST;
BEGIN
  v_stats := get_outfit_stats_combo(SYSDATE, NULL, 1);
  DBMS_OUTPUT.PUT_LINE('–ë—Ä–∏–≥–∞–¥: ' || v_stats(1));
  DBMS_OUTPUT.PUT_LINE('–ü—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤: ' || v_stats(2));
END;
```

---

–•–æ—á–µ—à —Ç–∞–∫–∏–π —Å–∞–º–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç —É —Ñ–æ—Ä–º–∞—Ç—ñ **JSON** (`CLOB`)? –¶–µ –∑—Ä—É—á–Ω–æ –¥–ª—è REST/JavaScript.