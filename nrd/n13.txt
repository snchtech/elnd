–°—É–ø–µ—Ä! –û—Å—å **–ø–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è `get_all_outfit_stats_html`**, —è–∫–∞:

---

## ‚úÖ –©–æ —Ä–æ–±–∏—Ç—å:

- –í–∏–∑–Ω–∞—á–∞—î 3 –ø–µ—Ä—ñ–æ–¥–∏:
  1. **–ü–æ—Ç–æ—á–Ω–∏–π –º–æ–º–µ–Ω—Ç —ñ –¥–∞–ª—ñ**  
  2. **–ü–æ—Ç–æ—á–Ω–∞ –∑–º—ñ–Ω–∞ (06‚Äì14, 14‚Äì22, 22‚Äì06)**  
  3. **–°—å–æ–≥–æ–¥–Ω—ñ (00:00 ‚Äì SYSDATE)**
- –û–±—á–∏—Å–ª—é—î –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É:
  - –ö—ñ–ª—å–∫—ñ—Å—Ç—å –±—Ä–∏–≥–∞–¥ —Ç–∞ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤ **—Ñ—ñ—Ä–º–∏ (org = 1)**
  - –ö—ñ–ª—å–∫—ñ—Å—Ç—å –±—Ä–∏–≥–∞–¥ —Ç–∞ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤ **–ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤ (org = 0)**
- –í—Ä–∞—Ö–æ–≤—É—î —Ñ—ñ–ª—å—Ç—Ä–∏ `p_department`, `p_unit`
- –ü–æ–≤–µ—Ä—Ç–∞—î –∫—Ä–∞—Å–∏–≤–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π **HTML-–±–ª–æ–∫ –¥–ª—è APEX**

---

## ‚úÖ –§—É–Ω–∫—Ü—ñ—è `get_all_outfit_stats_html`

```sql
CREATE OR REPLACE FUNCTION get_all_outfit_stats_html (
    p_department IN VARCHAR2 DEFAULT NULL,
    p_unit       IN VARCHAR2 DEFAULT NULL
) RETURN CLOB IS
    v_html       CLOB := '';
    v_stats      SYS.ODCIVARCHAR2LIST;
    
    -- –ó–º—ñ–Ω–∞
    v_shift_start DATE;
    v_shift_end   DATE;
BEGIN
    ----------------------------------------------------------------
    -- –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ—ó –∑–º—ñ–Ω–∏
    ----------------------------------------------------------------
    IF TO_CHAR(SYSDATE, 'HH24:MI') BETWEEN '06:00' AND '13:59' THEN
        v_shift_start := TRUNC(SYSDATE) + 6/24;
        v_shift_end := TRUNC(SYSDATE) + 14/24;
    ELSIF TO_CHAR(SYSDATE, 'HH24:MI') BETWEEN '14:00' AND '21:59' THEN
        v_shift_start := TRUNC(SYSDATE) + 14/24;
        v_shift_end := TRUNC(SYSDATE) + 22/24;
    ELSE
        IF TO_CHAR(SYSDATE, 'HH24:MI') >= '22:00' THEN
            v_shift_start := TRUNC(SYSDATE) + 22/24;
            v_shift_end := TRUNC(SYSDATE + 1) + 6/24;
        ELSE
            v_shift_start := TRUNC(SYSDATE - 1) + 22/24;
            v_shift_end := TRUNC(SYSDATE) + 6/24;
        END IF;
    END IF;

    ----------------------------------------------------------------
    -- HTML: –ü–æ—Ç–æ—á–Ω–∏–π –º–æ–º–µ–Ω—Ç
    ----------------------------------------------------------------
    v_html := v_html || '<b>–ù–∞ –¥–∞–Ω–∏–π –º–æ–º–µ–Ω—Ç:</b><br>';
    v_stats := get_outfit_stats_combo(SYSDATE, NULL, 1, p_department, p_unit);
    v_html := v_html || '–±—Ä–∏–≥–∞–¥ —Ñ—ñ—Ä–º–∏ - <span class="vl_sld">' || v_stats(1) || 
              '</span>, –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤ - <span class="vl_sld">' || v_stats(2) || '</span><br>';
    v_stats := get_outfit_stats_combo(SYSDATE, NULL, 0, p_department, p_unit);
    v_html := v_html || '–±—Ä–∏–≥–∞–¥ –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤ - <span class="vl_sld">' || v_stats(1) || 
              '</span>, –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤ - <span class="vl_sld">' || v_stats(2) || '</span><br><br>';

    ----------------------------------------------------------------
    -- HTML: –ü–æ—Ç–æ—á–Ω–∞ –∑–º—ñ–Ω–∞
    ----------------------------------------------------------------
    v_html := v_html || '<b>–ó–∞ –∑–º—ñ–Ω—É (' || TO_CHAR(v_shift_start, 'HH24:MI') || ' ‚Äì ' || TO_CHAR(v_shift_end, 'HH24:MI') || '):</b><br>';
    v_stats := get_outfit_stats_combo(v_shift_start, v_shift_end, 1, p_department, p_unit);
    v_html := v_html || '–±—Ä–∏–≥–∞–¥ —Ñ—ñ—Ä–º–∏ - <span class="vl_sld">' || v_stats(1) || 
              '</span>, –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤ - <span class="vl_sld">' || v_stats(2) || '</span><br>';
    v_stats := get_outfit_stats_combo(v_shift_start, v_shift_end, 0, p_department, p_unit);
    v_html := v_html || '–±—Ä–∏–≥–∞–¥ –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤ - <span class="vl_sld">' || v_stats(1) || 
              '</span>, –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤ - <span class="vl_sld">' || v_stats(2) || '</span><br><br>';

    ----------------------------------------------------------------
    -- HTML: –ó–∞ —Å—å–æ–≥–æ–¥–Ω—ñ
    ----------------------------------------------------------------
    v_html := v_html || '<b>–ó–∞ —Å—å–æ–≥–æ–¥–Ω—ñ:</b><br>';
    v_stats := get_outfit_stats_combo(TRUNC(SYSDATE), SYSDATE, 1, p_department, p_unit);
    v_html := v_html || '–±—Ä–∏–≥–∞–¥ —Ñ—ñ—Ä–º–∏ - <span class="vl_sld">' || v_stats(1) || 
              '</span>, –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤ - <span class="vl_sld">' || v_stats(2) || '</span><br>';
    v_stats := get_outfit_stats_combo(TRUNC(SYSDATE), SYSDATE, 0, p_department, p_unit);
    v_html := v_html || '–±—Ä–∏–≥–∞–¥ –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤ - <span class="vl_sld">' || v_stats(1) || 
              '</span>, –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤ - <span class="vl_sld">' || v_stats(2) || '</span><br>';

    RETURN v_html;
EXCEPTION
    WHEN OTHERS THEN
        RETURN '–ü–æ–º–∏–ª–∫–∞: ' || SQLERRM;
END;
/
```

---

## üìå –î–ª—è —Ü—å–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–Ω–æ–≤–∏—Ç–∏ —ñ `get_outfit_stats_combo`

### –î–æ–¥–∞–π `p_department`, `p_unit`:

```sql
CREATE OR REPLACE FUNCTION get_outfit_stats_combo (
    p_date_start IN DATE,
    p_date_end   IN DATE DEFAULT NULL,
    p_org_type   IN NUMBER,
    p_department IN VARCHAR2 DEFAULT NULL,
    p_unit       IN VARCHAR2 DEFAULT NULL
) RETURN SYS.ODCIVARCHAR2LIST IS
-- ...
    -- –í—Å–µ—Ä–µ–¥–∏–Ω—ñ –∑–∞–ø–∏—Ç—É –≤ WHERE:
    AND (:p_department IS NULL OR o.department = :p_department)
    AND (:p_unit IS NULL OR o.unit = :p_unit)
-- ...
```

---

## üß© –Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤ APEX

### 1. **Dynamic Content Region** (PL/SQL Function returning CLOB)

```plsql
BEGIN
  RETURN get_all_outfit_stats_html(:P1_DEPARTMENT, :P1_UNIT);
END;
```

---

### 2. **Select List Items**:
- `P1_DEPARTMENT`:
```sql
SELECT DISTINCT department d, department r FROM tw.wp_outfit@to_asics10 ORDER BY 1
```

- `P1_UNIT` (–∑–∞–ª–µ–∂–Ω–∏–π):
```sql
SELECT DISTINCT unit d, unit r 
FROM tw.wp_outfit@to_asics10 
WHERE (:P1_DEPARTMENT IS NULL OR department = :P1_DEPARTMENT)
ORDER BY 1
```

---

### 3. **–ö–Ω–æ–ø–∫–∞ "–°–∫–∏–Ω—É—Ç–∏":**
- **Dynamic Action:** Set Value = NULL –¥–ª—è `P1_DEPARTMENT`, `P1_UNIT`, –ø–æ—Ç—ñ–º `Refresh` —Ä–µ–≥—ñ–æ–Ω—É.

---

–ì–æ—Ç–æ–≤–æ üî•! –•–æ—á–µ—à, —è –∑—Ä–æ–±–ª—é –ø—Ä–∏–∫–ª–∞–¥ UI-–º–∞–∫–µ—Ç—É –∞–±–æ —à–∞–±–ª–æ–Ω —Ä–µ–≥—ñ–æ–Ω—ñ–≤ —É —Å—Ç–∏–ª—ñ APEX (—ñ–∑ –∫–Ω–æ–ø–∫–∞–º–∏, –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ —Ç–æ—â–æ)?