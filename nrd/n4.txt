–û—Å—å –ø–æ–≤–Ω—ñ—Å—Ç—é **–æ–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è —Ñ—É–Ω–∫—Ü—ñ—ó `get_team_summary_html`**, —è–∫–∞:

- –ø—Ä–∏–π–º–∞—î `p_date_start` (–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ) —ñ `p_date_end` (–æ–ø—Ü—ñ–π–Ω–æ ‚Äî —è–∫—â–æ `NULL`, –¥–∞–Ω—ñ –±–µ—Ä—É—Ç—å—Å—è "–≤—ñ–¥ —ñ –¥–∞–ª—ñ");
- –ø–æ–≤–µ—Ä—Ç–∞—î HTML-—Ä—è–¥–æ–∫ —ñ–∑ –±—Ä–∏–≥–∞–¥–∞–º–∏ —Ç–∞ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∞–º–∏ —Ñ—ñ—Ä–º–∏ –π –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤;
- –∞–¥–∞–ø—Ç–æ–≤–∞–Ω–∞ –¥–æ —Ä–æ–±–æ—Ç–∏ –≤ Oracle APEX, PL/SQL, –∞–±–æ SQL-–∑–∞–ø–∏—Ç—ñ.

---

## ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ–¥ —Ñ—É–Ω–∫—Ü—ñ—ó:

```sql
CREATE OR REPLACE FUNCTION get_team_summary_html (
    p_date_start IN DATE,
    p_date_end   IN DATE DEFAULT NULL
) RETURN CLOB IS
    v_html                 CLOB;
    v_firm_teams           NUMBER := 0;
    v_firm_workers         NUMBER := 0;
    v_contractor_teams     NUMBER := 0;
    v_contractor_workers   NUMBER := 0;
BEGIN
    WITH team_data AS (
        SELECT 
            tt.id_outfit, 
            COUNT(tt.id) AS count_team
        FROM tw_wp_team_v tt
        JOIN tw.wp_outfit_v k ON tt.id_outfit = k.id_outfit
        WHERE (tt.data_end >= p_date_start OR tt.data_end IS NULL)
        GROUP BY tt.id_outfit
    ),
    g_data AS (
        SELECT 
            k.id_outfit,
            NVL(team.count_team, 0) + DECODE(k.performer, NULL, 0, 1) AS team_count
        FROM tw.wp_outfit_v k
        LEFT JOIN team_data team ON team.id_outfit = k.id_outfit
    ),
    outfit_open_status AS (
        SELECT 
            tl.id_outfit,
            COUNT(tl.id_status) AS outfit_open
        FROM tw_wp_status_v tl
        WHERE tl.data >= p_date_start
          AND (p_date_end IS NULL OR tl.data <= p_date_end)
          AND tl.id_status = 6
        GROUP BY tl.id_outfit
    ),
    full_data AS (
        SELECT 
            o.id_outfit,
            DECODE(o.id_org, NULL, 0, 1) AS org,
            g.team_count
        FROM g_data g
        LEFT JOIN outfit_open_status r ON r.id_outfit = g.id_outfit
        LEFT JOIN tw.wp_outfit@to_asics10 o ON o.id_outfit = g.id_outfit
        WHERE (
            (
              o.data_start <= NVL(p_date_end, o.data_start) AND 
              o.data_finish >= p_date_start
            )
            OR TRUNC(o.data_prolongation, 'dd') >= TRUNC(p_date_start, 'dd')
        )
        AND r.outfit_open IS NOT NULL

        UNION ALL

        SELECT 
            oo.id_outfit,
            DECODE(oo.id_org, NULL, 0, 1) AS org,
            0 AS team_count
        FROM outfit_open_status rr
        LEFT JOIN tw.wp_outfit@to_asics10 oo ON oo.id_outfit = rr.id_outfit
        WHERE (
            (
              oo.data_start <= NVL(p_date_end, oo.data_start) AND 
              oo.data_finish >= p_date_start
            )
            OR TRUNC(oo.data_prolongation, 'dd') >= TRUNC(p_date_start, 'dd')
        )
        AND oo.team IS NULL
        AND rr.outfit_open IS NOT NULL
    )
    SELECT
        SUM(CASE WHEN org = 1 THEN 1 ELSE 0 END),
        SUM(CASE WHEN org = 1 THEN team_count ELSE 0 END),
        SUM(CASE WHEN org = 0 THEN 1 ELSE 0 END),
        SUM(CASE WHEN org = 0 THEN team_count ELSE 0 END)
    INTO
        v_firm_teams, v_firm_workers, v_contractor_teams, v_contractor_workers
    FROM full_data;

    -- –§–æ—Ä–º—É–≤–∞–Ω–Ω—è HTML-—Ä—è–¥–∫–∞
    v_html := 
        '–±—Ä–∏–≥–∞–¥ —Ñ—ñ—Ä–º–∏ - <span class="vl_sld">' || v_firm_teams || '</span>, –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤ - <span class="vl_sld">' || v_firm_workers || '</span><br>' ||
        '–±—Ä–∏–≥–∞–¥ –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤ - <span class="vl_sld">' || v_contractor_teams || '</span>, –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤ - <span class="vl_sld">' || v_contractor_workers || '</span>';

    RETURN v_html;
EXCEPTION
    WHEN OTHERS THEN
        RETURN '–ü–æ–º–∏–ª–∫–∞: ' || SQLERRM;
END;
/
```

---

## üß™ –°—Ü–µ–Ω–∞—Ä—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:

### üîπ 1. –í—ñ–¥ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç—É —ñ –¥–∞–ª—ñ:
```sql
SELECT get_team_summary_html(SYSDATE, NULL) FROM DUAL;
```

### üîπ 2. –í—ñ–¥ 12:00 –¥–æ 18:00 —Å—å–æ–≥–æ–¥–Ω—ñ:
```sql
SELECT get_team_summary_html(TRUNC(SYSDATE) + 12/24, TRUNC(SYSDATE) + 18/24) FROM DUAL;
```

### üîπ 3. –ü–æ–≤–Ω–∏–π –¥–µ–Ω—å:
```sql
SELECT get_team_summary_html(TRUNC(SYSDATE), TRUNC(SYSDATE + 1) - INTERVAL '1' SECOND) FROM DUAL;
```

---

## üìå –ü—Ä–∏–º—ñ—Ç–∫–∞:
–ú–æ–∂–µ—à —Ü—é —Ñ—É–Ω–∫—Ü—ñ—é –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —É:
- **APEX Dynamic Content** (—Ç–∏–ø: `PL/SQL Function returning CLOB`);
- **APEX SQL Report** —á–µ—Ä–µ–∑ `SELECT get_team_summary_html(...) FROM DUAL`;
- **JavaScript** (—è–∫—â–æ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏–º–µ—à JSON ‚Äî –º–æ–∂—É —Ç–µ–∂ –¥–æ–ø–æ–º–æ–≥—Ç–∏).

üîπ –•–æ—á–µ—à –¥–æ–¥–∞—Ç–∫–æ–≤–æ –∑—Ä–æ–±–∏—Ç–∏ –≤–µ—Ä—Å—ñ—é —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫–∞ –ø–æ–≤–µ—Ä—Ç–∞—î JSON (`CLOB`) –∑–∞–º—ñ—Å—Ç—å HTML ‚Äî –¥–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó —É JS/REST?