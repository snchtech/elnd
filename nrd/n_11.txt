–ß—É–¥–æ–≤–æ, –¥–∞–≤–∞–π —Ä–µ–∞–ª—ñ–∑—É—î–º–æ —Ü–µ –∑–∞ **–≤–∞—Ä—ñ–∞–Ω—Ç–æ–º 3**: —Ç–∏ –ø–µ—Ä–µ–¥–∞—î—à –ª–∏—à–µ **—Ä–µ–∂–∏–º —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó** (`:P10_MODE` –∞–±–æ —â–æ—Å—å –ø–æ–¥—ñ–±–Ω–µ), –∞ —É —Ñ–æ–Ω—ñ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è **—Ñ—É–Ω–∫—Ü—ñ—è**, —è–∫–∞ –ø–æ–≤–µ—Ä—Ç–∞—î `record_id`s —É –≤–∏–≥–ª—è–¥—ñ —Ä—è–¥–∫–∞ —á–µ—Ä–µ–∑ –∫–æ–º—É (`VARCHAR2`), —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ –∑–∞–ø–∏—Ç—ñ `WHERE id IN (...)`.

---

## üß† –¶—ñ–ª—å:
–ù–∞–ø–∏—Å–∞—Ç–∏ PL/SQL-—Ñ—É–Ω–∫—Ü—ñ—é, —è–∫–∞ –ø–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ `ID` —á–µ—Ä–µ–∑ –∫–æ–º—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ç—É —Å–∞–º—É –ª–æ–≥—ñ–∫—É:

- `creator_by` –∑ –ø–µ–≤–Ω–æ–≥–æ view
- `SIGNATURERIGHTS.department_id`
- `SIGNATUREHISTORY.signer_by`

---

## ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó: `get_related_record_ids`

```sql
CREATE OR REPLACE FUNCTION get_related_record_ids (
    p_user_id        NUMBER,
    p_filter_dept_id NUMBER
) RETURN VARCHAR2 IS
    l_ids    VARCHAR2(32767);
BEGIN
    SELECT LISTAGG(s.page_list_id, ',') WITHIN GROUP (ORDER BY s.page_list_id)
      INTO l_ids
      FROM source s
     WHERE 
           s.creator_by IN (
               SELECT u.user_id 
               FROM my_user_filter_view u 
               WHERE u.user_id = p_user_id
           )
        OR EXISTS (
            SELECT 1
            FROM signaturerights r
            WHERE r.source_id = s.id
              AND r.department_id = p_filter_dept_id
        )
        OR EXISTS (
            SELECT 1
            FROM signaturehistory h
            JOIN signaturerights r ON r.id = h.signright_id
            WHERE r.source_id = s.id
              AND h.signer_by = p_user_id
        );

    RETURN l_ids;
    
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN NULL;
END;
```

---

## üß™ –Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —É SQL-–∑–∞–ø–∏—Ç—ñ IR (Interactive Report)

–ù–∞ —Å—Ç–æ—Ä–æ–Ω—ñ –∑–≤—ñ—Ç—É, —É SQL:

```sql
SELECT *
FROM your_main_table
WHERE instr(',' || get_related_record_ids(:G_USER_ID, :G_DEPT_ID) || ',', ',' || id || ',') > 0
```

üî∏ –∞–±–æ, —è–∫—â–æ —É —Ç–µ–±–µ –≤–∂–µ –¥–æ—Å—Ç—É–ø–Ω–∞ `apex_string.split` (–ø–æ—á–∏–Ω–∞—é—á–∏ –∑ APEX 19.x):

```sql
SELECT *
FROM your_main_table
WHERE id IN (
    SELECT TO_NUMBER(TRIM(COLUMN_VALUE))
    FROM TABLE(apex_string.split(get_related_record_ids(:G_USER_ID, :G_DEPT_ID), ','))
)
```

---

## üß© –ü–æ—è—Å–Ω–µ–Ω–Ω—è:
| –ß–∞—Å—Ç–∏–Ω–∞ | –ü–æ—è—Å–Ω–µ–Ω–Ω—è |
|--------|-----------|
| `p_user_id` | ID –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–º–æ–∂–µ –±—É—Ç–∏ `:APP_USER_ID`, `:G_USER_ID` —Ç–æ—â–æ) |
| `p_filter_dept_id` | department, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó |
| `LISTAGG(..., ',')` | –°–∫–ª–µ—é—î –≤—Å—ñ `page_list_id` —á–µ—Ä–µ–∑ –∫–æ–º—É |
| `INSTR(... , id , ...)` | –ü—Ä–æ—Å—Ç–∏–π —Å–ø–æ—Å—ñ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –≤—Ö–æ–¥–∏—Ç—å `id` –¥–æ —Å–ø–∏—Å–∫—É |
| `apex_string.split` | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞, —â–æ –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ —Ä—è–¥–æ–∫ —É —Å–ø–∏—Å–æ–∫ |

---

## ‚ö†Ô∏è –ó–∞—É–≤–∞–∂–µ–Ω–Ω—è:
- –Ø–∫—â–æ `LISTAGG` –ø–µ—Ä–µ–≤–∏—â–∏—Ç—å 32k —Å–∏–º–≤–æ–ª—ñ–≤ ‚Äî –±—É–¥–µ –ø–æ–º–∏–ª–∫–∞. –£ —Ü—å–æ–º—É —Ä–∞–∑—ñ –∫—Ä–∞—â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `APEX_COLLECTION` –∞–±–æ `GTT`.
- –£ `IR` —Ç–∞–∫–æ–∂ –æ–±–º–µ–∂ —á–∞—Å—Ç–∏–Ω—É, —â–æ–± –Ω–µ –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ UI: `ROWNUM < 500`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥.

---

–•–æ—á–µ—à ‚Äî –º–æ–∂—É –æ–¥—Ä–∞–∑—É –∞–¥–∞–ø—Ç—É–≤–∞—Ç–∏ –¥–æ —Ç–≤–æ–≥–æ APEX Application, —è–∫—â–æ –¥–∞—Å–∏:
- —Ç–æ—á–Ω—É –Ω–∞–∑–≤—É —Ç–∞–±–ª–∏—Ü—ñ/–ø–æ–ª—è ID
- —è–∫ –Ω–∞–∑–∏–≤–∞—é—Ç—å—Å—è —Ç–≤–æ—ó page items (`:G_USER_ID`, `:P10_MODE` —Ç–æ—â–æ)

–•–æ—á–µ—à —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ü–µ –¥–∏–Ω–∞–º—ñ—á–Ω–æ ‚Äî –º–æ–∂—É –ø–æ–∫–∞–∑–∞—Ç–∏, —è–∫ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `get_related_record_ids` **–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ä–µ–∂–∏–º—É**, –∞ –Ω–µ –∑–∞–≤–∂–¥–∏.