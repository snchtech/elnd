Ð”ÑÐºÑƒÑŽ Ð·Ð° ÑƒÑ‚Ð¾Ñ‡Ð½ÐµÐ½Ð½Ñ! Ð¯ÐºÑ‰Ð¾ Ñ‚Ð¸ Ñ…Ð¾Ñ‡ÐµÑˆ **Ñ€Ð¾Ð·Ð´Ñ–Ð»Ð¸Ñ‚Ð¸ Ð·Ð²Ñ–Ñ‚Ð¸ Ð½Ð° Ð´Ð²Ð° Ð½ÐµÐ·Ð°Ð»ÐµÐ¶Ð½Ñ–**, Ð°Ð»Ðµ Ð»Ð¾Ð³Ñ–Ñ‡Ð½Ð¾ Ð¿Ð¾Ð²â€™ÑÐ·Ð°Ð½Ñ– **Ð¾ÐºÑ€ÐµÐ¼Ñ– Ð·Ð²Ñ–Ñ‚Ð¸** Ð½Ð° ÑÑ‚Ð¾Ñ€Ñ–Ð½Ñ†Ñ– (Ð±ÐµÐ· Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ master-detail Ð¼ÐµÑ…Ð°Ð½Ñ–Ð·Ð¼Ñƒ APEX), Ð¾ÑÑŒ ÑÐº Ñ†Ðµ Ð·Ñ€Ð¾Ð±Ð¸Ñ‚Ð¸:

---

## ðŸ§© Ð¦Ñ–Ð»ÑŒ

1. **ÐŸÐµÑ€ÑˆÐ¸Ð¹ Ð·Ð²Ñ–Ñ‚** â€” Ð¾ÑÐ½Ð¾Ð²Ð½Ð° Ð°Ð³Ñ€ÐµÐ³Ð¾Ð²Ð°Ð½Ð° Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ Ð¿Ð¾ `department` (Ð±ÐµÐ· Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹).
2. **Ð”Ñ€ÑƒÐ³Ð¸Ð¹ Ð·Ð²Ñ–Ñ‚** â€” ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿Ð¾ `performer_department_id`, Ð´Ðµ `performer_id` Ð¿Ñ€Ð¸ÑÑƒÑ‚Ð½Ñ–Ð¹.
3. ÐžÐ±Ð¸Ð´Ð²Ð° Ð·Ð²Ñ–Ñ‚Ð¸ Ð¾Ð½Ð¾Ð²Ð»ÑŽÑŽÑ‚ÑŒÑÑ **Ð¾Ð´Ð½Ð¾Ñ‡Ð°ÑÐ½Ð¾**, Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´, Ð¿Ñ–ÑÐ»Ñ Ð²Ð¸Ð±Ð¾Ñ€Ñƒ Ñ‡ÐµÐºÐ±Ð¾ÐºÑÑ–Ð² `P_DEPARTMENTS`, Ð°Ð±Ð¾ Ð·Ð° Ñ‡Ð°ÑÐ¾Ð²Ð¸Ð¼ Ð´Ñ–Ð°Ð¿Ð°Ð·Ð¾Ð½Ð¾Ð¼ Ñ‚Ð¾Ñ‰Ð¾.
4. ÐÐµÐ¼Ð°Ñ” Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð¿Ð¾ ÐºÐ»Ñ–ÐºÐ°Ñ….

---

## ðŸ›  ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´ Ñ€ÐµÐ°Ð»Ñ–Ð·Ð°Ñ†Ñ–Ñ—

### ðŸ”¹ APEX Page Items:

| Item            | ÐŸÑ€Ð¸Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ                     |
| --------------- | ------------------------------- |
| `P_DEPARTMENTS` | Checkbox Group Ð· Ð´ÐµÐ¿Ð°Ñ€Ñ‚Ð°Ð¼ÐµÐ½Ñ‚Ð°Ð¼Ð¸ |
| `P_DATE_START`  | Ð”Ð°Ñ‚Ð° Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ                    |
| `P_DATE_END`    | Ð”Ð°Ñ‚Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð½Ñ                 |

---

### ðŸ”¹ Ð—Ð²Ñ–Ñ‚ 1: Ð—Ð°Ð³Ð°Ð»ÑŒÐ½Ð¸Ð¹ (department-level)

```sql
SELECT
  department,
  SUM(total_people) AS total_people,
  SUM(total_brigades) AS total_brigades
FROM v_outfit_pivot_base
WHERE 1=1
  AND (
    :P_DEPARTMENTS IS NULL 
    OR department IN (SELECT column_value FROM TABLE(split_string(:P_DEPARTMENTS, ':')))
  )
  AND (
    (:P_DATE_START IS NULL OR status_start_date >= :P_DATE_START) AND
    (:P_DATE_END IS NULL OR status_start_date <= :P_DATE_END)
  )
GROUP BY department
ORDER BY department
```

---

### ðŸ”¹ Ð—Ð²Ñ–Ñ‚ 2: Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð¸Ð¹ (performer\_department\_id-level)

```sql
SELECT
  d.depart_short_name AS performer_department_name,
  v.department AS source_department,
  v.unit,
  SUM(v.total_people) AS total_people,
  SUM(v.total_brigades) AS total_brigades
FROM v_outfit_pivot_base v
JOIN users u ON u.id = v.performer_id
JOIN departments d ON d.id = u.performer_department_id
WHERE 1=1
  AND (
    :P_DEPARTMENTS IS NULL 
    OR v.department IN (SELECT column_value FROM TABLE(split_string(:P_DEPARTMENTS, ':')))
  )
  AND (
    (:P_DATE_START IS NULL OR v.status_start_date >= :P_DATE_START) AND
    (:P_DATE_END IS NULL OR v.status_start_date <= :P_DATE_END)
  )
GROUP BY d.depart_short_name, v.department, v.unit
ORDER BY d.depart_short_name, v.unit
```

---

## ðŸ” Dynamic Action: Â«Ð—Ð¼Ñ–Ð½ÐµÐ½Ð¾ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½ÑÂ»

1. ÐŸÐ¾Ð´Ñ–Ñ: `Change`
2. Items: `P_DEPARTMENTS`, `P_DATE_START`, `P_DATE_END`
3. True Actions:

   * **Refresh** â†’ `Report 1`
   * **Refresh** â†’ `Report 2`

---

## ðŸ§¾ ÐÐ»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð°

Ð¯ÐºÑ‰Ð¾ Ñ‚Ð¸ Ñ…Ð¾Ñ‡ÐµÑˆ Ð² Ð¾Ð´Ð½Ð¾Ð¼Ñƒ SQL Ð·Ñ–Ð±Ñ€Ð°Ñ‚Ð¸ Ð²ÑÐµ Ñ€Ð°Ð·Ð¾Ð¼ (Ð· Ð¿Ñ€Ð°Ð¿Ð¾Ñ€Ñ†ÐµÐ¼ `IS_PERFORMER = 1`), Ð¼Ð¾Ð¶Ñƒ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ `UNION ALL` Ð¿Ñ–Ð´Ñ…Ñ–Ð´. ÐÐ»Ðµ Ð² Ñ‚Ð²Ð¾Ñ”Ð¼Ñƒ Ð²Ð¸Ð¿Ð°Ð´ÐºÑƒ **Ñ€Ð¾Ð·Ð±Ð¸Ñ‚Ñ‚Ñ Ð½Ð° Ð´Ð²Ð° Ð¾ÐºÑ€ÐµÐ¼Ñ– Ð·Ð²Ñ–Ñ‚Ð¸ â€” ÐµÑ„ÐµÐºÑ‚Ð¸Ð²Ð½Ñ–ÑˆÐµ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ñ–**.

---

Ð‘Ð°Ð¶Ð°Ñ”Ñˆ, Ñ‰Ð¾Ð± Ñ ÑÑ„Ð¾Ñ€Ð¼ÑƒÐ²Ð°Ð² Ð¿Ð¾Ð²Ð½Ñƒ APEX-ÑÑ‚Ð¾Ñ€Ñ–Ð½ÐºÑƒ Ð· Ñ†Ð¸Ð¼Ð¸ Ð´Ð²Ð¾Ð¼Ð° Ð·Ð²Ñ–Ñ‚Ð°Ð¼Ð¸ Ð´Ð»Ñ Ñ–Ð¼Ð¿Ð¾Ñ€Ñ‚Ñƒ?
