–î—è–∫—É—é –∑–∞ —Ñ–æ—Ç–æ —Ç–∞ –ø–æ–≤–Ω–∏–π –æ–ø–∏—Å üôå –¢–∏ —Ö–æ—á–µ—à —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ **–º–∞—Ç—Ä–∏—á–Ω–∏–π –∑–≤—ñ—Ç** —É –≤–∏–≥–ª—è–¥—ñ:

| –ß–∞—Å–æ–≤–∏–π –ø–µ—Ä—ñ–æ–¥      | –¢–∏–ø –¥–∞–Ω–∏—Ö           | Unit 1 | Unit 2 | Unit 3 | –í—Å—å–æ–≥–æ |
|---------------------|---------------------|--------|--------|--------|--------|
| –ó–∞—Ä–∞–∑               | –ë—Ä–∏–≥–∞–¥ —Ñ—ñ—Ä–º–∏        | ...    | ...    | ...    | ...    |
|                     | –ë—Ä–∏–≥–∞–¥ –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤  | ...    | ...    | ...    | ...    |
|                     | –õ—é–¥–µ–π —Ñ—ñ—Ä–º–∏         | ...    | ...    | ...    | ...    |
|                     | –õ—é–¥–µ–π –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤   | ...    | ...    | ...    | ...    |
| –ó –ø–æ—á–∞—Ç–∫—É –¥–æ–±–∏      | ...                 |        |        |        |        |
| –ó –ø–æ—á–∞—Ç–∫—É –∑–º—ñ–Ω–∏     | ...                 |        |        |        |        |

‚úÖ –£—Å–µ —Ü–µ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ç–≤–æ—î—ó `VIEW` —ñ –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó.

---

## üîß –©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—Ä–æ–±–∏—Ç–∏:

### ‚úÖ 1. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é `get_unit_matrix_data(p_start, p_end)`

–í–æ–Ω–∞ –º–∞—î –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ **–º–∞—Ç—Ä–∏—Ü—é —É —Ñ–æ—Ä–º–∞—Ç—ñ:**
```sql
SELECT 
  time_period, 
  data_type,        -- '–ë—Ä–∏–≥–∞–¥ —Ñ—ñ—Ä–º–∏', '–õ—é–¥–µ–π –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤', —Ç–æ—â–æ
  unit,
  value
FROM ...
```

### ‚úÖ 2. –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ `Pivot SQL` —É APEX –∑–≤—ñ—Ç—ñ (–∞–±–æ PL/SQL HTML Table, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω –≥–Ω—É—á–∫–∏–π –≤–∏–≥–ª—è–¥)

---

## üß† –û—Å–Ω–æ–≤–Ω–∞ —ñ–¥–µ—è:

### 1. –¢–∏ –º–∞—î—à –¥–∞–Ω—ñ —É –≤–∏–≥–ª—è–¥—ñ:
```sql
SELECT unit, org, team_count, COUNT(*) as outfit_count
FROM your_view
WHERE data_start BETWEEN :p_start AND :p_end
GROUP BY unit, org;
```

–î–∞–ª—ñ –±—É–¥—É—î—à:

- **`org = 1`** ‚Üí —Ñ—ñ—Ä–º–∞
- **`org = 0`** ‚Üí –ø—ñ–¥—Ä—è–¥–Ω–∏–∫–∏

---

## ‚úÖ –ü—Ä–∏–∫–ª–∞–¥ —Ñ—É–Ω–∫—Ü—ñ—ó `get_unit_matrix_html(p_start, p_end, label)`

```sql
CREATE OR REPLACE FUNCTION get_unit_matrix_html (
  p_start IN DATE,
  p_end   IN DATE,
  p_label IN VARCHAR2
) RETURN CLOB IS
  v_html      CLOB := '';
  v_row       CLOB;
  v_unit1     NUMBER := 0;
  v_unit2     NUMBER := 0;
  v_unit3     NUMBER := 0;
  v_total     NUMBER := 0;
BEGIN
  -- –ë—Ä–∏–≥–∞–¥ —Ñ—ñ—Ä–º–∏
  SELECT 
    SUM(CASE WHEN unit = 0 THEN 1 ELSE 0 END),
    SUM(CASE WHEN unit = 1 THEN 1 ELSE 0 END),
    SUM(CASE WHEN unit = 2 THEN 1 ELSE 0 END),
    COUNT(*)
  INTO v_unit1, v_unit2, v_unit3, v_total
  FROM your_view
  WHERE org = 1 AND data_start BETWEEN p_start AND p_end;

  v_html := v_html || '<tr><td rowspan="4">' || p_label || '</td><td>–ë—Ä–∏–≥–∞–¥ —Ñ—ñ—Ä–º–∏</td><td>' || v_unit1 || '</td><td>' || v_unit2 || '</td><td>' || v_unit3 || '</td><td>' || v_total || '</td></tr>';

  -- –ë—Ä–∏–≥–∞–¥ –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤
  SELECT 
    SUM(CASE WHEN unit = 0 THEN 1 ELSE 0 END),
    SUM(CASE WHEN unit = 1 THEN 1 ELSE 0 END),
    SUM(CASE WHEN unit = 2 THEN 1 ELSE 0 END),
    COUNT(*)
  INTO v_unit1, v_unit2, v_unit3, v_total
  FROM your_view
  WHERE org = 0 AND data_start BETWEEN p_start AND p_end;

  v_html := v_html || '<tr><td>–ë—Ä–∏–≥–∞–¥ –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤</td><td>' || v_unit1 || '</td><td>' || v_unit2 || '</td><td>' || v_unit3 || '</td><td>' || v_total || '</td></tr>';

  -- –õ—é–¥–µ–π —Ñ—ñ—Ä–º–∏
  SELECT 
    SUM(CASE WHEN unit = 0 THEN team_count ELSE 0 END),
    SUM(CASE WHEN unit = 1 THEN team_count ELSE 0 END),
    SUM(CASE WHEN unit = 2 THEN team_count ELSE 0 END),
    SUM(team_count)
  INTO v_unit1, v_unit2, v_unit3, v_total
  FROM your_view
  WHERE org = 1 AND data_start BETWEEN p_start AND p_end;

  v_html := v_html || '<tr><td>–õ—é–¥–µ–π —Ñ—ñ—Ä–º–∏</td><td>' || v_unit1 || '</td><td>' || v_unit2 || '</td><td>' || v_unit3 || '</td><td>' || v_total || '</td></tr>';

  -- –õ—é–¥–µ–π –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤
  SELECT 
    SUM(CASE WHEN unit = 0 THEN team_count ELSE 0 END),
    SUM(CASE WHEN unit = 1 THEN team_count ELSE 0 END),
    SUM(CASE WHEN unit = 2 THEN team_count ELSE 0 END),
    SUM(team_count)
  INTO v_unit1, v_unit2, v_unit3, v_total
  FROM your_view
  WHERE org = 0 AND data_start BETWEEN p_start AND p_end;

  v_html := v_html || '<tr><td>–õ—é–¥–µ–π –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤</td><td>' || v_unit1 || '</td><td>' || v_unit2 || '</td><td>' || v_unit3 || '</td><td>' || v_total || '</td></tr>';

  RETURN v_html;
END;
/
```

---

## ‚úÖ –ü–æ—Ç—ñ–º –Ω–∞ APEX-—Å—Ç–æ—Ä—ñ–Ω—Ü—ñ:

### –°—Ç–≤–æ—Ä—é—î—à `Dynamic Content Region` –∑ –∫–æ–¥–æ–º:
```plsql
DECLARE
  v_html CLOB;
BEGIN
  v_html := '<table border="1" cellpadding="5" cellspacing="0">';
  v_html := v_html || '<tr><th>–ß–∞—Å</th><th>–¢–∏–ø</th><th>Unit 1</th><th>Unit 2</th><th>Unit 3</th><th>–í—Å—å–æ–≥–æ</th></tr>';

  -- –ó–∞—Ä–∞–∑
  v_html := v_html || get_unit_matrix_html(SYSDATE, NULL, '–ó–∞—Ä–∞–∑');

  -- –ó –ø–æ—á–∞—Ç–∫—É –¥–æ–±–∏
  v_html := v_html || get_unit_matrix_html(TRUNC(SYSDATE), SYSDATE, '–ó –ø–æ—á–∞—Ç–∫—É –¥–æ–±–∏');

  -- –ó –ø–æ—á–∞—Ç–∫—É –∑–º—ñ–Ω–∏
  v_html := v_html || get_unit_matrix_html(:P1_SHIFT_START, :P1_SHIFT_END, '–ó –ø–æ—á–∞—Ç–∫—É –∑–º—ñ–Ω–∏');

  v_html := v_html || '</table>';
  RETURN v_html;
END;
```

---

## üéõÔ∏è –£ APEX

- –ú–æ–∂–Ω–∞ –¥–∏–Ω–∞–º—ñ—á–Ω–æ —Ä–æ–∑—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ `:P1_SHIFT_START` / `:P1_SHIFT_END` (—É –ø—Ä–æ—Ü–µ—Å—ñ –∞–±–æ DA).
- –ê–±–æ –æ–±—á–∏—Å–ª—é–≤–∞—Ç–∏ —ó—Ö —É —Ñ—É–Ω–∫—Ü—ñ—ó.

---

üîπ –•–æ—á–µ—à ‚Äî —è –∑—Ä–æ–±–ª—é –ø–æ–≤–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ç–≤–æ—î—ó `view`, –∑ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏ `unit` —É —á–µ–∫–±–æ–∫—Å—ñ?