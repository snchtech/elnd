–ó–≤—ñ—Å–Ω–æ! –û—Å—å –æ–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è —Ñ—É–Ω–∫—Ü—ñ—ó `get_unit_quick_stats`, —è–∫–∞:

---

## ‚úÖ –©–æ –Ω–æ–≤–æ–≥–æ:
- –î–æ–¥–∞—î –∞—Ä–≥—É–º–µ–Ω—Ç–∏ `p_date_start` —ñ `p_date_end`
- –Ø–∫—â–æ:
  - `p_date_start` **—ñ** `p_date_end` = `NULL` ‚Üí ‚õî –±–µ–∑ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –ø–æ —á–∞—Å—É
  - `p_date_start` –∑–∞–¥–∞–Ω–∏–π, `p_date_end` `NULL` ‚Üí –∫—ñ–Ω–µ—Ü—å = `SYSDATE`
  - `p_date_start` `NULL`, `p_date_end` –∑–∞–¥–∞–Ω–∏–π ‚Üí –ø–æ—á–∞—Ç–æ–∫ –Ω–µ –≤—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è (–º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏)

---

## üîÅ –û–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è:

```plsql
CREATE OR REPLACE FUNCTION get_unit_quick_stats (
    p_unit         IN NUMBER,
    p_departments  IN VARCHAR2 DEFAULT NULL, -- 'DEP1:DEP2'
    p_date_start   IN DATE DEFAULT NULL,
    p_date_end     IN DATE DEFAULT NULL
) RETURN CLOB IS
    v_html        CLOB := '';
    v_firm_brig   NUMBER := 0;
    v_cont_brig   NUMBER := 0;
    v_firm_people NUMBER := 0;
    v_cont_people NUMBER := 0;

    v_end         DATE;
    v_has_date    BOOLEAN := FALSE;

    TYPE dep_table IS TABLE OF VARCHAR2(4000);
    v_dep_tbl dep_table := apex_string.split(p_departments, ':');
BEGIN
    -- —è–∫—â–æ —Ç—ñ–ª—å–∫–∏ p_date_start –∑–∞–¥–∞–Ω–∏–π, p_date_end = SYSDATE
    IF p_date_start IS NOT NULL THEN
        v_has_date := TRUE;
        v_end := NVL(p_date_end, SYSDATE);
    ELSIF p_date_end IS NOT NULL THEN
        v_has_date := TRUE;
        -- –∑–∞–ª–∏—à–∞—î–º–æ p_date_start NULL ‚Üí –ø–æ—á–∞—Ç–æ–∫ –Ω–µ –æ–±–º–µ–∂–µ–Ω–æ
        v_end := p_date_end;
    END IF;

    -- –ë—Ä–∏–≥–∞–¥–∏
    SELECT 
      COUNT(CASE WHEN org = 1 THEN 1 END),
      COUNT(CASE WHEN org = 0 THEN 1 END)
    INTO v_firm_brig, v_cont_brig
    FROM your_view
    WHERE unit = p_unit
      AND outfit_open = 6
      AND (p_departments IS NULL OR department MEMBER OF v_dep_tbl)
      AND (
        NOT v_has_date OR (
          (p_date_start IS NOT NULL AND data_start >= p_date_start) AND
          (p_date_end IS NOT NULL AND data_start <= v_end)
        )
      );

    -- –õ—é–¥–∏
    SELECT 
      NVL(SUM(CASE WHEN org = 1 THEN team_count ELSE 0 END), 0),
      NVL(SUM(CASE WHEN org = 0 THEN team_count ELSE 0 END), 0)
    INTO v_firm_people, v_cont_people
    FROM your_view
    WHERE unit = p_unit
      AND outfit_open = 6
      AND (p_departments IS NULL OR department MEMBER OF v_dep_tbl)
      AND (
        NOT v_has_date OR (
          (p_date_start IS NOT NULL AND data_start >= p_date_start) AND
          (p_date_end IS NOT NULL AND data_start <= v_end)
        )
      );

    -- –§–æ—Ä–º—É–≤–∞–Ω–Ω—è HTML
    v_html := '–ü–æ Unit: ' || p_unit || '<br>';
    v_html := v_html || v_firm_brig || ' –±—Ä–∏–≥–∞–¥ –§—ñ—Ä–º–∞, ' || v_cont_brig || ' –ü—ñ–¥—Ä—è–¥–Ω–∏–∫–∏<br>';
    v_html := v_html || v_firm_people || ' —á–æ–ª. –§—ñ—Ä–º–∞, ' || v_cont_people || ' –ü—ñ–¥—Ä—è–¥–Ω–∏–∫–∏';

    RETURN v_html;
EXCEPTION
    WHEN OTHERS THEN
        RETURN '–ü–æ–º–∏–ª–∫–∞: ' || SQLERRM;
END;
/
```

---

## ‚úÖ –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–ª–∏–∫—É:
```plsql
BEGIN
  RETURN get_unit_quick_stats(
    p_unit => 1,
    p_departments => 'DEP1:DEP2',
    p_date_start => SYSDATE - 1,
    p_date_end => NULL -- –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –±—É–¥–µ SYSDATE
  );
END;
```

---

üîß –•–æ—á–µ—à ‚Äî –º–æ–∂—É –¥–æ–¥–∞—Ç–∏ —â–µ –≤–∞—Ä—ñ–∞–Ω—Ç, –¥–µ –≤–∏–≤–æ–¥–∏—Ç—å—Å—è –¥–∞—Ç–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ (`–ü–æ Unit 1 –∑–∞ 01.04.2025 - 02.04.2025`).