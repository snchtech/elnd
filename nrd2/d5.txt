–ß—É–¥–æ–≤–æ, –∑–∞–≤–¥–∞–Ω–Ω—è –¥—É–∂–µ —á—ñ—Ç–∫–µ —ñ –ø–æ–≤–Ω—ñ—Å—Ç—é –∑—Ä–æ–∑—É–º—ñ–ª–µ –∑–∞–≤–¥—è–∫–∏ –º–∞–ª—é–Ω–∫–∞–º —ñ –ø–æ—è—Å–Ω–µ–Ω–Ω—è–º ‚úÖ

---

## üß© –©–æ –º–∏ —Ä–µ–∞–ª—ñ–∑–æ–≤—É—î–º–æ:

### üìç –û—Å–Ω–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ (–º–∞—Ç—Ä–∏—Ü—è –∑ `get_unit_matrix_html`):

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∫–ª—ñ–∫–∞—î –ø–æ –∫–æ–º—ñ—Ä—Ü—ñ ‚Üí –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è **–º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ** –∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–∏–º –∑–≤—ñ—Ç–æ–º:

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–æ–∑—à–∏—Ä–µ–Ω–æ–≥–æ –∑–≤—ñ—Ç—É (–º–æ–¥–∞–ª—å–Ω–æ–≥–æ):

- üîπ –î–∞–Ω—ñ –±–µ—Ä—É—Ç—å—Å—è –∑ —Ç—ñ—î—ó —Å–∞–º–æ—ó `VIEW`, –∞–ª–µ –∑ —Ñ—ñ–ª—å—Ç—Ä–æ–º:
  - –ß–∞—Å–æ–≤–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª (–ó–∞—Ä–∞–∑ / –ó–º—ñ–Ω–∞ / –ü–æ—á–∞—Ç–æ–∫ –¥–æ–±–∏)
- üîπ –í–∏–≤—ñ–¥ —É —Ñ–æ—Ä–º–∞—Ç—ñ (–¥–∏–≤. "–ú–∞–ª—é–Ω–æ–∫ 2"):
  - –ì—Ä—É–ø–∞ "–í—ñ–¥–¥—ñ–ª–∏" (`org = 0`)
  - –ì—Ä—É–ø–∞ "–ü—ñ–¥—Ä—è–¥–Ω–∏–∫–∏" (`org = 1, 2, ...`)
  - –î–ª—è –∫–æ–∂–Ω–æ–≥–æ `unit` ‚Äî –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ª—é–¥–µ–π, –±—Ä–∏–≥–∞–¥
  - –í–Ω–∏–∑—É ‚Äì –∑–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞

---

## üõ† –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤ Oracle APEX

---

### ‚úÖ 1. **–°—Ç–≤–æ—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É (Dialog Page)**

- –¢–∏–ø: `Modal Dialog`
- –ù–∞–∑–≤–∞: `P_MODAL_UNIT_STATS`
- –ü–∞—Ä–∞–º–µ—Ç—Ä–∏:
  - `P_MODAL_TIME_MODE` ‚Äî –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `'NOW'`, `'SHIFT'`, `'DAY'`
  - `P_MODAL_UNITS` ‚Äî –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ `0:1:2`
  - `P_MODAL_DEPARTMENTS` ‚Äî —Å–ø–∏—Å–æ–∫ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—ñ–≤

---

### ‚úÖ 2. **SQL-–∑–≤—ñ—Ç –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞**

#### üí° SQL-–∑–∞–ø–∏—Ç, —è–∫–∏–π –±—É–¥—É—î —Ç–∞–±–ª–∏—Ü—é, –ø–æ–¥—ñ–±–Ω—É –¥–æ –ú–∞–ª—é–Ω–∫–∞ 2:

```sql
SELECT 
  COALESCE(department, org_txt) AS group_name,
  org,
  unit,
  SUM(team_count) AS people,
  COUNT(id_outfit) AS brigades
FROM your_view
WHERE outfit_open = 6
  AND (
    (:P_MODAL_TIME_MODE = 'NOW' AND data_start <= SYSDATE)
    OR (:P_MODAL_TIME_MODE = 'SHIFT' AND data_start BETWEEN :P_MODAL_SHIFT_START AND SYSDATE)
    OR (:P_MODAL_TIME_MODE = 'DAY' AND data_start BETWEEN TRUNC(SYSDATE) AND SYSDATE)
  )
  AND (:P_MODAL_DEPARTMENTS IS NULL OR department IN (
       SELECT column_value FROM TABLE(apex_string.split(:P_MODAL_DEPARTMENTS, ':'))
  ))
  AND (:P_MODAL_UNITS IS NULL OR unit IN (
       SELECT column_value FROM TABLE(apex_string.split(:P_MODAL_UNITS, ':'))
  ))
GROUP BY 
  GROUPING SETS (
    (org, department, unit),
    (org, org_txt, unit),
    (unit),
    ()
  )
ORDER BY 
  CASE WHEN org IS NULL THEN 99 ELSE org END,
  department,
  org_txt,
  unit
```

---

### ‚úÖ 3. **–£ –º–∞—Ç—Ä–∏—Ü—ñ (HTML —Ç–∞–±–ª–∏—Ü—ñ)** ‚Äì –¥–æ–¥–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∫–ª—ñ–∫–∏

–£ —Ñ—É–Ω–∫—Ü—ñ—ó `get_unit_matrix_html` **–æ–±–≥–æ—Ä–Ω–∏ –∫–ª—ñ–∫–∞–±–µ–ª—å–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º**:

```html
<td>
  <a href="javascript:void(0);" 
     onclick="openUnitModal('NOW', 0)">
     1
  </a>
</td>
```

---

### ‚úÖ 4. **JavaScript-—Ñ—É–Ω–∫—Ü—ñ—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ (Page JS)**

```js
function openUnitModal(mode, unit) {
  apex.server.process("OPEN_MODAL", {
    x01: mode,
    x02: unit,
    x03: $v("P1_DEPARTMENTS")
  }, {
    success: function() {
      apex.navigation.dialog.open({
        pageId: "P_MODAL_UNIT_STATS",
        dialog: "modal",
        modal: true,
        reloadOnClose: true
      });
    }
  });
}
```

---

### ‚úÖ 5. **Page Process "OPEN_MODAL" (AJAX Callback)**

```plsql
:P_MODAL_TIME_MODE := apex_application.g_x01;
:P_MODAL_UNITS := apex_application.g_x02;
:P_MODAL_DEPARTMENTS := apex_application.g_x03;
```

---

### ‚úÖ 6. **–ó–≤—ñ—Ç –Ω–∞ –º–æ–¥–∞–ª—å–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ**

- –¢–∏–ø: Classic Report
- SQL: —Ç–µ, —â–æ –≤–∏—â–µ
- –í–∏–≤–æ–¥–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

| –ì—Ä—É–ø–∞     | Unit1 –ª—é–¥–∏ | Unit1 –±—Ä–∏–≥–∞–¥ | Unit2 –ª—é–¥–∏ | ... | –í—Å—å–æ–≥–æ –ª—é–¥–∏ | –í—Å—å–æ–≥–æ –±—Ä–∏–≥–∞–¥ |

---

## üîÅ –ö–æ—Ä–æ—Ç–∫–æ

| –ö—Ä–æ–∫ | –©–æ —Ä–æ–±–∏–º–æ |
|------|-----------|
| 1    | –í `get_unit_matrix_html` —Ä–æ–±–∏–º–æ `<a onclick="openUnitModal(...">` |
| 2    | –ü–µ—Ä–µ–¥–∞—î–º–æ —á–∞—Å/—é–Ω–∏—Ç–∏/–¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∏ —É `x01`, `x02`, `x03` |
| 3    | –í AJAX Callback –∑–∞–ø–∏—Å—É—î–º–æ —É `P_MODAL_*` |
| 4    | –£ –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ –∑–≤—ñ—Ç —á–∏—Ç–∞—î –∑ `P_MODAL_*` |
| 5    | –ó–≤—ñ—Ç –±—É–¥—É—î—Ç—å—Å—è –Ω–∞ —Ç—ñ–π —Å–∞–º—ñ–π view |

---

üîß –•–æ—á–µ—à ‚Äî —è –º–æ–∂—É –¥–∞—Ç–∏ –ø–æ–≤–Ω—É `PL/SQL`-—Ñ—É–Ω–∫—Ü—ñ—é –∑ HTML + JavaScript –≤–±—É–¥–æ–≤–∞–Ω–∏–π –ø—Ä—è–º–æ –≤ `td`, –≥–æ—Ç–æ–≤—É –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è. –ê–±–æ JSON –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É –≤ APEX.