–ß—É–¥–æ–≤–æ! –û—Å—å **–ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∏–π SQL-–∑–∞–ø–∏—Ç** –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –∑–≤—ñ—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç—ñ, —è–∫ –Ω–∞ ‚Äú–ú–∞–ª—é–Ω–æ–∫ 2‚Äù üìä

---

## üìå –©–æ –≤—Ä–∞—Ö–æ–≤—É—î —Ü–µ–π SQL:
- –ß–∞—Å–æ–≤–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª: `NOW`, `DAY`, `SHIFT` (—á–µ—Ä–µ–∑ `:P_MODAL_TIMEMODE`)
- –û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π–Ω–∞ –æ–∑–Ω–∞–∫–∞:
  - `org = 1` ‚Üí —Ñ—ñ—Ä–º–∏ (–≥—Ä—É–ø—É—é—Ç—å—Å—è –ø–æ `department`)
  - `org = 0` ‚Üí –ø—ñ–¥—Ä—è–¥–Ω–∏–∫–∏ (–≥—Ä—É–ø—É—é—Ç—å—Å—è –ø–æ `org_txt`)
- –í–∏–≤–æ–¥–∏—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ª—é–¥–µ–π (`team_count`) —ñ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –±—Ä–∏–≥–∞–¥ (`id_outfit`) –ø–æ –∫–æ–∂–Ω–æ–º—É `unit`
- –§–æ—Ä–º—É—î **–ø—ñ–¥—Å—É–º–∫–∏** –ø–æ –≥—Ä—É–ø–∞—Ö —ñ –≤–Ω–∏–∑—É ‚Äî –∑–∞–≥–∞–ª—å–Ω—ñ –ø—ñ–¥—Å—É–º–∫–∏
- –ü—Ä–∞—Ü—é—î –∑ —Ç–≤–æ—î—é `view`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `your_view`

---

## ‚úÖ SQL –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –∑–≤—ñ—Ç—É:

```sql
WITH base_data AS (
  SELECT 
    id_outfit,
    org,
    org_txt,
    department,
    unit,
    team_count,
    data_start
  FROM your_view
  WHERE outfit_open = 6
    AND (
      (:P_MODAL_TIMEMODE = 'NOW' AND data_start <= SYSDATE)
      OR (:P_MODAL_TIMEMODE = 'DAY' AND data_start BETWEEN TRUNC(SYSDATE) AND SYSDATE)
      OR (:P_MODAL_TIMEMODE = 'SHIFT' AND data_start BETWEEN :P_SHIFT_START AND SYSDATE)
    )
    AND (:P_MODAL_ORG IS NULL OR org = TO_NUMBER(:P_MODAL_ORG))
    AND (:P_MODAL_UNIT IS NULL OR unit = TO_NUMBER(:P_MODAL_UNIT))
    AND (
      :P_MODAL_DEPARTMENTS IS NULL 
      OR department IN (
        SELECT column_value FROM TABLE(apex_string.split(:P_MODAL_DEPARTMENTS, ':'))
      )
    )
),
agg_data AS (
  SELECT
    CASE WHEN org = 1 THEN department ELSE org_txt END AS group_name,
    org,
    unit,
    COUNT(id_outfit) AS brigades,
    SUM(team_count) AS people
  FROM base_data
  GROUP BY
    CASE WHEN org = 1 THEN department ELSE org_txt END,
    org,
    unit
),
pivoted AS (
  SELECT
    group_name,
    org,
    NVL(SUM(CASE WHEN unit = 0 THEN people END), 0) AS u1_people,
    NVL(SUM(CASE WHEN unit = 0 THEN brigades END), 0) AS u1_brigades,
    NVL(SUM(CASE WHEN unit = 1 THEN people END), 0) AS u2_people,
    NVL(SUM(CASE WHEN unit = 1 THEN brigades END), 0) AS u2_brigades,
    NVL(SUM(CASE WHEN unit = 2 THEN people END), 0) AS u3_people,
    NVL(SUM(CASE WHEN unit = 2 THEN brigades END), 0) AS u3_brigades,
    SUM(people) AS total_people,
    SUM(brigades) AS total_brigades
  FROM agg_data
  GROUP BY group_name, org
),
final_union AS (
  SELECT * FROM pivoted
  UNION ALL
  SELECT 
    '–£—Å—å–æ–≥–æ' AS group_name,
    NULL AS org,
    SUM(u1_people),
    SUM(u1_brigades),
    SUM(u2_people),
    SUM(u2_brigades),
    SUM(u3_people),
    SUM(u3_brigades),
    SUM(total_people),
    SUM(total_brigades)
  FROM pivoted
)
SELECT * FROM final_union
ORDER BY
  CASE 
    WHEN group_name = '–£—Å—å–æ–≥–æ' THEN 9999
    WHEN org = 1 THEN 1  -- —Ñ—ñ—Ä–º–∏
    WHEN org = 0 THEN 2  -- –ø—ñ–¥—Ä—è–¥–Ω–∏–∫–∏
    ELSE 3               -- fallback
  END,
  group_name;
```

---

## üìä –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É:

| group_name     | u1_people | u1_brigades | u2_people | u2_brigades | u3_people | u3_brigades | total_people | total_brigades |
|----------------|-----------|-------------|-----------|-------------|-----------|-------------|---------------|----------------|
| –í—ñ–¥–¥—ñ–ª ‚Ññ1      | 100       | 10          | 80        | 7           | 10        | 2           | 190           | 19             |
| –í—ñ–¥–¥—ñ–ª ‚Ññ2      | 50        | 5           | 60        | 6           | 20        | 3           | 130           | 14             |
| –ü—ñ–¥—Ä—è–¥–Ω–∏–∫ ‚Ññ1   | 40        | 4           | 30        | 2           | 10        | 1           | 80            | 7              |
| –ü—ñ–¥—Ä—è–¥–Ω–∏–∫ ‚Ññ2   | 20        | 2           | 15        | 1           | 0         | 0           | 35            | 3              |
| **–£—Å—å–æ–≥–æ**     | 210       | 21          | 185       | 16          | 40        | 6           | 435           | 43             |

---

## ‚úÖ –í APEX

1. **Modal Page** ‚Üí Classic Report or Interactive Report
2. SQL ‚Üí –≤—Å—Ç–∞–≤–ª—è—î—à —Ü–µ–π –∫–æ–¥
3. –ü–µ—Ä–µ–¥–∞—î—à:
   - `:P_MODAL_TIMEMODE`
   - `:P_MODAL_ORG`
   - `:P_MODAL_UNIT`
   - `:P_MODAL_DEPARTMENTS`
   - `:P_SHIFT_START` (–º–æ–∂–Ω–∞ –≤–∏—Ä–∞—Ö—É–≤–∞—Ç–∏ –≤ Page Load Dynamic Action)

---

‚úÖ –ì–æ—Ç–æ–≤–æ!  
–•–æ—á–µ—à ‚Äî –º–æ–∂—É –ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ —â–µ **–¥–∏–Ω–∞–º—ñ—á–Ω—É –æ–±—Ä–æ–±–∫—É `:P_SHIFT_START`** –∞–±–æ –≥–æ—Ç–æ–≤–∏–π **JSON –µ–∫—Å–ø–æ—Ä—Ç —Å—Ç–æ—Ä—ñ–Ω–∫–∏** –∑ –º–æ–¥–∞–ª—å–Ω–∏–º –≤—ñ–∫–Ω–æ–º?