–¶–µ —Å—É–ø–µ—Ä–ø—Ä–∞–∫—Ç–∏—á–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è ‚Äî —ñ –æ—Å—å **—á—ñ—Ç–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∑ –≤–∞—Ä—ñ–∞–Ω—Ç–∞–º–∏**, —è–∫ –¥—ñ—è—Ç–∏.

---

## üìå –ö–æ—Ä–æ—Ç–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:

> **–ù—ñ**, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ `VIEW` –≤ Oracle **–Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î bind-–ø–∞—Ä–∞–º–µ—Ç—Ä–∏** (—Ç–∏–ø—É `:P_MODAL_TIMEMODE`, `:P_MODAL_ORG` —Ç–æ—â–æ).

---

## üß† –ß–æ–º—É —Ç–∞–∫?
- `VIEW` ‚Äî —Ü–µ **—Ñ—ñ–∫—Å–æ–≤–∞–Ω–∞ SQL-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è**, —è–∫—É –Ω–µ –º–æ–∂–Ω–∞ "–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑—É–≤–∞—Ç–∏".
- `:P_...` ‚Äî —Ü–µ **bind-–ø–µ—Ä–µ–º—ñ–Ω–Ω—ñ APEX** –∞–±–æ PL/SQL, –≤–æ–Ω–∏ –ø—Ä–∞—Ü—é—é—Ç—å —Ç—ñ–ª—å–∫–∏ —É –¥–∏–Ω–∞–º—ñ—á–Ω–æ–º—É SQL (–∑–∞–ø–∏—Ç–∏, —è–∫—ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –Ω–∞ –ª—å–æ—Ç—É).
- –£ `VIEW` –Ω–µ–º–æ–∂–ª–∏–≤–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:
  - `:bind_variable`
  - `APEX_UTIL.GET_SESSION_STATE(...)`
  - `V('P_ITEM')`  
  ‚ùó –ë–æ —Ü–µ PL/SQL/SQL*Plus/HTML context, –∞ –Ω–µ pure SQL.

---

## ‚úÖ –í–ê–†–Ü–ê–ù–¢–ò –†–Ü–®–ï–ù–ù–Ø

---

### üî∏ –í–ê–†–Ü–ê–ù–¢ 1: View **–±–µ–∑ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤**, –∞ —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞–Ω–Ω—è ‚Äî –Ω–∞ —Ä—ñ–≤–Ω—ñ APEX (–†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–û)

–°—Ç–≤–æ—Ä–∏ view:

```sql
CREATE OR REPLACE VIEW v_outfit_pivot_base AS
WITH base_data AS (
  SELECT 
    id_outfit,
    org,
    org_txt,
    department,
    unit,
    team_count,
    data_start
  FROM your_view
  WHERE outfit_open = 6
),
agg_data AS (
  SELECT
    CASE WHEN org = 0 THEN department ELSE org_txt END AS group_name,
    org,
    unit,
    COUNT(id_outfit) AS brigades,
    SUM(team_count) AS people
  FROM base_data
  GROUP BY
    CASE WHEN org = 0 THEN department ELSE org_txt END,
    org,
    unit
),
pivoted AS (
  SELECT
    group_name,
    org,
    NVL(SUM(CASE WHEN unit = 0 THEN people END), 0) AS u1_people,
    NVL(SUM(CASE WHEN unit = 0 THEN brigades END), 0) AS u1_brigades,
    NVL(SUM(CASE WHEN unit = 1 THEN people END), 0) AS u2_people,
    NVL(SUM(CASE WHEN unit = 1 THEN brigades END), 0) AS u2_brigades,
    NVL(SUM(CASE WHEN unit = 2 THEN people END), 0) AS u3_people,
    NVL(SUM(CASE WHEN unit = 2 THEN brigades END), 0) AS u3_brigades,
    SUM(people) AS total_people,
    SUM(brigades) AS total_brigades
  FROM agg_data
  GROUP BY group_name, org
)
SELECT * FROM pivoted
UNION ALL
SELECT 
  '–£—Å—å–æ–≥–æ',
  NULL,
  SUM(u1_people),
  SUM(u1_brigades),
  SUM(u2_people),
  SUM(u2_brigades),
  SUM(u3_people),
  SUM(u3_brigades),
  SUM(total_people),
  SUM(total_brigades)
FROM pivoted;
```

### ‚úÖ –£ APEX –ø—Ä–æ—Å—Ç–æ –¥–æ–¥–∞—î—à Dynamic WHERE:

```sql
SELECT *
FROM v_outfit_pivot_base
WHERE 1=1
  AND (:P_MODAL_ORG IS NULL OR org = TO_NUMBER(:P_MODAL_ORG))
  AND (:P_MODAL_UNIT IS NULL OR unit = TO_NUMBER(:P_MODAL_UNIT))
  AND (:P_MODAL_DEPARTMENTS IS NULL 
       OR department IN (
           SELECT column_value FROM TABLE(split_string(:P_MODAL_DEPARTMENTS, ':'))
       )
      )
  AND (
    :P_MODAL_TIMEMODE = 'NOW' AND data_start <= SYSDATE
    OR :P_MODAL_TIMEMODE = 'DAY' AND data_start BETWEEN TRUNC(SYSDATE) AND SYSDATE
    OR :P_MODAL_TIMEMODE = 'SHIFT' AND data_start BETWEEN :P_SHIFT_START AND SYSDATE
  )
```

üü© **–ü–µ—Ä–µ–≤–∞–≥–∏:**
- `VIEW` –∫–µ—à—É—î—Ç—å—Å—è Oracle
- –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤ APEX, SQL, PL/SQL
- —É –∑–≤—ñ—Ç–∞—Ö –ø—Ä–∞—Ü—é—î —à–≤–∏–¥–∫–æ, –æ—Å–∫—ñ–ª—å–∫–∏ –ª–æ–≥—ñ–∫–∞ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è —ñ pivot ‚Äî –≤–∂–µ –≤ view

---

### üî∏ –í–ê–†–Ü–ê–ù–¢ 2: –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ **pipeline-—Ñ—É–Ω–∫—Ü—ñ—é** –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

üìå –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ _–≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –≤ SQL_, –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ **—Ñ—É–Ω–∫—Ü—ñ—é**, —è–∫–∞ –ø–æ–≤–µ—Ä—Ç–∞—î `TABLE`, —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ü—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏.

üìå –ê–ª–µ —Ü–µ —Å–∫–ª–∞–¥–Ω—ñ—à–µ —ñ –ø–æ—Ç—Ä–µ–±—É—î `PIPELINED FUNCTION` + —Ç–∏–ø—É RECORD/OBJECT.

–Ø–∫—â–æ —Ü—ñ–∫–∞–≤–∏—Ç—å ‚Äî –º–æ–∂—É –Ω–∞–≤–µ—Å—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥.

---

## üîö –ü—ñ–¥—Å—É–º–æ–∫:

| –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ —É view | –ú–æ–∂–ª–∏–≤–æ? |
|------------------|----------|
| `:P_PAGE_ITEM`   | ‚ùå        |
| –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —É APEX | ‚úÖ —á–µ—Ä–µ–∑ `WHERE` —É–º–æ–≤–∏ |
| –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞     | ‚úÖ pipeline function |

–•–æ—á–µ—à ‚Äî –º–æ–∂—É —Å—Ç–≤–æ—Ä–∏—Ç–∏ `v_outfit_pivot_base` —ñ SQL –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –¥–ª—è —Ç–≤–æ—î—ó APEX-—Å—Ç–æ—Ä—ñ–Ω–∫–∏ –ø—Ä—è–º–æ –∑–∞—Ä–∞–∑.