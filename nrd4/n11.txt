–°—É–ø–µ—Ä! –î–∞–≤–∞–π –¥–æ–¥–∞–º–æ –ø–µ—Ä–µ–¥–∞—á—É `:P_SHIFT_START` —è–∫ **–¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è**, —â–æ–± —É –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –ø–æ—Ç—Ä–∞–ø–ª—è–≤ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π —á–∞—Å –ø–æ—á–∞—Ç–∫—É –∑–º—ñ–Ω–∏.

---

## üìå –©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—Ä–æ–±–∏—Ç–∏:

- –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ `:P_SHIFT_START` –Ω–∞ –æ—Å–Ω–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
- –ü–µ—Ä–µ–¥–∞—Ç–∏ –π–æ–≥–æ –≤ `openUnitModal(...)` —á–µ—Ä–µ–∑ AJAX
- –ü—Ä–∏—Å–≤–æ—ó—Ç–∏ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ (`:P_SHIFT_START`)

---

## ‚úÖ 1. –î–æ–¥–∞–π Hidden Item `P_SHIFT_START` –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É (–¥–µ —î –∑–≤—ñ—Ç)

- –¢–∏–ø: **Hidden**
- Static ID: –∑–∞–ª–∏—à –ø–æ—Ä–æ–∂–Ω—ñ–º
- **Value Protected**: `No`
- –ù–∞–∑–≤–∞: `P_SHIFT_START`

---

## ‚úÖ 2. –î–æ–¥–∞–π –¥–∏–Ω–∞–º—ñ—á–Ω—É –æ–±—Ä–æ–±–∫—É —Ü—å–æ–≥–æ –ø–æ–ª—è (PL/SQL)

–°—Ç–≤–æ—Ä–∏ **"Dynamic Action" ‚Üí "Page Load"** –∞–±–æ "When Button Clicked", –¥–∞–ª—ñ:

### ‚ûï True Action ‚Üí **Set Value**

| –ü–∞—Ä–∞–º–µ—Ç—Ä             | –ó–Ω–∞—á–µ–Ω–Ω—è                                   |
|----------------------|--------------------------------------------|
| Set Type             | PL/SQL Function Body                       |
| PL/SQL Code          | ‚¨áÔ∏è (–¥–∏–≤ –Ω–∏–∂—á–µ)                              |
| Affected Items       | `P_SHIFT_START`                            |
| Fire on Initialization | ‚úÖ (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ) |

### üî¢ PL/SQL Code:

```plsql
DECLARE
  v_shift_start DATE;
BEGIN
  IF TO_CHAR(SYSDATE, 'HH24:MI') BETWEEN '06:00' AND '13:59' THEN
    v_shift_start := TRUNC(SYSDATE) + 6/24;
  ELSIF TO_CHAR(SYSDATE, 'HH24:MI') BETWEEN '14:00' AND '21:59' THEN
    v_shift_start := TRUNC(SYSDATE) + 14/24;
  ELSIF TO_CHAR(SYSDATE, 'HH24:MI') >= '22:00' THEN
    v_shift_start := TRUNC(SYSDATE) + 22/24;
  ELSE
    v_shift_start := TRUNC(SYSDATE - 1) + 22/24;
  END IF;

  RETURN TO_CHAR(v_shift_start, 'YYYY-MM-DD HH24:MI:SS');
END;
```

> üìù –Ø–∫—â–æ —Ö–æ—á–µ—à –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ DATE –Ω–∞–ø—Ä—è–º—É ‚Äî –Ω–µ –∫–æ–Ω–≤–µ—Ä—Ç—É–π —É `TO_CHAR`.

---

## ‚úÖ 3. –û–Ω–æ–≤–∏ JavaScript `openUnitModal(...)`

–¢–µ–ø–µ—Ä –¥–æ–¥–∞—î–º–æ `x04` ‚Äî shift_start:

```js
function openUnitModal(mode, unit) {
  apex.server.process("OPEN_MODAL", {
    x01: mode,
    x02: unit,
    x03: $v("P1_DEPARTMENTS"),
    x04: $v("P_SHIFT_START")  // ‚Üê –û—Å—å —Ç—É—Ç –º–∏ –ø–µ—Ä–µ–¥–∞—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è
  }, {
    success: function() {
      apex.navigation.dialog.open({
        pageId: "P_MODAL_UNIT_STATS",
        dialog: "modal",
        modal: true,
        reloadOnClose: true
      });
    }
  });
}
```

---

## ‚úÖ 4. –û–Ω–æ–≤–∏ AJAX Callback `OPEN_MODAL`

–¢–µ–ø–µ—Ä –¥–æ–¥–∞—î–º–æ 4-–µ –∑–Ω–∞—á–µ–Ω–Ω—è:

```plsql
:P_MODAL_TIME_MODE := apex_application.g_x01;
:P_MODAL_UNITS := apex_application.g_x02;
:P_MODAL_DEPARTMENTS := apex_application.g_x03;
:P_SHIFT_START := TO_DATE(apex_application.g_x04, 'YYYY-MM-DD HH24:MI:SS');
```

---

## ‚úÖ 5. –ù–∞ –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ

–û–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ **–µ–ª–µ–º–µ–Ω—Ç `P_SHIFT_START` (Hidden)** –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞.  
–ó—Ä–æ–±–∏ `Value Protected = No`.

---

## ‚úÖ 6. –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ SQL –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞

```sql
...
AND (
  :P_MODAL_TIME_MODE = 'NOW' AND data_start <= SYSDATE
  OR :P_MODAL_TIME_MODE = 'DAY' AND data_start BETWEEN TRUNC(SYSDATE) AND SYSDATE
  OR :P_MODAL_TIME_MODE = 'SHIFT' AND data_start BETWEEN :P_SHIFT_START AND SYSDATE
)
```

---

‚úÖ –¢–µ–ø–µ—Ä –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç—Ä–∏–º—É—î –∞–∫—Ç—É–∞–ª—å–Ω–∏–π —á–∞—Å –ø–æ—á–∞—Ç–∫—É –∑–º—ñ–Ω–∏ ‚Äî —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –π –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ üéØ

üîß –Ø–∫—â–æ —Ö–æ—á–µ—à, –º–æ–∂—É –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ —â–µ –±—ñ–ª—å—à –≥–Ω—É—á–∫–∏–º, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ `SHIFT_START` –≤—Ä—É—á–Ω—É –≤ –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ.