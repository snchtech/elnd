–î—è–∫—É—é, —â–æ –ø–æ–∫–∞–∑–∞–≤ –æ–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ–¥ üëå –î–∞–≤–∞–π —Ä–æ–∑–±–µ—Ä–µ–º–æ—Å—è –¥–µ—Ç–∞–ª—å–Ω–æ.

---

## üß© –¢–∏ —Ö–æ—á–µ—à:
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ **—É—Å—ñ –ø–æ–ª—è** (`unit`, `department`, `data_start`) –∑ `base_data ‚Üí agg_data ‚Üí final SELECT`
- –Ü –Ω–∞ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É —Ä—ñ–≤–Ω—ñ –º–∞—Ç–∏ —Ü—ñ –ø–æ–ª—è –¥–æ—Å—Ç—É–ø–Ω–∏–º–∏ **–¥–ª—è –ø–æ–¥–∞–ª—å—à–æ—ó —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**

---

## üîé –ê–ª–µ —â–æ –∑–∞—Ä–∞–∑ —É —Ç–µ–±–µ:

### –£ `agg_data`:
```sql
SELECT
  CASE WHEN org = 0 THEN department ELSE org_txt END AS group_name,
  org,
  unit,
  department,
  data_start,
  COUNT(id_outfit) AS brigades,
  SUM(team_count) AS people
FROM base_data
GROUP BY
  CASE WHEN org = 0 THEN department ELSE org_txt END,
  org,
  unit
```

‚ùó –ü—Ä–æ–±–ª–µ–º–∞: **—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à `data_start` —É SELECT**, –∞–ª–µ –Ω–µ –≤–∫–∞–∑–∞–≤ —ó—ó –≤ `GROUP BY`.

> ‚ùå –¶–µ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –ø–æ–º–∏–ª–∫–∏:  
`ORA-00979: not a GROUP BY expression`

---

## ‚úÖ –Ø–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ?

–¢–∏ –º–æ–∂–µ—à –∑—Ä–æ–±–∏—Ç–∏ **–æ–¥–Ω–µ –∑ –¥–≤–æ—Ö:**

---

### ‚úÖ **–í–∞—Ä—ñ–∞–Ω—Ç 1**: –î–æ–¥–∞—Ç–∏ `data_start` —É `GROUP BY` (—è–∫—â–æ –≤–æ–Ω–∞ –º–∞—î –±—É—Ç–∏ —É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ)

```sql
GROUP BY
  CASE WHEN org = 0 THEN department ELSE org_txt END,
  org,
  unit,
  department,
  data_start
```

–ê–ª–µ —Ç–æ–¥—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ **–Ω–µ –∞–≥—Ä–µ–≥–æ–≤–∞–Ω–∏–π –ø–æ –¥–∞—Ç–∞—Ö**, –∞ **–ø–æ –∫–æ–∂–Ω–æ–º—É data_start**, —Ç–æ–±—Ç–æ –æ—Ç—Ä–∏–º–∞—î—à –±—ñ–ª—å—à–µ —Ä—è–¥–∫—ñ–≤.

---

### ‚úÖ **–í–∞—Ä—ñ–∞–Ω—Ç 2**: –í–∏–∫–ª—é—á–∏—Ç–∏ `data_start` —ñ–∑ `agg_data`, —ñ –æ–±—á–∏—Å–ª—é–≤–∞—Ç–∏ –ª–∏—à–µ –≥—Ä—É–ø–æ–≤–∞–Ω—É —Ç–∞–±–ª–∏—Ü—é:

```sql
SELECT
  CASE WHEN org = 0 THEN department ELSE org_txt END AS group_name,
  org,
  unit,
  COUNT(id_outfit) AS brigades,
  SUM(team_count) AS people
FROM base_data
GROUP BY
  CASE WHEN org = 0 THEN department ELSE org_txt END,
  org,
  unit
```

–¶–µ–π –≤–∞—Ä—ñ–∞–Ω—Ç ‚Äî –∫–ª–∞—Å–∏—á–Ω–∏–π –¥–ª—è `pivot`, –±–æ –≤—ñ–Ω –¥–æ–∑–≤–æ–ª—è—î –±—É–¥—É–≤–∞—Ç–∏ –∞–≥—Ä–µ–≥–∞—Ç–∏ –ø–æ `unit`.

---

### üß† –©–æ –Ω–µ –º–æ–∂–Ω–∞ —Ä–æ–±–∏—Ç–∏:
–ù–µ–º–æ–∂–Ω–∞ –º—ñ–∫—Å—É–≤–∞—Ç–∏ –∞–≥—Ä–µ–≥–æ–≤–∞–Ω—ñ –π –Ω–µ–∞–≥—Ä–µ–≥–æ–≤–∞–Ω—ñ –∫–æ–ª–æ–Ω–∫–∏ –±–µ–∑ –≤–∫–ª—é—á–µ–Ω–Ω—è —ó—Ö —É `GROUP BY`.

---

## üü¢ –û—Ç–∂–µ ‚Äî —Ç–≤—ñ–π –∫–æ–¥ –±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏, **—è–∫—â–æ:**

1. –î–æ–¥–∞—Å–∏ `data_start` –¥–æ `GROUP BY`
2. –Ü –ø—Ä–∏–π–º–µ—à —Ç–æ–π —Ñ–∞–∫—Ç, —â–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ –¥–µ—Ç–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –ø–æ –¥–∞—Ç–∞—Ö

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:
–ó–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∑–∞–¥–∞—á—ñ ‚Äî —è–∫—â–æ —Ç–æ–±—ñ **—Ç—Ä–µ–±–∞ –±–∞—á–∏—Ç–∏ —Å—É–º–∞—Ä–Ω—É –∫–∞—Ä—Ç–∏–Ω—É**, –±–µ–∑ –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø–æ –¥–∞—Ç–∞—Ö ‚Äî **–Ω–µ –≤–∫–ª—é—á–∞–π `data_start`** —É `agg_data`.

–ê —è–∫—â–æ —Ç–∏ —Ö–æ—á–µ—à, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, **–≥—Ä–∞—Ñ—ñ–∫ –ø–æ –¥–Ω—è—Ö –∞–±–æ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é –ø–æ —á–∞—Å–æ–≤–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∞—Ö**, —Ç–æ–¥—ñ **–¥–æ–¥–∞–≤–∞–π `data_start` —É `GROUP BY`**.

---

üîß –Ø–∫—â–æ —Å–∫–∞–∂–µ—à, –¥–ª—è —á–æ–≥–æ —Ç–æ–±—ñ —Ü—ñ –ø–æ–ª—è –Ω–∞ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É —Ä—ñ–≤–Ω—ñ (`unit`, `department`, `data_start`) ‚Äî —è –¥–æ–ø–æ–º–æ–∂—É –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ —ó—Ö –∑–±–µ—Ä–µ–≥—Ç–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—ñ.