–ß—É–¥–æ–≤–æ! üëç –Ø–∫—â–æ —Ç–∏ –ø–ª–∞–Ω—É—î—à –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `v_outfit_pivot_base` —É –∑–≤—ñ—Ç–∞—Ö APEX **–∑ –¥–∏–Ω–∞–º—ñ—á–Ω–æ—é —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—î—é –∑–∞ `org`, `unit`, `department`, `data_start`**, —Ç–æ–¥—ñ —Ç–≤–æ—è view **–º–∞—î –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –º—ñ—Å—Ç–∏—Ç–∏** —Ü—ñ –∫–æ–ª–æ–Ω–∫–∏ —É —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É `SELECT`.

---

## ‚úÖ –Ø–∫ –∑—Ä–æ–±–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

–û—Å—å –æ–Ω–æ–≤–ª–µ–Ω–∏–π —ñ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç —Ç–≤–æ—î—ó view:

```sql
CREATE OR REPLACE VIEW v_outfit_pivot_base AS
WITH base_data AS (
  SELECT 
    id_outfit,
    org,
    org_txt,
    department,
    unit,
    team_count,
    data_start
  FROM your_view
  WHERE outfit_open = 6
),
agg_data AS (
  SELECT
    CASE WHEN org = 0 THEN department ELSE org_txt END AS group_name,
    org,
    unit,
    department,
    data_start,
    COUNT(id_outfit) AS brigades,
    SUM(team_count) AS people
  FROM base_data
  GROUP BY
    CASE WHEN org = 0 THEN department ELSE org_txt END,
    org,
    unit,
    department,
    data_start
)
SELECT
  group_name,
  org,
  unit,
  department,
  data_start,
  NVL(SUM(CASE WHEN unit = 0 THEN people END), 0) AS u1_people,
  NVL(SUM(CASE WHEN unit = 0 THEN brigades END), 0) AS u1_brigades,
  NVL(SUM(CASE WHEN unit = 1 THEN people END), 0) AS u2_people,
  NVL(SUM(CASE WHEN unit = 1 THEN brigades END), 0) AS u2_brigades,
  NVL(SUM(CASE WHEN unit = 2 THEN people END), 0) AS u3_people,
  NVL(SUM(CASE WHEN unit = 2 THEN brigades END), 0) AS u3_brigades,
  SUM(people) AS total_people,
  SUM(brigades) AS total_brigades
FROM agg_data
GROUP BY
  group_name,
  org,
  unit,
  department,
  data_start;
```

---

## üí° –ü–æ—è—Å–Ω–µ–Ω–Ω—è:

- `department`, `org`, `unit`, `data_start` ‚Äî **–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –≤ `GROUP BY`**, —â–æ–± –∑–±–µ—Ä–µ–≥—Ç–∏ —ó—Ö —É `SELECT`.
- `group_name` ‚Äî –ø–æ—Ç—Ä—ñ–±–µ–Ω, —è–∫—â–æ —Ç–∏ —Ö–æ—á–µ—à —Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –≥—Ä—É–ø–æ–≤–∞–Ω—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∏–ø—É "–§—ñ—Ä–º–∞" –∞–±–æ "–ü—ñ–¥—Ä—è–¥–Ω–∏–∫".
- –¶—è view –Ω–µ –º—ñ—Å—Ç–∏—Ç—å —Å—É–º–∞—Ä–Ω–æ–≥–æ —Ä—è–¥–∫–∞ `–£—Å—å–æ–≥–æ` ‚Äî –±–æ —Ç–∏ —Ö–æ—á–µ—à –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—î—é –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤. –ê–ª–µ —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ ‚Äî –º–æ–∂—É –ø–æ–∫–∞–∑–∞—Ç–∏, —è–∫ –¥–æ–¥–∞—Ç–∏ `UNION ALL` –¥–ª—è `–£—Å—å–æ–≥–æ` –±–µ–∑ –≤—Ç—Ä–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó.

---

## üü¢ –Ü —Ç–µ–ø–µ—Ä —Ç–∏ –º–æ–∂–µ—à —Å–ø–æ–∫—ñ–π–Ω–æ –ø–∏—Å–∞—Ç–∏ –≤ APEX:

```sql
SELECT *
FROM v_outfit_pivot_base
WHERE 1=1
  AND (:P_MODAL_ORG IS NULL OR org = TO_NUMBER(:P_MODAL_ORG))
  AND (:P_MODAL_UNIT IS NULL OR unit = TO_NUMBER(:P_MODAL_UNIT))
  AND (:P_MODAL_DEPARTMENTS IS NULL 
       OR department IN (
           SELECT column_value FROM TABLE(split_string(:P_MODAL_DEPARTMENTS, ':'))
       )
      )
  AND (
    :P_MODAL_TIMEMODE = 'NOW' AND data_start <= SYSDATE
    OR :P_MODAL_TIMEMODE = 'DAY' AND data_start BETWEEN TRUNC(SYSDATE) AND SYSDATE
    OR :P_MODAL_TIMEMODE = 'SHIFT' AND data_start BETWEEN :P_SHIFT_START AND SYSDATE
  )
```

---

üîß –Ø–∫—â–æ —Ö–æ—á–µ—à –¥–æ–¥–∞—Ç–∏ –¥–æ view —â–µ –π –∑–≤–µ–¥–µ–Ω–∏–π —Ä—è–¥–æ–∫ "–£—Å—å–æ–≥–æ" (–∞–ª–µ –±–µ–∑ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É —Ñ—ñ–ª—å—Ç—Ä—ñ–≤) ‚Äî –¥–∞–π –∑–Ω–∞—Ç–∏, –∑—Ä–æ–±–ª—é –æ–∫—Ä–µ–º–∏–π –ø—ñ–¥—Ö—ñ–¥.