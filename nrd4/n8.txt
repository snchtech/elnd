–ó–∞—Ä–∞–∑ –ø–æ—è—Å–Ω—é –≤—Å–µ –∫—Ä–æ–∫ –∑–∞ –∫—Ä–æ–∫–æ–º, —è–∫ –ø—Ä–∞—Ü—é—î —Ü–µ–π —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –∑ –ø–µ—Ä–µ–¥–∞—á–µ—é –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ ‚Äî –æ—Å–æ–±–ª–∏–≤–æ —Ñ–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–µ–¥–∞—á—É **departments** —É —Ñ–æ—Ä–º–∞—Ç—ñ —á–µ–∫–±–æ–∫—Å—ñ–≤ üëç

---

## üîÅ –°—Ü–µ–Ω–∞—Ä—ñ–π: –∫–ª—ñ–∫–∞—î—à –Ω–∞ —Ü–∏—Ñ—Ä—É –≤ –∑–≤—ñ—Ç—ñ ‚Üí –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –∑ –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—î—é ‚Üí –¥–∞–Ω—ñ –∑–∞–ª–µ–∂–∞—Ç—å –≤—ñ–¥:
- –ß–∞—Å–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º—É (`NOW`, `DAY`, `SHIFT`)
- –í–∏–±—Ä–∞–Ω–æ–≥–æ unit
- –í–∏–±—Ä–∞–Ω–æ–≥–æ department (—ñ–∑ —á–µ–∫–±–æ–∫—Å–∞ `P1_DEPARTMENTS`)

---

## üì¶ 1. HTML/PLSQL: –ö–ª—ñ–∫–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –≤ `<td>`

```html
<td>
  <a href="javascript:void(0);" 
     onclick="openUnitModal('NOW', 0)">
     1
  </a>
</td>
```

üîπ –¶–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ HTML-—Ç–∞–±–ª–∏—Ü—ñ (–∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ—ó —É —Ñ—É–Ω–∫—Ü—ñ—ó `get_unit_matrix_html`)  
üîπ –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –≤–∏–∫–ª–∏–∫–∞—î JS-—Ñ—É–Ω–∫—Ü—ñ—é `openUnitModal(mode, unit)`  
‚Äî `mode` ‚Äî —Ü–µ `'NOW'`, `'DAY'`, `'SHIFT'`  
‚Äî `unit` ‚Äî —Ü–µ –Ω–æ–º–µ—Ä –±–ª–æ–∫—É: 0, 1 –∞–±–æ 2

---

## üß† 2. JS-—Ñ—É–Ω–∫—Ü—ñ—è `openUnitModal(...)`

```js
function openUnitModal(mode, unit) {
  apex.server.process("OPEN_MODAL", {
    x01: mode,                    // —á–∞—Å (NOW, DAY, SHIFT)
    x02: unit,                    // unit (0,1,2)
    x03: $v("P1_DEPARTMENTS")     // —Ä—è–¥–æ–∫ –∑—ñ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ —á–µ–∫–±–æ–∫—Å—ñ–≤: 1523:1257
  }, {
    success: function() {
      apex.navigation.dialog.open({
        pageId: "P_MODAL_UNIT_STATS",   // —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
        dialog: "modal",
        modal: true,
        reloadOnClose: true
      });
    }
  });
}
```

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:
- `apex.server.process(...)` –≤–∏–∫–ª–∏–∫–∞—î **AJAX Callback** –∑ —ñ–º‚Äô—è–º `OPEN_MODAL`
- –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ `x01`, `x02`, `x03` –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è —è–∫ –≥–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ `apex_application.g_x01` —ñ —Ç.–¥.
- –£ `x03` –º–∏ –ø–µ—Ä–µ–¥–∞—î–º–æ `P1_DEPARTMENTS`, —è–∫–∏–π —É —á–µ–∫–±–æ–∫—Å—ñ –∑–∞–∑–≤–∏—á–∞–π –º–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∏–ø—É `1523:1257:1488`

---

## üîÅ 3. `OPEN_MODAL` ‚Äî AJAX Callback (PL/SQL)

```plsql
:P_MODAL_TIME_MODE := apex_application.g_x01;
:P_MODAL_UNITS := apex_application.g_x02;
:P_MODAL_DEPARTMENTS := apex_application.g_x03;
```

üîπ –¢—É—Ç –º–∏ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–µ—Ä–µ–¥–∞–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è —É **–ø—É–±–ª—ñ—á–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞**  
üîπ –¶–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ, —â–æ–± –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –≤—ñ–∫–Ω–∞ –≤ –Ω–µ—ó –≤–∂–µ –±—É–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è.

---

## ü™ü 4. `apex.navigation.dialog.open(...)`

```js
apex.navigation.dialog.open({
  pageId: "P_MODAL_UNIT_STATS",
  dialog: "modal",
  modal: true,
  reloadOnClose: true
});
```

üîπ –í—ñ–¥–∫—Ä–∏–≤–∞—î APEX-—Å—Ç–æ—Ä—ñ–Ω–∫—É `P_MODAL_UNIT_STATS` —è–∫ **–º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ**  
üîπ –í–æ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –±–∞—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è:
- `:P_MODAL_TIME_MODE`
- `:P_MODAL_UNITS`
- `:P_MODAL_DEPARTMENTS`

—è–∫—ñ —Ç–∏ –ø–µ—Ä–µ–¥–∞–≤ —á–µ—Ä–µ–∑ `apex_application.g_x01-03` –≤ –ø—Ä–æ—Ü–µ—Å—ñ `OPEN_MODAL`.

---

## üß™ –ù–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –≤—ñ–∫–Ω–∞ (`P_MODAL_UNIT_STATS`):

–ú–æ–∂–µ—à –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ view —ñ–∑ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏:

```sql
SELECT *
FROM v_outfit_pivot_base
WHERE 1=1
  AND (:P_MODAL_UNITS IS NULL OR unit = TO_NUMBER(:P_MODAL_UNITS))
  AND (:P_MODAL_TIME_MODE = 'NOW' AND data_start <= SYSDATE
       OR :P_MODAL_TIME_MODE = 'DAY' AND data_start BETWEEN TRUNC(SYSDATE) AND SYSDATE
       OR :P_MODAL_TIME_MODE = 'SHIFT' AND data_start BETWEEN :P_SHIFT_START AND SYSDATE)
  AND (:P_MODAL_DEPARTMENTS IS NULL 
       OR department IN (
         SELECT column_value FROM TABLE(split_string(:P_MODAL_DEPARTMENTS, ':'))
       )
      )
```

---

## ‚ú® –ü—ñ–¥—Å—É–º–æ–∫:

| –ï—Ç–∞–ø                  | –û–ø–∏—Å                                                                 |
|------------------------|----------------------------------------------------------------------|
| `<a onclick=...>`      | –í–∏–∫–ª–∏–∫–∞—î —Ñ—É–Ω–∫—Ü—ñ—é JS `openUnitModal(...)` –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏               |
| `openUnitModal(...)`   | –í–∏–∫–ª–∏–∫–∞—î AJAX + –≤—ñ–¥–∫—Ä–∏–≤–∞—î –≤—ñ–∫–Ω–æ –∑ –ø–µ—Ä–µ–¥–∞–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏              |
| `OPEN_MODAL` –ø—Ä–æ—Ü–µ—Å    | –ó–±–µ—Ä—ñ–≥–∞—î `x01`, `x02`, `x03` —É –µ–ª–µ–º–µ–Ω—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞    |
| –í—ñ–∫–Ω–æ `P_MODAL_UNIT_STATS` | –û—Ç—Ä–∏–º—É—î –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —ñ –≤–∏–∫–æ–Ω—É—î SQL-—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é                        |

---

üîß –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ ‚Äî —è –º–æ–∂—É –Ω–∞–¥–∞—Ç–∏ —à–∞–±–ª–æ–Ω `get_unit_matrix_html` –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ `onclick` –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏ –π –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.