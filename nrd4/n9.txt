–ó–≤—ñ—Å–Ω–æ! üëá –î–∞–≤–∞–π —è **–¥–µ—Ç–∞–ª—å–Ω–æ —ñ –ø–æ–µ—Ç–∞–ø–Ω–æ –ø–æ—è—Å–Ω—é**, —â–æ —Å–∞–º–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –≤ Oracle APEX, —â–æ–± –ø—Ä–∞—Ü—é–≤–∞–≤ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –∑ –ø–µ—Ä–µ–¥–∞—áe—é –∑–Ω–∞—á–µ–Ω—å (—á–µ—Ä–µ–∑ `apex_application.g_x01`, `g_x02`, `g_x03`).

---

## üìå –°—É—Ç—å —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É

1. –£ —Ç–µ–±–µ —î –∑–≤—ñ—Ç –∞–±–æ HTML-–±–ª–æ–∫ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ç–∞–±–ª–∏—Ü—è), –¥–µ –∫–ª—ñ–∫–∞—î—à –Ω–∞ `<a>`  
2. –ö–ª—ñ–∫ –≤–∏–∫–ª–∏–∫–∞—î JS-—Ñ—É–Ω–∫—Ü—ñ—é `openUnitModal(...)`
3. –í–æ–Ω–∞ –≤–∏–∫–ª–∏–∫–∞—î AJAX-–ø—Ä–æ—Ü–µ—Å `OPEN_MODAL`, —è–∫–∏–π **–ø–µ—Ä–µ–¥–∞—î –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤ –µ–ª–µ–º–µ–Ω—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞**
4. –ü–æ—Ç—ñ–º –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ —è–∫ **–º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ**, —ñ —Ç–∞–º —É–∂–µ —î —Ü—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ APEX item'–∞—Ö

---

## ‚úÖ –ü—É–Ω–∫—Ç–∏, —è–∫—ñ —Ç—Ä–µ–±–∞ –∑—Ä–æ–±–∏—Ç–∏

---

### üî∏ **1. –°—Ç–≤–æ—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É**

1. **Create Page ‚Üí Modal Dialog ‚Üí Blank Page**
2. –ù–∞–∑–≤–∏ —ó—ó, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `Unit Modal`, —Å—Ç–æ—Ä—ñ–Ω–∫–∞ `P_MODAL_UNIT_STATS`
3. –°—Ç–≤–æ—Ä–∏ –Ω–∞ –Ω—ñ–π **—Ç—Ä–∏ APEX-–µ–ª–µ–º–µ–Ω—Ç–∏**:

| –Ü–º‚Äô—è –µ–ª–µ–º–µ–Ω—Ç–∞        | –¢–∏–ø     | –ö–æ–º–µ–Ω—Ç–∞—Ä                                 |
|----------------------|---------|-------------------------------------------|
| `P_MODAL_TIME_MODE`  | Hidden  | –î–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è `'NOW'`, `'DAY'`, `'SHIFT'` |
| `P_MODAL_UNITS`      | Hidden  | Unit (0, 1, 2)                             |
| `P_MODAL_DEPARTMENTS`| Hidden  | –ó–Ω–∞—á–µ–Ω–Ω—è –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ñ–≤ `1523:1257` —ñ —Ç.–¥. |

> ‚õ≥ **–í–∞–∂–ª–∏–≤–æ**: –≤—Å—ñ —Ü—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –Ω–∞ **–º–æ–¥–∞–ª—å–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ**, –Ω–µ –æ—Å–Ω–æ–≤–Ω—ñ–π.

---

### üî∏ **2. –°—Ç–≤–æ—Ä–∏—Ç–∏ AJAX Callback "OPEN_MODAL"**

1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ **—Å—Ç–æ—Ä—ñ–Ω–∫—É, –∑–≤—ñ–¥–∫–∏ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –≤—ñ–∫–Ω–æ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, P1)**  
2. –í **Processing ‚Üí Ajax Callback ‚Üí Create Process**  
3. –ù–∞–∑–≤–∏: `OPEN_MODAL`

–í—Å—Ç–∞–≤ –∫–æ–¥:

```plsql
:P_MODAL_TIME_MODE := apex_application.g_x01;
:P_MODAL_UNITS := apex_application.g_x02;
:P_MODAL_DEPARTMENTS := apex_application.g_x03;
```

> –¶–µ–π –∫–æ–¥ –∑–±–µ—Ä—ñ–≥–∞—î –ø–µ—Ä–µ–¥–∞–Ω—ñ —á–µ—Ä–µ–∑ JS –∑–Ω–∞—á–µ–Ω–Ω—è (–≤ `g_x01`, `g_x02`, `g_x03`) —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞.

> ‚ùó –£—Å—ñ —Ü—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –º–∞—é—Ç—å –±—É—Ç–∏ **–ø—É–±–ª—ñ—á–Ω–∏–º–∏** (—Ç–æ–±—Ç–æ –≤–∏–¥–∏–º–∏–º–∏ —á–µ—Ä–µ–∑ `:P_MODAL_...` —ñ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤)

---

### üî∏ **3. –î–æ–¥–∞—Ç–∏ JavaScript-—Ñ—É–Ω–∫—Ü—ñ—é openUnitModal**

–ù–∞ **—Å—Ç–æ—Ä—ñ–Ω–∫—É –∑ —Ç–∞–±–ª–∏—Ü–µ—é** (–¥–µ –±—É–¥–µ –∫–ª—ñ–∫), –¥–æ–¥–∞–π —É **Page ‚Üí Execute When Page Loads**:

```js
function openUnitModal(mode, unit) {
  apex.server.process("OPEN_MODAL", {
    x01: mode,                        // NOW / DAY / SHIFT
    x02: unit,                        // Unit –Ω–æ–º–µ—Ä
    x03: $v("P1_DEPARTMENTS")         // –ó–Ω–∞—á–µ–Ω–Ω—è —á–µ–∫–±–æ–∫—Å—ñ–≤ (—Ç–∏–ø—É '1523:1257')
  }, {
    success: function() {
      apex.navigation.dialog.open({
        pageId: "P_MODAL_UNIT_STATS",  // –Ω–æ–º–µ—Ä —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
        dialog: "modal",
        modal: true,
        reloadOnClose: true
      });
    }
  });
}
```

üîπ `$v("P1_DEPARTMENTS")` –±–µ—Ä–µ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ —á–µ–∫–±–æ–∫—Å–∞  
üîπ `apex.server.process(...)` –ø–µ—Ä–µ–¥–∞—î –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —á–µ—Ä–µ–∑ `x01`, `x02`, `x03`

---

### üî∏ **4. –í–∏–∫–ª–∏–∫–∞—Ç–∏ —Ü—é —Ñ—É–Ω–∫—Ü—ñ—é –≤ HTML (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —É —Ñ—É–Ω–∫—Ü—ñ—ó `get_unit_matrix_html`)**

–£ HTML —Ç–∞–±–ª–∏—Ü—ñ:

```plsql
RETURN '<a href="javascript:void(0);" onclick="openUnitModal(''NOW'', 0);">' || p_value || '</a>';
```

üü° –ü—ñ—Å–ª—è –∫–ª—ñ–∫—É –Ω–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è:
1. –ü–µ—Ä–µ–¥–∞—î—Ç—å—Å—è `'NOW'` —Ç–∞ `unit = 0`
2. –í–∏—Ç—è–≥—É—î—Ç—å—Å—è –ø–æ—Ç–æ—á–Ω–∏–π `P1_DEPARTMENTS`
3. –í—Å—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –∫–ª–∞–¥—É—Ç—å—Å—è —É Hidden Items –Ω–∞ –º–æ–¥–∞–ª—å–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
4. –í—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ `P_MODAL_UNIT_STATS`

---

## üí° –î–æ–¥–∞—Ç–∫–æ–≤–æ: —â–æ –º–æ–∂–Ω–∞ —Ä–æ–±–∏—Ç–∏ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ

–ù–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ `P_MODAL_UNIT_STATS`, —Ç–∏ –≤–∂–µ –º–∞—î—à:

```sql
:P_MODAL_TIME_MODE := 'NOW'
:P_MODAL_UNITS := 0
:P_MODAL_DEPARTMENTS := '1523:1257'
```

–Ü –º–æ–∂–µ—à –æ–¥—Ä–∞–∑—É –ø–∏—Å–∞—Ç–∏:

```sql
SELECT *
FROM v_outfit_pivot_base
WHERE unit = TO_NUMBER(:P_MODAL_UNITS)
  AND department IN (
    SELECT column_value FROM TABLE(split_string(:P_MODAL_DEPARTMENTS, ':'))
  )
  AND (
    :P_MODAL_TIME_MODE = 'NOW' AND data_start <= SYSDATE
    OR :P_MODAL_TIME_MODE = 'DAY' AND data_start BETWEEN TRUNC(SYSDATE) AND SYSDATE
    OR :P_MODAL_TIME_MODE = 'SHIFT' AND data_start BETWEEN :P_SHIFT_START AND SYSDATE
  )
```

---

## üîö –ü—ñ–¥—Å—É–º–æ–∫

| –ö—Ä–æ–∫ | –û–ø–∏—Å |
|------|------|
| 1Ô∏è‚É£ | –°—Ç–≤–æ—Ä—é—î—à –º–æ–¥–∞–ª—å–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É –∑ Hidden Items |
| 2Ô∏è‚É£ | –°—Ç–≤–æ—Ä—é—î—à AJAX Callback `OPEN_MODAL` –Ω–∞ –æ—Å–Ω–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ |
| 3Ô∏è‚É£ | –î–æ–¥–∞—î—à JavaScript —Ñ—É–Ω–∫—Ü—ñ—é `openUnitModal(...)` |
| 4Ô∏è‚É£ | –ö–ª—ñ–∫–∞—î—à –Ω–∞ `<a>` ‚Äî –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –∑ —É–∂–µ –ø–µ—Ä–µ–¥–∞–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ |

---

üîß –•–æ—á–µ—à ‚Äî —è –º–æ–∂—É –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –¥–µ–º–æ-–ø—Ä–æ–µ–∫—Ç APEX –¥–ª—è —Ü—å–æ–≥–æ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É –∞–±–æ –¥–æ–ø–æ–º–æ–≥—Ç–∏ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ `P_SHIFT_START` –¥–∏–Ω–∞–º—ñ—á–Ω–æ.