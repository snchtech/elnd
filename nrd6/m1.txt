–¢–∞–∫, –¥—É–∂–µ –¥–æ–±—Ä–µ, —â–æ —Ç–∏ –ø–æ–º—ñ—Ç–∏–≤ —Ü—ñ –Ω—é–∞–Ω—Å–∏. –†–æ–∑–±–µ—Ä–µ–º–æ –æ–±–∏–¥–≤–∞ –ø—É–Ω–∫—Ç–∏:

---

## ‚úÖ **1. –£–º–æ–≤–∞ `AND department MEMBER OF v_departments_tbl` –¥–ª—è –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤**

–¢–∏ –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–π. –Ø–∫—â–æ **–ø—ñ–¥—Ä—è–¥–Ω–∏–∫–∏ (`org = 1`) –Ω–µ –º–∞—é—Ç—å `department`**, –∞–±–æ —è–∫—â–æ `department` –¥–ª—è –Ω–∏—Ö –Ω–µ —î –≤–∞–∂–ª–∏–≤–∏–º –∫—Ä–∏—Ç–µ—Ä—ñ—î–º —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó ‚Äî —Ç–æ–¥—ñ —Ü—é —É–º–æ–≤—É —Ç—Ä–µ–±–∞ –∑–∞–±—Ä–∞—Ç–∏ **—Ç—ñ–ª—å–∫–∏ –¥–ª—è –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤**.

### üîß –†—ñ—à–µ–Ω–Ω—è:
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `CASE` –≤ `WHERE` –∞–±–æ –¥–æ–¥–∞—î–º–æ –¥–æ–¥–∞—Ç–∫–æ–≤—É —É–º–æ–≤—É:
```sql
AND (
  org = 0 AND department MEMBER OF v_departments_tbl
  OR org = 1
)
```
–ê–ª–µ —Ç–∞–∫ —è–∫ —Ç–∏ –≤–∂–µ —Ä–æ–∑–¥—ñ–ª—è—î—à —Ñ—ñ—Ä–º—É –π –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤ –ø–æ —Ä—ñ–∑–Ω–∏—Ö `SELECT`, –∫—Ä–∞—â–µ **–ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–±—Ä–∞—Ç–∏** —Ü—é —É–º–æ–≤—É –∑ `SELECT`-—ñ–≤ –¥–ª—è `org = 1` ‚Äî **—â–æ —Ç–∏ –≤–∂–µ –π –Ω–∞–ø–∏—Å–∞–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ**.

---

## ‚úÖ **2. –£–º–æ–≤–∞ `AND (v_end IS NULL OR data_start BETWEEN v_start AND v_end)`**

–¢—É—Ç —Å–ø—Ä–∞–≤–¥—ñ —î **–ª–æ–≥—ñ—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞**. –£ –≤–∏–ø–∞–¥–∫—É, –∫–æ–ª–∏ `v_end IS NULL`, **—Ü—è —É–º–æ–≤–∞ –∑–∞–≤–∂–¥–∏ TRUE**, —Ç–æ–º—É —â–æ:
```sql
NULL IS NULL ‚Üí TRUE
```
–ê–ª–µ —Ü–µ **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ**, –±–æ —Ç–∏ —Ö–æ—á–µ—à **–≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Å–∏, —è–∫—ñ –ø—Ä–∏–ø–∞–¥–∞—é—Ç—å –Ω–∞ —á–∞—Å–æ–≤–∏–π –ø—Ä–æ–º—ñ–∂–æ–∫ `v_start` ‚Äì `v_end`**. –Ü —è–∫—â–æ `v_end IS NULL`, —Ç–æ —Ü–µ –≤–∏–≥–ª—è–¥–∞—î —è–∫ ¬´–±–µ–∑ –æ–±–º–µ–∂–µ–Ω–Ω—è¬ª, —â–æ **–≤–∫–ª—é—á–∞—î –≤—Å—ñ –∑–∞–ø–∏—Å–∏**.

---

### üîç –©–æ –º–∞—î –±—É—Ç–∏?

–ü—Ä–∞–≤–∏–ª—å–Ω–∞ –ª–æ–≥—ñ–∫–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –ø–æ —á–∞—Å—É:
```sql
AND (
  v_end IS NOT NULL AND data_start BETWEEN v_start AND v_end
  OR v_end IS NULL AND data_start >= v_start
)
```

–ê–ª–µ –∫—Ä–∞—â–µ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ –¥–ª—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ —Ç–∞–∫:

```sql
AND (
  (v_end IS NOT NULL AND data_start BETWEEN v_start AND v_end)
  OR (v_end IS NULL AND data_start >= v_start)
)
```

> üî∏ –¶–µ –∑–∞–±–µ–∑–ø–µ—á—É—î:
- –Ø–∫—â–æ `v_end` –∑–∞–¥–∞–Ω–æ ‚Äî –±–µ—Ä–µ–º–æ –º—ñ–∂ `start` —ñ `end`.
- –Ø–∫—â–æ `v_end` = NULL ‚Äî –±–µ—Ä–µ–º–æ –≤—Å—ñ –ø—ñ—Å–ª—è `v_start`.

---

## ‚úÖ –ü—ñ–¥—Å—É–º–æ–∫ ‚Äî —è–∫ **–≤–∏–ø—Ä–∞–≤–∏—Ç–∏** –≤ —Ñ—É–Ω–∫—Ü—ñ—ó:

### ‚úÖ –î–ª—è **—Ñ—ñ—Ä–º–∏** (`org = 0`):
```sql
AND department MEMBER OF v_departments_tbl
AND (
  (v_end IS NOT NULL AND data_start BETWEEN v_start AND v_end)
  OR (v_end IS NULL AND data_start >= v_start)
)
```

### ‚úÖ –î–ª—è **–ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤** (`org = 1`):
```sql
AND (
  (v_end IS NOT NULL AND data_start BETWEEN v_start AND v_end)
  OR (v_end IS NULL AND data_start >= v_start)
)
```

---

## üîÅ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è

–©–æ–± —É–Ω–∏–∫–∞—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –∫–æ–¥—É, –º–æ–∂–Ω–∞ –±—É–ª–æ –±–∏ –∑—Ä–æ–±–∏—Ç–∏ `FOR rec_org IN 0..1 LOOP` —ñ –æ–±'—î–¥–Ω–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –≤ –æ–¥–Ω—É —á–∞—Å—Ç–∏–Ω—É, –∞–ª–µ —è–∫—â–æ —Ç–æ–±—ñ —Ç–∞–∫ –∑—Ä—É—á–Ω—ñ—à–µ ‚Äî –∫—Ä–∞—â–µ –ø—Ä–æ—Å—Ç–æ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ —É–º–æ–≤–∏, —è–∫ –æ–ø–∏—Å–∞–Ω–æ –≤–∏—â–µ.

–•–æ—á–µ—à ‚Äî –º–æ–∂—É –ø–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—É –≤–µ—Ä—Å—ñ—é —Ç–≤–æ—î—ó —Ñ—É–Ω–∫—Ü—ñ—ó.