–î–æ–±—Ä–µ! –¢–≤–æ—è —ñ–¥–µ—è –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º SQL-–∑–∞–ø–∏—Ç—É –Ω–∞–ø—Ä—è–º—É –Ω–∞ `your_view` ‚Äî –ø–æ–≤–Ω—ñ—Å—Ç—é –ø—Ä–∞–≤–∏–ª—å–Ω–∞ —ñ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è WebSocket –ª–æ–≥—ñ–∫–∏ –Ω–∞ Oracle 10g. –ù–∏–∂—á–µ –Ω–∞–¥–∞–º –æ–Ω–æ–≤–ª–µ–Ω—É –≤–µ—Ä—Å—ñ—é SQL + –ø–æ—è—Å–Ω–µ–Ω–Ω—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø—É–Ω–∫—Ç—É.

---

## üîß –û–Ω–æ–≤–ª–µ–Ω–∏–π SQL (–±–µ–∑ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –ø–æ –¥–∞—Ç–∞—Ö, –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é –ø–æ—Ä–æ–∂–Ω—å–æ–≥–æ `:p_departments`):

```sql
SELECT
  COUNT(CASE WHEN org = 0 THEN 1 END) AS firm_brigades,
  COUNT(CASE WHEN org = 1 THEN 1 END) AS contractor_brigades,
  SUM(CASE WHEN org = 0 THEN team_count ELSE 0 END) AS firm_people,
  SUM(CASE WHEN org = 1 THEN team_count ELSE 0 END) AS contractor_people
FROM your_view
WHERE unit = :p_unit
  AND outfit_open = 6
  AND (
    :p_departments IS NULL 
    OR department IN (
        SELECT column_value FROM TABLE(split_string(:p_departments, ':'))
    )
  )
```

---

## ‚úÖ –ü–æ—è—Å–Ω–µ–Ω–Ω—è –¥–æ —Ç–≤–æ—ó—Ö –ø—É–Ω–∫—Ç—ñ–≤

### 1. **`p_date_start` —Ç–∞ `p_date_end` ‚Äî –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ**  
üî∏ –Ø–∫—â–æ —Ç–∏ –≤–∏–∫–ª—é—á–∞—î—à —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é –ø–æ —á–∞—Å—É ‚Äî –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–±–µ—Ä–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –±–ª–æ–∫, —è–∫ —É –∑–∞–ø–∏—Ç—ñ –≤–∏—â–µ. –ù–µ–º–∞—î –∂–æ–¥–Ω–æ–≥–æ –ø–æ–±—ñ—á–Ω–æ–≥–æ –µ—Ñ–µ–∫—Ç—É.

---

### 2. **`p_unit` ‚Äî –∑–∞–¥–∞—î—Ç—å—Å—è –≤—Ä—É—á–Ω—É**
üî∏ –í—Å–µ —á—É–¥–æ–≤–æ: –≤–∏–∫–ª–∏–∫–∞—î—à —Ç—Ä–∏ –∑–∞–ø–∏—Ç–∏:
```js
const result1 = await executeSQL({ p_unit: 0, p_departments: '1257:1523' });
const result2 = await executeSQL({ p_unit: 1, p_departments: '1257:1523' });
const result3 = await executeSQL({ p_unit: 2, p_departments: '1257:1523' });
```

---

### 3. **`p_departments` ‚Äî –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –∑ JS**

#### –Ø–∫ –ø–µ—Ä–µ–¥–∞—Ç–∏:

–ó JavaScript:
```js
const p_departments = "1257:1523"; // –∞–±–æ "" —è–∫—â–æ –≤—Å—ñ
```

–£ Node.js (oracledb):
```js
const binds = {
  p_unit: 1, // –∞–±–æ 0 / 2
  p_departments: departments.length > 0 ? departments : null // —è–∫—â–æ –ø—É—Å—Ç–∞ —Å—Ç—Ä–æ–∫–∞ ‚Äî —Å—Ç–∞–≤–∏–º–æ NULL
};

const result = await connection.execute(sqlQuery, binds, { outFormat: oracledb.OUT_FORMAT_OBJECT });
```

üîπ **–í–∞–∂–ª–∏–≤–æ:** —è–∫—â–æ `p_departments = NULL`, —Ç–æ –≤ SQL –≤—ñ–¥–ø—Ä–∞—Ü—é—î –æ—Å—å —Ü—è —á–∞—Å—Ç–∏–Ω–∞:
```sql
:p_departments IS NULL 
```
—ñ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è.

#### üëâ –û—Ç–∂–µ, –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –≤ Node.js:
```js
p_departments: rawDepartmentsString || null
```

---

## ‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (Node.js –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ):

–Ø–∫—â–æ —Ö–æ—á–µ—à –±—É—Ç–∏ –≤–ø–µ–≤–Ω–µ–Ω–∏–º, —â–æ –ø–æ—Ä–æ–∂–Ω—ñ–π —Ä—è–¥–æ–∫ –Ω–µ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ `IN ('')`, –∞ —Å–∞–º–µ –¥–æ **NULL**, —Ç–æ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏:
```js
const parsedDeps = rawDepartmentsString?.trim();
const p_departments = parsedDeps === "" ? null : parsedDeps;
```

---

## üß™ –¢–µ—Å—Ç:
SQL –≤—ñ–¥–ø—Ä–∞—Ü—å–æ–≤—É—î —Ç–∞–∫:
| `p_departments`       | –©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è                          |
|------------------------|------------------------------------------|
| `'1257:1523'`          | `department IN ('1257', '1523')`         |
| `NULL` –∞–±–æ `''`        | –≤–µ—Å—å —Ñ—ñ–ª—å—Ç—Ä —ñ–≥–Ω–æ—Ä—É—î—Ç—å—Å—è                  |

---

## üîö –ü—ñ–¥—Å—É–º–æ–∫

- ‚úÖ SQL –ø–æ–≤–Ω—ñ—Å—Ç—é –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π —ñ –ø—Ä–æ—Å—Ç–∏–π.
- ‚úÖ –õ–æ–≥—ñ–∫—É –ø–æ –¥–∞—Ç–∞—Ö —Ç–∏ –ø—Ä–∏–±—Ä–∞–≤ ‚Äî —Ü–µ —Å–ø—Ä–æ—Å—Ç–∏–ª–æ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è.
- ‚úÖ `p_unit` –∑–∞–¥–∞—î—Ç—å—Å—è —è–≤–Ω–æ, –æ–¥–∏–Ω –∑–∞–ø–∏—Ç = –æ–¥–∏–Ω unit.
- ‚úÖ `p_departments` –∫—Ä–∞—â–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ —è–∫ `null`, —è–∫—â–æ –Ω–µ –∑–∞–¥–∞–Ω–æ ‚Äî —Ç–æ–¥—ñ —Ñ—ñ–ª—å—Ç—Ä –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è.

–ì–æ—Ç–æ–≤–∏–π –¥–æ–ø–æ–º–æ–≥—Ç–∏ —Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥ Node.js –∫–æ–¥—É, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ.