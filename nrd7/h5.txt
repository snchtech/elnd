–û—Å—å –∞–¥–∞–ø—Ç–æ–≤–∞–Ω–∏–π `SELECT`-–∑–∞–ø–∏—Ç –¥–ª—è WebSocket-—Å—Ü–µ–Ω–∞—Ä—ñ—é, —è–∫–∏–π –ø–æ–≤–µ—Ä—Ç–∞—î –∞–≥—Ä–µ–≥–æ–≤–∞–Ω—ñ **–±—Ä—ñ–≥–∞–¥–∏ —Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª** –ø–æ `unit`, –≤—Ä–∞—Ö–æ–≤—É—é—á–∏ —Å—Ç–∞—Ç—É—Å 6 –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º `status_start_date` / `status_end_date`.

---

### ‚úÖ WebSocket-friendly SQL-–∑–∞–ø–∏—Ç (–±–µ–∑ —Ñ—É–Ω–∫—Ü—ñ—ó):

```sql
SELECT
  unit,
  COUNT(CASE WHEN org = 0 THEN 1 END) AS firm_brigades,
  COUNT(CASE WHEN org = 1 THEN 1 END) AS contractor_brigades,
  SUM(CASE WHEN org = 0 THEN team_count ELSE 0 END) AS firm_people,
  SUM(CASE WHEN org = 1 THEN team_count ELSE 0 END) AS contractor_people
FROM your_view
WHERE outfit_open = 6
  AND unit = :p_unit
  AND (
    :p_departments IS NULL 
    OR department IN (
      SELECT column_value FROM TABLE(split_string(:p_departments, ':'))
    )
  )
  AND (
    -- –ß–∞—Å–æ–≤–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –ø–µ—Ä–µ–¥–∞–Ω–æ
    (
      :p_date_start IS NOT NULL OR :p_date_end IS NOT NULL
    AND
      (
        status_start_date < NVL(:p_date_end, SYSDATE)
        AND (status_end_date IS NULL OR NVL(:p_date_start, TO_DATE('1900','YYYY')) < status_end_date)
      )
    )
    -- –ß–∞—Å–æ–≤–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ ‚Äî –ø–æ—Ç–æ—á–Ω—ñ –≤—ñ–¥–∫—Ä–∏—Ç—ñ
    OR (
      :p_date_start IS NULL AND :p_date_end IS NULL
      AND status_start_date < SYSDATE
      AND status_end_date IS NULL
    )
  )
GROUP BY unit;
```

---

### üì• –ü–∞—Ä–∞–º–µ—Ç—Ä–∏, —è–∫—ñ —Ç–∏ –º–∞—î—à –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –∑ WebSocket:

| –ù–∞–∑–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ | –ü—Ä–∏–∫–ª–∞–¥ | –ü—Ä–∏–º—ñ—Ç–∫–∞ |
|-----------------|---------|----------|
| `:p_unit`       | `0`, `1`, `2` | –ü–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –∑–∞–ø–∏—Ç —Ç—Ä–∏—á—ñ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ unit |
| `:p_departments`| `'1257:1523'` | –ú–æ–∂–µ –±—É—Ç–∏ NULL |
| `:p_date_start` | NULL –∞–±–æ `TO_DATE('2024-04-13 06:00', 'YYYY-MM-DD HH24:MI')` | –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Ä–µ–∂–∏–º—É |
| `:p_date_end`   | NULL –∞–±–æ `SYSDATE` | –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Ä–µ–∂–∏–º—É |

---

### üì§ –§–æ—Ä–º–∞—Ç –æ—á—ñ–∫—É–≤–∞–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É (–æ–¥–∏–Ω —Ä—è–¥–æ–∫ –Ω–∞ `unit`):

```json
{
  "unit": 0,
  "firm_brigades": 3,
  "contractor_brigades": 2,
  "firm_people": 15,
  "contractor_people": 8
}
```

---

### üß† –ü—Ä–∏–º—ñ—Ç–∫–∏:

- –ú–æ–∂–µ—à –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ `bindParams` —É `oracledb.execute(...)` –Ω–∞ Node.js –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –ø—ñ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –∑–Ω–∞—á–µ–Ω—å.
- –Ø–∫—â–æ —Ö–æ—á–µ—à –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –æ–¥—Ä–∞–∑—É –ø–æ **–≤—Å—ñ—Ö unit**, –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–±–µ—Ä–∏ `AND unit = :p_unit` —ñ `GROUP BY unit`.

–•–æ—á–µ—à, —è –≤—ñ–¥—Ä–∞–∑—É –ø–æ–∫–∞–∂—É –∑–∞–ø–∏—Ç, —è–∫–∏–π –ø–æ–≤–µ—Ä—Ç–∞—î –≤—Å—ñ 3 `unit` —É –≤–∏–≥–ª—è–¥—ñ –º–∞—Å–∏–≤—É ‚Äî —è–∫ `unit1`, `unit2`, `unit3` —É —Ç–≤–æ—î–º—É `dataOutfit`?