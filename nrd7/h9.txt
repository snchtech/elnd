–¢–∞–∫, –≤–∏ –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥—É–º–∞—î—Ç–µ: —Ç–∞–∫–∏–π SQL-–∑–∞–ø–∏—Ç –º–æ–∂–Ω–∞ **–æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏**, —ñ —Å–ø—Ä–∞–≤–¥—ñ –∫—Ä–∞—â–µ **–≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ `WITH` (common table expression)**, —â–æ–±:

1. –ó–º–µ–Ω—à–∏—Ç–∏ **–ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏** (`outfit_open = 6`, `status_start_date < SYSDATE`).
2. –ü–æ–∫—Ä–∞—â–∏—Ç–∏ **—á–∏—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å**.
3. –£ –¥–µ—è–∫–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö ‚Äì —Ç—Ä–æ—Ö–∏ –ø—Ä–∏—à–≤–∏–¥—à–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, —è–∫—â–æ Oracle –æ–ø—Ç–∏–º—ñ–∑–∞—Ç–æ—Ä –∫—Ä–∞—â–µ –∑–º–æ–∂–µ —Ä–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏ –∑–∞–≥–∞–ª—å–Ω—ñ —É–º–æ–≤–∏.

---

### ‚úÖ –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç —ñ–∑ `WITH`

```sql
WITH filtered_data AS (
  SELECT department
  FROM TEST_OUTFIT_DATA
  WHERE outfit_open = 6
    AND status_start_date < SYSDATE
    AND department IS NOT NULL
)
SELECT DISTINCT department AS display_value, department AS return_value
FROM (
  SELECT department FROM filtered_data
  WHERE status_end_date IS NULL

  UNION

  SELECT department FROM filtered_data
  WHERE status_end_date IS NULL OR status_end_date >= TRUNC(SYSDATE)

  UNION

  SELECT department FROM filtered_data
  WHERE status_end_date IS NULL OR status_end_date >= :P_SHIFT_START
)
ORDER BY department
```

---

### üß† –©–µ –∫—Ä–∞—â–µ: **–∑–∞–º—ñ—Å—Ç—å `UNION` ‚Üí `UNION ALL` + `DISTINCT`**
Oracle –Ω–µ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –æ–ø—Ç–∏–º—ñ–∑—É—î `UNION`, —Ç–æ–º—É –∑–∞–º—ñ–Ω–∞ –Ω–∞ `UNION ALL` —ñ–∑ `DISTINCT` –Ω–∞ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–º—É —Ä—ñ–≤–Ω—ñ –º–æ–∂–µ –±—É—Ç–∏ **–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—à–æ—é**, –æ—Å–æ–±–ª–∏–≤–æ —è–∫—â–æ `department` –≤–∂–µ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ.

```sql
WITH filtered_data AS (
  SELECT department, status_end_date
  FROM TEST_OUTFIT_DATA
  WHERE outfit_open = 6
    AND status_start_date < SYSDATE
    AND department IS NOT NULL
)
SELECT DISTINCT department AS display_value, department AS return_value
FROM (
  SELECT department FROM filtered_data WHERE status_end_date IS NULL
  UNION ALL
  SELECT department FROM filtered_data WHERE status_end_date IS NULL OR status_end_date >= TRUNC(SYSDATE)
  UNION ALL
  SELECT department FROM filtered_data WHERE status_end_date IS NULL OR status_end_date >= :P_SHIFT_START
)
ORDER BY department
```

---

### üß™ –ü–æ—è—Å–Ω–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ:
- `UNION` –≤–∏–∫–æ–Ω—É—î **—Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ —É—Å—É–Ω–µ–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤** ‚Äî —Ü–µ –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ.
- `UNION ALL` —à–≤–∏–¥—à–µ, –±–æ **–Ω–µ –ø—Ä–∏–±–∏—Ä–∞—î –¥—É–±–ª—ñ–∫–∞—Ç–∏** ‚Äî –º–∏ —Ü–µ —Ä–æ–±–∏–º–æ –æ–¥–∏–Ω —Ä–∞–∑ —á–µ—Ä–µ–∑ `DISTINCT` –Ω–∞ —Ä—ñ–≤–Ω—ñ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ –∑–∞–ø–∏—Ç—É.

---

### ‚úÖ –î–æ–¥–∞—Ç–∫–æ–≤–æ:
- –Ø–∫—â–æ `TEST_OUTFIT_DATA` ‚Äî —Ü–µ `VIEW`, –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ **–º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π view** –¥–ª—è `status_start_date < SYSDATE AND outfit_open = 6` —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ó—ó –≤ —Ü—å–æ–º—É –∑–∞–ø–∏—Ç—ñ.
- –Ø–∫—â–æ —î —ñ–Ω–¥–µ–∫—Å –ø–æ `(status_start_date, status_end_date, outfit_open, department)`, —Ü–µ —Ç–µ–∂ –∑–Ω–∞—á–Ω–æ –ø—Ä–∏—Å–∫–æ—Ä–∏—Ç—å –∑–∞–ø–∏—Ç.

---

üîö **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:**  
–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –æ—Å—Ç–∞–Ω–Ω—ñ–π –≤–∞—Ä—ñ–∞–Ω—Ç –∑ `UNION ALL` + `DISTINCT`, —ñ –≤–∏–Ω–µ—Å—ñ—Ç—å `status_start_date < SYSDATE AND outfit_open = 6` —É `WITH filtered_data`. –¶–µ –¥–∞—Å—Ç—å —è–∫ —á–∏—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å, —Ç–∞–∫ —ñ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å.