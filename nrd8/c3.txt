–î—É–∂–µ –≤–ª—É—á–Ω–µ –∑–∞—É–≤–∞–∂–µ–Ω–Ω—è ‚Äî —Å–ø—Ä–∞–≤–¥—ñ, —è–∫—â–æ —Ç–∏ –≤–∏–Ω–µ—Å–µ—à `unit` —É `agg_data`, –∞ –¥–∞–ª—ñ –∑—Ä–æ–±–∏—à **–∞–≥—Ä–µ–≥–∞—Ü—ñ—é –±–µ–∑ `GROUP BY unit`** —É —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É `SELECT`, —Ç–æ –Ω–∞ —Ä—ñ–≤–Ω—ñ APEX –≤–∂–µ **–Ω–µ –∑–º–æ–∂–µ—à** —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –ø–æ `unit`, –±–æ —Ü—å–æ–≥–æ –ø–æ–ª—è –ø—Ä–æ—Å—Ç–æ –Ω–µ –±—É–¥–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ view.

---

### ‚úÖ –í–∏—Å–Ω–æ–≤–æ–∫:

–©–æ–± **–º–æ–∂–Ω–∞ –±—É–ª–æ —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –ø–æ `unit` —É APEX**, –ø–æ–ª–µ `unit` **–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ —É —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É SELECT** –±–µ–∑ –∞–≥—Ä–µ–≥—É–≤–∞–Ω–Ω—è –ø–æ –Ω—å–æ–º—É. –û—Ç–∂–µ:

üîÅ –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ `unit` –Ω–∞–∑–∞–¥ —É `GROUP BY` —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ select.

---

### üîÑ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–∞ `view` –∑ `unit` —É —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É SELECT:

```sql
CREATE OR REPLACE FORCE VIEW v_outfit_pivot_base AS
WITH base_data AS (
  SELECT 
    id_outfit,
    org,
    org_txt,
    department,
    unit,
    team_count,
    data_start,
    status_start_date,
    status_end_date
  FROM TEST_OUTFIT_DATA
  WHERE outfit_open = 6
),
agg_data AS (
  SELECT
    CASE WHEN org = 0 THEN department ELSE org_txt END AS group_name,
    org,
    department,
    unit,
    data_start,
    status_start_date,
    status_end_date,
    COUNT(DISTINCT id_outfit) AS brigades,
    SUM(team_count) AS people
  FROM base_data
  GROUP BY
    CASE WHEN org = 0 THEN department ELSE org_txt END,
    org,
    department,
    unit,
    data_start,
    status_start_date,
    status_end_date
)
SELECT
  group_name,
  org,
  unit,
  department,
  data_start,
  status_start_date,
  status_end_date,
  -- –∑–Ω–∞—á–µ–Ω–Ω—è –ª–∏—à–µ –ø–æ –æ–¥–Ω–æ–º—É unit (–±–æ –º–∏ –≤–∂–µ –ø–æ –Ω—å–æ–º—É –≥—Ä—É–ø—É–≤–∞–ª–∏)
  NVL(SUM(CASE WHEN unit = 0 THEN people END), 0) AS u1_people,
  NVL(SUM(CASE WHEN unit = 0 THEN brigades END), 0) AS u1_brigades,
  NVL(SUM(CASE WHEN unit = 1 THEN people END), 0) AS u2_people,
  NVL(SUM(CASE WHEN unit = 1 THEN brigades END), 0) AS u2_brigades,
  NVL(SUM(CASE WHEN unit = 2 THEN people END), 0) AS u3_people,
  NVL(SUM(CASE WHEN unit = 2 THEN brigades END), 0) AS u3_brigades,
  SUM(people) AS total_people,
  SUM(brigades) AS total_brigades
FROM agg_data
GROUP BY
  group_name,
  org,
  unit,
  department,
  data_start,
  status_start_date,
  status_end_date;
```

---

### ‚úÖ –£ —Ç–≤–æ—î–º—É APEX-–∑–∞–ø–∏—Ç—ñ:

```sql
AND (:P_MODAL_UNIT IS NULL OR unit = TO_NUMBER(:P_MODAL_UNIT))
```

–±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∫–æ—Ä–µ–∫—Ç–Ω–æ, –±–æ `unit` –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –Ω–∞ —Ä—ñ–≤–Ω—ñ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.

---

üîî –Ø–∫—â–æ –∂ —Ç–∏ –∫–æ–ª–∏—Å—å –∑–∞—Ö–æ—á–µ—à –∑—Ä–æ–±–∏—Ç–∏ **—Å–ø—Ä–∞–≤–∂–Ω—ñ–π pivot**, —â–æ–± –æ–¥–∏–Ω —Ä—è–¥–æ–∫ –º–∞–≤ –æ–¥—Ä–∞–∑—É `unit1`, `unit2`, `unit3` –≤ –æ–¥–Ω–æ–º—É –∑–∞–ø–∏—Å—ñ ‚Äî —Ç–æ–¥—ñ `unit` –Ω–µ –º–æ–∂–Ω–∞ –≤–∫–ª—é—á–∞—Ç–∏ —É `GROUP BY`, —ñ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ –Ω–∏–º –º–∞—î –≤—ñ–¥–±—É–≤–∞—Ç–∏—Å—å **–Ω–∞ —Ä—ñ–≤–Ω—ñ –ø—ñ–¥–∑–∞–ø–∏—Ç—É –∞–±–æ –≤ WITH**.

–•–æ—á–µ—à —è –ø–æ–∫–∞–∂—É –æ–±–∏–¥–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –≤ –¥—ñ—ó (pivot vs per-unit-row)?