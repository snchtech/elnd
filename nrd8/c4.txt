–û—Å—å –ø—Ä–∏–∫–ª–∞–¥ SQL-–∫–æ–¥—É –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è `VIEW v_outfit_summary_pivot`, —è–∫–∞ –∞–≥—Ä–µ–≥—É—î –¥–∞–Ω—ñ –ø–æ `group_name` (–ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∏ —Ç–∞ –ø—ñ–¥—Ä—è–¥–Ω–∏–∫–∏) –∑ —Ä–æ–∑–±–∏—Ç—Ç—è–º –ø–æ `unit`:

```sql
CREATE OR REPLACE VIEW v_outfit_summary_pivot AS
WITH base_data AS (
  SELECT 
    id_outfit,
    org,
    org_txt,
    department,
    unit,
    team_count,
    status_start_date,
    status_end_date,
    CASE WHEN org = 0 THEN TO_CHAR(department) ELSE org_txt END AS group_name
  FROM TEST_OUTFIT_DATA
  WHERE outfit_open = 6
),
agg_data AS (
  SELECT
    group_name,
    org,
    unit,
    COUNT(id_outfit) AS brigades,
    SUM(team_count) AS people
  FROM base_data
  GROUP BY group_name, org, unit
)
SELECT
  group_name,
  org,
  NVL(SUM(CASE WHEN unit = 0 THEN people END), 0) AS u1_people,
  NVL(SUM(CASE WHEN unit = 0 THEN brigades END), 0) AS u1_brigades,
  NVL(SUM(CASE WHEN unit = 1 THEN people END), 0) AS u2_people,
  NVL(SUM(CASE WHEN unit = 1 THEN brigades END), 0) AS u2_brigades,
  NVL(SUM(CASE WHEN unit = 2 THEN people END), 0) AS u3_people,
  NVL(SUM(CASE WHEN unit = 2 THEN brigades END), 0) AS u3_brigades,
  SUM(people) AS total_people,
  SUM(brigades) AS total_brigades
FROM agg_data
GROUP BY group_name, org;
```

---

### üìå –ü–æ—è—Å–Ω–µ–Ω–Ω—è:

- `base_data`: –≤–∏–±–∏—Ä–∞—î –≤—Å—ñ outfit, —è–∫—ñ –≤—ñ–¥–∫—Ä–∏—Ç—ñ (`outfit_open = 6`), —ñ —Å—Ç–≤–æ—Ä—é—î –ª–æ–≥—ñ—á–Ω–µ –ø–æ–ª–µ `group_name`:
  - –Ø–∫—â–æ —Ü–µ **—Ñ—ñ—Ä–º–∞** (`org = 0`), —Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `department`
  - –Ø–∫—â–æ —Ü–µ **–ø—ñ–¥—Ä—è–¥–Ω–∏–∫** (`org = 1`), —Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `org_txt`
- `agg_data`: –ø—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ outfit —ñ —Å—É–º–∏ `team_count` –ø–æ `group_name`, `org` —Ç–∞ `unit`
- –§—ñ–Ω–∞–ª—å–Ω–∏–π select: —Ä–æ–±–∏—Ç—å pivot (—Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è) –ø–æ unit —ñ –æ–±—á–∏—Å–ª—é—î –ø—ñ–¥—Å—É–º–∫–∏

---

### üß© –©–æ –¥–∞–ª—ñ?

–ù–∞ –æ—Å–Ω–æ–≤—ñ —Ü—ñ—î—ó view:
- –ú–æ–∂–Ω–∞ —Ä–æ–±–∏—Ç–∏ –ø—Ä–æ—Å—Ç—É `SELECT * FROM v_outfit_summary_pivot`
- –£ APEX –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —É–º–æ–≤–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –ø–æ `org`, `group_name`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

```sql
WHERE (:P_MODAL_ORG IS NULL OR org = TO_NUMBER(:P_MODAL_ORG))
```

–•–æ—á–µ—à ‚Äî –º–æ–∂—É –æ–¥—Ä–∞–∑—É —Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ SQL –¥–ª—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó —Ü—ñ—î—ó view —É Classic Report –∑ —É–º–æ–≤–∞–º–∏ —á–∞—Å—É —Ç–∞ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—ñ–≤.