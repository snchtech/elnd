–¢–∞–∫, —Ç–∏ –º–æ–∂–µ—à –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ `department` —á–µ—Ä–µ–∑ —Ä–æ–∑–¥—ñ–ª—é–≤–∞—á (`:` –∞–±–æ `,`) –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ `org_txt` (—Ç–æ–±—Ç–æ –¥–ª—è `org != 0`), –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `LISTAGG()` —É –ø—ñ–¥–∑–∞–ø–∏—Ç—ñ. –¶–µ –¥–æ–∑–≤–æ–ª–∏—Ç—å —É–Ω–∏–∫–Ω—É—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è `org_txt` —É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –π –æ–±‚Äô—î–¥–Ω–∞—Ç–∏ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∏ –≤ –æ–¥–Ω–æ–º—É —Ä—è–¥–∫—É.

### üîß –Ø–∫ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ `group_name`:
- –î–ª—è `org = 0`: –∑–∞–ª–∏—à–∞—î–º–æ `department` —è–∫ —î.
- –î–ª—è `org != 0`: –æ—Ç—Ä–∏–º—É—î–º–æ `org_txt || ' (' || –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∏ —á–µ—Ä–µ–∑ `:` || ')'`

---

### ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–∞ `view` –∑ `LISTAGG`:

```sql
CREATE OR REPLACE FORCE EDITIONABLE VIEW V_OUTFIT_PIVOT_BASE AS
WITH base_data AS (
  SELECT 
    id_outfit,
    org,
    org_txt,
    department,
    unit,
    team_count,
    data_start,
    status_start_date,
    status_end_date
  FROM TEST_OUTFIT_DATA
  WHERE outfit_open = 6
),
-- –∑–≤–µ–¥–µ–Ω–Ω—è –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ñ–≤ –ø–æ org_txt (—Ç—ñ–ª—å–∫–∏ –¥–ª—è org != 0)
org_departments AS (
  SELECT
    org,
    org_txt,
    LISTAGG(DISTINCT department, ':') WITHIN GROUP (ORDER BY department) AS dep_list
  FROM base_data
  WHERE org != 0
  GROUP BY org, org_txt
),
agg_data AS (
  SELECT
    CASE 
      WHEN b.org = 0 THEN b.department
      ELSE d.org_txt || ' (' || d.dep_list || ')' 
    END AS group_name,
    b.org,
    b.unit,
    b.department,
    b.data_start,
    b.status_start_date,
    b.status_end_date,
    COUNT(b.id_outfit) AS brigades,
    SUM(b.team_count) AS people
  FROM base_data b
  LEFT JOIN org_departments d 
    ON b.org = d.org AND b.org_txt = d.org_txt
  GROUP BY
    CASE 
      WHEN b.org = 0 THEN b.department
      ELSE d.org_txt || ' (' || d.dep_list || ')' 
    END,
    b.org,
    b.unit,
    b.department,
    b.data_start,
    b.status_start_date,
    b.status_end_date
)
SELECT
  group_name,
  org,
  unit,
  department,
  data_start,
  status_start_date,
  status_end_date,
  NVL(SUM(CASE WHEN unit = 0 THEN people END), 0) AS u1_people,
  NVL(SUM(CASE WHEN unit = 0 THEN brigades END), 0) AS u1_brigades,
  NVL(SUM(CASE WHEN unit = 1 THEN people END), 0) AS u2_people,
  NVL(SUM(CASE WHEN unit = 1 THEN brigades END), 0) AS u2_brigades,
  NVL(SUM(CASE WHEN unit = 2 THEN people END), 0) AS u3_people,
  NVL(SUM(CASE WHEN unit = 2 THEN brigades END), 0) AS u3_brigades,
  SUM(people) AS total_people,
  SUM(brigades) AS total_brigades
FROM agg_data
GROUP BY
  group_name,
  org,
  unit,
  department,
  data_start,
  status_start_date,
  status_end_date;
```

---

### üü® –†–µ–∑—É–ª—å—Ç–∞—Ç:
- `group_name` –¥–ª—è `org = 0` = `department`
- `group_name` –¥–ª—è `org = 1` = `org_txt (1523:1540)` ‚Äî –¥–µ `1523`, `1540` —Ü–µ `department`'–∏

---

### ‚öô –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:
- `LISTAGG` –ø–æ `DISTINCT department` –∑ `GROUP BY org, org_txt` ‚Äî –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π –Ω–∞ —ñ–Ω–¥–µ–∫—Å–æ–≤–∞–Ω–∏—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö.
- –Ø–∫—â–æ `base_data` –æ–±–º–µ–∂—É—î—Ç—å—Å—è –ª–∏—à–µ `outfit_open = 6` ‚Äî –¥–æ–¥–∞—Ç–∫–æ–≤–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±—É–¥–µ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º.

üîé –•–æ—á–µ—à –¥–æ–¥–∞—Ç–∫–æ–≤–æ –∫–µ—à—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç `org_departments` –¥–ª—è —â–µ —à–≤–∏–¥—à–æ—ó —Ä–æ–±–æ—Ç–∏ –∞–±–æ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º–æ –¥–ª—è Oracle 10g —á–µ—Ä–µ–∑ `CONNECT BY` ‚Äî —Ç–∞–∫–æ–∂ –º–æ–∂–µ–º–æ —Ä–æ–∑–≥–ª—è–Ω—É—Ç–∏.