–ß—É–¥–æ–≤–æ! –î–∞–≤–∞–π —Ç–æ–¥—ñ –ø–æ–≤–Ω—ñ—Å—Ç—é –¥–æ–ø–æ–≤–Ω–∏–º–æ –ª–æ–≥—ñ–∫—É, —â–æ–± –±—É–ª–æ:

- –∫–Ω–æ–ø–∫–∞ "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ Excel"
- —É —Ñ–∞–π–ª –¥–æ–¥–∞–≤–∞–ª–∞—Å—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤–∏–±—Ä–∞–Ω–∏–π –ø–µ—Ä—ñ–æ–¥ (`PXX_DATE_START` —ñ `PXX_DATE_END`).

–†–æ–∑–ø–∏—à—É –ø–æ–∫—Ä–æ–∫–æ–≤–æ –¥—É–∂–µ —á—ñ—Ç–∫–æ:

---

## üîπ 1. –î–æ–¥–∞–π –∫–Ω–æ–ø–∫—É "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ Excel"

**–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–Ω–æ–ø–∫—É –≤ APEX:**
- **Button Name:** `BTN_DOWNLOAD_EXCEL`
- **Label:** `–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ Excel`
- **Position:** –ù–∞ –ø–∞–Ω–µ–ª—ñ –∑ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏ –∞–±–æ –Ω–∞–¥ –∑–≤—ñ—Ç–æ–º.

---

## üîπ 2. –°—Ç–≤–æ—Ä–∏ Dynamic Action –Ω–∞ –∫–Ω–æ–ø–∫—É

- **Event:** `Click`
- **Selection Type:** `Button` ‚Üí `BTN_DOWNLOAD_EXCEL`
- **True Action:** `Submit Page`
- - **Request:** `DOWNLOAD_EXCEL`
- (—Ç–æ–±—Ç–æ, –≤ –ø–æ–ª–µ "Request" –ø—Ä—è–º–æ —Ç–∞–∫ —ñ –ø–∏—à–∏: `DOWNLOAD_EXCEL`)

---

## üîπ 3. –°—Ç–≤–æ—Ä–∏ –ø—Ä–æ—Ü–µ—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó Excel

**Process:**
- **Name:** `PRC_GENERATE_EXCEL`
- **Type:** `PL/SQL Code`
- **Server-Side Condition:**
  - When Request = `DOWNLOAD_EXCEL`

**–ö–æ–¥ –ø—Ä–æ—Ü–µ—Å—É:** üëá

```plsql
DECLARE
    l_period_title VARCHAR2(400);
    l_mime_type    VARCHAR2(100) := 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';
    l_file_name    VARCHAR2(100);
BEGIN
    -- –§–æ—Ä–º—É—î–º–æ –ø–µ—Ä—ñ–æ–¥
    l_period_title := '–ü–µ—Ä—ñ–æ–¥: ';
    
    IF :PXX_DATE_START IS NOT NULL THEN
        l_period_title := l_period_title || TO_CHAR(:PXX_DATE_START, 'DD.MM.YYYY');
    ELSE
        l_period_title := l_period_title || '–±–µ–∑ –ø–æ—á–∞—Ç–∫—É';
    END IF;
    
    l_period_title := l_period_title || ' - ';
    
    IF :PXX_DATE_END IS NOT NULL THEN
        l_period_title := l_period_title || TO_CHAR(:PXX_DATE_END, 'DD.MM.YYYY');
    ELSE
        l_period_title := l_period_title || '–ø–æ—Ç–æ—á–Ω–∞ –¥–∞—Ç–∞';
    END IF;

    l_file_name := '–ó–≤—ñ—Ç_–ø–æ_–ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∞—Ö_' || TO_CHAR(SYSDATE, 'YYYYMMDD_HH24MISS') || '.xls';

    -- –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
    owa_util.mime_header(l_mime_type, FALSE);
    htp.p('Content-Disposition: attachment; filename="' || l_file_name || '"');
    owa_util.http_header_close;

    -- –ü–∏—à–µ–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–µ—Ä—ñ–æ–¥—É
    htp.p('<table border="1">');
    htp.p('<tr><th colspan="12">' || l_period_title || '</th></tr>');

    -- –ü–∏—à–µ–º–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ñ
    htp.p('<tr>
        <th>Group Name</th>
        <th>Org</th>
        <th>Unit</th>
        <th>Department</th>
        <th>Start Date</th>
        <th>U1 People</th>
        <th>U1 Brigades</th>
        <th>U2 People</th>
        <th>U2 Brigades</th>
        <th>U3 People</th>
        <th>U3 Brigades</th>
        <th>Total People</th>
        <th>Total Brigades</th>
    </tr>');

    -- –í–∏–±—ñ—Ä–∫–∞ –¥–∞–Ω–∏—Ö
    FOR rec IN (
        SELECT *
        FROM V_OUTFIT_PIVOT_BASE
        WHERE 1=1
          AND (:PXX_UNIT IS NULL OR unit = TO_NUMBER(:PXX_UNIT))
          AND (:PXX_DEPARTMENTS IS NULL 
               OR department IN (
                   SELECT column_value FROM TABLE(split_string(:PXX_DEPARTMENTS, ':'))
               ))
          AND (
            (:PXX_DATE_START IS NULL OR status_start_date >= :PXX_DATE_START)
            AND (:PXX_DATE_END IS NULL OR NVL(status_end_date, SYSDATE + 1) <= :PXX_DATE_END)
          )
    ) LOOP
        htp.p('<tr>');
        htp.p('<td>' || rec.group_name || '</td>');
        htp.p('<td>' || rec.org || '</td>');
        htp.p('<td>' || rec.unit || '</td>');
        htp.p('<td>' || rec.department || '</td>');
        htp.p('<td>' || TO_CHAR(rec.data_start, 'DD.MM.YYYY') || '</td>');
        htp.p('<td>' || rec.u1_people || '</td>');
        htp.p('<td>' || rec.u1_brigades || '</td>');
        htp.p('<td>' || rec.u2_people || '</td>');
        htp.p('<td>' || rec.u2_brigades || '</td>');
        htp.p('<td>' || rec.u3_people || '</td>');
        htp.p('<td>' || rec.u3_brigades || '</td>');
        htp.p('<td>' || rec.total_people || '</td>');
        htp.p('<td>' || rec.total_brigades || '</td>');
        htp.p('</tr>');
    END LOOP;

    htp.p('</table>');

    apex_application.stop_apex_engine; -- –∑—É–ø–∏–Ω—è—î–º–æ, —â–æ–± –±—Ä–∞—É–∑–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç—Ä–∏–º–∞–≤ —Ñ–∞–π–ª
END;
```

---

## üî• –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ

1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–±–∏—Ä–∞—î –¥–∞—Ç—É –ø–æ—á–∞—Ç–∫—É, –∫—ñ–Ω—Ü—è, unit, department.
2. –¢–∏—Å–Ω–µ –∫–Ω–æ–ø–∫—É "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ Excel".
3. –§–æ—Ä–º—É—î—Ç—å—Å—è —ñ –æ–¥—Ä–∞–∑—É —Å–∫–∞—á—É—î—Ç—å—Å—è Excel-—Ñ–∞–π–ª:
   - –ü–µ—Ä—à–∏–π —Ä—è–¥–æ–∫ ‚Äî —Ç–µ–∫—Å—Ç –ø–µ—Ä—ñ–æ–¥—É.
   - –î—Ä—É–≥–∏–π —Ä—è–¥–æ–∫ ‚Äî –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫.
   - –î–∞–ª—ñ ‚Äî –¥–∞–Ω—ñ –∑–∞ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏.

---

## ‚ùì –í—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ —Ç–∏–ø–æ–≤—ñ –ø–∏—Ç–∞–Ω–Ω—è:

- **–ß–∏ –±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –≤ APEX 22?** ‚Äì –¢–∞–∫, —Ü–µ–π —Å–ø–æ—Å—ñ–± –±–∞–∑–æ–≤–∏–π —ñ —Å—É–º—ñ—Å–Ω–∏–π.
- **–ß–∏ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ APEX_DATA_EXPORT?** ‚Äì –ú–æ–∂–Ω–∞, —è–∫—â–æ —Ö–æ—á–µ—à –±—ñ–ª—å—à —Å–∫–ª–∞–¥–Ω–µ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è. –ê–ª–µ –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ HTML->Excel —Ü–µ–π –≤–∞—Ä—ñ–∞–Ω—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ñ—à–∏–π –∑–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—é.
- **–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É `.xls` —á–∏ `.xlsx`?** ‚Äì –¶–µ –±—É–¥–µ `.xls` (–ø—Ä–æ—Å—Ç–æ HTML —Ç–∞–±–ª–∏—Ü—è), –∞–ª–µ Excel –≤—ñ–¥–∫—Ä–∏—î –±–µ–∑ –ø–æ–º–∏–ª–æ–∫.

---

–•–æ—á–µ—à, —â–µ –ø–æ–∫–∞–∂—É –≤–∞—Ä—ñ–∞–Ω—Ç —á–µ—Ä–µ–∑ `APEX_DATA_EXPORT` –¥–ª—è —Å–ø—Ä–∞–≤–∂–Ω—å–æ–≥–æ `.xlsx` —Ñ–∞–π–ª—É –∑ –∫–æ–ª—å–æ—Ä–∞–º–∏, —à—Ä–∏—Ñ—Ç–∞–º–∏ —ñ –∞–≤—Ç–æ–ø—ñ–¥–±–æ—Ä–æ–º —à–∏—Ä–∏–Ω–∏ –∫–æ–ª–æ–Ω–æ–∫? üî•  
(–º–æ–∂–µ–º–æ –∑—Ä–æ–±–∏—Ç–∏ –¥—Ä—É–≥—É –≤–µ—Ä—Å—ñ—é ‚Äì —Ç—Ä–æ—Ö–∏ —Å–∫–ª–∞–¥–Ω—ñ—à–µ, –∞–ª–µ –∫—Ä–∞—Å–∏–≤—ñ—à–µ)  
–•–æ—á–µ—à? üöÄ