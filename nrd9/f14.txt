–î—è–∫—É—é, —Ç–µ–ø–µ—Ä –∑—Ä–æ–∑—É–º—ñ–ª–æ. –ü–æ–º–∏–ª–∫–∞ `ORA-00932: inconsistent datatypes: expected NUMBER got CHAR` **–Ω–µ —Å—Ç–æ—Å—É—î—Ç—å—Å—è `b.unit`**, –∞ **—Å–∞–º–µ `CASE WHEN ...` —É `GROUP BY`**, –¥–µ:

```sql
CASE 
  WHEN b.org = 0 THEN TO_CHAR(b.department)
  ELSE d.org_txt || ' (' || d.dep_list || ')' 
END
```

–¢—É—Ç Oracle –æ—á—ñ–∫—É—î, —â–æ `GROUP BY` –≤–∏—Ä–∞–∑–∏ –±—É–¥—É—Ç—å **—É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω—ñ –∑–∞ —Ç–∏–ø–æ–º** ‚Äî –∞ —Å–∞–º–µ:

- `TO_CHAR(b.department)` ‚Äî `VARCHAR2`
- `d.org_txt || ' (' || d.dep_list || ')'` ‚Äî —Ç–µ–∂ `VARCHAR2`

–ê–ª–µ **Oracle —ñ–Ω–æ–¥—ñ –æ—á—ñ–∫—É—î NUMBER**, —è–∫—â–æ –≤ —ñ–Ω—à–∏—Ö –º—ñ—Å—Ü—è—Ö `b.department` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤—Å—è —è–∫ `NUMBER`, –∞–±–æ –≤ `SELECT`-—á–∞—Å—Ç–∏–Ω—ñ `group_name` –≤–∂–µ –±—É–≤ `NUMBER`.

---

## ‚úÖ –†—ñ—à–µ–Ω–Ω—è

–¢—Ä–µ–±–∞ **–≤—ñ–¥–¥–∞—Ç–∏ Oracle—É —á—ñ—Ç–∫–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è**, —â–æ `group_name` **—î —Å—Ç—Ä–æ–∫–æ–≤–∏–º** —Ç–∏–ø–æ–º. –¢–æ–º—É –ø–æ—Ç—Ä—ñ–±–Ω–æ **–æ–≥–æ–ª–æ—Å–∏—Ç–∏ `group_name` –æ–∫—Ä–µ–º–æ** —É `SELECT`, —ñ **—É `GROUP BY` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø—Å–µ–≤–¥–æ–Ω—ñ–º**, –∞–±–æ –ø—Ä–æ–¥—É–±–ª—é–≤–∞—Ç–∏ —Ç–æ–π —Å–∞–º–∏–π –≤–∏—Ä–∞–∑.

**–ù–∞–π–±–µ–∑–ø–µ—á–Ω—ñ—à–µ ‚Äî –ø—Ä–∏–±—Ä–∞—Ç–∏ `CASE` —ñ–∑ `GROUP BY` —ñ –∑–∞–º—ñ–Ω–∏—Ç–∏ –π–æ–≥–æ –∫–æ–ø—ñ—î—é –≤–∏—Ä–∞–∑—É, —è–∫ —É `SELECT`.**

---

### ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ `agg_data`:

```sql
agg_data AS (
  SELECT
    CASE 
      WHEN b.org = 0 THEN TO_CHAR(b.department)
      ELSE d.org_txt || ' (' || d.dep_list || ')' 
    END AS group_name,
    b.org,
    b.unit,
    b.department,
    b.data_start,
    b.status_start_date,
    b.status_end_date,
    COUNT(b.id_outfit) AS brigades,
    SUM(b.team_count) AS people
  FROM base_data b
  LEFT JOIN org_departments d 
    ON b.org = d.org AND b.org_txt = d.org_txt
  GROUP BY
    b.org,
    b.unit,
    b.department,
    b.data_start,
    b.status_start_date,
    b.status_end_date,
    CASE 
      WHEN b.org = 0 THEN TO_CHAR(b.department)
      ELSE d.org_txt || ' (' || d.dep_list || ')' 
    END
)
```

---

–¶–µ **—É—Å—É–Ω–µ –ø–æ–º–∏–ª–∫—É —Ç–∏–ø—É**, –±–æ Oracle –æ—Ç—Ä–∏–º–∞—î –ø–æ–≤–Ω—ñ—Å—Ç—é –æ–¥–Ω–∞–∫–æ–≤–∏–π `CASE`-–≤–∏—Ä–∞–∑ —É `SELECT` —ñ `GROUP BY`, –∞ `TO_CHAR()` —è–≤–Ω–æ –≤–∏–∑–Ω–∞—á–∏—Ç—å —Ç–∏–ø.

---

üîß **–î–æ–¥–∞—Ç–∫–æ–≤–æ**: —è–∫—â–æ `department` –∑–∞–≤–∂–¥–∏ `NUMBER`, –∞–ª–µ —Ç–∏ —Ö–æ—á–µ—à –π–æ–≥–æ –æ–±'—î–¥–Ω–∞—Ç–∏ –∑ `VARCHAR2` —É `group_name`, —Ç–æ –≤ `CASE WHEN` **–æ–±–∏–¥–≤—ñ –≥—ñ–ª–∫–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ `VARCHAR2`**, —ñ–Ω–∞–∫—à–µ Oracle "–±–∞—á–∏—Ç—å" `group_name` —è–∫ `NUMBER`.

---

–ü–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø–æ–≤–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç `CREATE OR REPLACE VIEW` –∑ —Ü—ñ—î—é –ø—Ä–∞–≤–∫–æ—é?