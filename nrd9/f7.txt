–û—Å—å SQL-–∑–∞–ø–∏—Ç, —è–∫–∏–π –≥–µ–Ω–µ—Ä—É—î –¥–∞–Ω—ñ, –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó `get_unit_matrix_html`, —É –≤–∏–≥–ª—è–¥—ñ, –ø—Ä–∏–¥–∞—Ç–Ω–æ–º—É –¥–ª—è APEX Interactive Report –∞–±–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤ Excel:

```sql
WITH base_filtered AS (
  SELECT
    CASE WHEN org = 0 THEN department ELSE org_txt END AS group_name,
    org,
    unit,
    department,
    team_count,
    status_start_date,
    status_end_date
  FROM your_view
  WHERE outfit_open = 6
    AND (:P_DEPARTMENTS IS NULL OR department IN (
      SELECT column_value FROM TABLE(split_string(:P_DEPARTMENTS, ':'))
    ))
),
time_windows AS (
  SELECT 'NOW' AS period_key, SYSDATE AS v_start, SYSDATE AS v_end FROM DUAL
  UNION ALL
  SELECT 'DAY', TRUNC(SYSDATE), SYSDATE FROM DUAL
  UNION ALL
  SELECT 'SHIFT', :P_SHIFT_START, SYSDATE FROM DUAL
),
expanded AS (
  SELECT
    tw.period_key,
    b.org,
    b.unit,
    b.department,
    b.team_count
  FROM base_filtered b
  CROSS JOIN time_windows tw
  WHERE
    b.status_start_date < tw.v_end
    AND (b.status_end_date IS NULL OR tw.v_start < b.status_end_date)
),
aggregated AS (
  SELECT
    period_key,
    CASE 
      WHEN org = 0 THEN '–ë—Ä–∏–≥–∞–¥ —Ñ—ñ—Ä–º–∏'
      WHEN org = 1 THEN '–ë—Ä–∏–≥–∞–¥ –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤'
    END AS type_label,
    unit,
    COUNT(*) AS brigades,
    SUM(team_count) AS people
  FROM expanded
  GROUP BY period_key, org, unit
),
pivoted AS (
  SELECT
    period_key,
    type_label,
    SUM(CASE WHEN unit = 0 THEN brigades END) AS unit1,
    SUM(CASE WHEN unit = 1 THEN brigades END) AS unit2,
    SUM(CASE WHEN unit = 2 THEN brigades END) AS unit3,
    SUM(brigades) AS total
  FROM aggregated
  GROUP BY period_key, type_label
  UNION ALL
  SELECT
    period_key,
    CASE WHEN type_label = '–ë—Ä–∏–≥–∞–¥ —Ñ—ñ—Ä–º–∏' THEN '–õ—é–¥–µ–π —Ñ—ñ—Ä–º–∏' ELSE '–õ—é–¥–µ–π –ø—ñ–¥—Ä—è–¥–Ω–∏–∫—ñ–≤' END,
    SUM(CASE WHEN unit = 0 THEN people END),
    SUM(CASE WHEN unit = 1 THEN people END),
    SUM(CASE WHEN unit = 2 THEN people END),
    SUM(people)
  FROM aggregated
  GROUP BY period_key, type_label
)
SELECT * FROM pivoted
ORDER BY period_key, type_label;
```

üìå **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**:
- –í APEX –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –æ–∫—Ä–µ–º–∏–π Interactive Report –∑ —Ü–∏–º SQL.
- –î–ª—è –µ–∫—Å–ø–æ—Ä—Ç—É –≤ Excel ‚Äî –ø—Ä–æ—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É –∫–Ω–æ–ø–∫—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.
- –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ `:P_DEPARTMENTS` —ñ `:P_SHIFT_START` –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ, —è–∫—â–æ —Å—Ç–≤–æ—Ä–µ–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ APEX items.

–•–æ—á–µ—à, —â–æ–± —è –¥–æ–ø–æ–º—ñ–≥ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Ü–µ–π –∑–≤—ñ—Ç —É APEX?