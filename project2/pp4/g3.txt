Так, усе ок — якщо на “Новий вхід” ти **закриваєш попередню сесію**, то одночасно відкритих сесій не буде. Але є кілька важливих нюансів.

## Ключові моменти

1. **Не став “‑1” у часі.**
   `logout_time` — це дата/час. Значення `‑1` для `DATE/TIMESTAMP` технічно неможливе й погано читається в SQL. Краще:

* закривати звичайним часом (наприклад, поточним або `last_seen`),
* і додатково відмічати **причину/статус закриття**:

  * `close_reason = 'FORCED' | 'AUTO_IDLE' | 'MANUAL'`,
  * або `close_status = 'OK' | 'BAD'`.

2. **Гарантія “лише 1 відкрита”**
   Навіть із кнопкою “Новий вхід” корисно мати технічну гарантію, що відкритих сесій не з’явиться:

* унікальний індекс на *відкритість*:
  `(USER_ID, NVL(LOGOUT_DATE, DATE '4712-12-31'))`
  — тоді БД не дозволить випадково залишити дві відкриті.

3. **Що робить “Новий вхід”**
   Алгоритм однаковий для NFC і ручного вводу:

* якщо **нема відкритої**: просто створити нову сесію;
* якщо **є відкрита**:
  a) **“Вийти”** → `logout_date := NOW`, `close_reason := 'MANUAL'`;
  b) **“Новий вхід”** → **спершу закрити попередню** (`logout_date := NOW`, `close_reason := 'FORCED'`), **потім** створити нову.
  (Можна замість `NOW` ставити `last_seen`, якщо хочеш “акуратніший” інтервал.)

4. **Аналітика “поганих виходів”**
   Замість магічного `‑1` ти отримуєш чисті звіти:

* “некоректні” = `close_reason = 'FORCED'` або `close_status = 'BAD'`.
* легко рахувати частоту таких випадків по користувачах/пристроях.

5. **UX мінус = +1 крок**
   Так, на вихід додається крок підтвердження. Але це й є сенс: користувач свідомо обирає — **закрити** чи **почати нову**. Для NFC можна показати діалог із таймером (наприклад, автозакриття через 5 c, якщо не натиснув нічого).

## Підсумок

* Так, твоя логіка працює й **не допускає кількох відкритих сесій**, якщо на “Новий вхід” ти **спочатку закриваєш попередню**.
* Не використовуй `‑1` у полі дати — заміни на звичайний час + **окремий маркер причини** (`close_reason`/`close_status`).
* Постав унікальний індекс “лише 1 відкрита” як страховку — і питання зникає навіть при помилках користувача чи гонках.
