Here's an example of PL/SQL code that you can use to achieve the desired tasks:

1) Check new rows in the collection by id_task and add them to TABLE_1:


FOR i IN 1..APEX_COLLECTION.GET_COUNT(p_collection_name => 'YOUR_COLLECTION_NAME') LOOP
   SELECT COUNT(*) INTO l_exists FROM TABLE_1 WHERE id_tsk = APEX_COLLECTION.GET_ITEM_NUMBER(p_collection_name => 'YOUR_COLLECTION_NAME', p_idx => i, p_attr_number => 'ID_TSK');
   IF l_exists = 0 THEN
      INSERT INTO TABLE_1 (id_tsk, position, department, office, stage, sort_order)
      VALUES(
         APEX_COLLECTION.GET_ITEM_NUMBER(p_collection_name => 'YOUR_COLLECTION_NAME', p_idx => i, p_attr_number => 'ID_TSK'),
         APEX_COLLECTION.GET_ITEM(p_collection_name => 'YOUR_COLLECTION_NAME', p_idx => i, p_attr_number => 'POSITION'),
         APEX_COLLECTION.GET_ITEM(p_collection_name => 'YOUR_COLLECTION_NAME', p_idx => i, p_attr_number => 'DEPARTMENT'),
         APEX_COLLECTION.GET_ITEM_NUMBER(p_collection_name => 'YOUR_COLLECTION_NAME', p_idx => i, p_attr_number => 'OFFICE'),
         APEX_COLLECTION.GET_ITEM_NUMBER(p_collection_name => 'YOUR_COLLECTION_NAME', p_idx => i, p_attr_number => 'STAGE'),
         APEX_COLLECTION.GET_ITEM_NUMBER(p_collection_name => 'YOUR_COLLECTION_NAME', p_idx => i, p_attr_number => 'SORT_ORDER')
      );
   END IF;
END LOOP;

Copy code


2) Check deleted rows by id_task and delete them from TABLE_1:


FOR i IN 1..APEX_COLLECTION.GET_COUNT(p_collection_name => 'YOUR_COLLECTION_NAME') LOOP
   SELECT COUNT(*) INTO l_exists FROM TABLE_1 WHERE id_tsk = APEX_COLLECTION.GET_ITEM_NUMBER(p_collection_name => 'YOUR_COLLECTION_NAME', p_idx => i, p_attr_number => 'ID_TSK');
   IF l_exists = 1 THEN
      DELETE FROM TABLE_1 WHERE id_tsk = APEX_COLLECTION.GET_ITEM_NUMBER(p_collection_name => 'YOUR_COLLECTION_NAME', p_idx => i, p_attr_number => 'ID_TSK');
   END IF;
END LOOP;

Copy code


3) Check and update the sort order column in TABLE_1:


FOR i IN 1..APEX_COLLECTION.GET_COUNT(p_collection_name => 'YOUR_COLLECTION_NAME') LOOP
   SELECT COUNT(*) INTO l_exists FROM TABLE_1 WHERE id_tsk = APEX_COLLECTION.GET_ITEM_NUMBER(p_collection_name => 'YOUR_COLLECTION_NAME', p_idx => i, p_attr_number => 'ID_TSK');
   IF l_exists = 1 THEN
      UPDATE TABLE_1 SET sort_order = APEX_COLLECTION.GET_ITEM_NUMBER(p_collection_name => 'YOUR_COLLECTION_NAME', p_idx => i, p_attr_number => 'SORT_ORDER')
      WHERE id_tsk = APEX_COLLECTION.GET_ITEM_NUMBER(p_collection_name => 'YOUR_COLLECTION_NAME', p_idx => i, p_attr_number => 'ID_TSK');
   END IF;
END LOOP;

Copy code


Make sure to replace 'YOUR_COLLECTION_NAME' with the actual name of your APEX collection, and update the column and table names according to your schema.
