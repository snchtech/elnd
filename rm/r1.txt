–£ Oracle PL/SQL –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä `CASE` –∞–±–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É `NVL` —É `WHERE`-—É–º–æ–≤—ñ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ —Ñ—ñ–ª—å—Ç—Ä–∞. –ù–∏–∂—á–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –≤–∞—à–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó:

```sql
CREATE OR REPLACE FUNCTION get_data(depart IN NUMBER, unit IN NUMBER)
RETURN SYS_REFCURSOR IS
    result_cursor SYS_REFCURSOR;
BEGIN
    OPEN result_cursor FOR
        SELECT * FROM db_table t
        WHERE t.date = TRUNC(SYSDATE) 
        AND (depart IS NULL AND t.perm = 2 OR depart IS NOT NULL AND t.perm IN (2, depart));
    
    RETURN result_cursor;
END get_data;
/
```

### **–ü–æ—è—Å–Ω–µ–Ω–Ω—è –∫–æ–¥—É:**
1. **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ `depart IS NULL`**:
   - –Ø–∫—â–æ `depart` **NULL**, —Ç–æ–¥—ñ **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `t.perm = 2`**.
   - –Ø–∫—â–æ `depart` **–Ω–µ NULL**, —Ç–æ–¥—ñ **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `t.perm IN (2, depart)`**.
   
2. **`TRUNC(SYSDATE)`**:
   - –Ø–∫—â–æ `t.date` –º—ñ—Å—Ç–∏—Ç—å `DATE`-–∑–Ω–∞—á–µ–Ω–Ω—è –∑ —á–∞—Å–æ–º, –≤–∞–∂–ª–∏–≤–æ —É—Å—É–Ω—É—Ç–∏ —á–∞—Å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `TRUNC(SYSDATE)`, —ñ–Ω–∞–∫—à–µ –≤—ñ–Ω –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏–º–µ `SYSDATE`, —è–∫–∏–π –º–∞—î —Ç–∞–∫–æ–∂ –≥–æ–¥–∏–Ω—É, —Ö–≤–∏–ª–∏–Ω—É, —Å–µ–∫—É–Ω–¥–∏.

3. **–§—É–Ω–∫—Ü—ñ—è –ø–æ–≤–µ—Ä—Ç–∞—î `SYS_REFCURSOR`**:
   - –¶–µ –¥–æ–∑–≤–æ–ª—è—î —ó—ó –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –∑ PL/SQL –±–ª–æ–∫—É –∞–±–æ –≤ SQL-–∑–∞–ø–∏—Ç—ñ, –æ—Ç—Ä–∏–º—É—é—á–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —É –∫—É—Ä—Å–æ—Ä—ñ.

### **–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–ª–∏–∫—É —Ñ—É–Ω–∫—Ü—ñ—ó:**
```sql
DECLARE
    v_cursor SYS_REFCURSOR;
    v_row db_table%ROWTYPE;
BEGIN
    v_cursor := get_data(NULL, 1); -- depart = NULL
    LOOP
        FETCH v_cursor INTO v_row;
        EXIT WHEN v_cursor%NOTFOUND;
        DBMS_OUTPUT.PUT_LINE(v_row.some_column);
    END LOOP;
    CLOSE v_cursor;
END;
/
```

–Ø–∫—â–æ —É –≤–∞—Å `Oracle 10g` —ñ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ **–¥–∏–Ω–∞–º—ñ—á–Ω–æ –±—É–¥—É–≤–∞—Ç–∏ SQL-–∑–∞–ø–∏—Ç**, –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ `EXECUTE IMMEDIATE`:

```sql
CREATE OR REPLACE FUNCTION get_data(depart IN NUMBER, unit IN NUMBER)
RETURN SYS_REFCURSOR IS
    result_cursor SYS_REFCURSOR;
    v_sql VARCHAR2(1000);
BEGIN
    v_sql := 'SELECT * FROM db_table t WHERE t.date = TRUNC(SYSDATE)';

    IF depart IS NULL THEN
        v_sql := v_sql || ' AND t.perm = 2';
    ELSE
        v_sql := v_sql || ' AND t.perm IN (2, :depart)';
    END IF;

    OPEN result_cursor FOR v_sql USING depart;
    RETURN result_cursor;
END get_data;
/
```

–¶–µ–π –≤–∞—Ä—ñ–∞–Ω—Ç –ø—ñ–¥—Ö–æ–¥–∏—Ç—å, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç –¥–∏–Ω–∞–º—ñ—á–Ω–æ.

–°–ø–æ–¥—ñ–≤–∞—é—Å—å, —Ü–µ –¥–æ–ø–æ–º–æ–∂–µ! üöÄ