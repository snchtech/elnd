<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debugging filterData</title>
</head>
<body>
    TEST
<script>
function filterData(data, position, department, unit) {
  const uniqueSourceIDs = new Set();

  return data.filter(function (el) {
    console.log(`\nÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ð·Ð°Ð¿Ð¸ÑÑƒ:`, el);

    // ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ð½Ð° ÑƒÐ½Ñ–ÐºÐ°Ð»ÑŒÐ½Ñ–ÑÑ‚ÑŒ SOURCE_ID
    if (uniqueSourceIDs.has(el.SOURCE_ID)) {
      console.log(`â© ÐŸÑ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½Ð¾ Ñ‡ÐµÑ€ÐµÐ· Ð´ÑƒÐ±Ð»Ñ–ÐºÐ°Ñ‚ SOURCE_ID:`, el.SOURCE_ID);
      return false;
    }
    uniqueSourceIDs.add(el.SOURCE_ID);

    let matches = true;

    // Ð¤Ñ–Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ñ–Ñ Ð¿Ð¾ POSITION_ID, DEPARTMENT_ID, U_ID
    if (position !== null && position !== undefined) {
      matches = matches && el.POSITION_ID === position;
      console.log(`ðŸ” ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° POSITION_ID: ${el.POSITION_ID} === ${position} ->`, matches);
    }
    if (department !== null && department !== undefined) {
      matches = matches && el.DEPARTMENT_ID === department;
      console.log(`ðŸ” ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° DEPARTMENT_ID: ${el.DEPARTMENT_ID} === ${department} ->`, matches);
    }
    if (unit !== null && unit !== undefined) {
      matches = matches && el.U_ID === unit;
      console.log(`ðŸ” ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° U_ID: ${el.U_ID} === ${unit} ->`, matches);
    }

    // Ð¯ÐºÑ‰Ð¾ Ð¿Ð¾Ð¿ÐµÑ€ÐµÐ´Ð½Ñ– ÑƒÐ¼Ð¾Ð²Ð¸ Ð½Ðµ Ð²Ð¸ÐºÐ¾Ð½ÑƒÑŽÑ‚ÑŒÑÑ, Ð½Ðµ Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€ÑÑ”Ð¼Ð¾ PERMITION_ID
    if (!matches) {
      console.log(`âŒ Ð’Ñ–Ð´Ñ„Ñ–Ð»ÑŒÑ‚Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ð´Ð¾ Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ¸ PERMITION_ID`);
      return false;
    }

    // Ð¤Ñ–Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ñ–Ñ Ð¿Ð¾ PERMITION_ID
    if (el.POSITION_ID === 545 || el.POSITION_ID === 812) {
      // Ð¯ÐºÑ‰Ð¾ POSITION_ID = 545 Ð°Ð±Ð¾ 812 â†’ Ð·Ð°Ð»Ð¸ÑˆÐ°Ñ”Ð¼Ð¾ Ð»Ð¸ÑˆÐµ Ñ‚Ñ–, Ð´Ðµ PERMITION_ID Ð¼Ñ–ÑÑ‚Ð¸Ñ‚ÑŒ 2
      matches = el.PERMITION_ID.includes(2);
      console.log(`ðŸ” POSITION_ID 545/812 â†’ Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° PERMITION_ID.includes(2) ->`, matches);
    } else {
      // Ð”Ð»Ñ Ð²ÑÑ–Ñ… Ñ–Ð½ÑˆÐ¸Ñ… POSITION_ID â†’ Ð·Ð°Ð»Ð¸ÑˆÐ°Ñ”Ð¼Ð¾, ÑÐºÑ‰Ð¾ PERMITION_ID Ð¼Ñ–ÑÑ‚Ð¸Ñ‚ÑŒ 2 Ð°Ð±Ð¾ DEPARTMENT_ID (ÑÐºÑ‰Ð¾ Ð²Ñ–Ð½ Ð½Ðµ null)
      matches = el.PERMITION_ID.includes(2) || (el.DEPARTMENT_ID !== null && el.PERMITION_ID.includes(el.DEPARTMENT_ID));
      console.log(`ðŸ” Ð†Ð½ÑˆÐ¸Ð¹ POSITION_ID â†’ Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° PERMITION_ID.includes(2) || includes(DEPARTMENT_ID) ->`, matches);
    }

    return matches;
  });
}

// ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´ Ð´Ð°Ð½Ð¸Ñ…
const dataTest = [
  { SOURCE_ID: 100, POSITION_ID: 545, DEPARTMENT_ID: 1100, U_ID: 1, PERMITION_ID: [2, 15] },
  { SOURCE_ID: 1005, POSITION_ID: 654, DEPARTMENT_ID: 1100, U_ID: 1, PERMITION_ID: [2, 1100] },
  { SOURCE_ID: 1015, POSITION_ID: 545, DEPARTMENT_ID: null, U_ID: 2, PERMITION_ID: [2, 15] },
  { SOURCE_ID: 1011, POSITION_ID: 812, DEPARTMENT_ID: null, U_ID: 2, PERMITION_ID: [2, 17] },
  { SOURCE_ID: 107, POSITION_ID: null, DEPARTMENT_ID: 1100, U_ID: null, PERMITION_ID: [2, 10] },
];

// Ð’Ð¸ÐºÐ»Ð¸Ðº Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ—
const filteredData = filterData(dataTest, 654, 1100, null);
console.log(`\nðŸŽ¯ Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ñ„Ñ–Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ñ–Ñ—:`, filteredData);
</script>
</body>
</html>
