–©–æ–± –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –≤—Å—ñ—Ö API-–µ–Ω–¥–ø–æ—ñ–Ω—Ç—ñ–≤ **–ª–∏—à–µ —á–µ—Ä–µ–∑ JWT —Ç–æ–∫–µ–Ω**, –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ **middleware** `authenticateToken` –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑–∞—Ö–∏—â–µ–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç—É.

### ‚úÖ **–î–æ–¥–∞–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –≤—Å—ñ—Ö –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∞—Ö**

### 1Ô∏è‚É£ **–î–æ–¥–∞–º–æ Middleware –¥–æ –≤—Å—ñ—Ö –º–∞—Ä—à—Ä—É—Ç—ñ–≤**

–î–ª—è —Ü—å–æ–≥–æ –º–∏ –ø—ñ–¥–∫–ª—é—á–∞—î–º–æ middleware —É –≥–æ–ª–æ–≤–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä–Ω–æ–º—É —Ñ–∞–π–ª—ñ (`server.js`) **–¥–æ –≤—Å—ñ—Ö –º–∞—Ä—à—Ä—É—Ç—ñ–≤, —â–æ –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –∑ `/api`**.

---

### üì¶ **–§–∞–π–ª `server.js`**

```javascript
import express from 'express';
import cors from 'cors';
import dotenv from 'dotenv';

import authRoutes from './routes/auth.js';
import schemeRoutes from './routes/schemes.js';
import { authenticateToken } from './middlewares/authMiddleware.js';

dotenv.config();

const app = express();
const PORT = process.env.PORT || 5000;

app.use(cors());
app.use(express.json());

// üìå –†–æ—É—Ç –¥–ª—è –ª–æ–≥—ñ–Ω—É (–Ω–µ –ø–æ—Ç—Ä–µ–±—É—î —Ç–æ–∫–µ–Ω)
app.use('/api/auth', authRoutes);

// üìå –î–æ–¥–∞–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –≤—Å—ñ—Ö —ñ–Ω—à–∏—Ö /api –º–∞—Ä—à—Ä—É—Ç—ñ–≤
app.use('/api', authenticateToken, schemeRoutes);

app.listen(PORT, () => {
  console.log(`‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω–æ –Ω–∞ –ø–æ—Ä—Ç—ñ ${PORT}`);
});
```

---

### üîç **–î–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞?**

üîí –£ —Ü—å–æ–º—É —Ä—è–¥–∫—É:

```javascript
app.use('/api', authenticateToken, schemeRoutes);
```

1. **–í—Å–µ, —â–æ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ `/api`** (–∫—Ä—ñ–º `/api/auth`) —Å–ø–æ—á–∞—Ç–∫—É –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ `authenticateToken`.  
2. **–Ø–∫—â–æ —Ç–æ–∫–µ–Ω –≤—ñ–¥—Å—É—Ç–Ω—ñ–π –∞–±–æ –Ω–µ–¥—ñ–π—Å–Ω–∏–π**, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—Ç—Ä–∏–º—É—î –ø–æ–º–∏–ª–∫—É:  
   ```json
   {
     "status": "error",
     "error": "–¢–æ–∫–µ–Ω –≤—ñ–¥—Å—É—Ç–Ω—ñ–π –∞–±–æ –Ω–µ–¥—ñ–π—Å–Ω–∏–π"
   }
   ```  
3. **–Ø–∫—â–æ —Ç–æ–∫–µ–Ω –≤–∞–ª—ñ–¥–Ω–∏–π**, –∑–∞–ø–∏—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –¥–æ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞.

---

### 2Ô∏è‚É£ **–û–Ω–æ–≤–ª–µ–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏**

### üîê **–†–æ—É—Ç –¥–ª—è —Å—Ö–µ–º (`routes/schemes.js`)**

```javascript
import express from 'express';
import { getSchemes, saveScheme } from '../controllers/schemeController.js';

const router = express.Router();

// –í—Å—ñ —Ü—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ —Ç–µ–ø–µ—Ä –∑–∞—Ö–∏—â–µ–Ω—ñ —Ç–æ–∫–µ–Ω–æ–º!
router.get('/schemes', getSchemes);
router.post('/schemes', saveScheme);

export default router;
```

**‚ö†Ô∏è –ü—Ä–∏–º—ñ—Ç–∫–∞:**  
–ú–∏ **–Ω–µ –¥–æ–¥–∞—î–º–æ** —Ç—É—Ç –≤—Ä—É—á–Ω—É `authenticateToken`, –±–æ –≤—ñ–Ω –≤–∂–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –≥–ª–æ–±–∞–ª—å–Ω–æ –≤ `server.js` –¥–ª—è –≤—Å—ñ—Ö `/api` –º–∞—Ä—à—Ä—É—Ç—ñ–≤.

---

### 3Ô∏è‚É£ **–ü–æ—è—Å–Ω–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏**

- **‚úÖ –õ–æ–≥—ñ–Ω (–¥–æ—Å—Ç—É–ø–Ω–∏–π –±–µ–∑ —Ç–æ–∫–µ–Ω–∞):**  
  `/api/auth/login` –ø—Ä–∞—Ü—é—î –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞.  

- **üîí –ó–∞—Ö–∏—â–µ–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏:**  
  –í—Å—ñ —ñ–Ω—à—ñ `/api` –º–∞—Ä—à—Ä—É—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å—Å—è —á–µ—Ä–µ–∑ `authenticateToken`.

- **üìÇ –†–æ—É—Ç–µ—Ä–∏ —Å–ø—Ä–æ—â—É—é—Ç—å—Å—è**, –±–æ –ª–æ–≥—ñ–∫–∞ –±–µ–∑–ø–µ–∫–∏ –≤–∂–µ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∞.

---

### 4Ô∏è‚É£ **–î–æ–¥–∞—Ç–∫–æ–≤–∞ –±–µ–∑–ø–µ–∫–∞: –†–æ–ª—ñ**

–©–æ–± –æ–±–º–µ–∂–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –ø–µ–≤–Ω–∏—Ö –º–∞—Ä—à—Ä—É—Ç—ñ–≤ –∑–∞ —Ä–æ–ª—è–º–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ç—ñ–ª—å–∫–∏ –¥–ª—è `Editor`), —Å—Ç–≤–æ—Ä–∏–º–æ —â–µ –æ–¥–∏–Ω middleware.

---

### üîê **Middleware –¥–ª—è —Ä–æ–ª–µ–π (`middlewares/roleMiddleware.js`)**

```javascript
export const authorizeRoles = (...allowedRoles) => {
  return (req, res, next) => {
    const userRoles = req.user.roles;

    const hasAccess = allowedRoles.some(role => userRoles.includes(role));

    if (!hasAccess) {
      return res.status(403).json({ status: 'error', error: '–î–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–∏–π' });
    }

    next();
  };
};
```

---

### üìÇ **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –∑–∞ —Ä–æ–ª—è–º–∏**

```javascript
import express from 'express';
import { getSchemes, saveScheme } from '../controllers/schemeController.js';
import { authorizeRoles } from '../middlewares/roleMiddleware.js';

const router = express.Router();

// üõ† –î–æ—Å—Ç—É–ø –¥–ª—è –≤—Å—ñ—Ö –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
router.get('/schemes', getSchemes);

// ‚úèÔ∏è –î–æ—Å—Ç—É–ø –¥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ö–µ–º–∏ –ª–∏—à–µ –¥–ª—è —Ä–æ–ª—ñ 'Editor'
router.post('/schemes', authorizeRoles('Editor'), saveScheme);

export default router;
```

---

### üîë **–†–µ–∑—É–ª—å—Ç–∞—Ç**

1. **–í—Å—ñ –∑–∞–ø–∏—Ç–∏ –¥–æ `/api` –ø—Ä–æ—Ö–æ–¥—è—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–∫—É —Ç–æ–∫–µ–Ω–∞.**  
2. **–î–æ—Å—Ç—É–ø –¥–æ –ø–µ–≤–Ω–∏—Ö –¥—ñ–π –æ–±–º–µ–∂–µ–Ω–∏–π –∑–∞ —Ä–æ–ª—è–º–∏.**  
3. **–Ø–∫—â–æ —Ç–æ–∫–µ–Ω –Ω–µ–¥—ñ–π—Å–Ω–∏–π** ‚Üí `401 Unauthorized`.  
4. **–Ø–∫—â–æ —Ä–æ–ª—å –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î** ‚Üí `403 Forbidden`.

---

üí° **–¢–∞–∫–∏–º —á–∏–Ω–æ–º:**  
- –ö–æ–∂–µ–Ω –∑–∞–ø–∏—Ç –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —ñ –≤–∞–ª—ñ–¥–Ω—ñ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞.  
- –õ–æ–≥—ñ–Ω –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏–º.  
- –ó–∞—Ö–∏—â–µ–Ω—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ `/api` –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ –±–µ–∑ —Ç–æ–∫–µ–Ω–∞.