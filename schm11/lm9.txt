–î–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è **JWT —Ç–æ–∫–µ–Ω–∞** –∫—Ä–∞—â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **HTTP-only cookies**. –¶–µ —É–Ω–µ–º–æ–∂–ª–∏–≤–ª—é—î –¥–æ—Å—Ç—É–ø –¥–æ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ JavaScript, —â–æ –∑–∞—Ö–∏—â–∞—î –≤—ñ–¥ –∞—Ç–∞–∫ —Ç–∏–ø—É **XSS**.

## üîí **–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –∑—á–∏—Ç—É–≤–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞ –∑ HTTP-only Cookies**

---

### üì¶ **1. –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**

```
/my-nextjs-app
  ‚îú‚îÄ‚îÄ /pages
  ‚îÇ     ‚îú‚îÄ‚îÄ api
  ‚îÇ     ‚îÇ     ‚îú‚îÄ‚îÄ login.js         // API –¥–ª—è –ª–æ–≥—ñ–Ω—É
  ‚îÇ     ‚îÇ     ‚îî‚îÄ‚îÄ user.js          // API –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
  ‚îÇ     ‚îú‚îÄ‚îÄ index.js
  ‚îÇ     ‚îî‚îÄ‚îÄ dashboard.js           // –ó–∞—Ö–∏—â–µ–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞
  ‚îú‚îÄ‚îÄ /utils
  ‚îÇ     ‚îî‚îÄ‚îÄ jwtHelper.js           // –†–æ–±–æ—Ç–∞ –∑ —Ç–æ–∫–µ–Ω–∞–º–∏
  ‚îî‚îÄ‚îÄ package.json
```

---

### üìå **2. –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Ç–æ–∫–µ–Ω–∞–º–∏ (`/utils/jwtHelper.js`)**

```javascript
import jwt from 'jsonwebtoken';

const SECRET_KEY = process.env.JWT_SECRET || 'your_secret_key';

// –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–æ–∫–µ–Ω–∞
export const generateToken = (payload, expiresIn = '5m') => {
  return jwt.sign(payload, SECRET_KEY, { expiresIn });
};

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
export const verifyToken = (token) => {
  try {
    return jwt.verify(token, SECRET_KEY);
  } catch (err) {
    return null;
  }
};
```

---

### üîë **3. –õ–æ–≥—ñ–Ω —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è HTTP-only cookie (`/pages/api/login.js`)**

```javascript
import { generateToken } from '../../utils/jwtHelper';
import cookie from 'cookie';

export default async function handler(req, res) {
  if (req.method !== 'POST') {
    return res.status(405).json({ message: 'Method Not Allowed' });
  }

  const { username, password } = req.body;

  // üîê –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–Ω–∞ —ñ –ø–∞—Ä–æ–ª—è (–∑–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ —Å–ø—Ä–∞–≤–∂–Ω—é –ø–µ—Ä–µ–≤—ñ—Ä–∫—É)
  if (username === 'admin' && password === 'password') {
    const payload = {
      username: 'admin',
      department: '–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω–∏–π –≤—ñ–¥–¥—ñ–ª',
      unit: '–ü—ñ–¥—Ä–æ–∑–¥—ñ–ª 1',
      position: '–Ü–Ω–∂–µ–Ω–µ—Ä',
    };

    const token = generateToken(payload, '5m'); // Acess Token –Ω–∞ 5 —Ö–≤

    res.setHeader('Set-Cookie', cookie.serialize('accessToken', token, {
      httpOnly: true,
      secure: process.env.NODE_ENV === 'production',
      sameSite: 'strict',
      maxAge: 60 * 5, // 5 —Ö–≤–∏–ª–∏–Ω
      path: '/',
    }));

    return res.status(200).json({ message: '–õ–æ–≥—ñ–Ω —É—Å–ø—ñ—à–Ω–∏–π' });
  }

  res.status(401).json({ message: '–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å' });
}
```

---

### üì• **4. –û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (`/pages/api/user.js`)**

```javascript
import { verifyToken } from '../../utils/jwtHelper';
import cookie from 'cookie';

export default async function handler(req, res) {
  const { accessToken } = cookie.parse(req.headers.cookie || '');

  if (!accessToken) {
    return res.status(401).json({ message: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ' });
  }

  const decoded = verifyToken(accessToken);

  if (!decoded) {
    return res.status(401).json({ message: '–¢–æ–∫–µ–Ω –Ω–µ–¥—ñ–π—Å–Ω–∏–π –∞–±–æ –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–∏–π' });
  }

  return res.status(200).json({
    username: decoded.username,
    department: decoded.department,
    unit: decoded.unit,
    position: decoded.position,
  });
}
```

---

### üîí **5. Middleware –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É —Å—Ç–æ—Ä—ñ–Ω–æ–∫ (`/middleware/withAuth.js`)**

```javascript
'use client';
import { useRouter } from 'next/navigation';
import { useEffect, useState } from 'react';

const withAuth = (WrappedComponent) => {
  return (props) => {
    const [loading, setLoading] = useState(true);
    const [user, setUser] = useState(null);
    const router = useRouter();

    useEffect(() => {
      const fetchUser = async () => {
        try {
          const res = await fetch('/api/user');
          if (res.status === 200) {
            const data = await res.json();
            setUser(data);
          } else {
            router.push('/login');
          }
        } catch (err) {
          console.error('–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó:', err);
          router.push('/login');
        } finally {
          setLoading(false);
        }
      };

      fetchUser();
    }, []);

    if (loading) return <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>;
    if (!user) return null;

    return <WrappedComponent {...props} user={user} />;
  };
};

export default withAuth;
```

---

### üîê **6. –ó–∞—Ö–∏—â–µ–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ (`/pages/dashboard.js`)**

```javascript
import withAuth from '../middleware/withAuth';

const Dashboard = ({ user }) => {
  return (
    <div>
      <h1>–í—ñ—Ç–∞—î–º–æ, {user.username}!</h1>
      <p>–í—ñ–¥–¥—ñ–ª: {user.department}</p>
      <p>–ü—ñ–¥—Ä–æ–∑–¥—ñ–ª: {user.unit}</p>
      <p>–ü–æ—Å–∞–¥–∞: {user.position}</p>
    </div>
  );
};

export default withAuth(Dashboard);
```

---

### üöÄ **7. –§–æ—Ä–º–∞ –ª–æ–≥—ñ–Ω—É (`/pages/login.js`)**

```javascript
'use client';
import { useRouter } from 'next/navigation';
import { useState } from 'react';

export default function LoginPage() {
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const router = useRouter();

  const handleLogin = async (e) => {
    e.preventDefault();
    try {
      const res = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password }),
      });

      if (res.ok) {
        router.push('/dashboard');
      } else {
        alert('–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å');
      }
    } catch (err) {
      console.error('–ü–æ–º–∏–ª–∫–∞ –ª–æ–≥—ñ–Ω—É:', err);
    }
  };

  return (
    <form onSubmit={handleLogin}>
      <input
        type="text"
        placeholder="–õ–æ–≥—ñ–Ω"
        value={username}
        onChange={(e) => setUsername(e.target.value)}
        required
      />
      <input
        type="password"
        placeholder="–ü–∞—Ä–æ–ª—å"
        value={password}
        onChange={(e) => setPassword(e.target.value)}
        required
      />
      <button type="submit">–í—Ö—ñ–¥</button>
    </form>
  );
}
```

---

## üõ° **8. –ë–µ–∑–ø–µ–∫–∞ HTTP-only Cookies**

1. **`httpOnly: true`** ‚Äî –∑–∞–±–æ—Ä–æ–Ω—è—î –¥–æ—Å—Ç—É–ø –¥–æ –∫—É–∫—ñ–≤ —á–µ—Ä–µ–∑ JavaScript (–∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ XSS).
2. **`secure: true`** ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ —Ç—ñ–ª—å–∫–∏ –ø–æ HTTPS.
3. **`sameSite: 'strict'`** ‚Äî –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ CSRF –∞—Ç–∞–∫.

---

## ‚öôÔ∏è **9. –í–∏—Å–Ω–æ–≤–æ–∫**

- **Access Token** –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É **HTTP-only Cookies** —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.  
- **–î–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** (–ø–æ–∑–∏—Ü—ñ—è, –≤—ñ–¥–¥—ñ–ª, –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª) –∑—á–∏—Ç—É—é—Ç—å—Å—è —ñ–∑ **JWT —Ç–æ–∫–µ–Ω–∞**.  
- **Middleware** –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Ç–æ–∫–µ–Ω —ñ –æ–±–º–µ–∂—É—î –¥–æ—Å—Ç—É–ø –¥–æ —Å—Ç–æ—Ä—ñ–Ω–æ–∫.  

–¶–µ –±–µ–∑–ø–µ—á–Ω–∏–π —ñ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –≤ Next.js.