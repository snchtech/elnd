–û—Å—å –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫–æ–¥, —è–∫–∏–π –º–∞—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∫–æ—Ä–µ–∫—Ç–Ω–æ:

1. **–ü—Ä–æ–±–ª–µ–º–∞ –∑ `fetch('/api/getUserData')`**: –£ —Ç–µ–±–µ –≤ `withAuth` –Ω–µ–º–∞—î –æ–±—Ä–æ–±–∫–∏ —Å–∏—Ç—É–∞—Ü—ñ—ó, –∫–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∞–±–æ fetch –≤–∏–∫–ª–∏–∫–∞—î –ø–æ–º–∏–ª–∫—É. –ö—Ä—ñ–º —Ç–æ–≥–æ, –≤—ñ–¥—Å—É—Ç–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ `headers.cookie`, —â–æ –º–æ–∂–µ —Å–ø—Ä–∏—á–∏–Ω—è—Ç–∏ –ø–æ–º–∏–ª–∫—É –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É API.

2. **–ü–æ–º–∏–ª–∫–∞ –∑ `displayName`**: –í HOC –∑–∞–≤–∂–¥–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ `displayName`, —â–æ–± –º–æ–∂–Ω–∞ –±—É–ª–æ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É DevTools.

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫–æ–¥

#### **API Route (`pages/api/getUserData.js`)**
```javascript
import cookie from 'cookie';
import jwt from 'jsonwebtoken';

export default function handler(req, res) {
  try {
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —î cookie –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
    if (!req.headers.cookie) {
      return res.status(401).json({ error: 'No cookies found' });
    }

    // –†–æ–∑–±–∏—Ä–∞—î–º–æ cookies
    const cookies = cookie.parse(req.headers.cookie);
    const token = cookies.token;

    if (!token) {
      return res.status(401).json({ error: 'No token found' });
    }

    // –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è JWT —Ç–æ–∫–µ–Ω–∞
    const userData = jwt.verify(token, process.env.JWT_SECRET);

    return res.status(200).json({ userData });
  } catch (error) {
    return res.status(400).json({ error: 'Invalid token' });
  }
}
```

---

#### **HOC (`withAuth.js`)**
```javascript
'use client';

import { useAuth } from '../context/AuthContext';
import { useRouter } from 'next/navigation';
import { useEffect, useState } from 'react';

const withAuth = (WrappedComponent, requiredRole = null) => {
  const AuthHOC = (props) => {
    const { authStatus, user, setUser } = useAuth();
    const router = useRouter();
    const [loading, setLoading] = useState(true);

    useEffect(() => {
      const fetchUserData = async () => {
        try {
          const response = await fetch('/api/getUserData', {
            method: 'GET',
            credentials: 'include', // –í–∞–∂–ª–∏–≤–æ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ cookies
            headers: {
              'Content-Type': 'application/json',
            },
          });

          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }

          const data = await response.json();
          if (data.userData) {
            setUser(data.userData);
          }
        } catch (error) {
          console.error('Error fetching user data:', error);
          router.push('/login'); // –†–µ–¥—ñ—Ä–µ–∫—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –ª–æ–≥—ñ–Ω—É
        } finally {
          setLoading(false);
        }
      };

      fetchUserData();
    }, []);

    if (loading) {
      return <p>Loading...</p>;
    }

    return <WrappedComponent {...props} />;
  };

  // –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è `displayName` –¥–ª—è DevTools
  AuthHOC.displayName = `withAuth(${WrappedComponent.displayName || WrappedComponent.name || 'Component'})`;

  return AuthHOC;
};

export default withAuth;
```

---

### **–©–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ:**
‚úÖ **–î–æ–¥–∞–Ω–æ `credentials: 'include'` –≤ `fetch`**, —â–æ–± –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ cookies –ø—Ä–∏ –∑–∞–ø–∏—Ç—ñ.<br>
‚úÖ **–î–æ–¥–∞–Ω–æ –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫** —É `fetchUserData`, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –Ω–µ–≤–∏–¥–∏–º–∏—Ö –ø–æ–º–∏–ª–æ–∫.<br>
‚úÖ **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ `displayName`** –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è HOC —É DevTools.<br>
‚úÖ **–†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –Ω–∞ `cookies` –≤ API –º–∞—Ä—à—Ä—É—Ç—ñ**, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–∫–∏ `undefined`.<br>
‚úÖ **–î–æ–¥–∞–Ω–æ `setUser(data.userData)`**, —â–æ–± –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —É `AuthContext`.<br>
‚úÖ **–Ø–∫—â–æ –∑–∞–ø–∏—Ç –Ω–µ–≤–¥–∞–ª–∏–π, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –Ω–∞ `/login`**.<br>

–¢–µ–ø–µ—Ä –≤—Å–µ –º–∞—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º! üöÄ