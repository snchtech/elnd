### üîπ **–í—Ä–∞—Ö—É–≤–∞–Ω–Ω—è —á–∞—Å—É –∂–∏—Ç—Ç—è (`accessExpireIn` —Ç–∞ `refreshExpireIn`)**
–£ —Ç–≤–æ—î–º—É –≤–∏–ø–∞–¥–∫—É, –¥–µ —á–∞—Å –∂–∏—Ç—Ç—è (`accessExpireIn` —ñ `refreshExpireIn`) **–∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ HTTP-only cookies**, –º–æ–∂–Ω–∞ –ø–æ–∫—Ä–∞—â–∏—Ç–∏ –ª–æ–≥—ñ–∫—É, —â–æ–± **–Ω–µ —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤—É–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω** –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ, –∞ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è —á–∞—Å—É.

‚úÖ **–ß–æ–º—É —Ü–µ –∫–æ—Ä–∏—Å–Ω–æ?**  
- **–ú–æ–∂–Ω–∞ —à–≤–∏–¥—à–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ —Å–µ—Å—ñ—é** –±–µ–∑ —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∫–∏ JWT.  
- **–ó–º–µ–Ω—à—É—î—Ç—å—Å—è –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä** (–Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É –¥–µ–∫–æ–¥—É–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω).  
- **–ü—Ä–æ—Å—Ç–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —á–∞—Å–æ–º –∂–∏—Ç—Ç—è** –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ `iat` (issued at) —É —Ç–æ–∫–µ–Ω—ñ.  

---

## üîπ **üìå 1. –û–Ω–æ–≤–ª–µ–Ω–∏–π API `/api/auth/checkAuth.js`**
–¶–µ–π API —Ç–µ–ø–µ—Ä –ø–µ—Ä–µ–≤—ñ—Ä—è—î **`accessExpireIn` —ñ `refreshExpireIn` –±–µ–∑ —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∫–∏ —Ç–æ–∫–µ–Ω—ñ–≤**.

```javascript
import { parse } from 'cookie';

export default function handler(req, res) {
  try {
    // –û—Ç—Ä–∏–º—É—î–º–æ cookies
    const cookies = parse(req.headers.cookie || '');

    const accessToken = cookies.accessToken;
    const refreshToken = cookies.refreshToken;
    const accessExpireIn = cookies.accessExpireIn ? parseInt(cookies.accessExpireIn, 10) : null;
    const refreshExpireIn = cookies.refreshExpireIn ? parseInt(cookies.refreshExpireIn, 10) : null;

    const currentTime = Math.floor(Date.now() / 1000); // –ü–æ—Ç–æ—á–Ω–∏–π —á–∞—Å —É —Å–µ–∫—É–Ω–¥–∞—Ö

    // –Ø–∫—â–æ –Ω–µ–º–∞—î —Ç–æ–∫–µ–Ω—ñ–≤ ‚Äì –≤–∏—Ö—ñ–¥
    if (!accessToken && !refreshToken) {
      return res.status(401).json({ isAuth: false, message: 'No tokens found' });
    }

    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∞—Å –∂–∏—Ç—Ç—è accessToken
    if (accessExpireIn && accessExpireIn > currentTime) {
      return res.status(200).json({ isAuth: true, userSession: 'access_valid' });
    }

    // –Ø–∫—â–æ accessToken –ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∏–π, –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ refreshToken
    if (refreshExpireIn && refreshExpireIn > currentTime) {
      return res.status(200).json({ isAuth: true, userSession: 'refresh_valid' });
    }

    // –Ø–∫—â–æ —ñ refreshToken –ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∏–π ‚Äì —Ä–æ–±–∏–º–æ logout
    res.setHeader('Set-Cookie', [
      'accessToken=; HttpOnly; Path=/; Max-Age=0',
      'refreshToken=; HttpOnly; Path=/; Max-Age=0',
      'accessExpireIn=; HttpOnly; Path=/; Max-Age=0',
      'refreshExpireIn=; HttpOnly; Path=/; Max-Age=0',
    ]);
    return res.status(401).json({ isAuth: false, message: 'Session expired' });

  } catch (error) {
    return res.status(500).json({ isAuth: false, message: 'Internal server error' });
  }
}
```

---

## üîπ **üìå 2. –û–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è `isAuth` (`utils/auth.js`)**
–¶—è —Ñ—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Å—Ç–∞—Ç—É—Å —Å–µ—Å—ñ—ó —á–µ—Ä–µ–∑ `/api/auth/checkAuth`.  
–Ø–∫—â–æ **–æ–±–∏–¥–≤–∞ —Ç–æ–∫–µ–Ω–∏ –ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω—ñ**, —Ç–æ –≤–æ–Ω–∞ –≤–∏–∫–æ–Ω—É—î logout —ñ —Ä–µ–¥—ñ—Ä–µ–∫—Ç.

```javascript
export const isAuth = async () => {
  try {
    const response = await fetch('/api/auth/checkAuth', {
      method: 'GET',
      credentials: 'include', // –ü–µ—Ä–µ–¥–∞—î HTTP-only cookies
      headers: { 'Content-Type': 'application/json' },
    });

    const data = await response.json();

    if (!data.isAuth) {
      // –Ø–∫—â–æ —Å–µ—Å—ñ—è –∑–∞–∫—ñ–Ω—á–∏–ª–∞—Å—è, –≤–∏–∫–æ–Ω—É—î–º–æ logout
      await fetch('/api/auth/logout', { method: 'POST', credentials: 'include' });
      window.location.href = '/login';
      return false;
    }

    return true;
  } catch (error) {
    console.error('Error checking auth:', error);
    return false;
  }
};
```

---

## üîπ **üìå 3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `isAuth` —É HOC `withAuth.js`**
```javascript
'use client';

import { useRouter } from 'next/navigation';
import { useEffect, useState } from 'react';
import { isAuth } from '../utils/auth';

const withAuth = (WrappedComponent) => {
  const AuthHOC = (props) => {
    const router = useRouter();
    const [loading, setLoading] = useState(true);

    useEffect(() => {
      const checkAuthentication = async () => {
        const authenticated = await isAuth();
        if (!authenticated) {
          router.push('/login');
        } else {
          setLoading(false);
        }
      };

      checkAuthentication();
    }, []);

    if (loading) {
      return <p>Loading...</p>;
    }

    return <WrappedComponent {...props} />;
  };

  AuthHOC.displayName = `withAuth(${WrappedComponent.displayName || WrappedComponent.name || 'Component'})`;

  return AuthHOC;
};

export default withAuth;
```

---

## üîπ **üìå 4. API `/api/auth/logout.js`**
–¶–µ–π API –≤–∏–¥–∞–ª—è—î –≤—Å—ñ —Å–µ—Å—ñ–π–Ω—ñ cookies, –≤–∫–ª—é—á–∞—é—á–∏ `accessExpireIn` —Ç–∞ `refreshExpireIn`.

```javascript
export default function handler(req, res) {
  res.setHeader('Set-Cookie', [
    'accessToken=; HttpOnly; Path=/; Max-Age=0',
    'refreshToken=; HttpOnly; Path=/; Max-Age=0',
    'accessExpireIn=; HttpOnly; Path=/; Max-Age=0',
    'refreshExpireIn=; HttpOnly; Path=/; Max-Age=0',
  ]);
  res.status(200).json({ message: 'Logged out' });
}
```

---

## üîπ **üìå 5. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `withAuth` —É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ**
```javascript
import withAuth from '../hoc/withAuth';

const Dashboard = () => {
  return <h1>Welcome to the Dashboard</h1>;
};

export default withAuth(Dashboard);
```

---

## ‚úÖ **üìå –ü—ñ–¥—Å—É–º–æ–∫**
‚úî **–ó–∞–º—ñ—Å—Ç—å –¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ —É `jwt.verify`, –º–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —ó—Ö `exp` –∑–Ω–∞—á–µ–Ω–Ω—è –∑ cookie.**  
‚úî **–ú–µ–Ω—à–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –æ—Å–∫—ñ–ª—å–∫–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —à–≤–∏–¥—à–µ.**  
‚úî **–Ø–∫—â–æ `accessToken` –≤–∞–ª—ñ–¥–Ω–∏–π ‚Üí –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π.**  
‚úî **–Ø–∫—â–æ `accessToken` –∑–∞–∫—ñ–Ω—á–∏–≤—Å—è, –∞–ª–µ `refreshToken` —â–µ –∞–∫—Ç–∏–≤–Ω–∏–π ‚Üí –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ç–µ–∂ –≤–≤–∞–∂–∞—î—Ç—å—Å—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–º.**  
‚úî **–Ø–∫—â–æ –æ–±–∏–¥–≤–∞ —Ç–æ–∫–µ–Ω–∏ –∑–∞–∫—ñ–Ω—á–∏–ª–∏—Å—è ‚Üí –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è `logout` —ñ —Ä–µ–¥—ñ—Ä–µ–∫—Ç.**  

üîπ **–¢–µ–ø–µ—Ä —Ç–≤–æ—è –ª–æ–≥—ñ–∫–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –ø–æ–≤–Ω—ñ—Å—Ç—é –≤—Ä–∞—Ö–æ–≤—É—î —á–∞—Å –∂–∏—Ç—Ç—è —Ç–æ–∫–µ–Ω—ñ–≤ –±–µ–∑ —ó—Ö –¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è! üöÄ**