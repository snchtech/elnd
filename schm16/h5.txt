–¢–∞–∫, –º–æ–∂–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ `fetchWithRefresh`, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `isAuth`. –ó–∞—Ä–∞–∑ —É —Ç–≤–æ—î–º—É –∫–æ–¥—ñ:
1. **–¢–∏ –≤—Ä—É—á–Ω—É –∑—á–∏—Ç—É—î—à `document.cookie` –¥–ª—è `accessTokenExpIn`** ‚Üí –¶–µ –Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, –±–æ cookie **HTTP-only** —ñ –Ω–µ –∑–∞–≤–∂–¥–∏ –¥–æ—Å—Ç—É–ø–Ω–µ –≤ `document.cookie`.
2. **–ó–∞–ø–∏—Ç `/api/auth/refresh` —Ä–æ–±–∏—Ç—å—Å—è –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤** ‚Üí –Ø–∫—â–æ —Ç–æ–∫–µ–Ω –Ω–µ–¥—ñ–π—Å–Ω–∏–π, –∑–∞–ø–∏—Ç `/api/auth/refresh` –º–æ–∂–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—å –¥–≤—ñ—á—ñ.
3. **–ö—Ä–∞—â–µ –æ–∫—Ä–µ–º–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ `isAuth` –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Ç–æ–º** ‚Üí –ê –Ω–µ –ø—ñ–¥ —á–∞—Å –∫–æ–∂–Ω–æ–≥–æ `fetch`.

---

## üîπ **üìå –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ –≤–µ—Ä—Å—ñ—è `fetchWithRefresh`**
–û–Ω–æ–≤–∏–º–æ –∫–æ–¥, —â–æ–± –≤—ñ–Ω:
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤ `isAuth()` –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–æ–∫–µ–Ω—ñ–≤ –ø–µ—Ä–µ–¥ –æ—Å–Ω–æ–≤–Ω–∏–º –∑–∞–ø–∏—Ç–æ–º.
- –†–æ–±–∏–≤ `refreshToken` **—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ `isAuth()` –ø–æ–≤–µ—Ä—Ç–∞—î `false`**.
- **–ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤ `document.cookie` –Ω–∞–ø—Ä—è–º—É**, –±–æ `HTTP-only` cookies –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ.

### **üìù –û–Ω–æ–≤–ª–µ–Ω–∏–π `fetchWithRefresh.js`**
```javascript
import { isAuth } from './auth';

export const fetchWithRefresh = async (url, options = {}) => {
  try {
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é –ø–µ—Ä–µ–¥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è–º –∑–∞–ø–∏—Ç—É
    const authenticated = await isAuth();

    if (!authenticated) {
      console.warn("Session expired. Refreshing tokens...");
      const refreshRes = await fetch("/api/auth/refresh", { method: "POST", credentials: "include" });

      if (!refreshRes.ok) {
        throw new Error("Failed to refresh tokens");
      }
    }

    // –í–∏–∫–æ–Ω—É—î–º–æ –æ—Å–Ω–æ–≤–Ω–∏–π –∑–∞–ø–∏—Ç –ø—ñ—Å–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞
    const res = await fetch(url, {
      ...options,
      credentials: "include", // –í–∞–∂–ª–∏–≤–æ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ `HTTP-only` cookies
    });

    if (res.ok) {
      return await res.json();
    }

    // –Ø–∫—â–æ –æ—Å–Ω–æ–≤–Ω–∏–π –∑–∞–ø–∏—Ç –ø–æ–≤–µ—Ä—Ç–∞—î 401, –ø—Ä–æ–±—É—î–º–æ –ø–æ–Ω–æ–≤–∏—Ç–∏ —Ç–æ–∫–µ–Ω —ñ –ø–æ–≤—Ç–æ—Ä–∏—Ç–∏ –∑–∞–ø–∏—Ç
    if (res.status === 401) {
      console.warn("Access token expired during request. Refreshing...");

      // –ü—Ä–æ–±—É—î–º–æ –ø–æ–Ω–æ–≤–∏—Ç–∏ —Ç–æ–∫–µ–Ω
      const refreshRes = await fetch("/api/auth/refresh", { method: "POST", credentials: "include" });

      if (!refreshRes.ok) {
        throw new Error("Failed to refresh tokens after 401");
      }

      // –ü–æ–≤—Ç–æ—Ä—é—î–º–æ –∑–∞–ø–∏—Ç –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
      const retryRes = await fetch(url, {
        ...options,
        credentials: "include",
      });

      if (!retryRes.ok) {
        throw new Error("Failed to fetch data after token refresh");
      }

      return await retryRes.json();
    }

    throw new Error(`Failed to fetch: ${res.statusText}`);
  } catch (err) {
    console.error("Error fetching data:", err);
    throw err;
  }
};
```

---

## üîπ **üìå –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ `isAuth.js`**
–ó–∞–º—ñ—Å—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ `document.cookie`, –º–∏ —Ä–æ–±–∏–º–æ –∑–∞–ø–∏—Ç –¥–æ `/api/auth/checkAuth`, —è–∫–∏–π **–ø–µ—Ä–µ–≤—ñ—Ä—è—î `accessTokenExpIn` —Ç–∞ `refreshTokenExpIn` –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ**.

```javascript
export const isAuth = async () => {
  try {
    const response = await fetch('/api/auth/checkAuth', {
      method: 'GET',
      credentials: 'include', // –ü–µ—Ä–µ–¥–∞—î HTTP-only cookies
      headers: { 'Content-Type': 'application/json' },
    });

    const data = await response.json();

    if (!data.isAuth) {
      return false;
    }

    return true;
  } catch (error) {
    console.error('Error checking auth:', error);
    return false;
  }
};
```

---

## üîπ **üìå –©–æ –∑–º—ñ–Ω–∏–ª–æ—Å—è —Ç–∞ —è–∫—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è**
| ‚ùå –°—Ç–∞—Ä–∏–π –∫–æ–¥ | ‚úÖ –ù–æ–≤–∏–π –∫–æ–¥ |
|--------------|------------|
| –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `document.cookie`, —è–∫–∏–π –Ω–µ –º–æ–∂–µ –∑—á–∏—Ç—É–≤–∞—Ç–∏ `HTTP-only` cookies | –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `isAuth()`, —è–∫–∏–π –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä |
| `refreshToken` –∑–∞–ø–∏—Ç—É—î—Ç—å—Å—è –¥–≤—ñ—á—ñ (–ø—Ä–∏ `accessTokenExpIn` —ñ –ø—ñ—Å–ª—è 401) | `refreshToken` –∑–∞–ø–∏—Ç—É—î—Ç—å—Å—è **—Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑** –ø—Ä–∏ `isAuth() === false` |
| –ö–æ–¥ `fetch` –Ω–µ –±—É–≤ —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–º (–±—É–ª–æ –∫—ñ–ª—å–∫–∞ `fetch`) | `fetch` —Ç–µ–ø–µ—Ä –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è **—Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞** |
| –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤ `credentials: 'include'` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ cookies | –î–æ–¥–∞—î `credentials: 'include'`, —â–æ–± `HTTP-only` cookies –ø—Ä–∞—Ü—é–≤–∞–ª–∏ |

---

## üîπ **üìå –Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `fetchWithRefresh`**
–¢–µ–ø–µ—Ä –∑–∞–ø–∏—Ç–∏ –¥–æ API –º–æ–∂–Ω–∞ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —Ç–∞–∫:
```javascript
const getUserData = async () => {
  try {
    const data = await fetchWithRefresh('/api/user/data');
    console.log('User Data:', data);
  } catch (error) {
    console.error('Error fetching user data:', error);
  }
};
```

‚úÖ **–ö–æ–ª–∏ —Ç–æ–∫–µ–Ω –≤–∞–ª—ñ–¥–Ω–∏–π** ‚Üí API-–∑–∞–ø–∏—Ç –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤—ñ–¥—Ä–∞–∑—É.  
‚úÖ **–ö–æ–ª–∏ `accessToken` –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–∏–π** ‚Üí –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è `refreshToken`, –ø–æ—Ç—ñ–º –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∑–∞–ø–∏—Ç.  
‚úÖ **–ö–æ–ª–∏ `refreshToken` —Ç–µ–∂ –Ω–µ–¥—ñ–π—Å–Ω–∏–π** ‚Üí —Ä–µ–¥—ñ—Ä–µ–∫—Ç –Ω–∞ `/login`.

---

## üîπ **üìå –¢–µ–ø–µ—Ä —Ç–≤—ñ–π fetch –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π! üöÄ**
- **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `isAuth()` –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–æ–∫–µ–Ω—ñ–≤ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Ç–æ–º.**
- **–û–Ω–æ–≤–ª—é—î `accessToken` –ª–∏—à–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ (—Ä–∞–∑–æ–º —ñ–∑ `isAuth()`).**
- **–ù–µ –∑—á–∏—Ç—É—î `document.cookie`, –∞ –ø—Ä–∞—Ü—é—î –∑ HTTP-only cookies —á–µ—Ä–µ–∑ `credentials: include`.**
- **–ü—Ä–∞—Ü—é—î –±–µ–∑ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤ –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ –ø–æ–Ω–æ–≤–ª–µ–Ω–Ω—è.**

üîπ **–ì–æ—Ç–æ–≤–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É! üî•**