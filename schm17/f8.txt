### ‚úÖ **üìå –í—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –ø–µ—Ä—à–µ –ø–∏—Ç–∞–Ω–Ω—è: —á–∏ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ `accessTokenEtls` –Ω–∞ 30 —Ö–≤ –¥–ª—è –∑–º–µ–Ω—à–µ–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ API?**
–¢–∞–∫, —è–∫—â–æ —Ç–∏ **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à `accessTokenEtls` –∑ —á–∞—Å–æ–º –∂–∏—Ç—Ç—è 30 —Ö–≤**, —Ç–æ:
- **Next.js middleware** –∑–º–æ–∂–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é –±–µ–∑ –∑–≤–µ—Ä–Ω–µ–Ω—å –¥–æ —Å—Ç–æ—Ä–æ–Ω–Ω—å–æ–≥–æ API.
- –û–Ω–æ–≤–ª–µ–Ω–Ω—è `accessTokenEtls` –±—É–¥–µ –≤—ñ–¥–±—É–≤–∞—Ç–∏—Å—è **—Ä–∞–∑ –Ω–∞ 30 —Ö–≤–∏–ª–∏–Ω**, —â–æ **–∑–º–µ–Ω—à–∏—Ç—å –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è** –Ω–∞ API.

üìå **–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î?**
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ä–æ–±–∏—Ç—å –∑–∞–ø–∏—Ç ‚Üí `middleware.js` –ø–µ—Ä–µ–≤—ñ—Ä—è—î `accessTokenEtls` (–±–µ–∑ API).
- `accessTokenEtls` –ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω—É–≤–∞–≤—Å—è ‚Üí –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∑–∞–ø–∏—Ç –¥–æ `/api/auth/refreshtoken`, –¥–µ –≤–∂–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è `refreshTokenEtls`.
- –Ø–∫—â–æ `refreshTokenEtls` —â–µ –∞–∫—Ç–∏–≤–Ω–∏–π ‚Üí –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø–∞—Ä–∞ `accessTokenEtls` + `refreshTokenEtls`.
- –Ø–∫—â–æ `refreshTokenEtls` —Ç–∞–∫–æ–∂ –Ω–µ–¥—ñ–π—Å–Ω–∏–π ‚Üí –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è **logout**.

üìå **–í–∏–≥–æ–¥–∞:**  
‚úî **–ó–Ω–∞—á–Ω–µ –∑–º–µ–Ω—à–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ API**.  
‚úî **–ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —É `middleware.js`** (–ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ `accessTokenEtls`).  
‚úî **–¢–æ—á–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–µ—Å—ñ—ó** —É Next.js –±–µ–∑ –∑–∞–π–≤–∏—Ö –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ –Ω–∞ API.

üìå **–ö–æ–ª–∏ `accessTokenEtls` –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è?**
- –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á **–∞–∫—Ç–∏–≤–Ω–∏–π**, `accessTokenEtls` –æ–Ω–æ–≤–∏—Ç—å—Å—è –∫–æ–∂–Ω—ñ 30 —Ö–≤.
- –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á **–Ω–µ–∞–∫—Ç–∏–≤–Ω–∏–π**, –π–æ–≥–æ —Å–µ—Å—ñ—è –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è **–∂–∏—Ç—Ç—è `refreshTokenEtls`**.

**üîπ –í–∏—Å–Ω–æ–≤–æ–∫:** ‚úÖ **–¶–µ–π –ø—ñ–¥—Ö—ñ–¥ –¥–æ–∑–≤–æ–ª—è—î middleware –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –±–µ–∑ API —ñ —Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç –Ω–∞ API –ª–∏—à–µ —Ä–∞–∑ –Ω–∞ 30 —Ö–≤–∏–ª–∏–Ω. –¶–µ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç! üöÄ**

---

### ‚úÖ **üìå –í—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –¥—Ä—É–≥–µ –ø–∏—Ç–∞–Ω–Ω—è: —â–æ –±—É–¥–µ, —è–∫—â–æ `refreshToken` –Ω–∞ API –≤–∂–µ –ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∏–π –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É `${REMOTE_API}/token-info`?**
üìå **–°—Ü–µ–Ω–∞—Ä—ñ–π:**  
1. Next.js –≤–∏–∫–æ–Ω—É—î `fetch(`${REMOTE_API}/token-info`)`, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ `refreshExpireIn`.
2. –ê–ª–µ –Ω–∞ API `refreshToken` —É–∂–µ –Ω–µ–¥—ñ–π—Å–Ω–∏–π, —Ç–æ–º—É API –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç—å `401 Unauthorized`.
3. –í Next.js —Ü–µ –æ–∑–Ω–∞—á–∞—î, —â–æ **–Ω–µ–º–∞—î —Å–µ–Ω—Å—É –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω–∏, –±–æ —Å—Ç–æ—Ä–æ–Ω–Ω—î API –≤–∂–µ –∞–Ω—É–ª—é–≤–∞–ª–æ —Å–µ—Å—ñ—é**.

üìå **–©–æ —Ä–æ–±–∏—Ç–∏ –≤ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É?**
- –Ø–∫—â–æ `refreshToken` –≤–∂–µ –Ω–µ–¥—ñ–π—Å–Ω–∏–π, –ø–æ—Ç—Ä—ñ–±–Ω–æ **–≤—ñ–¥—Ä–∞–∑—É –≤–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ —Å–µ—Å—ñ–π–Ω—ñ cookies —ñ –∑—Ä–æ–±–∏—Ç–∏ logout**.

üìå **–Ø–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–æ–±–∏—Ç–∏ —Ü—é —Å–∏—Ç—É–∞—Ü—ñ—é —É –∫–æ–¥—ñ?**
```javascript
try {
  const refreshInfo = await fetch(`${REMOTE_API}/token-info`, { method: "GET" });

  if (refreshInfo.status === 401) {
    console.warn("refreshToken expired on API. Logging out...");
    return logoutUser();
  }

  const { refreshExpireIn } = await refreshInfo.json();
} catch (error) {
  console.error("Error fetching token-info:", error);
  return logoutUser();
}

// –§—É–Ω–∫—Ü—ñ—è –≤–∏—Ö–æ–¥—É
function logoutUser() {
  return NextResponse.redirect(new URL("/login", req.url), {
    headers: {
      "Set-Cookie": [
        "accessTokenEtls=; HttpOnly; Path=/; Max-Age=0",
        "refreshTokenEtls=; HttpOnly; Path=/; Max-Age=0",
        "accessToken=; HttpOnly; Path=/; Max-Age=0",
        "refreshToken=; HttpOnly; Path=/; Max-Age=0",
      ].join(", "),
    },
  });
}
```

üìå **–©–æ —Ä–æ–±–∏—Ç—å —Ü–µ–π –∫–æ–¥?**
‚úî **–ü–µ—Ä–µ–≤—ñ—Ä—è—î —Å—Ç–∞—Ç—É—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ `token-info`** ‚Üí —è–∫—â–æ `401`, –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è logout.  
‚úî **–í–∏–¥–∞–ª—è—î –≤—Å—ñ —Ç–æ–∫–µ–Ω–∏** –ø–µ—Ä–µ–¥ —Ä–µ–¥—ñ—Ä–µ–∫—Ç–æ–º –Ω–∞ `/login`.  
‚úî **–õ–æ–≥—ñ—á–Ω–æ –∑–∞–≤–µ—Ä—à—É—î —Å–µ—Å—ñ—é** –Ω–∞ Next.js, —è–∫—â–æ —Å—Ç–æ—Ä–æ–Ω–Ω—î API –≤–∂–µ –≤–∏–¥–∞–ª–∏–ª–æ `refreshToken`.  

**üîπ –í–∏—Å–Ω–æ–≤–æ–∫:** ‚úÖ **–¶–µ–π –º–µ—Ö–∞–Ω—ñ–∑–º –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –Ω–µ –±—É–¥–µ —Ä–æ–∑—Å–∏–Ω—Ö—Ä–æ–Ω—É –º—ñ–∂ —Ç–æ–∫–µ–Ω–∞–º–∏ —É Next.js —Ç–∞ API. üöÄ**