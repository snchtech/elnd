## ‚úÖ **–ê–Ω–∞–ª—ñ–∑ –ø—ñ–¥—Ö–æ–¥—É –∑ –¥–≤–æ–º–∞ —Å–µ—Å—ñ—è–º–∏ JWT (–æ–∫—Ä–µ–º–æ –¥–ª—è Next.js —ñ API)**

### **üìå –û—Å–Ω–æ–≤–Ω–∞ —ñ–¥–µ—è**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **–¥–≤–∞ –Ω–∞–±–æ—Ä–∏ JWT —Ç–æ–∫–µ–Ω—ñ–≤**:
  - **Next.js JWT (`accessTokenEtls` & `refreshTokenEtls`)** ‚Üí –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è **–ª–æ–∫–∞–ª—å–Ω–æ—ó –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó** –≤ Next.js, –∑–º–µ–Ω—à—É—î –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ API.
  - **API JWT (`accessToken` & `refreshToken`)** ‚Üí –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ **–∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ API**, –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ª–∏—à–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ.

---
## **üîπ –ß–æ–º—É —Ü–µ–π –ø—ñ–¥—Ö—ñ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π?**
‚úÖ **1. –ó–º–µ–Ω—à–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ API**
- **Next.js –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `accessTokenEtls`** –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó **–ª–æ–∫–∞–ª—å–Ω–æ** (–≤ `middleware.js`, —É protected routes).
- **–ó–∞–ø–∏—Ç–∏ –Ω–∞ API —Ä–æ–±–ª—è—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ** (—Ä–∞–∑ –Ω–∞ 30 —Ö–≤ ‚Äì 1 –≥–æ–¥ –∑–∞–º—ñ—Å—Ç—å –∫–æ–∂–Ω–æ–≥–æ HTTP-–∑–∞–ø–∏—Ç—É).

‚úÖ **2. –ë–µ–∑–ø–µ—á–Ω–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤**
- **–û–±–∏–¥–≤–∞ —Ç–æ–∫–µ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ HTTP-only cookies**, —â–æ –∑–∞—Ö–∏—â–∞—î —ó—Ö –≤—ñ–¥ XSS-–∞—Ç–∞–∫.
- **–†–æ–∑–¥—ñ–ª–µ–Ω–Ω—è —Å–µ—Å—ñ–π –º—ñ–∂ Next.js —ñ API** ‚Üí —è–∫—â–æ `refreshToken` API –∑–∞–∫—ñ–Ω—á–∏—Ç—å—Å—è, Next.js —Ü–µ —à–≤–∏–¥–∫–æ –≤–∏—è–≤–∏—Ç—å —ñ –æ—á–∏—Å—Ç–∏—Ç—å —Å–≤–æ—é —Å–µ—Å—ñ—é.

‚úÖ **3. –ì–Ω—É—á–∫—ñ—Å—Ç—å —É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—ñ —Å–µ—Å—ñ—ó**
- –ú–æ–∂–Ω–∞ **–Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º—ñ —á–∞—Å–∏ –∂–∏—Ç—Ç—è —Ç–æ–∫–µ–Ω—ñ–≤**, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:
  - `accessTokenEtls = 30 —Ö–≤`
  - `refreshTokenEtls = 12 –≥–æ–¥`
  - `accessToken = 10 —Ö–≤`
  - `refreshToken = 12 –≥–æ–¥`
- –¶–µ –¥–æ–∑–≤–æ–ª—è—î **–ª–æ–∫–∞–ª—å–Ω–æ —Ç—Ä–∏–º–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–º** –ø—Ä–æ—Ç—è–≥–æ–º 30 —Ö–≤ –±–µ–∑ –∑–∞–π–≤–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ API.

‚úÖ **4. –ö—Ä–∞—â–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–µ—Å—ñ—ó**
- –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á **–Ω–µ–∞–∫—Ç–∏–≤–Ω–∏–π –ø—Ä–æ—Ç—è–≥–æ–º 12 –≥–æ–¥**, —Ç–æ –æ–±–∏–¥–≤–∞ `refreshToken` —Å—Ç–∞–Ω—É—Ç—å –Ω–µ–¥—ñ–π—Å–Ω–∏–º–∏, —ñ —Å–µ—Å—ñ—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è.
- –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á **–∞–∫—Ç–∏–≤–Ω–∏–π**, Next.js –æ–Ω–æ–≤–ª—é—î `accessTokenEtls`, –∞–ª–µ –∑–∞–ø–∏—Ç—É—î –Ω–æ–≤—ñ API-—Ç–æ–∫–µ–Ω–∏ —Ç—ñ–ª—å–∫–∏ —Ä–∞–∑ –Ω–∞ 30-40 —Ö–≤.

‚úÖ **5. –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**
- **Next.js –ø—Ä–∞—Ü—é—î —à–≤–∏–¥—à–µ**, –±–æ **–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ**.
- –ó–∞–ø–∏—Ç–∏ –Ω–∞ API **—Ä–æ–±–ª—è—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω—ñ–π –ø–æ—Ç—Ä–µ–±—ñ** (–æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤, –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö).
- **–ú–µ–Ω—à–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä API**, —â–æ –≤–∞–∂–ª–∏–≤–æ –ø—Ä–∏ –≤–µ–ª–∏–∫—ñ–π –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.

---

## **üîπ –ú–æ–∂–ª–∏–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏ —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó**
### **üìå 1. –†–∏–∑–∏–∫ —Ä–æ–∑—Å–∏–Ω—Ö—Ä–æ–Ω—É –º—ñ–∂ `refreshToken` API —ñ Next.js**
‚ùå **–ü—Ä–æ–±–ª–µ–º–∞:** –Ø–∫—â–æ `refreshToken` –Ω–∞ API –≤–∂–µ –ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∏–π, –∞ `refreshTokenEtls` —â–µ –¥—ñ—î, Next.js –Ω–µ –∑–º–æ–∂–µ –æ–Ω–æ–≤–∏—Ç–∏ API —Ç–æ–∫–µ–Ω–∏.

‚úÖ **–†—ñ—à–µ–Ω–Ω—è:**  
- –ü—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ `accessTokenEtls`, **–ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ `refreshExpireIn` API** —á–µ—Ä–µ–∑ `/token-info`.
- –Ø–∫—â–æ `refreshToken` API –≤–∂–µ –∑–∞–∫—ñ–Ω—á–∏–≤—Å—è ‚Üí –Ω–µ–≥–∞–π–Ω–æ –≤–∏–¥–∞–ª–∏—Ç–∏ **–≤—Å—ñ —Ç–æ–∫–µ–Ω–∏ –≤ Next.js** —ñ **–≤–∏–π—Ç–∏ –∑ —Å–∏—Å—Ç–µ–º–∏**.

```javascript
const refreshInfo = await fetch(`${REMOTE_API}/token-info`, { method: "GET" });

if (refreshInfo.status === 401) {
  console.warn("refreshToken expired on API. Logging out...");
  return logoutUser(); // –û—á–∏—â–µ–Ω–Ω—è cookies —ñ —Ä–µ–¥—ñ—Ä–µ–∫—Ç
}
```

---

### **üìå 2. –î—É–±–ª—é–≤–∞–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –≤ Next.js —ñ API**
‚ùå **–ü—Ä–æ–±–ª–µ–º–∞:** –í –æ–±–æ—Ö —Å–∏—Å—Ç–µ–º–∞—Ö (`Next.js` —Ç–∞ `API`) –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∫–æ–¥ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ JWT.

‚úÖ **–†—ñ—à–µ–Ω–Ω—è:**  
- **–í–∏–Ω–µ—Å—Ç–∏ –∑–∞–≥–∞–ª—å–Ω—É –ª–æ–≥—ñ–∫—É —Ä–æ–±–æ—Ç–∏ –∑ JWT —É —Å–ø—ñ–ª—å–Ω–∏–π –º–æ–¥—É–ª—å** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –æ–∫—Ä–µ–º–∏–π `jwt-utils.js` –¥–ª—è –æ–±–æ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤).
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **–æ–¥–∏–Ω —ñ —Ç–æ–π —Å–∞–º–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Ç–æ–∫–µ–Ω—ñ–≤**.

---

### **üìå 3. –û–Ω–æ–≤–ª–µ–Ω–Ω—è `refreshTokenEtls` –ª–∏—à–µ –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ**
‚ùå **–ü—Ä–æ–±–ª–µ–º–∞:** –Ø–∫—â–æ `refreshTokenEtls` –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è **–∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É, –∫–æ–ª–∏ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è `accessTokenEtls`**, —Ü–µ –º–æ–∂–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –∑–∞–π–≤—ñ –∑–∞–ø–∏—Ç–∏.

‚úÖ **–†—ñ—à–µ–Ω–Ω—è:**  
- –û–Ω–æ–≤–ª—é–≤–∞—Ç–∏ `refreshTokenEtls` **–ª–∏—à–µ —è–∫—â–æ –∑–∞–ª–∏—à–∏–ª–æ—Å—å –º–µ–Ω—à–µ 2 –≥–æ–¥ –¥–æ –π–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è**.
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ª–æ–≥—ñ–∫—É:
  ```javascript
  if (refreshExpireIn - refreshEtlsExpireIn < 2 * 60 * 60) {
    // –û–Ω–æ–≤–ª—é—î–º–æ —ñ refreshTokenEtls
  }
  ```

---

## **üîπ –ü—ñ–¥—Å—É–º–∫–æ–≤–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø—ñ–¥—Ö–æ–¥—É**
| –ö—Ä–∏—Ç–µ—Ä—ñ–π | –û—Ü—ñ–Ω–∫–∞ (‚≠ê 1-5) | –ö–æ–º–µ–Ω—Ç–∞—Ä |
|----------|---------------|-----------|
| **–ó–º–µ–Ω—à–µ–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ API** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | –ó–Ω–∞—á–Ω–æ –∑–Ω–∏–∂—É—î –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, –æ—Å–æ–±–ª–∏–≤–æ –ø—Ä–∏ –≤–∏—Å–æ–∫—ñ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ |
| **–ë–µ–∑–ø–µ–∫–∞** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `HTTP-only cookies`, –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ XSS |
| **–ì–Ω—É—á–∫—ñ—Å—Ç—å —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–µ—Å—ñ—î—é** | ‚≠ê‚≠ê‚≠ê‚≠ê | –õ–æ–∫–∞–ª—å–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–µ—Å—ñ—ó –≤ Next.js –¥–∞—î –±—ñ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—é |
| **–†–∏–∑–∏–∫ —Ä–æ–∑—Å–∏–Ω—Ö—Ä–æ–Ω—É** | ‚≠ê‚≠ê‚≠ê | –Ø–∫—â–æ `refreshToken` API –∑–∞–∫—ñ–Ω—á–∏—Ç—å—Å—è —Ä–∞–Ω—ñ—à–µ, —Ç–æ Next.js –º–æ–∂–µ –±—É—Ç–∏ —â–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π |
| **–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó** | ‚≠ê‚≠ê‚≠ê‚≠ê | –ü–æ—Ç—Ä—ñ–±–Ω–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–≤—ñ JWT-—Å–µ—Å—ñ—ó |

---

## **‚úÖ –í–∏—Å–Ω–æ–≤–æ–∫: —Ü–µ–π –ø—ñ–¥—Ö—ñ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π, —è–∫—â–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π**
‚úî **–î–æ–∑–≤–æ–ª—è—î Next.js —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –±–µ–∑ –∑–≤–µ—Ä–Ω–µ–Ω—å –¥–æ API**.  
‚úî **–ú—ñ–Ω—ñ–º—ñ–∑—É—î –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ API, –æ—Å–∫—ñ–ª—å–∫–∏ –∑–∞–ø–∏—Ç–∏ –Ω–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ —Ä–æ–±–ª—è—Ç—å—Å—è –ª–∏—à–µ —Ä–∞–∑ –Ω–∞ 30 —Ö–≤–∏–ª–∏–Ω**.  
‚úî **–ì–Ω—É—á–∫–æ –∫–µ—Ä—É—î —Å–µ—Å—ñ—î—é**: –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–º —É Next.js –¥–æ–≤—à–µ, –Ω—ñ–∂ —É —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É –ø—ñ–¥—Ö–æ–¥—ñ –∑ –æ–¥–Ω–∏–º —Ç–æ–∫–µ–Ω–æ–º.  

üîπ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:**  
1. **–ü–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ `refreshToken` API –ø–µ—Ä–µ–¥ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º `accessTokenEtls`**.  
2. **–û–Ω–æ–≤–ª—é–≤–∞—Ç–∏ `refreshTokenEtls` –ª–∏—à–µ –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ**.  
3. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —î–¥–∏–Ω—É –ª–æ–≥—ñ–∫—É –¥–ª—è JWT —É Next.js —ñ API**.  

üöÄ **–Ø–∫—â–æ –≤—Å–µ —Ü–µ –±—É–¥–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ ‚Äì –ø—ñ–¥—Ö—ñ–¥ —ñ–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–∏—Ö –ø—Ä–æ–µ–∫—Ç—ñ–≤!**