### ‚úÖ **üìå –Ø–∫ `Set-Cookie` –≤ `refreshresttokens.js` –æ–Ω–æ–≤–ª—é—î cookies, —è–∫—â–æ –∑–∞–ø–∏—Ç —Å–ø–æ—á–∞—Ç–∫—É –π–¥–µ –¥–æ `customFetch`?**
–¢–≤—ñ–π –≤–∏–ø–∞–¥–æ–∫ —É—Å–∫–ª–∞–¥–Ω—é—î—Ç—å—Å—è —Ç–∏–º, —â–æ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É –±—Ä–∞—É–∑–µ—Ä—ñ –Ω–µ —Ä–æ–±–∏—Ç—å –∑–∞–ø–∏—Ç –Ω–∞–ø—Ä—è–º—É –¥–æ `refreshresttokens`, –∞ –¥–æ `customFetch`**. –û—Ç–∂–µ, –æ–Ω–æ–≤–ª–µ–Ω–Ω—è `cookies` –ø–æ–≤–∏–Ω–Ω–æ –ø—Ä–æ–π—Ç–∏ —á–µ—Ä–µ–∑ `customFetch`.

---

## üîπ **üìå –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –∫—Ä–æ–∫ –∑–∞ –∫—Ä–æ–∫–æ–º**
### **1Ô∏è‚É£ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ä–æ–±–∏—Ç—å –∑–∞–ø–∏—Ç –¥–æ `customFetch`**
```javascript
const response = await fetch("/api/rest/customfetch", {
  method: "POST",
  credentials: "include", // –î–æ–∑–≤–æ–ª—è—î –±—Ä–∞—É–∑–µ—Ä—É –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ cookies
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ url: "/departments", options: { method: "GET" } }),
});
```
‚úî `credentials: "include"` –¥–æ–∑–≤–æ–ª—è—î –±—Ä–∞—É–∑–µ—Ä—É –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ **–ø–æ—Ç–æ—á–Ω—ñ `cookies`**.

---

### **2Ô∏è‚É£ `customFetch` –±–∞—á–∏—Ç—å, —â–æ `accessToken` –∑–∞–∫—ñ–Ω—á–∏–≤—Å—è, —ñ —Ä–æ–±–∏—Ç—å –∑–∞–ø–∏—Ç –¥–æ `refreshresttokens`**
```javascript
const refreshResponse = await fetch("/api/rest/refreshresttokens", {
  method: "POST",
  credentials: "include", // –î–æ–∑–≤–æ–ª—è—î –æ—Ç—Ä–∏–º–∞—Ç–∏ –Ω–æ–≤—ñ cookies
  headers: { "Content-Type": "application/json" },
});
```
‚úî `credentials: "include"` **–≥–∞—Ä–∞–Ω—Ç—É—î**, —â–æ **–±—Ä–∞—É–∑–µ—Ä –æ—Ç—Ä–∏–º–∞—î –Ω–æ–≤—ñ cookies** —É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.

---

### **3Ô∏è‚É£ `refreshresttokens.js` –æ–Ω–æ–≤–ª—é—î `Set-Cookie`**
```javascript
const response = NextResponse.json({ message: "Tokens refreshed" });

response.headers.set(
  "Set-Cookie",
  [
    `accessToken=${accessToken}; HttpOnly; Path=/; Secure; SameSite=Strict`,
    `refreshToken=${newRefreshToken}; HttpOnly; Path=/; Secure; SameSite=Strict`,
    `userDataEtls=${userDataEtls}; HttpOnly; Path=/; Secure; SameSite=Strict`,
  ].join(", ")
);

return response;
```
‚úî **–¶–µ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –Ω–æ–≤—ñ `cookies` —É –≤—ñ–¥–ø–æ–≤—ñ–¥—å, —ñ –±—Ä–∞—É–∑–µ—Ä —ó—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î**.

---

### **4Ô∏è‚É£ `customFetch` –æ—Ç—Ä–∏–º—É—î –≤—ñ–¥–ø–æ–≤—ñ–¥—å, —ñ –Ω–æ–≤—ñ cookies –≤–∂–µ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ**
```javascript
const refreshedTokens = await fetch("/api/rest/refreshresttokens", {
  method: "POST",
  credentials: "include",
  headers: { "Content-Type": "application/json" },
});

if (!refreshedTokens.ok) return redirectToLogin();

// üîπ cookies –≤–∂–µ –æ–Ω–æ–≤–∏–ª–∏—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä—ñ, —Ç–æ–º—É –ø—Ä–æ—Å—Ç–æ –≤–∏–∫–æ–Ω—É—î–º–æ –Ω–æ–≤–∏–π –∑–∞–ø–∏—Ç
response = await fetch(`${REMOTE_API}${url}`, {
  ...options,
  headers: { ...options.headers, Authorization: `Bearer ${accessToken}` },
});
```
‚úî **–¢—É—Ç –Ω–µ–º–∞—î –ø–æ—Ç—Ä–µ–±–∏ –≤—Ä—É—á–Ω—É –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ —Ç–æ–∫–µ–Ω–∏ ‚Äì –±—Ä–∞—É–∑–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î cookies.**  
‚úî **–¢–µ–ø–µ—Ä `customFetch` –ø—Ä–æ—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –æ–Ω–æ–≤–ª–µ–Ω—ñ cookies —É –∫–æ–∂–Ω–æ–º—É –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ.**

---

## ‚úÖ **üìå –í–∏—Å–Ω–æ–≤–æ–∫**
1Ô∏è‚É£ **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ä–æ–±–∏—Ç—å –∑–∞–ø–∏—Ç –¥–æ `customFetch`.**  
2Ô∏è‚É£ **–Ø–∫—â–æ `accessToken` –Ω–µ–¥—ñ–π—Å–Ω–∏–π, `customFetch` —Ä–æ–±–∏—Ç—å –∑–∞–ø–∏—Ç –¥–æ `refreshresttokens`.**  
3Ô∏è‚É£ **`refreshresttokens` –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î –Ω–æ–≤—ñ `cookies` —á–µ—Ä–µ–∑ `Set-Cookie`.**  
4Ô∏è‚É£ **–ë—Ä–∞—É–∑–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î `cookies` –ø—ñ—Å–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ `refreshresttokens`.**  
5Ô∏è‚É£ **–ù–∞—Å—Ç—É–ø–Ω—ñ –∑–∞–ø–∏—Ç–∏ `customFetch` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –æ–Ω–æ–≤–ª–µ–Ω—ñ —Ç–æ–∫–µ–Ω–∏.**  

üöÄ **–¢–∏ –∑—Ä–æ–±–∏–≤ –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ! `Set-Cookie` —Å–ø—Ä–∞—Ü—é—î —ñ –æ–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω–∏ –Ω–∞–≤—ñ—Ç—å —á–µ—Ä–µ–∑ `customFetch`. üî•**