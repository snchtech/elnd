### ‚úÖ **üìå –ü–æ–±—É–¥–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∏ —Ä–æ–ª–µ–π —Ç–∞ –¥–æ—Å—Ç—É–ø—É –≤ Next.js + Oracle**
–¶—è —Å–∏—Å—Ç–µ–º–∞ –ø—ñ–¥—Ç—Ä–∏–º—É—î:  
‚úî **–î–∏–Ω–∞–º—ñ—á–Ω—ñ —Ä–æ–ª—ñ** (Viewer, Editor, Administrator, Department-roles, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `29`, `18`)  
‚úî **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –º–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ä–æ–ª–µ–π**  
‚úî **–ì–Ω—É—á–∫–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ä–æ–ª—è–º–∏ —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–∏—Ö**  
‚úî **HOC (`withRoleAccess`) –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É —Å—Ç–æ—Ä—ñ–Ω–æ–∫ —Ç–∞ –æ–∫—Ä–µ–º–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤**  

---

## üîπ **üìå 1. –û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è —Ä–æ–ª–µ–π —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö (Oracle)**
### üîπ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö**
–í Oracle —Å—Ç–≤–æ—Ä—é—î–º–æ —Ç—Ä–∏ —Ç–∞–±–ª–∏—Ü—ñ:
```sql
-- üîπ –¢–∞–±–ª–∏—Ü—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
CREATE TABLE users (
    id NUMBER PRIMARY KEY,
    username VARCHAR2(100) UNIQUE NOT NULL
);

-- üîπ –¢–∞–±–ª–∏—Ü—è —Ä–æ–ª–µ–π
CREATE TABLE roles (
    id NUMBER PRIMARY KEY,
    role_name VARCHAR2(100) UNIQUE NOT NULL
);

-- üîπ –ü—Ä–æ–º—ñ–∂–Ω–∞ —Ç–∞–±–ª–∏—Ü—è "–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á-—Ä–æ–ª—å"
CREATE TABLE user_roles (
    user_id NUMBER REFERENCES users(id) ON DELETE CASCADE,
    role_id NUMBER REFERENCES roles(id) ON DELETE CASCADE,
    PRIMARY KEY (user_id, role_id)
);
```
‚úî –û–¥–∏–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –º–∞—Ç–∏ **–∫—ñ–ª—å–∫–∞ —Ä–æ–ª–µ–π**  
‚úî –†–æ–ª—å –º–æ–∂–µ –±—É—Ç–∏ **–≥–ª–æ–±–∞–ª—å–Ω–æ—é** (Viewer, Editor, Administrator) –∞–±–æ **–ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–æ—é –¥–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—É** (`29`, `18` —Ç–æ—â–æ)  

---

### üîπ **–ü—Ä–∏–∫–ª–∞–¥ –Ω–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Ä–æ–ª—è–º–∏**
```sql
INSERT INTO users (id, username) VALUES (1, 'user1');
INSERT INTO users (id, username) VALUES (2, 'user2');

INSERT INTO roles (id, role_name) VALUES (1, 'Viewer');
INSERT INTO roles (id, role_name) VALUES (2, 'Editor');
INSERT INTO roles (id, role_name) VALUES (3, 'Administrator');
INSERT INTO roles (id, role_name) VALUES (4, '29'); -- –†–æ–ª—å –∑–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–º
INSERT INTO roles (id, role_name) VALUES (5, '18'); -- –†–æ–ª—å –∑–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–º

INSERT INTO user_roles (user_id, role_id) VALUES (1, 1); -- user1 -> Viewer
INSERT INTO user_roles (user_id, role_id) VALUES (1, 4); -- user1 -> 29
INSERT INTO user_roles (user_id, role_id) VALUES (2, 1); -- user2 -> Viewer
INSERT INTO user_roles (user_id, role_id) VALUES (2, 2); -- user2 -> Editor
INSERT INTO user_roles (user_id, role_id) VALUES (2, 5); -- user2 -> 18
```

---

### üîπ **–ó–∞–ø–∏—Ç –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–æ–ª–µ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**
```sql
SELECT r.role_name
FROM user_roles ur
JOIN roles r ON ur.role_id = r.id
WHERE ur.user_id = :userId;
```
‚úî –ü–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `[Viewer, 29]` –∞–±–æ `[Viewer, Editor, 18]`).

---

## üîπ **üìå 2. –Ø–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ —Ä–æ–ª—è–º–∏ —É Next.js**
–£ Next.js –ø—Ä–∏ –ª–æ–≥—ñ–Ω—ñ **–æ—Ç—Ä–∏–º—É—î–º–æ —Å–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π** —ñ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ —ó—Ö —É `userDataEtls` (JWT-—Ç–æ–∫–µ–Ω —É cookies).

### üîπ **–î–æ–¥–∞–≤–∞–Ω–Ω—è —Ä–æ–ª–µ–π —É `userDataEtls` –ø—ñ–¥ —á–∞—Å –ª–æ–≥—ñ–Ω—É**
–§–∞–π–ª `api/auth/login.js`
```javascript
import { NextResponse } from "next/server";
import { SignJWT } from "jose";

const ETLS_ACCESS = new TextEncoder().encode(process.env.ETLS_ACCESS);
const EXPIRES_IN_ACCESS_ETLS = 15 * 60; // 15 —Ö–≤ —É —Å–µ–∫—É–Ω–¥–∞—Ö

export async function POST(req) {
  try {
    const { username, password } = await req.json();

    const apiResponse = await fetch(`${process.env.REMOTE_API}/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password }),
    });

    if (!apiResponse.ok) {
      return NextResponse.json({ error: "Invalid credentials" }, { status: 401 });
    }

    const { userId, roles } = await apiResponse.json(); // üîπ –û—Ç—Ä–∏–º—É—î–º–æ —Å–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π

    const userDataEtls = await new SignJWT({ userId, username, roles })
      .setProtectedHeader({ alg: "HS256" })
      .setExpirationTime(Math.floor(Date.now() / 1000) + EXPIRES_IN_ACCESS_ETLS)
      .sign(ETLS_ACCESS);

    const response = NextResponse.json({ message: "Login successful", roles });

    response.headers.set(
      "Set-Cookie",
      `userDataEtls=${userDataEtls}; HttpOnly; Path=/; Secure; SameSite=Strict`
    );

    return response;
  } catch (error) {
    return NextResponse.json({ error: "Internal Server Error" }, { status: 500 });
  }
}
```
‚úî **–ü—Ä–∏ –ª–æ–≥—ñ–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ —Å–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —É `userDataEtls` (JWT —É cookies)**  
‚úî **–†–æ–ª—ñ –º–æ–∂–Ω–∞ –∑—á–∏—Ç—É–≤–∞—Ç–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ñ –∞–±–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ —É `middleware.js`**  

---

## üîπ **üìå 3. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è HOC `withRoleAccess` —É Next.js**
–°—Ç–≤–æ—Ä–∏–º–æ HOC –¥–ª—è **–∑–∞—Ö–∏—Å—Ç—É —Å—Ç–æ—Ä—ñ–Ω–æ–∫ —ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤**.

```javascript
// üîπ utils/withRoleAccess.js
import { useAuth } from "@/context/AuthContext";

export function withRoleAccess(WrappedComponent, allowedRoles = []) {
  return function RoleProtectedComponent(props) {
    const { user } = useAuth();

    if (!user || !user.roles) {
      return <p>Access Denied</p>;
    }

    const hasAccess = user.roles.some((role) => allowedRoles.includes(role));

    if (!hasAccess) {
      return <p>Access Denied</p>;
    }

    return <WrappedComponent {...props} />;
  };
}
```
‚úî **–ü–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ —É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —î –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ä–æ–ª—å**  
‚úî **–Ø–∫—â–æ —Ä–æ–ª—ñ –Ω–µ–º–∞—î ‚Üí –ø–æ–∫–∞–∑—É—î "Access Denied"**  
‚úî **–ú–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ —ñ —Å—Ç–æ—Ä—ñ–Ω–æ–∫**  

---

### üîπ **üìå –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è HOC –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É —Å—Ç–æ—Ä—ñ–Ω–æ–∫**
```javascript
// pages/admin.js
import { withRoleAccess } from "@/utils/withRoleAccess";

function AdminPage() {
  return <h1>Welcome, Admin!</h1>;
}

export default withRoleAccess(AdminPage, ["Administrator"]);
```
‚úî –°—Ç–æ—Ä—ñ–Ω–∫–∞ `/admin` –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç—ñ–ª—å–∫–∏ –¥–ª—è `Administrator`.  

---

### üîπ **üìå –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è HOC –¥–ª—è –æ–∫—Ä–µ–º–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞**
```javascript
// components/DeleteButton.js
import { withRoleAccess } from "@/utils/withRoleAccess";

function DeleteButton() {
  return <button>Delete</button>;
}

export default withRoleAccess(DeleteButton, ["Administrator", "Editor"]);
```
‚úî **–ö–Ω–æ–ø–∫–∞ "Delete" –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏—à–µ `Administrator` —Ç–∞ `Editor`**  

---

## ‚úÖ **üìå –ü—ñ–¥—Å—É–º–æ–∫**
| **–©–æ –∑—Ä–æ–±–ª–µ–Ω–æ?** | **–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è** |
|------------------|------------------------------|
| **–†–æ–ª—ñ —É –ë–î (Oracle)** | –¢–∞–±–ª–∏—Ü—ñ `users`, `roles`, `user_roles` |
| **–û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–æ–ª–µ–π –ø—Ä–∏ –ª–æ–≥—ñ–Ω—ñ** | SQL-–∑–∞–ø–∏—Ç –Ω–∞ `REMOTE_API` |
| **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ä–æ–ª–µ–π —É `JWT` (cookies)** | `userDataEtls` —É `cookies` |
| **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–ª–µ–π –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ñ** | `useAuth().user.roles` |
| **–ó–∞—Ö–∏—Å—Ç —Å—Ç–æ—Ä—ñ–Ω–æ–∫ —Ç–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤** | HOC `withRoleAccess` |

üöÄ **–¢–µ–ø–µ—Ä —Ç–≤–æ—è —Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –≥–æ—Ç–æ–≤–∞ –¥–æ —Ä–æ–±–æ—Ç–∏!**  
‚úî –ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–∞ **(–º–æ–∂–Ω–∞ –ª–µ–≥–∫–æ –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ —Ä–æ–ª—ñ)**  
‚úî –ì–Ω—É—á–∫–∞ **(–¥–æ—Å—Ç—É–ø –Ω–∞ —Ä—ñ–≤–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–æ–∫ —Ç–∞ –æ–∫—Ä–µ–º–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤)**  
‚úî –ë–µ–∑–ø–µ—á–Ω–∞ **(—Ä–æ–ª—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É cookies —è–∫ JWT)**  