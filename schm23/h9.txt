-- Таблиця REFERENCE_TYPE
CREATE TABLE REFERENCE_TYPE (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    type VARCHAR2(255)
);

-- Таблиця REF_ELEMENT (розширена для підтримки різних типів прив'язок)
CREATE TABLE REF_ELEMENT (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    reference_type NUMBER,
    element_id NUMBER,
    name VARCHAR2(255),
    point_from NUMBER,
    point_to NUMBER,
    coordinate_x NUMBER,
    coordinate_y NUMBER,
    image_src VARCHAR2(255),
    file_blob BLOB,
    date_update DATE DEFAULT SYSDATE,
    scheme_id NUMBER,
    album_id NUMBER,
    color_id NUMBER,
    file_id NUMBER, -- Додаємо зв'язок на таблицю файлів
    CONSTRAINT fk_ref_element_reference_type FOREIGN KEY (reference_type) REFERENCES REFERENCE_TYPE(id),
    CONSTRAINT fk_ref_element_element FOREIGN KEY (element_id) REFERENCES ELEMENT(id),
    CONSTRAINT fk_ref_element_scheme FOREIGN KEY (scheme_id) REFERENCES SCHEME(id),
    CONSTRAINT fk_ref_element_album FOREIGN KEY (album_id) REFERENCES ALBUM(id),
    CONSTRAINT fk_ref_element_color FOREIGN KEY (color_id) REFERENCES SCHEME_COLORS(id),
    CONSTRAINT fk_ref_element_file FOREIGN KEY (file_id) REFERENCES SCHEME_FILES(id)
);

-- Таблиця SCHEME_FILES для зберігання прив'язаних файлів до схем
CREATE TABLE SCHEME_FILES (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    scheme_id NUMBER,
    file_name VARCHAR2(255),
    file_type VARCHAR2(50),
    file_blob BLOB,
    date_upload DATE DEFAULT SYSDATE,
    uploaded_by NUMBER, -- Користувач, який завантажив
    CONSTRAINT fk_scheme_files_scheme FOREIGN KEY (scheme_id) REFERENCES SCHEME(id)
);

-- Таблиця SCHEME
CREATE TABLE SCHEME (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    album_id NUMBER,
    name VARCHAR2(255),
    depart_id NUMBER,
    unit_id NUMBER,
    description VARCHAR2(1000),
    date_create DATE DEFAULT SYSDATE,
    date_update DATE,
    stable NUMBER(1),
    format VARCHAR2(50),
    page_number NUMBER,
    system VARCHAR2(255),
    shifr VARCHAR2(255),
    last_editor_id NUMBER,
    CONSTRAINT fk_scheme_album FOREIGN KEY (album_id) REFERENCES ALBUM(id)
);

-- Таблиця CHANGE_ELEMENT для зберігання елементів "зміни"
CREATE TABLE CHANGE_ELEMENT (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    scheme_id NUMBER REFERENCES SCHEME(id),
    element_id NUMBER REFERENCES ELEMENT(id),
    change_number NUMBER NOT NULL, -- Цифра всередині кола
    x_position NUMBER,
    y_position NUMBER,
    line_x NUMBER, -- Координати лінії
    line_y NUMBER,
    added_by NUMBER, -- Користувач, який додав зміну
    date_added DATE DEFAULT SYSDATE
);

-- Таблиця CHANGE_ELEMENT_LINK для зв'язку змін з елементами
CREATE TABLE CHANGE_ELEMENT_LINK (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    change_id NUMBER REFERENCES CHANGE_ELEMENT(id),
    element_id NUMBER REFERENCES ELEMENT(id),
    linked_by NUMBER, -- Хто зв’язав
    date_linked DATE DEFAULT SYSDATE
);

-- Індекси для пришвидшення пошуку
CREATE INDEX idx_ref_element_scheme_id ON REF_ELEMENT(scheme_id);
CREATE INDEX idx_ref_element_element_id ON REF_ELEMENT(element_id);
CREATE INDEX idx_scheme_files_scheme_id ON SCHEME_FILES(scheme_id);
CREATE INDEX idx_scheme_album_id ON SCHEME(album_id);
CREATE INDEX idx_change_element_scheme_id ON CHANGE_ELEMENT(scheme_id);
CREATE INDEX idx_change_element_element_id ON CHANGE_ELEMENT(element_id);
CREATE INDEX idx_change_element_link_change_id ON CHANGE_ELEMENT_LINK(change_id);
CREATE INDEX idx_change_element_link_element_id ON CHANGE_ELEMENT_LINK(element_id);
