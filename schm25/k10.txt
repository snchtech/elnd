-- –¢–∞–±–ª–∏—Ü—è SCHEME (–æ—Å–Ω–æ–≤–Ω–∞ —Ç–∞–±–ª–∏—Ü—è —Å—Ö–µ–º)
CREATE TABLE SCHEME (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR2(255) NOT NULL,
    album_id NUMBER,
    depart_id NUMBER,
    unit_id NUMBER,
    description CLOB,
    format VARCHAR2(50),
    system VARCHAR2(255),
    shifr VARCHAR2(255),
    CONSTRAINT fk_scheme_album FOREIGN KEY (album_id) REFERENCES ALBUM(id)
);

-- –¢–∞–±–ª–∏—Ü—è SCHEME_VERSION (–≤–µ—Ä—Å—ñ—ó —Å—Ö–µ–º)
CREATE TABLE SCHEME_VERSION (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    scheme_id NUMBER NOT NULL,
    version_number NUMBER NOT NULL, -- –ù–æ–º–µ—Ä –≤–µ—Ä—Å—ñ—ó
    is_stable NUMBER(1) DEFAULT 0, -- 1 - —Å—Ç–∞–±—ñ–ª—å–Ω–∞, 0 - –ø–æ—Ç–æ—á–Ω–∞ —Ä–µ–¥–∞–≥–æ–≤–∞–Ω–∞
    is_archived NUMBER(1) DEFAULT 0, -- 1 - –∞—Ä—Ö—ñ–≤–Ω–∞ –≤–µ—Ä—Å—ñ—è
    page_number NUMBER, -- –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –∑ SCHEME
    created_at DATE DEFAULT SYSDATE,
    updated_at DATE,
    created_by NUMBER,
    updated_by NUMBER,
    CONSTRAINT fk_scheme_version_scheme FOREIGN KEY (scheme_id) REFERENCES SCHEME(id)
);

-- –¢–∞–±–ª–∏—Ü—è SCHEME_DOCUMENTS (–ø—Ä–∏–≤‚Äô—è–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –¥–æ —Å—Ö–µ–º)
CREATE TABLE SCHEME_DOCUMENTS (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    scheme_version_id NUMBER NOT NULL,
    file_name VARCHAR2(255),
    file_id BLOB,
    date_update DATE,
    editor_number NUMBER,
    CONSTRAINT fk_scheme_documents_version FOREIGN KEY (scheme_version_id) REFERENCES SCHEME_VERSION(id)
);

-- –Ü–Ω–¥–µ–∫—Å–∏ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ—à—É–∫—É
CREATE INDEX idx_scheme_album_id ON SCHEME(album_id);
CREATE INDEX idx_scheme_version_scheme_id ON SCHEME_VERSION(scheme_id);
CREATE INDEX idx_scheme_documents_version_id ON SCHEME_DOCUMENTS(scheme_version_id);


–¢–∞–∫, –º–æ–∂–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞ **–≤–∏–¥–∞–ª–∏—Ç–∏ –¥–µ—è–∫—ñ –ø–æ–ª—è –∑ `SCHEME`**, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –¥—É–±–ª—é—é—Ç—å—Å—è —É `SCHEME_VERSION`.

### **–ß–æ–º—É `parent_scheme_id` –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω?**
- **–ú–∏ –≤–∂–µ –º–∞—î–º–æ `SCHEME_VERSION`**, —è–∫–∞ –∑–±–µ—Ä—ñ–≥–∞—î –≤—Å—ñ –≤–µ—Ä—Å—ñ—ó —Å—Ö–µ–º–∏.
- –í—Å—ñ –≤–µ—Ä—Å—ñ—ó —Å—Ö–µ–º–∏ –ø–æ–≤'—è–∑–∞–Ω—ñ —á–µ—Ä–µ–∑ `scheme_id` —É `SCHEME_VERSION`.
- –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞–π—Ç–∏ **–æ—Å—Ç–∞–Ω–Ω—ñ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ –≤–µ—Ä—Å—ñ—ó**, –º–æ–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ —Ä–æ–±–∏—Ç–∏ `JOIN` –º—ñ–∂ `SCHEME` —Ç–∞ `SCHEME_VERSION` –±–µ–∑ –∑–∞–π–≤–æ–≥–æ –ø–æ–ª—è `parent_scheme_id`.

### **–û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `SCHEME`**
```sql
CREATE TABLE SCHEME (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR2(255) NOT NULL,
    album_id NUMBER,
    depart_id NUMBER,
    unit_id NUMBER,
    description CLOB,
    format VARCHAR2(50),
    system VARCHAR2(255),
    shifr VARCHAR2(255),
    CONSTRAINT fk_scheme_album FOREIGN KEY (album_id) REFERENCES ALBUM(id)
);
```
**üîπ –í–∏–¥–∞–ª–µ–Ω—ñ –ø–æ–ª—è:**
‚úÖ `parent_scheme_id` ‚Äì –ù–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω, –±–æ —î `SCHEME_VERSION`.  
‚úÖ `date_create`, `date_update` ‚Äì –¶–µ –≤–∂–µ —î –≤ `SCHEME_VERSION`.  
‚úÖ `stable` ‚Äì –Ñ `is_stable` –≤ `SCHEME_VERSION`.  
‚úÖ `page_number` ‚Äì –Ø–∫—â–æ —Ü–µ –Ω–µ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä, –π–æ–≥–æ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏ –≤ `SCHEME_VERSION`.  
‚úÖ `last_editor_id` ‚Äì –ó–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `updated_by` —É `SCHEME_VERSION`.  

### **–Ø–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∞–∫—Ç—É–∞–ª—å–Ω—É —Å—Ç–∞–±—ñ–ª—å–Ω—É –≤–µ—Ä—Å—ñ—é –¥–ª—è —Å—Ö–µ–º–∏?**
```sql
SELECT s.id AS scheme_id, sv.id AS version_id, s.name, s.description, sv.version_number
FROM SCHEME s
JOIN SCHEME_VERSION sv ON s.id = sv.scheme_id
WHERE sv.is_stable = 1;
```

**üìå –í–∏—Å–Ω–æ–≤–æ–∫:**  
–ó–º–µ–Ω—à–∏–ª–∏ **–¥—É–±–ª—é–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö**, –∑—Ä–æ–±–∏–ª–∏ **–≥–Ω—É—á–∫—ñ—à—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É**, –∑–∞–ª–∏—à–∏–ª–∏ **—Ç—ñ–ª—å–∫–∏ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –ø–æ–ª—è –≤ SCHEME**.  

–Ø –∑–∞—Ä–∞–∑ –≤–Ω–µ—Å—É —Ü—ñ –∑–º—ñ–Ω–∏ –≤ —Ç–≤—ñ–π SQL-–∫–æ–¥.

–Ø –æ–Ω–æ–≤–∏–≤ SQL-–∫–æ–¥, –≤–∏–¥–∞–ª–∏–≤—à–∏ –¥—É–±–ª—å–æ–≤–∞–Ω—ñ –ø–æ–ª—è –∑ `SCHEME` —Ç–∞ –ø–µ—Ä–µ–Ω—ñ—Å—à–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ (`page_number`) —É `SCHEME_VERSION`. –¶–µ –∑—Ä–æ–±–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —á–∏—Å—Ç—ñ—à–æ—é —Ç–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—à–æ—é. –Ø–∫—â–æ —î —â–µ —É—Ç–æ—á–Ω–µ–Ω–Ω—è –∞–±–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –∑–º—ñ–Ω–∏, –¥–∞–π –∑–Ω–∞—Ç–∏! üòä