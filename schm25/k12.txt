### **–Ø–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —Å—Ö–µ–º–∏ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –Ω–æ–≤–æ—ó –≤–µ—Ä—Å—ñ—ó –Ω–∞ —Ä—ñ–≤–Ω—ñ –ë–î Oracle**
–ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –Ω–æ–≤–æ—ó –≤–µ—Ä—Å—ñ—ó —Å—Ö–µ–º–∏ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–ø—ñ—é–≤–∞—Ç–∏ –≤—Å—ñ –ø—ñ–¥–≤‚Äô—è–∑–∞–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏** (`ELEMENT`, `ELEMENT_TEXT`, `ZVT`, `REF_ELEMENT` —Ç–æ—â–æ), —â–æ–± –Ω–æ–≤–∞ –≤–µ—Ä—Å—ñ—è –º–∞–ª–∞ —Ç—ñ –∂ —Å–∞–º—ñ –¥–∞–Ω—ñ, –∞–ª–µ –º–æ–≥–ª–∞ –±—É—Ç–∏ –∑–º—ñ–Ω–µ–Ω–∞ –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Å—Ç–∞–±—ñ–ª—å–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó.

---

### **1. –î–æ–¥–∞–≤–∞–Ω–Ω—è `scheme_version_id` —É –≤—Å—ñ —Ç–∞–±–ª–∏—Ü—ñ, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑—ñ —Å—Ö–µ–º–æ—é**
–©–æ–± –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç –±—É–≤ –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–∏–π –¥–æ –ø–µ–≤–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó —Å—Ö–µ–º–∏, —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ (`ELEMENT`, `ELEMENT_TEXT`, `ZVT`, `REF_ELEMENT` —Ç–æ—â–æ) –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ `scheme_version_id`:
```sql
ALTER TABLE ELEMENT ADD scheme_version_id NUMBER REFERENCES SCHEME_VERSION(id);
ALTER TABLE ELEMENT_TEXT ADD scheme_version_id NUMBER REFERENCES SCHEME_VERSION(id);
ALTER TABLE ZVT ADD scheme_version_id NUMBER REFERENCES SCHEME_VERSION(id);
ALTER TABLE REF_ELEMENT ADD scheme_version_id NUMBER REFERENCES SCHEME_VERSION(id);
```

---

### **2. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∏ `clone_scheme_version`**
–î–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —Å—Ö–µ–º–∏ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –Ω–æ–≤–æ—ó –≤–µ—Ä—Å—ñ—ó –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ PL/SQL-–ø—Ä–æ—Ü–µ–¥—É—Ä—É:
```sql
CREATE OR REPLACE PROCEDURE clone_scheme_version (
    p_old_version_id NUMBER,
    p_new_version_id NUMBER
) AS
BEGIN
    -- –ö–æ–ø—ñ—é—î–º–æ –≤—Å—ñ –≥—Ä–∞—Ñ—ñ—á–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
    INSERT INTO ELEMENT (scheme_version_id, name, status_id, department_id, unit_id, date_update, group_id, element_type, x_position, y_position, width, height, radius, fill_color, created_at, element_blob, show_status)
    SELECT p_new_version_id, name, status_id, department_id, unit_id, date_update, group_id, element_type, x_position, y_position, width, height, radius, fill_color, created_at, element_blob, show_status
    FROM ELEMENT WHERE scheme_version_id = p_old_version_id;

    -- –ö–æ–ø—ñ—é—î–º–æ —Ç–µ–∫—Å—Ç–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
    INSERT INTO ELEMENT_TEXT (scheme_version_id, text_element_id, element_id, text_content, text_type, font_size, font_color, background_color, alignment, is_bold, is_italic, is_underlined)
    SELECT p_new_version_id, text_element_id, element_id, text_content, text_type, font_size, font_color, background_color, alignment, is_bold, is_italic, is_underlined
    FROM ELEMENT_TEXT WHERE scheme_version_id = p_old_version_id;

    -- –ö–æ–ø—ñ—é—î–º–æ ZVT –µ–ª–µ–º–µ–Ω—Ç–∏
    INSERT INTO ZVT (scheme_version_id, param_type_id, location_id, indicator_id, ios_status, x_position, y_position, width, height, color_id, created_at, updated_at, created_by, updated_by)
    SELECT p_new_version_id, param_type_id, location_id, indicator_id, ios_status, x_position, y_position, width, height, color_id, created_at, updated_at, created_by, updated_by
    FROM ZVT WHERE scheme_version_id = p_old_version_id;

    -- –ö–æ–ø—ñ—é—î–º–æ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
    INSERT INTO REF_ELEMENT (scheme_version_id, reference_type, element_id, name, point_from, point_to, coordinate_x, coordinate_y, image_src, file_blob, date_update, scheme_id, album_id, color_id)
    SELECT p_new_version_id, reference_type, element_id, name, point_from, point_to, coordinate_x, coordinate_y, image_src, file_blob, date_update, scheme_id, album_id, color_id
    FROM REF_ELEMENT WHERE scheme_version_id = p_old_version_id;

    COMMIT;
END clone_scheme_version;
/
```

---

### **3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∏ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –Ω–æ–≤–æ—ó –≤–µ—Ä—Å—ñ—ó**
–ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ—á–∏–Ω–∞—î —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Å—Ç–∞–±—ñ–ª—å–Ω—É –≤–µ—Ä—Å—ñ—é:
1. –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è **–Ω–æ–≤–∞ –≤–µ—Ä—Å—ñ—è —Å—Ö–µ–º–∏**:
   ```sql
   DECLARE v_new_version_id NUMBER;
   BEGIN
       INSERT INTO SCHEME_VERSION (scheme_id, version_number, is_stable, is_archived, created_by)
       VALUES (:scheme_id, (SELECT COALESCE(MAX(version_number), 0) + 1 FROM SCHEME_VERSION WHERE scheme_id = :scheme_id), 0, 0, :user_id)
       RETURNING id INTO v_new_version_id;

       -- –í–∏–∫–ª–∏–∫–∞—î–º–æ –ø—Ä–æ—Ü–µ–¥—É—Ä—É –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
       clone_scheme_version(:old_version_id, v_new_version_id);
   END;
   ```
2. –¢–µ–ø–µ—Ä —É –Ω–æ–≤—ñ–π –≤–µ—Ä—Å—ñ—ó (`scheme_version_id`) —î –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó.

---

### **–Ø–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤ Next.js –ø—Ä–∏ –ø—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ö–µ–º**
1. **–û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó**
   ```javascript
   const fetchStableScheme = async (schemeId) => {
       const response = await fetch(`/api/schemes/${schemeId}?stable=1`);
       return await response.json();
   };
   ```
   - –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è SQL-–∑–∞–ø–∏—Ç:
     ```sql
     SELECT * FROM SCHEME_VERSION WHERE scheme_id = :scheme_id AND is_stable = 1;
     ```

2. **–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Å—Ö–µ–º–∏:**
   - –Ø–∫—â–æ –Ω–µ–º–∞—î –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó (`is_stable = 0`), —Ç–æ —Å—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤—É –≤–µ—Ä—Å—ñ—é —Ç–∞ –∫–æ–ø—ñ—é—î–º–æ –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ —á–µ—Ä–µ–∑ API-–∑–∞–ø–∏—Ç:
     ```javascript
     const createNewVersion = async (schemeId) => {
         const response = await fetch(`/api/schemes/${schemeId}/new-version`, { method: 'POST' });
         return await response.json();
     };
     ```
   - –¶–µ –≤–∏–∫–ª–∏—á–µ SQL-–ø—Ä–æ—Ü–µ–¥—É—Ä—É `clone_scheme_version`.

3. **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω —É –ø–æ—Ç–æ—á–Ω—ñ–π –≤–µ—Ä—Å—ñ—ó**
   - –ü—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ –∑–º—ñ–Ω –æ–Ω–æ–≤–ª—é—î–º–æ –µ–ª–µ–º–µ–Ω—Ç–∏ –Ω–æ–≤–æ—ó –≤–µ—Ä—Å—ñ—ó (`scheme_version_id`):
     ```javascript
     const updateElement = async (elementId, updatedData) => {
         await fetch(`/api/elements/${elementId}`, {
             method: 'PUT',
             body: JSON.stringify(updatedData),
         });
     };
     ```
   - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è SQL-–∑–∞–ø–∏—Ç:
     ```sql
     UPDATE ELEMENT SET x_position = :x, y_position = :y, updated_by = :user_id WHERE id = :element_id;
     ```

4. **–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è**
   - –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ "–ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è":
     ```javascript
     const finalizeVersion = async (schemeId) => {
         await fetch(`/api/schemes/${schemeId}/finalize`, { method: 'POST' });
     };
     ```
   - SQL-–∑–∞–ø–∏—Ç–∏:
     ```sql
     UPDATE SCHEME_VERSION SET is_stable = 0, is_archived = 1 WHERE scheme_id = :scheme_id AND is_stable = 1;
     UPDATE SCHEME_VERSION SET is_stable = 1 WHERE id = :version_id;
     ```

---

### **üìå –ü—ñ–¥—Å—É–º–æ–∫**
üîπ **–ù–∞ —Ä—ñ–≤–Ω—ñ –ë–î:**
- –î–æ–¥–∞–ª–∏ `scheme_version_id` —É –≤—Å—ñ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ.
- –†–µ–∞–ª—ñ–∑—É–≤–∞–ª–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—É `clone_scheme_version`, —è–∫–∞ –∫–æ–ø—ñ—é—î –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –Ω–æ–≤–æ—ó –≤–µ—Ä—Å—ñ—ó.

üîπ **–ù–∞ —Ä—ñ–≤–Ω—ñ Next.js:**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ API-–∑–∞–ø–∏—Ç–∏ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤–µ—Ä—Å—ñ—ó.
- –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ **—Å—Ç–∞–±—ñ–ª—å–Ω—ñ –≤–µ—Ä—Å—ñ—ó** —É –ø–µ—Ä–µ–≥–ª—è–¥–∞—á—ñ.
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ **–æ–∫—Ä–µ–º–∏–π `scheme_version_id`** –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —á–µ—Ä–Ω–µ—Ç–∫–∞–º–∏, –ø–æ–∫–∏ —Å—Ö–µ–º–∞ –Ω–µ —Å—Ç–∞–Ω–µ —Å—Ç–∞–±—ñ–ª—å–Ω–æ—é.

üöÄ **–¶—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–æ–∑–≤–æ–ª—è—î –±–µ–∑–ø–µ—á–Ω–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –≤–µ—Ä—Å—ñ—è–º–∏ —Å—Ö–µ–º, —É–Ω–∏–∫–∞—é—á–∏ –Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É —Å—Ç–∞–±—ñ–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö.** –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ —â–µ —è–∫—ñ—Å—å –∑–º—ñ–Ω–∏ ‚Äì –¥–∞–π –∑–Ω–∞—Ç–∏! üòä