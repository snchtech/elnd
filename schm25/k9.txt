-- –¢–∞–±–ª–∏—Ü—è SCHEME (–æ—Å–Ω–æ–≤–Ω–∞ —Ç–∞–±–ª–∏—Ü—è —Å—Ö–µ–º)
CREATE TABLE SCHEME (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    parent_scheme_id NUMBER, -- –í–∫–∞–∑—É—î –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É —Å—Ö–µ–º—É –¥–ª—è –≤–µ—Ä—Å—ñ–π
    name VARCHAR2(255) NOT NULL,
    album_id NUMBER,
    depart_id NUMBER,
    unit_id NUMBER,
    description CLOB,
    date_create DATE DEFAULT SYSDATE,
    date_update DATE,
    stable NUMBER(1) DEFAULT 0, -- 1 - —Å—Ç–∞–±—ñ–ª—å–Ω–∞, 0 - —Ä–µ–¥–∞–≥–æ–≤–∞–Ω–∞, 2 - –∞—Ä—Ö—ñ–≤–Ω–∞
    format VARCHAR2(50),
    page_number NUMBER,
    system VARCHAR2(255),
    shifr VARCHAR2(255),
    last_editor_id NUMBER,
    CONSTRAINT fk_scheme_album FOREIGN KEY (album_id) REFERENCES ALBUM(id),
    CONSTRAINT fk_parent_scheme FOREIGN KEY (parent_scheme_id) REFERENCES SCHEME(id)
);

-- –¢–∞–±–ª–∏—Ü—è SCHEME_VERSION (–≤–µ—Ä—Å—ñ—ó —Å—Ö–µ–º)
CREATE TABLE SCHEME_VERSION (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    scheme_id NUMBER NOT NULL,
    version_number NUMBER NOT NULL, -- –ù–æ–º–µ—Ä –≤–µ—Ä—Å—ñ—ó
    is_stable NUMBER(1) DEFAULT 0, -- 1 - —Å—Ç–∞–±—ñ–ª—å–Ω–∞, 0 - –ø–æ—Ç–æ—á–Ω–∞ —Ä–µ–¥–∞–≥–æ–≤–∞–Ω–∞
    is_archived NUMBER(1) DEFAULT 0, -- 1 - –∞—Ä—Ö—ñ–≤–Ω–∞ –≤–µ—Ä—Å—ñ—è
    created_at DATE DEFAULT SYSDATE,
    updated_at DATE,
    created_by NUMBER,
    updated_by NUMBER,
    CONSTRAINT fk_scheme_version_scheme FOREIGN KEY (scheme_id) REFERENCES SCHEME(id)
);

-- –¢–∞–±–ª–∏—Ü—è SCHEME_DOCUMENTS (–ø—Ä–∏–≤‚Äô—è–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –¥–æ —Å—Ö–µ–º)
CREATE TABLE SCHEME_DOCUMENTS (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    scheme_version_id NUMBER NOT NULL,
    file_name VARCHAR2(255),
    file_id BLOB,
    date_update DATE,
    editor_number NUMBER,
    CONSTRAINT fk_scheme_documents_version FOREIGN KEY (scheme_version_id) REFERENCES SCHEME_VERSION(id)
);

-- –Ü–Ω–¥–µ–∫—Å–∏ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ—à—É–∫—É
CREATE INDEX idx_scheme_album_id ON SCHEME(album_id);
CREATE INDEX idx_scheme_version_scheme_id ON SCHEME_VERSION(scheme_id);
CREATE INDEX idx_scheme_documents_version_id ON SCHEME_DOCUMENTS(scheme_version_id);

### **–Ø–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ü–µ–π —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª —É Next.js –ø—Ä–∏ –ø—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ö–µ–º —É –ø–µ—Ä–µ–≥–ª—è–¥–∞—á—ñ**

1. **–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó —Å—Ö–µ–º–∏ –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É:**
   - –ü—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –ø–µ—Ä–µ–≥–ª—è–¥–∞—á–∞, –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∑–∞–ø–∏—Ç –¥–æ API:  
     ```sql
     SELECT * FROM SCHEME_VERSION 
     WHERE scheme_id = :scheme_id AND is_stable = 1;
     ```
   - –û—Ç—Ä–∏–º–∞–Ω–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–∞ –≤–µ—Ä—Å—ñ—è –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ.

2. **–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Å—Ö–µ–º–∏:**
   - –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ "–†–µ–¥–∞–≥—É–≤–∞—Ç–∏", –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è, —á–∏ —ñ—Å–Ω—É—î **—Ä–µ–¥–∞–≥–æ–≤–∞–Ω–∞** –≤–µ—Ä—Å—ñ—è (`is_stable = 0`).
   - –Ø–∫—â–æ —ó—ó –Ω–µ–º–∞—î, —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∫–æ–ø—ñ—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó:
     ```sql
     INSERT INTO SCHEME_VERSION (scheme_id, version_number, is_stable, is_archived, created_by)
     VALUES (:scheme_id, (SELECT COALESCE(MAX(version_number), 0) + 1 FROM SCHEME_VERSION WHERE scheme_id = :scheme_id), 0, 0, :user_id);
     ```
   - Next.js –æ—Ç—Ä–∏–º—É—î `id` –Ω–æ–≤–æ—ó –≤–µ—Ä—Å—ñ—ó, —Ç–∞ –ø—Ä–∞—Ü—é—î –∑ –Ω–µ—é —è–∫ –∑ –ø–æ—Ç–æ—á–Ω–æ—é.

3. **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω —É —Ä–µ–¥–∞–≥–æ–≤–∞–Ω—ñ–π –≤–µ—Ä—Å—ñ—ó:**
   - –ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–Ω–æ—Å–∏—Ç—å –∑–º—ñ–Ω–∏, —Ü—ñ –∑–º—ñ–Ω–∏ –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å—Å—è **–¥–æ –ø–æ—Ç–æ—á–Ω–æ—ó —Ä–µ–¥–∞–≥–æ–≤–∞–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó** (–∑ `is_stable = 0`).
   - API –æ–Ω–æ–≤–ª—é—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –∑–∞–ø–∏—Å:
     ```sql
     UPDATE SCHEME_VERSION SET updated_at = SYSDATE, updated_by = :user_id WHERE id = :version_id;
     ```
   - –§–∞–π–ª–∏ —Ç–∞–∫–æ–∂ –ø—Ä–∏–≤‚Äô—è–∑—É—é—Ç—å—Å—è –¥–æ —Ü—ñ—î—ó –≤–µ—Ä—Å—ñ—ó.

4. **–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–æ–≤–æ—ó —Å—Ç–∞–±—ñ–ª—å–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó:**
   - –ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥–æ–¥–∞—î –¥–æ–∫—É–º–µ–Ω—Ç —ñ –Ω–∞—Ç–∏—Å–∫–∞—î "–ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è":
     - –°—Ç–∞—Ä–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–∞ –≤–µ—Ä—Å—ñ—è –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –≤ –∞—Ä—Ö—ñ–≤:
       ```sql
       UPDATE SCHEME_VERSION SET is_stable = 0, is_archived = 1 WHERE scheme_id = :scheme_id AND is_stable = 1;
       ```
     - –ù–æ–≤–∞ –≤–µ—Ä—Å—ñ—è —Å—Ç–∞—î —Å—Ç–∞–±—ñ–ª—å–Ω–æ—é:
       ```sql
       UPDATE SCHEME_VERSION SET is_stable = 1 WHERE id = :version_id;
       ```

5. **–ü–µ—Ä–µ–≥–ª—è–¥ –∞—Ä—Ö—ñ–≤–Ω–∏—Ö –≤–µ—Ä—Å—ñ–π:**
   - –ü—Ä–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –ø–µ—Ä–µ–≥–ª—è–¥—É –∞—Ä—Ö—ñ–≤–Ω–∏—Ö –≤–µ—Ä—Å—ñ–π:
     ```sql
     SELECT * FROM SCHEME_VERSION WHERE scheme_id = :scheme_id AND is_archived = 1 ORDER BY version_number DESC;
     ```
   - –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–±–∏—Ä–∞—î –≤–µ—Ä—Å—ñ—é, —ñ Next.js –ø—ñ–¥–≤–∞–Ω—Ç–∞–∂—É—î —ó—ó —É –ø–µ—Ä–µ–≥–ª—è–¥–∞—á.

üìå **–©–æ —Ü–µ –¥–∞—î?**
‚úÖ **–ë–µ–∑–ø–µ–∫–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó** ‚Äì –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –±–∞—á–∞—Ç—å –ª–∏—à–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω—É –≤–µ—Ä—Å—ñ—é.  
‚úÖ **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó** ‚Äì –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ —Å—Ç–∞—Ä—ñ –≤–µ—Ä—Å—ñ—ó.  
‚úÖ **–ì–Ω—É—á–∫—ñ—Å—Ç—å —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è** ‚Äì –ø–æ–∫–∏ —Å—Ö–µ–º–∞ —Ä–µ–¥–∞–≥—É—î—Ç—å—Å—è, —Å—Ç–∞–±—ñ–ª—å–Ω–∞ –≤–µ—Ä—Å—ñ—è –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –Ω–µ–∑–º—ñ–Ω–Ω–æ—é.

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ —É—Ç–æ—á–Ω–∏—Ç–∏ –∞–±–æ –¥–æ–ø–æ–≤–Ω–∏—Ç–∏ –ª–æ–≥—ñ–∫—É, –¥–∞–π –∑–Ω–∞—Ç–∏! üöÄ