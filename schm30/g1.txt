–û—Å—å SQL-–∑–∞–ø–∏—Ç –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è **–æ—Å—Ç–∞–Ω–Ω—å–æ—ó —Ä–µ–¥–∞–≥–æ–≤–∞–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó** (`is_stable = 0`) —Å—Ö–µ–º–∏ (`scheme_id`):

```sql
SELECT id, version_number, is_stable, created_at
FROM SCHEME_VERSION
WHERE scheme_id = :schemeId 
AND is_stable = 0
AND is_archived = 0
ORDER BY created_at DESC
FETCH FIRST 1 ROW ONLY;
```

---

### **–ü–æ—è—Å–Ω–µ–Ω–Ω—è –∑–∞–ø–∏—Ç—É**:
1. **–§—ñ–ª—å—Ç—Ä—É—î–º–æ –ø–æ `scheme_id`** ‚Üí –ó–Ω–∞—Ö–æ–¥–∏–º–æ –≤—Å—ñ –≤–µ—Ä—Å—ñ—ó —Ü—ñ—î—ó —Å—Ö–µ–º–∏.
2. **–û–±–º–µ–∂—É—î–º–æ `is_stable = 0`** ‚Üí –®—É–∫–∞—î–º–æ **—Ä–µ–¥–∞–≥–æ–≤–∞–Ω—É** (–Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω—É) –≤–µ—Ä—Å—ñ—é.
3. **–í–∏–∫–ª—é—á–∞—î–º–æ –∞—Ä—Ö—ñ–≤–Ω—ñ –≤–µ—Ä—Å—ñ—ó (`is_archived = 0`)** ‚Üí –ë–µ—Ä–µ–º–æ —Ç—ñ–ª—å–∫–∏ –∞–∫—Ç—É–∞–ª—å–Ω—ñ –≤–µ—Ä—Å—ñ—ó.
4. **–°–æ—Ä—Ç—É—î–º–æ –∑–∞ –¥–∞—Ç–æ—é —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è `ORDER BY created_at DESC`** ‚Üí –û—Å—Ç–∞–Ω–Ω—è –≤–µ—Ä—Å—ñ—è –±—É–¥–µ –ø–µ—Ä—à–æ—é.
5. **`FETCH FIRST 1 ROW ONLY`** ‚Üí –û—Ç—Ä–∏–º—É—î–º–æ **—Ç—ñ–ª—å–∫–∏ –æ—Å—Ç–∞–Ω–Ω—é —Ä–µ–¥–∞–≥–æ–≤–∞–Ω—É –≤–µ—Ä—Å—ñ—é**.

---

### **–°—Ç–≤–æ—Ä—é—î–º–æ API `/api/rest/getLastEditedVersion.js`**
–¶–µ–π API –ø–æ–≤–µ—Ä—Ç–∞—î `scheme_version_id` –æ—Å—Ç–∞–Ω–Ω—å–æ—ó —Ä–µ–¥–∞–≥–æ–≤–∞–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó.

```javascript
import { queryDatabase } from "@/utils/db";

export default async function handler(req, res) {
  if (req.method !== "GET") {
    return res.status(405).json({ error: "Method Not Allowed" });
  }

  try {
    const { schemeId } = req.query;

    if (!schemeId) {
      return res.status(400).json({ error: "–ù–µ–æ–±—Ö—ñ–¥–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä schemeId" });
    }

    const sql = `
      SELECT id, version_number, is_stable, TO_CHAR(created_at, 'YYYY-MM-DD HH24:MI:SS') AS created_at
      FROM SCHEME_VERSION
      WHERE scheme_id = :schemeId 
      AND is_stable = 0
      AND is_archived = 0
      ORDER BY created_at DESC
      FETCH FIRST 1 ROW ONLY
    `;

    const params = { schemeId };
    const result = await queryDatabase(sql, params);

    if (result.rows.length === 0) {
      return res.status(404).json({ error: "–û—Å—Ç–∞–Ω–Ω—è —Ä–µ–¥–∞–≥–æ–≤–∞–Ω–∞ –≤–µ—Ä—Å—ñ—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞" });
    }

    res.status(200).json(result.rows[0]);
  } catch (error) {
    console.error("–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –æ—Å—Ç–∞–Ω–Ω—å–æ—ó —Ä–µ–¥–∞–≥–æ–≤–∞–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó:", error);
    res.status(500).json({ error: "Internal Server Error" });
  }
}
```

---

### **–î–æ–¥–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é `getLastEditedVersion` —É `utils/api.js`**
```javascript
export const getLastEditedVersion = async (schemeId) => {
  const response = await fetch(`/api/rest/getLastEditedVersion?schemeId=${schemeId}`);

  if (!response.ok) {
    throw new Error("–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –æ—Å—Ç–∞–Ω–Ω—å–æ—ó —Ä–µ–¥–∞–≥–æ–≤–∞–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó");
  }

  return response.json();
};
```

---

## **–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î?**
1Ô∏è‚É£ **Next.js –≤–∏–∫–ª–∏–∫–∞—î `getLastEditedVersion(schemeId)`**.  
2Ô∏è‚É£ **API `/api/rest/getLastEditedVersion`** –∑–Ω–∞—Ö–æ–¥–∏—Ç—å –æ—Å—Ç–∞–Ω–Ω—é —Ä–µ–¥–∞–≥–æ–≤–∞–Ω—É –≤–µ—Ä—Å—ñ—é.  
3Ô∏è‚É£ **–ü–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è `scheme_version_id` –æ—Å—Ç–∞–Ω–Ω—å–æ—ó —Ä–µ–¥–∞–≥–æ–≤–∞–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó**.  
4Ô∏è‚É£ **–Ø–∫—â–æ —Ä–µ–¥–∞–≥–æ–≤–∞–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó –Ω–µ–º–∞—î**, –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è `404`.  

–ì–æ—Ç–æ–≤–æ! üéØ **–¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –ª–µ–≥–∫–æ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—é —Ä–µ–¥–∞–≥–æ–≤–∞–Ω—É –≤–µ—Ä—Å—ñ—é!** üöÄ  
–Ø–∫—â–æ —î –ø–∏—Ç–∞–Ω–Ω—è ‚Äî –ø–∏—Ç–∞–π! üòä