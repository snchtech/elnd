–î—É–∂–µ –¥–æ–±—Ä–µ! –¢–≤–æ—î –∑–∞–≤–¥–∞–Ω–Ω—è ‚Äî —Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –ø–æ—Ç—É–∂–Ω–∏–π –∂—É—Ä–Ω–∞–ª –∑–∞–≤–¥–∞–Ω—å –∑ –ø–æ–≤–Ω–æ—é –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—î—é. –ù–∏–∂—á–µ —è –ø–æ–∫–∞–∂—É, —è–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ `VIEW` –≤ Oracle, —è–∫–∞:

* –æ–±‚Äô—î–¥–Ω—É—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –∑ –æ—Å–Ω–æ–≤–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—å;
* —Ñ–æ—Ä–º—É—î –∑–º—ñ—Å—Ç HTML —É –∫–æ–ª–æ–Ω–∫–∞—Ö (—ñ–∑ –∫–ª–∞—Å–∞–º–∏ `task_creator` —Ç–∞ `signer_info`);
* –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î —è–∫ –æ–¥–∏–Ω–∏—á–Ω—ñ, —Ç–∞–∫ —ñ —ñ—î—Ä–∞—Ä—Ö—ñ—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è;
* –≤—Ä–∞—Ö–æ–≤—É—î —Å—Ç–∞—Ç—É—Å –æ–∑–Ω–∞–π–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

---

### üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑–æ–≤–æ—ó `VIEW` `V_TASKS_FULL`

```sql
CREATE OR REPLACE VIEW V_TASKS_FULL AS
SELECT
    t.ID AS TASK_ID,
    
    -- 1. –î–∞—Ç–∞ –ø–æ—á–∞—Ç–∫—É
    t.PLANNING_DATE_START,
    
    -- 2. UNIT
    u.NAME AS UNIT_NAME,
    
    -- 3. –ó–º—ñ—Å—Ç –∑–∞–≤–¥–∞–Ω–Ω—è (TEXT –∞–±–æ HTML-—Å–ø–∏—Å–æ–∫)
    CASE 
        WHEN t.TYPE_ID = 0 THEN t.TASK_CONTENT
        ELSE (
            SELECT LISTAGG('<li>' || s.SUBTASK_CONTENT || '</li>', '') 
            WITHIN GROUP (ORDER BY s.SUBTASK_ORDER)
            FROM TASK_SUBTASKS s
            WHERE s.TASK_ID = t.ID
        )
    END AS TASK_DESCRIPTION_HTML,
    
    -- 4. –•—Ç–æ –≤–∏–¥–∞–≤ (stage 1)
    (
        SELECT 
            '<span class="task_creator">' ||
            NVL(pos.NAME, '') || ', ' || NVL(dep.NAME, '') || ', ' || NVL(u2.USERNAME, '') ||
            '</span>' ||
            COALESCE(
                (
                    SELECT '<span class="signer_info">' || us.USERNAME || ', ' || TO_CHAR(h.SIGNER_DATE, 'DD.MM.YYYY HH24:MI') || '</span>'
                    FROM SIGNATUREHISTORY h
                    JOIN USERS us ON us.ID = h.SIGNER_BY
                    WHERE h.SIGNRIGHT_ID = sr.ID
                    FETCH FIRST ROW ONLY
                ),
                ''
            )
        FROM SIGNATURERIGHTS sr
        LEFT JOIN POSITION_TABLE pos ON pos.ID = sr.POSITION_ID
        LEFT JOIN DEPARTMENT_TABLE dep ON dep.ID = sr.DEPARTMENT_ID
        LEFT JOIN USER_TABLE u2 ON u2.ID = sr.USER_ID
        WHERE sr.TASK_ID = t.ID AND sr.STAGES_ID = 1
        FETCH FIRST ROW ONLY
    ) AS CREATOR_INFO,

    -- 5. –í–∏–∫–æ–Ω–∞–≤—Ü—ñ (–º–æ–∂–µ –±—É—Ç–∏ –±–∞–≥–∞—Ç–æ)
    (
        SELECT LISTAGG(
            '<span class="task_creator">' || 
            NVL(pos.NAME, '') || ', ' || NVL(dep.NAME, '') || ', ' || NVL(u2.USERNAME, '') || '</span>' ||
            COALESCE((
                SELECT '<span class="signer_info">' || us.USERNAME || ', ' || TO_CHAR(h.SIGNER_DATE, 'DD.MM.YYYY HH24:MI') || '</span>'
                FROM SIGNATUREHISTORY h
                JOIN USERS us ON us.ID = h.SIGNER_BY
                WHERE h.SIGNRIGHT_ID = sr2.ID
                FETCH FIRST ROW ONLY
            ), ''),
        ' <br> ') 
        FROM SIGNATURERIGHTS sr2
        LEFT JOIN POSITION_TABLE pos ON pos.ID = sr2.POSITION_ID
        LEFT JOIN DEPARTMENT_TABLE dep ON dep.ID = sr2.DEPARTMENT_ID
        LEFT JOIN USER_TABLE u2 ON u2.ID = sr2.USER_ID
        WHERE sr2.TASK_ID = t.ID AND sr2.STAGES_ID = 2
    ) AS EXECUTOR_INFO,

    -- 6. –ü–ª–∞–Ω–æ–≤–∞ –¥–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
    t.PLANNING_DATE_END,

    -- 7. –§–∞–∫—Ç–∏—á–Ω–∞ –¥–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è (stage 3)
    (
        SELECT TO_CHAR(h.SIGNER_DATE, 'DD.MM.YYYY HH24:MI') || ' (' || us.USERNAME || ')'
        FROM SIGNATUREHISTORY h
        JOIN SIGNATURERIGHTS sr3 ON sr3.ID = h.SIGNRIGHT_ID
        JOIN USER_TABLE us ON us.ID = h.SIGNER_BY
        WHERE sr3.TASK_ID = t.ID AND sr3.STAGES_ID = 3
        FETCH FIRST ROW ONLY
    ) AS ACTUAL_DATE_END_INFO,

    -- 8. –°—Ç–∞—Ç—É—Å
    st.NAME AS STATUS_NAME,

    -- 9. –í—ñ–¥–¥—ñ–ª
    dep.NAME AS DEPARTMENT_NAME,

    -- 10. –ü—Ä–∏–º—ñ—Ç–∫–∞
    t.NOTE,

    -- 11. –û–∑–Ω–∞–π–æ–º–ª–µ–Ω–∏–π
    (
        SELECT us.USERNAME || ' (' || TO_CHAR(tv.DATE_VIEWED, 'DD.MM.YYYY HH24:MI') || ')'
        FROM TASK_VIEWED tv
        JOIN USER_TABLE us ON us.ID = tv.USER_ID
        WHERE tv.TASK_ID = t.ID 
          AND TRUNC(tv.DATE_VIEWED) = TRUNC(SYSDATE)
        FETCH FIRST ROW ONLY
    ) AS VIEWED_BY

FROM TASKS t
LEFT JOIN UNIT u ON u.ID = t.UNIT_ID
LEFT JOIN STATUS_TABLE st ON st.ID = t.STATUS_ID
LEFT JOIN DEPARTMENT_TABLE dep ON dep.ID = t.DEPARTMENT_ID;
```

---

### üìù –ü–æ—è—Å–Ω–µ–Ω–Ω—è:

* `LISTAGG(..., '<br>')` ‚Äî –∞–≥—Ä–µ–≥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö –¥–ª—è –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤ –∞–±–æ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å —É –≤–∏–≥–ª—è–¥—ñ HTML-—Å—Ç—Ä–æ–∫–∏.
* `FETCH FIRST ROW ONLY` ‚Äî –¥–ª—è —Å–∫–æ—Ä–æ—á–µ–Ω–Ω—è –¥–æ –æ–¥–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É –ø—Ä–∏ `STAGES_ID = 1` –∞–±–æ `3`.
* `span class="task_creator"` / `signer_info` ‚Äî –¥–ª—è –º–æ–∂–ª–∏–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ CSS.
* –£ –∫–æ–ª–æ–Ω—Ü—ñ `TASK_DESCRIPTION_HTML` –º–∏ –≤—Å—Ç–∞–≤–ª—è—î–º–æ HTML `<li>`, –∞–ª–µ —É APEX —Ç—Ä–µ–±–∞ –±—É–¥–µ **–¥–∞—Ç–∏ escape** –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –æ–ø—Ü—ñ—é **"Escape special characters = No"**.

---

### ‚úÖ –©–æ —Ç—Ä–µ–±–∞ –¥–ª—è APEX:

1. –°—Ç–≤–æ—Ä–∏—Ç–∏ Interactive Report –Ω–∞ –±–∞–∑—ñ —Ü—å–æ–≥–æ view.
2. –£–≤—ñ–º–∫–Ω—É—Ç–∏ —Ä–µ–∂–∏–º HTML —É –∫–æ–ª–æ–Ω–∫–∞—Ö —ñ–∑ HTML.
3. –î–æ–¥–∞—Ç–∏ –ø—ñ–∫—Ç–æ–≥—Ä–∞–º—É –≤ –∫–æ–ª–æ–Ω–∫—É ‚Ññ1 ‚Äî —è–∫ link to dialog/modal (—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∞ –∫–∞—Ä—Ç–∫–∞).
4. –í–∏–≤–µ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–ª–æ–Ω–æ–∫ —É —Ñ–æ—Ä–º–∞—Ç—ñ, —è–∫–∏–π —É–∑–≥–æ–¥–∂—É—î—Ç—å—Å—è –∑ –≤–∏–º–æ–≥–∞–º–∏.

---

–•–æ—á–µ—à, —è –∑–≥–µ–Ω–µ—Ä—É—é —Ç–æ–±—ñ —â–µ –π CSS –¥–ª—è `task_creator` —ñ `signer_info`, —â–æ–± –≤–æ–Ω–∏ –º–∞–ª–∏ —Å—Ç–∏–ª—å –¥–ª—è APEX?
