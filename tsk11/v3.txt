–¢–∞–∫, —Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—Å–µ —Ä–æ–∑—É–º—ñ—î—à ‚Äî —Ç–µ–ø–µ—Ä –ø–æ—è—Å–Ω—é –ª–æ–≥—ñ–∫—É –ø–æ –∫—Ä–æ–∫–∞—Ö —ñ —á—ñ—Ç–∫–æ —Ä–æ–∑–¥—ñ–ª—é, —è–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ä–æ–±–æ—Ç—É –∑ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è–º–∏ —ñ –ø—ñ–¥—à–∞–±–ª–æ–Ω–∞–º–∏ –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –ø–µ—Ä–µ–º–∏–∫–∞—á–∞ `P6_TASK_MODE`:

---

### üîÑ –ó–∞–≥–∞–ª—å–Ω–∞ —ñ–¥–µ—è

–ù–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è (—Å—Ç–æ—Ä—ñ–Ω–∫–∞ 6):

* `P6_TASK_MODE = 0` ‚Äî –ø—Ä–∞—Ü—é—î–º–æ –∑ —Ç–∞–±–ª–∏—Ü–µ—é `TASK_SUBTASKS`
* `P6_TASK_MODE = 1` ‚Äî –ø—Ä–∞—Ü—é—î–º–æ –∑ —Ç–∞–±–ª–∏—Ü–µ—é `TASK_TEMPLATE_SUBTASKS`

–í—Å—ñ —ñ–Ω—à—ñ item (`P6_SUBTASK_CONTENT`, `P6_PLANNING_DATE_END`, `P6_PARENT_ID` —Ç–æ—â–æ) –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –æ–¥–Ω–∞–∫–æ–≤–∏–º–∏.

---

### ‚úÖ –Ø–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ INSERT

**1. –û–¥–∏–Ω `PROCESS` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `SAVE_SUB_ENTRY`)**
–í—ñ–Ω –ø–µ—Ä–µ–≤—ñ—Ä—è—î –∑–Ω–∞—á–µ–Ω–Ω—è `:P6_TASK_MODE`:

```plsql
BEGIN
  IF :P6_TASK_MODE = 0 THEN
    -- INSERT —É TASK_SUBTASKS
    INSERT INTO TASK_SUBTASKS (
      TASK_ID,
      SUBTASK_CONTENT,
      PLANNING_DATE_END,
      PARENT_ID,
      SUBTASK_ORDER,
      STATUS_ID
    ) VALUES (
      :P6_TASK_ID,
      :P6_SUBTASK_CONTENT,
      TO_DATE(:P6_PLANNING_DATE_END, 'DD.MM.YYYY HH24:MI'),
      :P6_PARENT_ID,
      :P6_SUBTASK_ORDER,
      1
    );

  ELSIF :P6_TASK_MODE = 1 THEN
    -- INSERT —É TASK_TEMPLATE_SUBTASKS
    INSERT INTO TASK_TEMPLATE_SUBTASKS (
      TEMPLATE_ID,
      SUBTASK_CONTENT,
      STATUS_ID,
      PARENT_ID,
      SUBTASK_ORDER
    ) VALUES (
      :P6_TASK_ID,
      :P6_SUBTASK_CONTENT,
      1,
      :P6_PARENT_ID,
      :P6_SUBTASK_ORDER
    );
  END IF;
END;
```

---

### ‚úèÔ∏è –Ø–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ UPDATE

–ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ, –≤ –æ–¥–Ω–æ–º—É `PROCESS` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `UPDATE_SUB_ENTRY`):

```plsql
BEGIN
  IF :P6_TASK_MODE = 0 THEN
    UPDATE TASK_SUBTASKS
    SET
      SUBTASK_CONTENT    = :P6_SUBTASK_CONTENT,
      PLANNING_DATE_END  = TO_DATE(:P6_PLANNING_DATE_END, 'DD.MM.YYYY HH24:MI'),
      PARENT_ID          = :P6_PARENT_ID
    WHERE ID = :P6_ID;

  ELSIF :P6_TASK_MODE = 1 THEN
    UPDATE TASK_TEMPLATE_SUBTASKS
    SET
      SUBTASK_CONTENT = :P6_SUBTASK_CONTENT,
      PARENT_ID       = :P6_PARENT_ID
    WHERE ID = :P6_ID;
  END IF;
END;
```

---

### üì© –Ø–∫ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ `P6_TASK_MODE`

–ö–æ–ª–∏ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—à —Ñ–æ—Ä–º—É –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —á–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è:

* —É —Ç–≤–æ—î–º—É JavaScript –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –¥—ñ–∞–ª–æ–≥—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç–∏ `P6_TASK_MODE` –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö `p_items / p_values` —Ä–∞–∑–æ–º —ñ–∑ `P6_ID`, —è–∫—â–æ –π–¥–µ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è.

```javascript
apex.server.process("GET_SUBTASK_EDIT_URL", {
  x01: subtaskId,
  x02: taskMode // 0 –∞–±–æ 1
}, {
  dataType: "json",
  success: function(pData) {
    apex.navigation.redirect(pData.url);
  }
});
```

–ê –≤ `PL/SQL` process –¥–ª—è –ø–æ–±—É–¥–æ–≤–∏ URL:

```plsql
DECLARE
  l_url VARCHAR2(4000);
BEGIN
  l_url := apex_page.get_url (
    p_page        => 6,
    p_clear_cache => '6',
    p_items       => 'P6_ID,P6_TASK_MODE',
    p_values      => APEX_APPLICATION.G_X01 || ',' || APEX_APPLICATION.G_X02,
    p_request     => 'DIALOG'
  );

  APEX_JSON.OPEN_OBJECT;
  APEX_JSON.WRITE('url', l_url);
  APEX_JSON.CLOSE_OBJECT;
END;
```

---

### üìå –í–∞–∂–ª–∏–≤–æ:

* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π `P6_TASK_MODE` –Ω–µ —è–∫ `Hidden`, –∞ —è–∫ `Display Only`, —â–æ–± –±–∞—á–∏—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–∏ –¥–µ–±–∞–∑—ñ
* –ù–∞ `Page Load` —Ç–∞–∫–æ–∂ –≤–∏—Å—Ç–∞–≤–ª—è–π `P6_TASK_MODE`, —è–∫—â–æ –ø–µ—Ä–µ–¥–∞—î—à —Ç—ñ–ª—å–∫–∏ `P5_TASK_MODE` –∑ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏

---

–ì–æ—Ç–æ–≤–∏–π –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º–∏ –∫—Ä–æ–∫–∞–º–∏: —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `Delete`, `Duplicate`, custom menu –¥–ª—è —à–∞–±–ª–æ–Ω—ñ–≤ ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏, —â–æ –¥–∞–ª—ñ? ‚úÖ
