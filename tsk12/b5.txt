–û—Å—å –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è **–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è –∞–±–æ —à–∞–±–ª–æ–Ω—É** –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –∑–Ω–∞—á–µ–Ω–Ω—è `P5_TASK_MODE` (0 ‚Äì –∑–∞–≤–¥–∞–Ω–Ω—è, 1 ‚Äì —à–∞–±–ª–æ–Ω), –≤–∫–ª—é—á–∞—é—á–∏:

* –ö–Ω–æ–ø–∫–∏ `TASK_EDIT` —Ç–∞ `TEMPLATE_EDIT`
* –û–¥–∏–Ω **Ajax Callback –ø—Ä–æ—Ü–µ—Å** `UPDATE_TASK_OR_TEMPLATE`
* JavaScript –¥–ª—è –∑–∞–ø—É—Å–∫—É
* Apex Notification –∑ —Ç–∞–π–º–µ—Ä–æ–º

---

## ‚úÖ 1. –ö–Ω–æ–ø–∫–∏

–ù–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ 5 (–∞–±–æ —ñ–Ω—à—ñ–π):

* –î–æ–¥–∞–π –∫–Ω–æ–ø–∫—É `TASK_EDIT`

  * Server-side condition: `:P5_TASK_MODE = 0`

* –î–æ–¥–∞–π –∫–Ω–æ–ø–∫—É `TEMPLATE_EDIT`

  * Server-side condition: `:P5_TASK_MODE = 1`

---

## ‚úÖ 2. Ajax Callback: `UPDATE_TASK_OR_TEMPLATE`

**Create Process > Ajax Callback > PL/SQL Code**:

```plsql
DECLARE
  v_mode PLS_INTEGER := TO_NUMBER(:P5_TASK_MODE);
BEGIN
  IF v_mode = 0 THEN
    UPDATE TASKS
    SET
      TASK_CONTENT       = :P5_TASK_CONTENT,
      PLANNING_DATE_START = TO_DATE(:P5_DATE1, 'DD.MM.YYYY HH24:MI'),
      PLANNING_DATE_END   = TO_DATE(:P5_DATE2, 'DD.MM.YYYY HH24:MI'),
      DEPARTMENT_ID       = :P5_DEPARTMENT_ID,
      UNIT_ID             = :P5_UNIT_ID,
      TYPE_ID             = :P5_SELECT_TASK_TYPE,
      PAGE_LIST_ID        = :P5_PAGE_LIST_ID,
      NOTE                = :P5_NOTE
    WHERE ID = :P5_TASK_ID;

  ELSIF v_mode = 1 THEN
    UPDATE TASK_TEMPLATES
    SET
      TASK_CONTENT      = :P5_TASK_CONTENT,
      DEPARTMENT_ID     = :P5_DEPARTMENT_ID,
      UNIT_ID           = :P5_UNIT_ID,
      TYPE_ID           = :P5_SELECT_TASK_TYPE,
      PAGE_LIST_ID      = :P5_PAGE_LIST_ID,
      PERIOD_MODE       = :P5_SELECT_PERIOD_MODE,
      PERIOD_INTERVAL   = :P5_TEXT1,
      PERIOD_TIME       = :P5_DATE3,
      HOURLY_TIMES      = :P5_TEXT2,
      DATE_END          = :P5_DATE_END
    WHERE ID = :P5_TASK_ID;

  END IF;

  APEX_JSON.OPEN_OBJECT;
  APEX_JSON.WRITE('status', 'success');
  APEX_JSON.CLOSE_OBJECT;

EXCEPTION
  WHEN OTHERS THEN
    APEX_JSON.OPEN_OBJECT;
    APEX_JSON.WRITE('status', 'error');
    APEX_JSON.WRITE('message', SQLERRM);
    APEX_JSON.CLOSE_OBJECT;
END;
```

---

## ‚úÖ 3. JavaScript –∫–æ–¥ –¥–ª—è –æ–±–æ—Ö –∫–Ω–æ–ø–æ–∫

**Create Dynamic Action**:

* **Event**: `Click`
* **Selection Type**: `Button`
* **Button Names**: `TASK_EDIT`, `TEMPLATE_EDIT`
* **True Action**: `Execute JavaScript Code`

```javascript
apex.server.process("UPDATE_TASK_OR_TEMPLATE", {
  pageItems: "#P5_TASK_CONTENT,#P5_DATE1,#P5_DATE2,#P5_DEPARTMENT_ID,#P5_UNIT_ID,#P5_SELECT_TASK_TYPE,#P5_PAGE_LIST_ID,#P5_NOTE,#P5_DATE3,#P5_TEXT1,#P5_TEXT2,#P5_DATE_END,#P5_TASK_MODE,#P5_SELECT_PERIOD_MODE,#P5_TASK_ID"
}, {
  dataType: "json",
  success: function(pData) {
    if (pData.status === 'success') {
      apex.message.showPageSuccess("–£—Å–ø—ñ—à–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–æ!");
      setTimeout(function() {
        apex.message.clearErrors(); // –ù–∞ –≤—Å—è–∫ –≤–∏–ø–∞–¥–æ–∫
        apex.message.hidePageSuccess();
      }, 3000);
    } else {
      apex.message.alert("–ü–æ–º–∏–ª–∫–∞: " + (pData.message || "–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞"));
    }
  },
  error: function() {
    apex.message.alert("‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –∑–∞–ø–∏—Å—É");
  }
});
```

---

## üîÅ –î–æ–¥–∞—Ç–∫–æ–≤–æ:

* –£—Å—ñ `P5_*` –ø–æ–ª—è –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ.
* –ó–Ω–∞—á–µ–Ω–Ω—è `P5_TASK_MODE` –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–º (–Ω–µ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–º `Display = None`, –∫—Ä–∞—â–µ `Read-only` –∞–±–æ `Hidden`).

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

* –û–¥–∏–Ω Ajax –ø—Ä–æ—Ü–µ—Å –æ–±—Ä–æ–±–ª—è—î —ñ –∑–∞–≤–¥–∞–Ω–Ω—è, —ñ —à–∞–±–ª–æ–Ω–∏
* –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—à–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–Ω–∏–∫–∞—î —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏
* –£ —Ä–∞–∑—ñ –ø–æ–º–∏–ª–∫–∏ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –¥—ñ–∞–ª–æ–≥

–•–æ—á–µ—à —Ç–∞–∫–æ–∂ –∑—Ä–æ–±–∏—Ç–∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–∫—Ä–∏—Ç—Ç—è –¥—ñ–∞–ª–æ–≥—É** –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, —è–∫—â–æ —Ñ–æ—Ä–º–∞ ‚Äî –º–æ–¥–∞–ª—å–Ω–∞?
