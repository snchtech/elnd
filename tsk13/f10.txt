–î–æ–±—Ä–µ! üëá –î–∞–≤–∞–π –¥–æ–ø—Ä–∞—Ü—é—î–º–æ –∫–Ω–æ–ø–∫—É **"–í –∞—Ä—Ö—ñ–≤"**, —â–æ–± –ø–µ—Ä–µ–¥ –∞–Ω—É–ª—é–≤–∞–Ω–Ω—è–º –±—É–ª–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è, —ñ —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤–∏–∫–æ–Ω—É–≤–∞–≤—Å—è `AJAX Callback`:

---

## ‚úÖ 1. –ö–Ω–æ–ø–∫–∞ `ARCHIVE_TASK`

* **Button Name**: `ARCHIVE_TASK`
* **Action**: `Defined by Dynamic Action`
* **Condition**: `:P_TASK_ACTION_MODE = 0`

---

## ‚úÖ 2. –î–æ–¥–∞–π `Dynamic Action`:

**–ù–∞–∑–≤–∞:** `Archive Task Confirm`

* **Event**: Click
* **Selection Type**: Button
* **Button**: `ARCHIVE_TASK`

---

### üîπ True Action 1: `Execute JavaScript Code`

```js
apex.confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –∞–Ω—É–ª—é–≤–∞—Ç–∏ —Ü–µ –∑–∞–≤–¥–∞–Ω–Ω—è/—à–∞–±–ª–æ–Ω?", {
  title: "–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è",
  buttonLabels: {
    ok: "–ê–Ω—É–ª—é–≤–∞—Ç–∏",
    cancel: "–°–∫–∞—Å—É–≤–∞—Ç–∏"
  },
  callback: function (confirmed) {
    if (confirmed) {
      apex.server.process("ARCHIVE_TASK_PROCESS", {
        x01: $v('P_TASK_ID'),
        x02: $v('P_TASK_MODE')
      }, {
        dataType: "json",
        success: function(pData) {
          if (pData.status === 'ok') {
            apex.message.showPageSuccess(pData.message || "–£—Å–ø—ñ—à–Ω–æ –∞–Ω—É–ª—å–æ–≤–∞–Ω–æ");
            apex.navigation.dialogClose("archived"); // –ó–∞–∫—Ä–∏–≤–∞—î –≤—ñ–∫–Ω–æ
          } else {
            apex.message.alert(pData.message || "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∞–Ω—É–ª—é–≤–∞–Ω–Ω—ñ.");
          }
        },
        error: function() {
          apex.message.alert("‚ùå –°–µ—Ä–≤–µ—Ä–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∞–Ω—É–ª—é–≤–∞–Ω–Ω—ñ.");
        }
      });
    }
  }
});
```

---

## ‚úÖ 3. –°–µ—Ä–≤–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å `ARCHIVE_TASK_PROCESS`

**Type**: `PL/SQL anonymous block`
**Execution Name**: `ARCHIVE_TASK_PROCESS`
**Called via**: `Ajax Callback` (‚ùóÔ∏è–Ω–µ –∫–Ω–æ–ø–∫–æ—é)

```plsql
DECLARE
  v_task_id  NUMBER := TO_NUMBER(APEX_APPLICATION.G_X01);
  v_mode     NUMBER := TO_NUMBER(APEX_APPLICATION.G_X02);
BEGIN
  -- 1. SIGNATUREHISTORY –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
  FOR r IN (
    SELECT h.ID
    FROM SIGNATURERIGHTS s
    JOIN SIGNATUREHISTORY h ON h.SIGNRIGHT_ID = s.ID
    WHERE s.TASK_ID = v_task_id
      AND (h.SIGNER_BY IS NULL OR h.SIGNER_DATE IS NULL)
  ) LOOP
    UPDATE SIGNATUREHISTORY
    SET SIGNER_BY   = :P0_USER_ID,
        SIGNER_DATE = SYSDATE,
        NEW_STATUS_ID = 11,
        NOTE = '–ê–Ω—É–ª—å–æ–≤–∞–Ω–æ',
        SDATE = SYSDATE
    WHERE ID = r.ID;
  END LOOP;

  -- 2. –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É
  IF v_mode = 0 THEN
    UPDATE TASKS SET STATUS_ID = 11 WHERE ID = v_task_id;
  ELSIF v_mode = 1 THEN
    UPDATE TASK_TEMPLATES SET STATUS_ID = 11 WHERE ID = v_task_id;
  END IF;

  -- 3. JSON Response
  APEX_JSON.OPEN_OBJECT;
  APEX_JSON.WRITE('status', 'ok');
  APEX_JSON.WRITE('message', '‚úÖ –ó–∞–ø–∏—Å –∞–Ω—É–ª—å–æ–≤–∞–Ω–æ —Ç–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ –∞—Ä—Ö—ñ–≤');
  APEX_JSON.CLOSE_OBJECT;

EXCEPTION
  WHEN OTHERS THEN
    APEX_JSON.OPEN_OBJECT;
    APEX_JSON.WRITE('status', 'error');
    APEX_JSON.WRITE('message', SQLERRM);
    APEX_JSON.CLOSE_OBJECT;
END;
```

---

## ‚úÖ 4. –ù–∞ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ (–¥–µ `mainReport`)

–°—Ç–≤–æ—Ä–∏ `Dynamic Action`:

* **Event**: `Dialog Closed`

* **Client-Side Condition**:

  ```js
  this.data.dialogReturn === 'archived'
  ```

* **True Action 1**: Refresh Region ‚Üí `mainReport`

* **True Action 2**: Execute JS

```js
apex.message.showPageSuccess("‚úÖ –ó–∞–≤–¥–∞–Ω–Ω—è/—à–∞–±–ª–æ–Ω —É—Å–ø—ñ—à–Ω–æ –∞–Ω—É–ª—å–æ–≤–∞–Ω–æ");
```

---

üîî –ì–æ—Ç–æ–≤–æ! –û—Ç—Ä–∏–º–∞–ª–∏:

* ‚úÖ –ö–Ω–æ–ø–∫—É –∑ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º
* üõ† –û–±—Ä–æ–±–∫—É —á–µ—Ä–µ–∑ `AJAX`
* üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
* üîÉ –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –∑–∞–≤–¥–∞–Ω—å

–•–æ—á–µ—à, —â–æ–± —è –ø–æ–∫–∞–∑–∞–≤, —è–∫ **–∞–Ω—É–ª—é–≤–∞—Ç–∏ —à–∞–±–ª–æ–Ω** –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –∫–∞—Ä—Ç–∫–∏ –Ω–∞ –æ–∫—Ä–µ–º—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –±–µ–∑ –¥—ñ–∞–ª–æ–≥—É?
