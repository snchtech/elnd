–¶–µ **–¥—É–∂–µ –≤–ª—É—á–Ω–µ —ñ –≤–∞–∂–ª–∏–≤–µ –ø–∏—Ç–∞–Ω–Ω—è** ‚Äî —ñ–¥–µ–∞–ª—å–Ω–µ –∑ —Ç–æ—á–∫–∏ –∑–æ—Ä—É **–æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è sequence, UX —ñ –∫–æ–Ω—Ç—Ä–æ–ª—é –≤–≤–æ–¥—É**. –ù–∏–∂—á–µ –ø–æ–∫–∞–∂—É **–ø–æ–≤–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º**, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î:

---

### ‚úÖ **1. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `SEQUENCE.NEXTVAL` —Ç—ñ–ª—å–∫–∏ —Ç–æ–¥—ñ, –∫–æ–ª–∏ —Ü–µ —Å–ø—Ä–∞–≤–¥—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ**

---

## üîπ –Ü–¥–µ—è

**–ù–µ –≥–µ–Ω–µ—Ä—É–π `TASK_ID` –∞–±–æ `TEMPLATE_ID` –≤ `Before Header`.**
–ó–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ:

* –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ **"–î–æ–¥–∞—Ç–∏ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è" –∞–±–æ "–î–æ–¥–∞—Ç–∏ –ø—ñ–¥—à–∞–±–ª–æ–Ω"**
* –ü–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è, —á–∏ `:P_TASK_ID` –∞–±–æ `:P_TEMPLATE_ID` –≤–∂–µ –ø—Ä–∏—Å–≤–æ—î–Ω–æ
* –Ø–∫—â–æ `NULL` ‚Üí –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è `NEXTVAL` —ñ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ hidden item
* –Ø–∫—â–æ –Ω–µ `NULL` ‚Üí –ø—Ä–æ—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —ñ—Å–Ω—É—é—á–µ –∑–Ω–∞—á–µ–Ω–Ω—è

---

### ‚úÖ –ü—Ä–∏–∫–ª–∞–¥ JavaScript –ª–æ–≥—ñ–∫–∏ –Ω–∞ –∫–Ω–æ–ø—Ü—ñ "–î–æ–¥–∞—Ç–∏ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è"

```javascript
if (!$v('P_TASK_ID')) {
  apex.server.process("GENERATE_TASK_ID", {}, {
    dataType: "text",
    success: function(newId) {
      $s("P_TASK_ID", newId); // –∑–±–µ—Ä—ñ–≥–∞—î–º–æ ID
      openSubtaskDialog(); // —Ç–≤–æ—è —Ñ—É–Ω–∫—Ü—ñ—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –≤—ñ–∫–Ω–∞
    }
  });
} else {
  openSubtaskDialog();
}
```

---

### ‚úÖ –ü—Ä–æ—Ü–µ—Å `GENERATE_TASK_ID` (Ajax Callback):

```plsql
DECLARE
  v_id TASKS.ID%TYPE;
BEGIN
  SELECT TASK_SEQ.NEXTVAL INTO v_id FROM DUAL;
  HTP.PRN(v_id); -- –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–æ–≤–∏–π ID
END;
```

> –ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ –¥–ª—è `TEMPLATE_ID`, –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –ø–µ—Ä—à–æ–≥–æ –ø—ñ–¥—à–∞–±–ª–æ–Ω—É.

---

## üîπ –ü–µ—Ä–µ–≤–∞–≥–∏

* **–ñ–æ–¥–µ–Ω sequence –Ω–µ –∑–Ω–∏–∫–∞—î –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫**
* –ü–µ—Ä—à–∏–π –∑–∞–ø–∏—Å —É `TASK_SUBTASKS` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î `P_TASK_ID`
* –ü—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —à–∞–±–ª–æ–Ω—É/–∑–∞–≤–¥–∞–Ω–Ω—è ID –≤–∂–µ —î ‚Üí –º–æ–∂–µ—à –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è —ñ–Ω—à–∏—Ö –≤—Å—Ç–∞–≤–æ–∫

---

---

### ‚úÖ **2. –û—á–∏—â–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ —ñ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–º–∏–∫–∞—á–∞ `P_TASK_MODE`, —è–∫—â–æ —î –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è/–ø—ñ–¥—à–∞–±–ª–æ–Ω–∏**

---

## üîπ –ó–∞–≤–¥–∞–Ω–Ω—è:

* –Ø–∫—â–æ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –≤–∂–µ —î —Ö–æ—á–∞ –± –æ–¥–Ω–µ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è/–ø—ñ–¥—à–∞–±–ª–æ–Ω ‚Üí –±–ª–æ–∫—É–≤–∞—Ç–∏:

  * `P_TASK_MODE`
  * `P_TASK_TYPE`
* –Ø–∫—â–æ `P_TASK_MODE` –∑–º—ñ–Ω—é—î—Ç—å—Å—è ‚Äî –ø–æ–ø–µ—Ä–µ–¥–∂–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:

  * *"–£—Å—ñ –≤–≤–µ–¥–µ–Ω—ñ –¥–∞–Ω—ñ –±—É–¥–µ –≤—Ç—Ä–∞—á–µ–Ω–æ, –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏?"*
  * –Ø–∫—â–æ –ø–æ–≥–æ–¥–∂—É—î—Ç—å—Å—è ‚Üí –æ—á–∏—â–∞—î–º–æ –≤—Å—ñ –ø–æ–ª—è —Ñ–æ—Ä–º–∏ + –≤—Å—ñ IG

---

## ‚úÖ 1. JavaScript –Ω–∞ –∑–º—ñ–Ω—É `P_TASK_MODE`

```javascript
apex.item('P_TASK_MODE').setChangeCallback(function() {
  const hasSubtasks = apex.region('TASK_SUBTASKS_IG_1').widget().interactiveGrid("getViews","grid").model.length > 0;
  const hasSubtemplates = apex.region('TASK_TEMPLATE_SUBTASKS_IG').widget().interactiveGrid("getViews","grid").model.length > 0;

  if (hasSubtasks || hasSubtemplates) {
    apex.message.alert("–ü–µ—Ä–µ–¥ –∑–º—ñ–Ω–æ—é —Ç–∏–ø—É –∑–∞–≤–¥–∞–Ω–Ω—è –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –∞–±–æ –ø—ñ–¥—à–∞–±–ª–æ–Ω–∏.");
    $s("P_TASK_MODE", $v("P_TASK_MODE")); // —Å–∫–∞—Å–æ–≤—É—î–º–æ –∑–º—ñ–Ω—É
    return false;
  }

  apex.confirm("–£—Å—ñ –¥–∞–Ω—ñ –±—É–¥–µ –æ—á–∏—â–µ–Ω–æ. –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏?", {
    title: "–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è",
    callback: function(yes) {
      if (yes) {
        clearTaskFormFields();
      } else {
        $s("P_TASK_MODE", $v("P_TASK_MODE")); // –≤—ñ–¥–∫–∞—Ç
      }
    }
  });
});
```

---

## ‚úÖ 2. –§—É–Ω–∫—Ü—ñ—è –æ—á–∏—â–µ–Ω–Ω—è –ø–æ–ª—ñ–≤

```javascript
function clearTaskFormFields() {
  const fieldsToClear = [
    'P_TASK_CONTENT', 'P_NOTE', 'P_PLANNING_DATE_START', 'P_PLANNING_DATE_END',
    'P_PERIOD_MODE', 'P_PERIOD_INTERVAL', 'P_PERIOD_TIME', 'P_WEEKLY_DAYS',
    'P_WEEKLY_TIME', 'P_DATE_END', 'P_TYPE_ID', 'P_UNIT', 'P_TASK_ID', 'P_TEMPLATE_ID'
  ];

  fieldsToClear.forEach(item => $s(item, ""));

  // –û—á–∏—Å—Ç–∏—Ç–∏ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è/–ø—ñ–¥—à–∞–±–ª–æ–Ω–∏
  apex.region('TASK_SUBTASKS_IG_1').widget().interactiveGrid("getActions").invoke("reset");
  apex.region('TASK_TEMPLATE_SUBTASKS_IG').widget().interactiveGrid("getActions").invoke("reset");
}
```

---

## ‚úÖ 3. –î–∏–Ω–∞–º—ñ—á–Ω–µ `Disable` –ø–µ—Ä–µ–º–∏–∫–∞—á–∞

–£ –¥–∏–Ω–∞–º—ñ—á–Ω–æ–º—É –¥—ñ—ó (–Ω–∞ `Page Load` —ñ `Refresh IG`) –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏:

```javascript
const igTask = apex.region('TASK_SUBTASKS_IG_1').widget().interactiveGrid("getViews", "grid").model;
const igTemplate = apex.region('TASK_TEMPLATE_SUBTASKS_IG').widget().interactiveGrid("getViews", "grid").model;

const hasRecords = igTask.length > 0 || igTemplate.length > 0;
apex.item('P_TASK_MODE').setDisabled(hasRecords);
apex.item('P_TASK_TYPE').setDisabled(hasRecords);
```

---

## üîî –ü—ñ–¥—Å—É–º–æ–∫:

| –ú–µ—Ç–∞                                              | –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ                |
| ------------------------------------------------- | -------------------------- |
| ‚ùå –£–Ω–∏–∫–Ω–µ–Ω–Ω—è –∑–∞–π–≤–æ–≥–æ `nextval`                     | ‚úÖ –ß–µ—Ä–µ–∑ lazy ID generation |
| üßπ –û—á–∏—â–µ–Ω–Ω—è —Ñ–æ—Ä–º–∏ –ø—Ä–∏ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—ñ —Ç–∏–ø—É            | ‚úÖ confirm + clearFields()  |
| üîí –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–∏ —Ç–∏–ø—É –ø—Ä–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ disable      |
| üîÉ –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ª–µ–≥–∫–æ –æ–Ω–æ–≤–∏—Ç–∏                       | ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞ –ª–æ–≥—ñ–∫–∞          |

---

üîß –•–æ—á–µ—à ‚Äî –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑—Ä–æ–±–∏—Ç–∏ `apex.message.dialog` –∑–∞–º—ñ—Å—Ç—å `confirm`, –¥–ª—è –∫—Ä–∞—Å–∏–≤—ñ—à–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –ü–æ—Ç—Ä—ñ–±–Ω–æ?
