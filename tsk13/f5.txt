–û—Å—å —è–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ç–≤—ñ–π —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª **–ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è –∞–±–æ —à–∞–±–ª–æ–Ω—É** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –º–æ–¥–∞–ª—å–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –¥–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤:

---

## ‚úÖ 1. –ó–º—ñ–Ω–∏—Ç–∏ `INSERT_TASK` –∞–±–æ `INSERT_TEMPLATE`

–£ –ø—Ä–æ—Ü–µ—Å—ñ –≤—Å—Ç–∞–≤–∫–∏ –∑–∞–≤–¥–∞–Ω–Ω—è/—à–∞–±–ª–æ–Ω—É (–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ 5) –ø–æ—Ç—Ä—ñ–±–Ω–æ:

1. –ó–∞–ø–∏—Å–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è/—à–∞–±–ª–æ–Ω.
2. –û—Ç—Ä–∏–º–∞—Ç–∏ `TASK_ID` (—á–µ—Ä–µ–∑ `RETURNING`).
3. –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ URL –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É 7 –∑ –ø–µ—Ä–µ–¥–∞—á–µ—é `TASK_ID`.
4. –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ —Ü–µ–π URL —É JSON.

### üîß –ö–æ–¥ `PL/SQL Process` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `CREATE_TASK_AND_REDIRECT`):

```plsql
DECLARE
  v_new_id TASKS.ID%TYPE;
  v_url    VARCHAR2(4000);
BEGIN
  -- 1. –°—Ç–≤–æ—Ä—é—î–º–æ –∑–∞–≤–¥–∞–Ω–Ω—è
  INSERT INTO TASKS (
    ID, DATE_CREATE, TASK_CONTENT, CREATOR_ID, PLANNING_DATE_START,
    PLANNING_DATE_END, STATUS_ID, DEPARTMENT_ID, UNIT_ID, TYPE_ID,
    PAGE_LIST_ID, IS_GENERATED, GENERATED_DATE, TEMPLATE_ID, NOTE
  ) VALUES (
    TASKS_SEQ.NEXTVAL,
    SYSDATE,
    :P5_TASK_CONTENT,
    :APP_USER,
    TO_DATE(:P5_DATE1, 'DD.MM.YYYY HH24:MI'),
    TO_DATE(:P5_DATE2, 'DD.MM.YYYY HH24:MI'),
    1, :P5_DEPARTMENT_ID, :P5_UNIT_ID, :P5_SELECT_TASK_TYPE,
    NULL, 0, NULL, NULL, :P5_NOTE
  )
  RETURNING ID INTO v_new_id;

  -- 2. –§–æ—Ä–º—É—î–º–æ URL –¥–ª—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ 7
  v_url := apex_page.get_url (
    p_page        => 7,
    p_clear_cache => '7',
    p_items       => 'P7_TASK_ID',
    p_values      => v_new_id,
    p_request     => 'DIALOG'
  );

  -- 3. –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —è–∫ JSON
  APEX_JSON.OPEN_OBJECT;
  APEX_JSON.WRITE('status', 'ok');
  APEX_JSON.WRITE('url', v_url);
  APEX_JSON.CLOSE_OBJECT;

EXCEPTION
  WHEN OTHERS THEN
    APEX_JSON.OPEN_OBJECT;
    APEX_JSON.WRITE('status', 'error');
    APEX_JSON.WRITE('message', SQLERRM);
    APEX_JSON.CLOSE_OBJECT;
END;
```

---

## ‚úÖ 2. –í–∏–∫–ª–∏–∫ Ajax –∑ JavaScript —Ç–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏

### üîπ –ù–∞ –∫–Ω–æ–ø–∫—É `CREATE TASK` –¥–æ–¥–∞–π `Dynamic Action`:

* Event: `Click`
* True Action: **Execute JavaScript Code**:

```js
apex.server.process("CREATE_TASK_AND_REDIRECT", {
  pageItems: "#P5_TASK_CONTENT, #P5_DATE1, #P5_DATE2, #P5_NOTE, #P5_UNIT_ID, #P5_DEPARTMENT_ID, #P5_SELECT_TASK_TYPE"
}, {
  dataType: "json",
  success: function(pData) {
    if (pData.status === 'ok') {
      apex.navigation.dialog(pData.url, {
        title: "–î–æ–¥–∞–≤–∞–Ω–Ω—è –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤",
        height: "auto",
        width: "800",
        modal: true
      });
    } else {
      apex.message.alert("–ü–æ–º–∏–ª–∫–∞: " + (pData.message || "–Ω–µ–≤—ñ–¥–æ–º–æ"));
    }
  },
  error: function() {
    apex.message.alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è.");
  }
});
```

---

## ‚úÖ 3. –°—Ç–æ—Ä—ñ–Ω–∫–∞ 7 ‚Äî `Before Header Process`: –≤—Å—Ç–∞–≤–∫–∞ –∑–∞–ø–∏—Å—ñ–≤ —É `SIGNATURERIGHTS`

```plsql
BEGIN
  -- Stage 1
  INSERT INTO SIGNATURERIGHTS (
    TASK_ID, POSITION_ID, DEPARTMENT_ID, UNIT_ID, USER_ID,
    STAGE_ID, SORT_ORDER, SUBTASK_ID, SHIFT_GROUP_ID, SHIFT_TIME_ID
  ) VALUES (
    :P7_TASK_ID,
    :P0_POSITION_ID,
    :P0_DEPARTMENT_ID,
    :P0_UNIT_ID,
    :P0_USER_ID,
    1,
    1,
    NULL,
    NULL,
    NULL
  );

  -- Stage 3
  INSERT INTO SIGNATURERIGHTS (
    TASK_ID, POSITION_ID, DEPARTMENT_ID, UNIT_ID, USER_ID,
    STAGE_ID, SORT_ORDER, SUBTASK_ID, SHIFT_GROUP_ID, SHIFT_TIME_ID
  ) VALUES (
    :P7_TASK_ID,
    :P0_POSITION_ID,
    :P0_DEPARTMENT_ID,
    :P0_UNIT_ID,
    :P0_USER_ID,
    3,
    1,
    NULL,
    NULL,
    NULL
  );
END;
```

> üîî –ú–æ–∂–µ—à –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ `Server Side Condition: P7_TASK_ID is not null`, —â–æ–± –Ω–µ –≤—Å—Ç–∞–≤–ª—è–ª–æ—Å—å –∑–∞–π–≤–æ–≥–æ.

---

üîÑ –•–æ—á–µ—à ‚Äî –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ —Ç–∞–∫–æ–∂ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–∫—Ä–∏–≤–∞—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É 7 –ø—ñ—Å–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –π —Ä–æ–±–∏—Ç–∏ `refresh` –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π. –•–æ—á–µ—à –¥–æ–¥–∞—Ç–∏?
