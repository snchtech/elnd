–ß—É–¥–æ–≤–æ! –û—Å—å —è–∫ **–∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤—Å—ñ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –∑ `APEX_COLLECTION` —É —Ç–∞–±–ª–∏—Ü—é `TASK_SUBTASKS`** –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ `–ó–±–µ—Ä–µ–≥—Ç–∏` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `CREATE_TASK`, `SAVE_TEMPLATE` —Ç–æ—â–æ).

---

## ‚úÖ –ö–†–û–ö 1. –ü—Ä–æ—Ü–µ—Å –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: `SAVE_TASK_SUBTASKS_FROM_COLLECTION`

–¶–µ —Å–µ—Ä–≤–µ—Ä–Ω–∏–π `PL/SQL Process`, —è–∫–∏–π:

* –ü—Ä–æ—Ö–æ–¥–∏—Ç—å—Å—è –ø–æ `TASK_SUBTASKS_COLLECTION`
* –í—Å—Ç–∞–≤–ª—è—î –¥–∞–Ω—ñ –≤ `TASK_SUBTASKS`
* –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î —ñ—î—Ä–∞—Ä—Ö—ñ—é —á–µ—Ä–µ–∑ `MAP` —Å—Ç–∞—Ä–∏—Ö ‚Üí –Ω–æ–≤–∏—Ö `SEQ_ID` ‚Üî `ID`
* –ù–µ –∑–±–µ—Ä—ñ–≥–∞—î –∑–∞–ø–∏—Å–∏, —è–∫—ñ –≤–∂–µ —î –≤ –ë–î

---

### üîß –ö–æ–¥ –ø—Ä–æ—Ü–µ—Å—É (–ø—Ä–∏–∫–ª–∞–¥)

```plsql
DECLARE
  l_task_id TASK_SUBTASKS.TASK_ID%TYPE := :P5_TASK_ID; -- –∞–±–æ P_TASK_ID
  l_new_id  TASK_SUBTASKS.ID%TYPE;

  -- –º–∞–ø–∞: –∫–æ–ª–µ–∫—Ü—ñ–π–Ω–∏–π SEQ_ID ‚Üí –Ω–æ–≤–∏–π ID –≤ –ë–î
  TYPE t_id_map IS TABLE OF NUMBER INDEX BY NUMBER;
  l_id_map t_id_map;

BEGIN
  FOR r IN (
    SELECT *
    FROM APEX_COLLECTIONS
    WHERE COLLECTION_NAME = 'TASK_SUBTASKS_COLLECTION'
      AND c010 = 'NEW' -- —Ç—ñ–ª—å–∫–∏ –Ω–æ–≤—ñ
  ) LOOP

    -- –í—Å—Ç–∞–≤–ª—è—î–º–æ –±–µ–∑ PARENT_ID (—Ç–∏–º—á–∞—Å–æ–≤–æ)
    INSERT INTO TASK_SUBTASKS (
      TASK_ID,
      SUBTASK_CONTENT,
      PLANNING_DATE_END,
      PARENT_ID,
      SUBTASK_ORDER,
      STATUS_ID
    ) VALUES (
      l_task_id,
      r.c001,                             -- SUBTASK_CONTENT
      NULL,                               -- PLANNING_DATE_END (–∑–∞ –ø–æ—Ç—Ä–µ–±–∏)
      NULL,                               -- PARENT_ID —Ç–∏–º—á–∞—Å–æ–≤–æ NULL
      r.c008,                             -- SUBTASK_ORDER
      1                                   -- STATUS_ID = —Å—Ç–≤–æ—Ä–µ–Ω–æ
    )
    RETURNING ID INTO l_new_id;

    -- –ó–∞–ø–∞–º‚Äô—è—Ç–æ–≤—É—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å
    l_id_map(r.seq_id) := l_new_id;
  END LOOP;

  -- –û–Ω–æ–≤–ª—é—î–º–æ PARENT_ID –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏
  FOR r IN (
    SELECT *
    FROM APEX_COLLECTIONS
    WHERE COLLECTION_NAME = 'TASK_SUBTASKS_COLLECTION'
      AND c010 = 'NEW'
      AND c009 IS NOT NULL
  ) LOOP
    UPDATE TASK_SUBTASKS
    SET PARENT_ID = l_id_map(TO_NUMBER(r.c009))
    WHERE ID = l_id_map(r.seq_id);
  END LOOP;

  -- –û—á–∏—â–∞—î–º–æ –∫–æ–ª–µ–∫—Ü—ñ—é
  APEX_COLLECTION.DELETE_COLLECTION('TASK_SUBTASKS_COLLECTION');
END;
```

---

## üß© –ö–†–û–ö 2. –î–æ–¥–∞—Ç–∏ —Ü–µ–π Process –¥–æ –∫–Ω–æ–ø–∫–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è

* Name: `SAVE_TASK_SUBTASKS_FROM_COLLECTION`
* Type: PL/SQL
* Condition: When Button Pressed = `CREATE_TASK`
* –ú—ñ—Å—Ü–µ: **Before** `Close Dialog` –∞–±–æ `Redirect`

---

## üßΩ –ö–†–û–ö 3. –ó–∞ –ø–æ—Ç—Ä–µ–±–∏ ‚Äî –¥–æ–¥–∞—Ç–∏ —Å—Ö–æ–∂—É –ª–æ–≥—ñ–∫—É –¥–ª—è —à–∞–±–ª–æ–Ω—ñ–≤

–ü—Ä–æ—Å—Ç–æ –∑—Ä–æ–±–∏ –∫–æ–ø—ñ—é –∫–æ–¥—É, –∑–º—ñ–Ω–∏:

* –¢–∞–±–ª–∏—Ü—é –Ω–∞ `TASK_TEMPLATE_SUBTASKS`
* –ö–æ–ª–µ–∫—Ü—ñ—é –Ω–∞ `TASK_TEMPLATE_SUBTASKS_COLLECTION`
* –Ü–º‚Äô—è –ø–æ–ª—è –Ω–∞ `TEMPLATE_ID`

---

## ‚úÖ –ë–æ–Ω—É—Å: –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è `c010 = 'NEW'`

* –ö–æ–ª–∏ —Ç–∏ —Ä–µ–¥–∞–≥—É—î—à, –º–æ–∂–µ—à –æ–Ω–æ–≤–∏—Ç–∏ `c010 = 'EXISTING'`
* –Ü —Ç–æ–¥—ñ:

  * `'NEW'` ‚Üí –≤—Å—Ç–∞–≤–ª—è—é—Ç—å—Å—è
  * `'EXISTING'` ‚Üí –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è
  * `'DELETED'` ‚Üí –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è

---

–•–æ—á–µ—à, —â–æ–± —è **–ø–æ–∫–∞–∑–∞–≤, —è–∫ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –∞–±–æ –≤–∏–¥–∞–ª—è—Ç–∏ –∑–∞–ø–∏—Å–∏ –∑ –∫–æ–ª–µ–∫—Ü—ñ—ó –ø—ñ–¥ —á–∞—Å —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è?**
