–ß—É–¥–æ–≤–æ! –ü–æ–∫–∞–∂—É, —è–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ **–ø–æ–≤–Ω—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å —É `APEX_COLLECTION`**, –∞ —Å–∞–º–µ:

---

## üîÑ 1. –û–ù–û–í–õ–ï–ù–ù–Ø –∑–∞–ø–∏—Å—É –≤ `APEX_COLLECTION`

### üìç –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ "–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è":

* –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è `Dialog` —Å—Ç–æ—Ä—ñ–Ω–∫–∞
* –î–∞–Ω—ñ –∑ `APEX_COLLECTION` –∑–∞ `SEQ_ID` (–ø–µ—Ä–µ–¥–∞—é—Ç—å —á–µ—Ä–µ–∑ `P6_SEQ_ID`)
* –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ä–µ–¥–∞–≥—É—î —Ñ–æ—Ä–º—É, –Ω–∞—Ç–∏—Å–∫–∞—î –∫–Ω–æ–ø–∫—É `UPDATE_SUBTASK`

### ‚úÖ **Process** `UPDATE_SUBTASK_IN_COLLECTION`:

```plsql
BEGIN
  APEX_COLLECTION.UPDATE_MEMBER_ATTRIBUTE(
    p_collection_name => 'TASK_SUBTASKS_COLLECTION',
    p_seq             => :P6_SEQ_ID,
    p_attr_number     => 1, -- C001: SUBTASK_CONTENT
    p_attr_value      => :P6_SUBTASK_CONTENT
  );

  APEX_COLLECTION.UPDATE_MEMBER_ATTRIBUTE(
    p_collection_name => 'TASK_SUBTASKS_COLLECTION',
    p_seq             => :P6_SEQ_ID,
    p_attr_number     => 8, -- C008: SUBTASK_ORDER
    p_attr_value      => :P6_SUBTASK_ORDER
  );

  APEX_COLLECTION.UPDATE_MEMBER_ATTRIBUTE(
    p_collection_name => 'TASK_SUBTASKS_COLLECTION',
    p_seq             => :P6_SEQ_ID,
    p_attr_number     => 9, -- C009: PARENT_ID (SEQ_ID)
    p_attr_value      => :P6_PARENT_SEQ_ID
  );

  -- –ü–æ–∑–Ω–∞—á–∞—î–º–æ, —â–æ —Ü–µ EXISTING (–¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è)
  APEX_COLLECTION.UPDATE_MEMBER_ATTRIBUTE(
    p_collection_name => 'TASK_SUBTASKS_COLLECTION',
    p_seq             => :P6_SEQ_ID,
    p_attr_number     => 10, -- C010: —Å—Ç–∞—Ç—É—Å –∑–∞–ø–∏—Å—É
    p_attr_value      => 'EXISTING'
  );
END;
```

---

## ‚ùå 2. –í–ò–î–ê–õ–ï–ù–ù–Ø –∑–∞–ø–∏—Å—É –∑ `APEX_COLLECTION`

> –Ø–∫—â–æ –∑–∞–ø–∏—Å —â–µ **–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π —É –ë–î**, –º–∏ –ø—Ä–æ—Å—Ç–æ –≤–∏–¥–∞–ª—è—î–º–æ –∑ –∫–æ–ª–µ–∫—Ü—ñ—ó.
> –Ø–∫—â–æ –∑–∞–ø–∏—Å –≤–∂–µ —ñ—Å–Ω—É—î –≤ –ë–î ‚Äî –≤—ñ–¥–º—ñ—á–∞—î–º–æ –π–æ–≥–æ —è–∫ `"DELETED"` –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ—ó –æ–±—Ä–æ–±–∫–∏.

### ‚úÖ **JS-–ª–æ–≥—ñ–∫–∞** –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ "–í–∏–¥–∞–ª–∏—Ç–∏":

```javascript
apex.server.process("MARK_OR_REMOVE_SUBTASK", {
  x01: subtaskSeqId
}, {
  dataType: "json",
  success: function(pData) {
    if (pData.status === "ok") {
      apex.region("TASK_SUBTASKS_IG_1").refresh();
    } else {
      apex.message.alert("‚ùå " + (pData.message || "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ"));
    }
  }
});
```

### ‚úÖ **–ü—Ä–æ—Ü–µ—Å–∏–Ω–≥ `MARK_OR_REMOVE_SUBTASK`**:

```plsql
DECLARE
  l_seq_id NUMBER := APEX_APPLICATION.G_X01;
  l_status VARCHAR2(20);
BEGIN
  SELECT c010
  INTO l_status
  FROM APEX_COLLECTIONS
  WHERE COLLECTION_NAME = 'TASK_SUBTASKS_COLLECTION'
    AND SEQ_ID = l_seq_id;

  IF l_status = 'NEW' THEN
    -- –í–∏–¥–∞–ª—è—î–º–æ –ø–æ–≤–Ω—ñ—Å—Ç—é
    APEX_COLLECTION.DELETE_MEMBER('TASK_SUBTASKS_COLLECTION', l_seq_id);
  ELSE
    -- –ü–æ–∑–Ω–∞—á–∞—î–º–æ —è–∫ –≤–∏–¥–∞–ª–µ–Ω–∏–π
    APEX_COLLECTION.UPDATE_MEMBER_ATTRIBUTE(
      p_collection_name => 'TASK_SUBTASKS_COLLECTION',
      p_seq             => l_seq_id,
      p_attr_number     => 10,
      p_attr_value      => 'DELETED'
    );
  END IF;

  APEX_JSON.OPEN_OBJECT;
  APEX_JSON.WRITE('status', 'ok');
  APEX_JSON.CLOSE_OBJECT;
EXCEPTION
  WHEN OTHERS THEN
    APEX_JSON.OPEN_OBJECT;
    APEX_JSON.WRITE('status', 'error');
    APEX_JSON.WRITE('message', SQLERRM);
    APEX_JSON.CLOSE_OBJECT;
END;
```

---

## üîÑ 3. –û–ë–†–û–ë–ö–ê `DELETED` —É –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ –≤ –ë–î

üëâ –î–æ–¥–∞–π —É –ø—Ä–æ—Ü–µ—Å—ñ `SAVE_TASK_SUBTASKS_FROM_COLLECTION` –æ—Å—å —Ü–µ–π –±–ª–æ–∫:

```plsql
-- –í–∏–¥–∞–ª—è—î–º–æ –≤—Å—ñ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è, —è–∫—ñ –º–∞—é—Ç—å –ø–æ–∑–Ω–∞—á–∫—É 'DELETED'
FOR r IN (
  SELECT c002 AS id
  FROM apex_collections
  WHERE collection_name = 'TASK_SUBTASKS_COLLECTION'
    AND c010 = 'DELETED'
    AND c002 IS NOT NULL -- –º–∞—î –±—É—Ç–∏ ID –∑ –ë–î
) LOOP
  DELETE FROM TASK_SUBTASKS WHERE ID = r.id;
END LOOP;
```

---

## üîê –£–í–ê–ì–ê

* –Ø–∫—â–æ –∑–∞–ø–∏—Å `"NEW"` ‚Üí –≤—Å—Ç–∞–≤–ª—è—î–º–æ –≤ —Ç–∞–±–ª–∏—Ü—é
* –Ø–∫—â–æ `"EXISTING"` ‚Üí –æ–Ω–æ–≤–ª—é—î–º–æ –≤ —Ç–∞–±–ª–∏—Ü—ñ (–ø–æ–∫–∞–∂—É –ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ —Ç—Ä–µ–±–∞)
* –Ø–∫—â–æ `"DELETED"` ‚Üí –≤–∏–¥–∞–ª—è—î–º–æ –∑ —Ç–∞–±–ª–∏—Ü—ñ

---

üîÅ –•–æ—á–µ—à –ø—Ä–∏–∫–ª–∞–¥ **`UPDATE` –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –∑ –∫–æ–ª–µ–∫—Ü—ñ—ó ‚Üí –ë–î** –¥–ª—è `EXISTING` –∑–∞–ø–∏—Å—ñ–≤?
