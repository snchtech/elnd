–û—Å—å –ø–æ–≤–Ω–∏–π –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–∏–π –ø—Ä–æ—Ü–µ—Å `SAVE_TEMPLATE_SUBTASKS_FROM_COLLECTION`, —è–∫–∏–π:

* –í—Å—Ç–∞–≤–ª—è—î –Ω–æ–≤—ñ –∑–∞–ø–∏—Å–∏ –¥–æ `TASK_TEMPLATE_SUBTASKS`
* –û–Ω–æ–≤–ª—é—î –Ω–∞—è–≤–Ω—ñ
* –í–∏–¥–∞–ª—è—î –ø–æ–∑–Ω–∞—á–µ–Ω—ñ —è–∫ `DELETED`
* –û—á–∏—â–∞—î –∫–æ–ª–µ–∫—Ü—ñ—é `TASK_TEMPLATE_SUBTASKS_COLLECTION`

---

## ‚úÖ PL/SQL –ø—Ä–æ—Ü–µ—Å: `SAVE_TEMPLATE_SUBTASKS_FROM_COLLECTION`

```plsql
DECLARE
  v_id NUMBER;
BEGIN
  -- ‚úÖ INSERT –Ω–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤
  FOR r IN (
    SELECT 
      c001 AS subtask_content,
      c008 AS subtask_order,
      c009 AS parent_id
    FROM apex_collections
    WHERE collection_name = 'TASK_TEMPLATE_SUBTASKS_COLLECTION'
      AND c010 = 'NEW'
  ) LOOP
    INSERT INTO TASK_TEMPLATE_SUBTASKS (
      TEMPLATE_ID,
      SUBTASK_CONTENT,
      STATUS_ID,
      PARENT_ID,
      SUBTASK_ORDER
    ) VALUES (
      :P_TEMPLATE_ID,
      r.subtask_content,
      1, -- –∞–±–æ —ñ–Ω—à–∏–π —Å—Ç–∞—Ç—É—Å –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
      TO_NUMBER(r.parent_id),
      TO_NUMBER(r.subtask_order)
    )
    RETURNING ID INTO v_id;
  END LOOP;

  -- ‚úÖ UPDATE —ñ—Å–Ω—É—é—á–∏—Ö –∑–∞–ø–∏—Å—ñ–≤
  FOR r IN (
    SELECT
      c002 AS id,
      c001 AS subtask_content,
      c008 AS subtask_order,
      c009 AS parent_id
    FROM apex_collections
    WHERE collection_name = 'TASK_TEMPLATE_SUBTASKS_COLLECTION'
      AND c010 = 'EXISTING'
      AND c002 IS NOT NULL
  ) LOOP
    UPDATE TASK_TEMPLATE_SUBTASKS
    SET
      SUBTASK_CONTENT    = r.subtask_content,
      SUBTASK_ORDER      = TO_NUMBER(r.subtask_order),
      PARENT_ID          = TO_NUMBER(r.parent_id)
    WHERE ID = TO_NUMBER(r.id);
  END LOOP;

  -- ‚úÖ DELETE –ø–æ–∑–Ω–∞—á–µ–Ω–∏—Ö —è–∫ DELETED
  FOR r IN (
    SELECT c002 AS id
    FROM apex_collections
    WHERE collection_name = 'TASK_TEMPLATE_SUBTASKS_COLLECTION'
      AND c010 = 'DELETED'
      AND c002 IS NOT NULL
  ) LOOP
    DELETE FROM TASK_TEMPLATE_SUBTASKS
    WHERE ID = TO_NUMBER(r.id);
  END LOOP;

  -- ‚úÖ –û—á–∏—Å—Ç–∏—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—é
  APEX_COLLECTION.DELETE_COLLECTION('TASK_TEMPLATE_SUBTASKS_COLLECTION');

EXCEPTION
  WHEN OTHERS THEN
    raise_application_error(-20001, '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ –ø—ñ–¥—à–∞–±–ª–æ–Ω—ñ–≤: ' || SQLERRM);
END;
```

---

## üîÑ –ö–æ–ª–∏ –≤–∏–∫–ª–∏–∫–∞—Ç–∏?

* –¶–µ–π –ø—Ä–æ—Ü–µ—Å –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è **—à–∞–±–ª–æ–Ω—É**, –∫–æ–ª–∏ `:P_TASK_MODE = 1`
* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∑–∞–º—ñ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—É –∑ `TASK_SUBTASKS`

---

‚úÖ –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ, –º–æ–∂—É —Ç–∞–∫–æ–∂ –¥–∞—Ç–∏ —Å–ø—ñ–ª—å–Ω—É –ª–æ–≥—ñ–∫—É:

* –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å, —è–∫–∏–π –ø–µ—Ä–µ–≤—ñ—Ä—è—î `:P_TASK_MODE`
* —ñ —Å–∞–º –≤–∏—Ä—ñ—à—É—î, —è–∫—É –∫–æ–ª–µ–∫—Ü—ñ—é –æ–±—Ä–æ–±–∏—Ç–∏ (–¥–ª—è –∑–∞–≤–¥–∞–Ω—å —á–∏ —à–∞–±–ª–æ–Ω—ñ–≤)

–ü–æ–∫–∞–∑–∞—Ç–∏ —Å–ø—ñ–ª—å–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç?
