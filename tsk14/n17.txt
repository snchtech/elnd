–û—Å—å —è–∫ –∑—Ä–æ–±–∏—Ç–∏ **–¥—É–±–ª—é–≤–∞–Ω–Ω—è –ø—ñ–¥–∑–∞–ø–∏—Å—ñ–≤ —ñ–∑ `APEX_COLLECTION`** –¥–ª—è –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å (task\_mode = 0) –∞–±–æ –ø—ñ–¥—à–∞–±–ª–æ–Ω—ñ–≤ (task\_mode = 1).

---

## ‚úÖ –¶—ñ–ª—å

1. –í–∑—è—Ç–∏ –≤—Å—ñ –∑–∞–ø–∏—Å–∏ –∑ –∫–æ–ª–µ–∫—Ü—ñ—ó.
2. –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–ø—ñ—ó:

   * –∑ –Ω–æ–≤–∏–º `PARENT_ID`, —è–∫—â–æ –±—É–ª–∏ —ñ—î—Ä–∞—Ä—Ö—ñ—ó.
   * —ñ–∑ –Ω–æ–≤–∏–º–∏ ID.
3. –í—Å—Ç–∞–≤–∏—Ç–∏ —ó—Ö **—É —Ç—É –∂ —Å–∞–º—É –∫–æ–ª–µ–∫—Ü—ñ—é**, –∞–ª–µ –∑—ñ —Å—Ç–∞—Ç—É—Å–æ–º `NEW`.

---

## ‚öôÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–ª–µ–∫—Ü—ñ–π:

* `C001` ‚Äì SUBTASK\_CONTENT
* `C002` ‚Äì ID (NULL –¥–ª—è –Ω–æ–≤–∏—Ö)
* `C003` ‚Äì PLANNING\_DATE\_END
* `C008` ‚Äì SUBTASK\_ORDER
* `C009` ‚Äì PARENT\_ID
* `C010` ‚Äì —Å—Ç–∞—Ç—É—Å (`NEW`, `EXISTING`, `DELETED`)

---

## üß† –Ü–¥–µ—è: –∑—Ä–æ–±–∏—Ç–∏ –¥–≤—ñ —Ñ–∞–∑–∏

1. **–ü–µ—Ä—à–∞ —Ñ–∞–∑–∞** ‚Äî —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–ø—ñ—ó –≤—Å—ñ—Ö –∑–∞–ø–∏—Å—ñ–≤, –∑–∞–ø–∞–º‚Äô—è—Ç–∞—Ç–∏ —Å—Ç–∞—Ä–∏–π ‚Üí –Ω–æ–≤–∏–π —ñ–Ω–¥–µ–∫—Å.
2. **–î—Ä—É–≥–∞ —Ñ–∞–∑–∞** ‚Äî –æ–Ω–æ–≤–∏—Ç–∏ `PARENT_ID` –≤ –∫–æ–ø—ñ—è—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –Ω–æ–≤–∏—Ö ID.

---

## ‚úÖ PL/SQL PROCESS: `DUPLICATE_SUBITEMS_FROM_COLLECTION`

```plsql
DECLARE
  l_coll_name      VARCHAR2(100);
  l_idx            PLS_INTEGER := 1;
  l_count          PLS_INTEGER;
  l_map_old_to_new DBMS_SQL.VARCHAR2_TABLE;
  l_seq_suffix     VARCHAR2(10);
BEGIN
  IF :P_TASK_MODE = '0' THEN
    l_coll_name := 'TASK_SUBTASKS_COLLECTION';
  ELSE
    l_coll_name := 'TASK_TEMPLATE_SUBTASKS_COLLECTION';
  END IF;

  l_count := APEX_COLLECTION.COLLECTION_MEMBER_COUNT(p_collection_name => l_coll_name);
  l_seq_suffix := TO_CHAR(SYSDATE, 'HH24MISS'); -- –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —Å—É—Ñ—ñ–∫—Å –¥–ª—è SUBTASK_ORDER

  -- üîÅ –ü—Ä–æ—Ö–æ–¥–∏–º–æ –≤—Å—ñ –∑–∞–ø–∏—Å–∏, –¥—É–±–ª—é—î–º–æ
  FOR i IN 1 .. l_count LOOP
    DECLARE
      v_new_seq VARCHAR2(30) := l_seq_suffix || '_' || TO_CHAR(i);
      v_new_index NUMBER;
    BEGIN
      APEX_COLLECTION.ADD_MEMBER(
        p_collection_name => l_coll_name,
        p_c001            => APEX_COLLECTION.GET_MEMBER_ATTRIBUTE(l_coll_name, i, 'C001'), -- CONTENT
        p_c002            => NULL, -- –Ω–æ–≤–∏–π, –±–µ–∑ ID
        p_c003            => APEX_COLLECTION.GET_MEMBER_ATTRIBUTE(l_coll_name, i, 'C003'), -- DATE
        p_c008            => APEX_COLLECTION.GET_MEMBER_ATTRIBUTE(l_coll_name, i, 'C008'), -- ORDER
        p_c009            => APEX_COLLECTION.GET_MEMBER_ATTRIBUTE(l_coll_name, i, 'C009'), -- PARENT_ID (—Ç–∏–º—á–∞—Å–æ–≤–æ —Å—Ç–∞—Ä–∏–π)
        p_c010            => 'NEW'
      );

      v_new_index := APEX_COLLECTION.LAST(p_collection_name => l_coll_name).seq_id;

      -- –ó–∞–ø–∞–º‚Äô—è—Ç–æ–≤—É—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å —Å—Ç–∞—Ä–æ–≥–æ ‚Üí –Ω–æ–≤–æ–≥–æ
      l_map_old_to_new(TO_CHAR(APEX_COLLECTION.GET_MEMBER_ATTRIBUTE(l_coll_name, i, 'C002'))) := TO_CHAR(v_new_index);
    END;
  END LOOP;

  -- üîÅ –î—Ä—É–≥–∞ —Ñ–∞–∑–∞ ‚Äî –æ–Ω–æ–≤–∏—Ç–∏ PARENT_ID –≤ –∫–æ–ø—ñ—è—Ö
  FOR i IN 1 .. APEX_COLLECTION.COLLECTION_MEMBER_COUNT(p_collection_name => l_coll_name) LOOP
    IF APEX_COLLECTION.GET_MEMBER_ATTRIBUTE(l_coll_name, i, 'C010') = 'NEW' THEN
      DECLARE
        v_old_parent VARCHAR2(100) := APEX_COLLECTION.GET_MEMBER_ATTRIBUTE(l_coll_name, i, 'C009');
        v_new_parent VARCHAR2(100);
      BEGIN
        IF v_old_parent IS NOT NULL THEN
          v_new_parent := l_map_old_to_new(v_old_parent);
          IF v_new_parent IS NOT NULL THEN
            APEX_COLLECTION.UPDATE_MEMBER_ATTRIBUTE(l_coll_name, i, 9, v_new_parent);
          END IF;
        END IF;
      END;
    END IF;
  END LOOP;

EXCEPTION
  WHEN OTHERS THEN
    raise_application_error(-20001, '‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—ñ –ø—ñ–¥–∑–∞–ø–∏—Å—ñ–≤: ' || SQLERRM);
END;
```

---

## üìå –ü—ñ—Å–ª—è –¥—É–±–ª—é–≤–∞–Ω–Ω—è

* IG –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ (–±–æ source ‚Äî –∫–æ–ª–µ–∫—Ü—ñ—è)
* –ü–æ—Ä—è–¥–æ–∫, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —ñ—î—Ä–∞—Ä—Ö—ñ—è –∑–±–µ—Ä–µ–∂–µ–Ω–∞
* –ù–µ–º–∞—î –º—É—Å–æ—Ä–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —É –ë–î

---

## üß™ –•–æ—á–µ—à, —è –ø–æ–∫–∞–∂—É –ø—Ä–∏–∫–ª–∞–¥ **–¥—É–±–ª—é–≤–∞–Ω–Ω—è –ª–∏—à–µ –æ–¥–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É**, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–¥—É–±–ª—é–≤–∞—Ç–∏" –≤ –∫–∞—Å—Ç–æ–º–Ω–æ–º—É –º–µ–Ω—é?
