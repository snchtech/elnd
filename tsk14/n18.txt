–ß—É–¥–æ–≤–æ! –û—Å—å —è–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ **–¥—É–±–ª—é–≤–∞–Ω–Ω—è –æ–¥–Ω–æ–≥–æ –ø—ñ–¥–∑–∞–ø–∏—Å—É** –∑ `APEX_COLLECTION` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –∞–±–æ –ø—ñ–¥—à–∞–±–ª–æ–Ω—É), –≤–∫–ª—é—á–Ω–æ –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é –≤–∫–ª–∞–¥–µ–Ω–æ—Å—Ç—ñ (–¥–æ—á—ñ—Ä–Ω—ñ—Ö –∑–∞–ø–∏—Å—ñ–≤):

---

## ‚úÖ –°—Ü–µ–Ω–∞—Ä—ñ–π

–ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –≤ –∫–∞—Å—Ç–æ–º–Ω–æ–º—É –º–µ–Ω—é –ø—É–Ω–∫—Ç—É **"–î—É–±–ª—é–≤–∞—Ç–∏"**, –≤–∏ –ø–µ—Ä–µ–¥–∞—î—Ç–µ `ID` (`C002`) –∑–∞–ø–∏—Å—É, —è–∫–∏–π —Ö–æ—á–µ—Ç–µ –¥—É–±–ª—é–≤–∞—Ç–∏. –ü—Ä–æ—Ü–µ—Å–∏–Ω–≥:

1. –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –∑–∞–ø–∏—Å —É –∫–æ–ª–µ–∫—Ü—ñ—ó.
2. –ö–æ–ø—ñ—é—î –π–æ–≥–æ –∑ –Ω–æ–≤–∏–º ID (NULL), —Å—Ç–∞—Ç—É—Å–æ–º `NEW`.
3. –Ø–∫—â–æ –∑–∞–ø–∏—Å –º–∞—î –¥–æ—á—ñ—Ä–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ ‚Äî –¥—É–±–ª—é—î —ó—Ö —Ç–∞–∫–æ–∂ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ (–∑—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏).

---

## üß© –°–µ—Ä–≤–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å `DUPLICATE_ONE_SUBITEM_FROM_COLLECTION`

```plsql
DECLARE
  l_coll_name   VARCHAR2(100);
  l_target_id   VARCHAR2(100) := APEX_APPLICATION.G_X01;
  l_seq_suffix  VARCHAR2(10) := TO_CHAR(SYSTIMESTAMP, 'HH24MISSFF3');
  l_map_old_new DBMS_SQL.VARCHAR2_TABLE;

  -- üß† –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞
  PROCEDURE duplicate_recursive(p_parent_id VARCHAR2, p_new_parent_id VARCHAR2) IS
    v_index       NUMBER;
    v_content     VARCHAR2(4000);
    v_date        DATE;
    v_order       NUMBER;
    v_new_index   NUMBER;
  BEGIN
    FOR rec IN (
      SELECT *
      FROM APEX_COLLECTIONS
      WHERE COLLECTION_NAME = l_coll_name
        AND C002 = p_parent_id
    ) LOOP
      -- –û—Å–Ω–æ–≤–Ω–∏–π –∑–∞–ø–∏—Å
      v_content := rec.C001;
      v_date    := TO_DATE(rec.C003, 'YYYY-MM-DD HH24:MI:SS');
      v_order   := TO_NUMBER(NVL(rec.C008, '1'));

      -- –î–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π –∑–∞–ø–∏—Å
      APEX_COLLECTION.ADD_MEMBER(
        p_collection_name => l_coll_name,
        p_c001            => v_content,
        p_c002            => NULL, -- –Ω–æ–≤–∏–π ID
        p_c003            => TO_CHAR(v_date, 'YYYY-MM-DD HH24:MI:SS'),
        p_c008            => v_order,
        p_c009            => p_new_parent_id,
        p_c010            => 'NEW'
      );

      v_new_index := APEX_COLLECTION.LAST(p_collection_name => l_coll_name).seq_id;
      l_map_old_new(p_parent_id) := TO_CHAR(v_new_index);

      -- –î–æ—á—ñ—Ä–Ω—ñ ‚Äî —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ
      FOR child IN (
        SELECT *
        FROM APEX_COLLECTIONS
        WHERE COLLECTION_NAME = l_coll_name
          AND C009 = p_parent_id
      ) LOOP
        duplicate_recursive(child.C002, TO_CHAR(v_new_index));
      END LOOP;
    END LOOP;
  END;

BEGIN
  -- 1. –ù–∞–∑–≤–∞ –∫–æ–ª–µ–∫—Ü—ñ—ó
  l_coll_name := CASE :P_TASK_MODE
                   WHEN '0' THEN 'TASK_SUBTASKS_COLLECTION'
                   WHEN '1' THEN 'TASK_TEMPLATE_SUBTASKS_COLLECTION'
                 END;

  -- 2. –ó–∞–ø—É—Å–∫–∞—î–º–æ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–µ –¥—É–±–ª—é–≤–∞–Ω–Ω—è
  duplicate_recursive(l_target_id, NULL);

  -- 3. OK response
  APEX_JSON.OPEN_OBJECT;
  APEX_JSON.WRITE('status', 'ok');
  APEX_JSON.CLOSE_OBJECT;

EXCEPTION
  WHEN OTHERS THEN
    APEX_JSON.OPEN_OBJECT;
    APEX_JSON.WRITE('status', 'error');
    APEX_JSON.WRITE('message', SQLERRM);
    APEX_JSON.CLOSE_OBJECT;
END;
```

---

## üß© JS-–∫–æ–¥ –¥–ª—è –≤–∏–∫–ª–∏–∫—É

```javascript
document.getElementById("menu-duplicate-subtask").addEventListener("click", function () {
  const id = this.dataset.id;
  if (!id) return;

  apex.server.process("DUPLICATE_ONE_SUBITEM_FROM_COLLECTION", {
    x01: id
  }, {
    dataType: "json",
    success: function(pData) {
      if (pData.status === 'ok') {
        apex.region("TASK_SUBTASKS_IG_1").refresh();
      } else {
        apex.message.alert("‚ùå –ü–æ–º–∏–ª–∫–∞: " + (pData.message || '–ù–µ–≤—ñ–¥–æ–º–æ'));
      }
    },
    error: function() {
      apex.message.alert("‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—ñ –∑ —Å–µ—Ä–≤–µ—Ä–æ–º");
    }
  });

  document.getElementById("custom-ig-menu").style.display = "none";
});
```

> üîÅ –ü—ñ–¥—Å—Ç–∞–≤ `TASK_TEMPLATE_SUBTASKS_IG`, —è–∫—â–æ –ø—Ä–∞—Ü—é—î—à —ñ–∑ —à–∞–±–ª–æ–Ω–∞–º–∏

---

## üí° –ü—Ä–∏–º—ñ—Ç–∫–∞:

* –ú–∏ –¥—É–±–ª—é—î–º–æ **—Ä–∞–∑–æ–º —ñ–∑ —É—Å—ñ–º–∞ –Ω–∞—â–∞–¥–∫–∞–º–∏** (—è–∫—â–æ –≤–æ–Ω–∏ —î).
* –ù–æ–≤–∞ –∫–æ–ø—ñ—è –∑'—è–≤–∏—Ç—å—Å—è –≤ Interactive Grid, –±–æ –≤—ñ–Ω –±—É–¥—É—î—Ç—å—Å—è –Ω–∞ –∫–æ–ª–µ–∫—Ü—ñ—ó.

---

–ì–æ—Ç–æ–≤–∏–π –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –¥—ñ—ó –∑ custom menu (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, **—Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è**, **–¥–æ–¥–∞–≤–∞–Ω–Ω—è –¥–æ—á—ñ—Ä–Ω—å–æ–≥–æ**)?
