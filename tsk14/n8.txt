–°—É–ø–µ—Ä! –¢–µ–ø–µ—Ä —Ä–µ–∞–ª—ñ–∑—É—î–º–æ **–≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è**, –≤—Ä–∞—Ö–æ–≤—É—é—á–∏ –¥–≤—ñ —Å–∏—Ç—É–∞—Ü—ñ—ó:

---

## ‚úÖ –°—Ü–µ–Ω–∞—Ä—ñ—ó:

1. üîπ **–ó–∞–ø–∏—Å —â–µ –Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π —É –ë–î** (—ñ—Å–Ω—É—î —Ç—ñ–ª—å–∫–∏ –≤ `APEX_COLLECTIONS`)
2. üî∏ **–ó–∞–ø–∏—Å –≤–∂–µ —ñ—Å–Ω—É—î –≤ –ë–î** (`TASK_SUBTASKS.TASK_ID = :P5_TASK_ID`), –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ–∑–Ω–∞—á–∏—Ç–∏ –π–æ–≥–æ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è (–Ω–µ –≤–∏–¥–∞–ª—è—Ç–∏ –æ–¥—Ä–∞–∑—É)

---

## üß© –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ä—ñ—à–µ–Ω–Ω—è

* –í `APEX_COLLECTIONS` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ **`C010 = 'DELETE'`** —è–∫ –ø–æ–∑–Ω–∞—á–∫—É –¥–ª—è –∑–∞–ø–∏—Å—ñ–≤, —è–∫—ñ —Ç—Ä–µ–±–∞ –≤–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–∏ –æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º—É –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ
* –í–∏–¥–∞–ª–µ–Ω–Ω—è –∑ IG ‚Äî –ª–∏—à–µ **–≤—ñ–∑—É–∞–ª—å–Ω–µ** (–ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –Ω–µ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è)

---

# üîÅ 1. –í–∏–¥–∞–ª–µ–Ω–Ω—è –≤ JavaScript (custom menu):

```javascript
document.getElementById("menu-delete-subtask").addEventListener("click", function () {
  const seqId = this.dataset.seqid;
  if (!seqId) return;

  apex.message.confirm("–í–∏ –¥—ñ–π—Å–Ω–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è?", function (okPressed) {
    if (okPressed) {
      apex.server.process("DELETE_SUBTASK_COLLECTION", {
        x01: seqId
      }, {
        dataType: "json",
        success: function (pData) {
          if (pData.status === "ok") {
            apex.region("TASK_SUBTASKS_IG_1").refresh();
          } else {
            apex.message.alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ.");
          }
        },
        error: function () {
          apex.message.alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—ñ –∑ —Å–µ—Ä–≤–µ—Ä–æ–º.");
        }
      });
    }
  });

  // –•–æ–≤–∞—î–º–æ –º–µ–Ω—é
  document.getElementById("custom-ig-menu").style.display = "none";
});
```

---

# üîß 2. Ajax Callback: `DELETE_SUBTASK_COLLECTION`

```plsql
DECLARE
  l_seq_id NUMBER := TO_NUMBER(APEX_APPLICATION.G_X01);
  l_task_id NUMBER;
BEGIN
  -- –û—Ç—Ä–∏–º–∞—î–º–æ TASK_ID –∞–±–æ NULL
  SELECT n001
  INTO l_task_id
  FROM APEX_COLLECTIONS
  WHERE COLLECTION_NAME = 'TASK_SUBTASKS_COLLECTION'
    AND SEQ_ID = l_seq_id;

  -- –Ø–∫—â–æ TASK_ID —ñ—Å–Ω—É—î ‚Üí –∑–∞–ø–∏—Å –≤–∂–µ –≤ –ë–î ‚Üí –ø–æ–∑–Ω–∞—á–∞—î–º–æ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
  IF l_task_id IS NOT NULL THEN
    APEX_COLLECTION.UPDATE_MEMBER_ATTRIBUTE(
      p_collection_name => 'TASK_SUBTASKS_COLLECTION',
      p_seq             => l_seq_id,
      p_attr_number     => 10, -- C010
      p_attr_value      => 'DELETE'
    );
  ELSE
    -- –Ø–∫—â–æ —â–µ –Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π ‚Üí –ø—Ä–æ—Å—Ç–æ –≤–∏–¥–∞–ª—è—î–º–æ –∑ –∫–æ–ª–µ–∫—Ü—ñ—ó
    APEX_COLLECTION.DELETE_MEMBER(
      p_collection_name => 'TASK_SUBTASKS_COLLECTION',
      p_seq             => l_seq_id
    );
  END IF;

  APEX_JSON.OPEN_OBJECT;
  APEX_JSON.WRITE('status', 'ok');
  APEX_JSON.CLOSE_OBJECT;
EXCEPTION
  WHEN OTHERS THEN
    APEX_JSON.OPEN_OBJECT;
    APEX_JSON.WRITE('status', 'error');
    APEX_JSON.WRITE('message', SQLERRM);
    APEX_JSON.CLOSE_OBJECT;
END;
```

---

# üßº 3. –í–∏–¥–∞–ª–µ–Ω–Ω—è —É —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É INSERT / UPDATE (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—ñ—Å–ª—è CREATE TASK)

```plsql
FOR r IN (
  SELECT *
  FROM APEX_COLLECTIONS
  WHERE COLLECTION_NAME = 'TASK_SUBTASKS_COLLECTION'
)
LOOP
  IF r.c010 = 'DELETE' THEN
    -- –í–∏–¥–∞–ª—è—î–º–æ –∑ –ë–î
    DELETE FROM TASK_SUBTASKS WHERE ID = r.n002;
  ELSE
    -- –Ü–Ω—à—ñ: INSERT / UPDATE
    NULL;
  END IF;
END LOOP;
```

> `r.n002` ‚Äî —Ü–µ `ID` –∑ —Ç–∞–±–ª–∏—Ü—ñ (—Ç–∏ –º–æ–∂–µ—à –¥–æ–¥–∞—Ç–∏ –π–æ–≥–æ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó —á–µ—Ä–µ–∑ `N002 := EXISTING_ID`)

---

# üìå –ü–æ—Ä–∞–¥–∞:

* –Ø–∫—â–æ –∑–∞–ø–∏—Å —â–µ –Ω–µ —ñ—Å–Ω—É—î –≤ —Ç–∞–±–ª–∏—Ü—ñ ‚Üí –π–æ–≥–æ –Ω–µ –±—É–¥–µ –≤ `N002`, –º–æ–∂–Ω–∞ –Ω–µ —á—ñ–ø–∞—Ç–∏
* –Ø–∫—â–æ —Ç–∏ —Ö–æ—á–µ—à –±—É—Ç–∏ 100% —Ç–æ—á–Ω–∏–º ‚Äî —Å—Ç–≤–æ—Ä—é–π –∫–æ–ª–µ–∫—Ü—ñ—é –∑ –ø–æ–ª–µ–º `N002` –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è `TASK_SUBTASKS.ID` (–∞–±–æ `TEMPLATE_SUBTASKS.ID`)

---

–•–æ—á–µ—à —Ç–µ–ø–µ—Ä —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ **–¥–æ–¥–∞–≤–∞–Ω–Ω—è –¥–æ—á—ñ—Ä–Ω—å–æ–≥–æ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è** –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —ñ—î—Ä–∞—Ä—Ö—ñ—ó –≤ `APEX_COLLECTIONS`?
