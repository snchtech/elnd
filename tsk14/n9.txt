–°—É–ø–µ—Ä! –¢–µ–ø–µ—Ä —Ä–µ–∞–ª—ñ–∑—É—î–º–æ **–¥–æ–¥–∞–≤–∞–Ω–Ω—è –¥–æ—á—ñ—Ä–Ω—å–æ–≥–æ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –≤ APEX\_COLLECTIONS**, –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —ñ—î—Ä–∞—Ä—Ö—ñ—ó.

---

### üîß –ó–∞–≥–∞–ª—å–Ω—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏:

1. –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤—Å—ñ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –≤ `APEX_COLLECTIONS`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `TASK_SUBTASKS_COLLECTION`
2. –î–ª—è –¥–æ—á—ñ—Ä–Ω—ñ—Ö –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ **SEQ\_ID –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —É `C009`)
3. `SUBTASK_ORDER` –≤–∏–∑–Ω–∞—á–∞—î–º–æ –≤—ñ–¥–Ω–æ—Å–Ω–æ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `3`, `3.1`, `3.1.1`

---

## ‚úÖ –ö—Ä–æ–∫ 1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Ajax Callback: `ADD_SUBTASK_CHILD`

```plsql
DECLARE
  l_task_id   NUMBER := TO_NUMBER(:P5_TASK_ID);
  l_content   VARCHAR2(4000) := APEX_APPLICATION.G_X01;
  l_parent_id NUMBER := TO_NUMBER(APEX_APPLICATION.G_X02); -- SEQ_ID –≤ –∫–æ–ª–µ–∫—Ü—ñ—ó
  l_parent_order VARCHAR2(100);
  l_child_index NUMBER;
  l_subtask_order VARCHAR2(100);
BEGIN
  -- –û—Ç—Ä–∏–º—É—î–º–æ SUBTASK_ORDER –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞
  SELECT c008
  INTO l_parent_order
  FROM APEX_COLLECTIONS
  WHERE COLLECTION_NAME = 'TASK_SUBTASKS_COLLECTION'
    AND SEQ_ID = l_parent_id;

  -- –†–∞—Ö—É—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–∞—â–∞–¥–∫—ñ–≤ —É –±–∞—Ç—å–∫–∞
  SELECT COUNT(*) + 1
  INTO l_child_index
  FROM APEX_COLLECTIONS
  WHERE COLLECTION_NAME = 'TASK_SUBTASKS_COLLECTION'
    AND c009 = l_parent_id;

  -- –§–æ—Ä–º—É—î–º–æ –Ω–æ–≤–∏–π –ø–æ—Ä—è–¥–æ–∫ (SUBTASK_ORDER)
  l_subtask_order := l_parent_order || '.' || l_child_index;

  -- –î–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π –¥–æ—á—ñ—Ä–Ω—ñ–π –∑–∞–ø–∏—Å
  APEX_COLLECTION.ADD_MEMBER(
    p_collection_name => 'TASK_SUBTASKS_COLLECTION',
    p_n001            => l_task_id,
    p_c001            => l_content,
    p_c008            => l_subtask_order, -- SUBTASK_ORDER
    p_c009            => TO_CHAR(l_parent_id), -- –∑–≤'—è–∑–æ–∫ —ñ–∑ –±–∞—Ç—å–∫–æ–º (SEQ_ID)
    p_c010            => 'NEW'
  );

  APEX_JSON.OPEN_OBJECT;
  APEX_JSON.WRITE('status', 'ok');
  APEX_JSON.CLOSE_OBJECT;
EXCEPTION
  WHEN OTHERS THEN
    APEX_JSON.OPEN_OBJECT;
    APEX_JSON.WRITE('status', 'error');
    APEX_JSON.WRITE('message', SQLERRM);
    APEX_JSON.CLOSE_OBJECT;
END;
```

---

## üì¶ JavaScript –¥–ª—è –≤–∏–∫–ª–∏–∫—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤ custom menu)

```javascript
document.getElementById("menu-add-child-subtask").addEventListener("click", function () {
  const parentSeqId = this.dataset.seqid;
  const taskId = $v('P5_TASK_ID'); // –∞–±–æ –ø–µ—Ä–µ–¥–∞–π –æ–∫—Ä–µ–º–æ

  const content = prompt("–í–≤–µ–¥—ñ—Ç—å –∑–º—ñ—Å—Ç –Ω–æ–≤–æ–≥–æ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è");
  if (!content) return;

  apex.server.process("ADD_SUBTASK_CHILD", {
    x01: content,
    x02: parentSeqId
  }, {
    dataType: "json",
    success: function(pData) {
      if (pData.status === "ok") {
        apex.region("TASK_SUBTASKS_IG_1").refresh();
      } else {
        apex.message.alert("‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ");
      }
    },
    error: function() {
      apex.message.alert("‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞");
    }
  });

  document.getElementById("custom-ig-menu").style.display = "none";
});
```

---

## üìä –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ—Ä–∞–¥–∏:

* `C009` ‚Äî –∑–≤'—è–∑–æ–∫ —ñ–∑ –±–∞—Ç—å–∫–æ–º (–≤–∫–∞–∑—É—î –Ω–∞ `SEQ_ID` –±–∞—Ç—å–∫–∞)
* `C008` ‚Äî SUBTASK\_ORDER
* –î–ª—è —Ä–µ–Ω–¥–µ—Ä—É –≤ IG –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∏–π CTE –Ω–∞ `APEX_COLLECTIONS`, –∞–±–æ –≤ JS –æ–±—á–∏—Å–ª—é–≤–∞—Ç–∏ `level`, `indent`, —ñ –≤–∏–≤–æ–¥–∏—Ç–∏ —è–∫ `RPAD` —á–∏ HTML

---

–•–æ—á–µ—à, —â–æ–± —è –ø–æ–∫–∞–∑–∞–≤, **—è–∫ –≤–∏–≤–æ–¥–∏—Ç–∏ —ñ—î—Ä–∞—Ä—Ö—ñ—á–Ω–æ –≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫ –∑ –∫–æ–ª–µ–∫—Ü—ñ—ó** –¥–ª—è Interactive Grid?
