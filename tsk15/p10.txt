–û—Å—å –æ–Ω–æ–≤–ª–µ–Ω–∏–π JavaScript-–∫–æ–¥ –∑–≥—ñ–¥–Ω–æ –∑ —Ç–≤–æ—ó–º–∏ –≤–∏–º–æ–≥–∞–º–∏:

* ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –∑–∞–ø–æ–≤–Ω–µ–Ω–∏—Ö –ø–æ–ª—ñ–≤ —Ç–∞ –∑–∞–ø–∏—Å—ñ–≤ —É –∫–æ–ª–µ–∫—Ü—ñ—è—Ö.
* ‚úÖ –ü–æ–∫–∞–∑—É—î –æ–¥–Ω–µ –∑–∞–≥–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º.
* ‚úÖ –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î ‚Äî –æ—á–∏—â–∞—î –ø–æ–ª—è —Ç–∞ –≤–∏–∫–ª–∏–∫–∞—î **Ajax Callback**, —è–∫–∏–π –æ—á–∏—â–∞—î –∫–æ–ª–µ–∫—Ü—ñ—ó —á–µ—Ä–µ–∑ `APEX_COLLECTION.DELETE_COLLECTION`.
* ‚úÖ –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –ø–µ—Ä–µ–º–∏–∫–∞—á–∞ `P_TASK_MODE`.

```javascript
document.addEventListener("DOMContentLoaded", function () {
  const switchItem = document.querySelector('#P_TASK_MODE');
  if (!switchItem) return;

  const wrapper = switchItem.closest('.t-Form-fieldContainer');
  if (!wrapper) return;

  // –°—Ç–≤–æ—Ä—é—î–º–æ overlay
  const overlay = document.createElement('span');
  overlay.className = 'switch-overlay';
  overlay.title = '–û—á–∏—Å—Ç—ñ—Ç—å –¥–∞–Ω—ñ –ø–µ—Ä–µ–¥ –∑–º—ñ–Ω–æ—é —Ä–µ–∂–∏–º—É';
  wrapper.style.position = 'relative';
  wrapper.appendChild(overlay);

  overlay.addEventListener('click', function () {
    const hasSubtasks = apex.region('TASK_SUBTASKS_IG_1')?.widget()?.interactiveGrid("getViews", "grid").model.length > 0;
    const hasSubtemplates = apex.region('TASK_TEMPLATE_SUBTASKS_IG')?.widget()?.interactiveGrid("getViews", "grid").model.length > 0;
    const hasFilledFields = ['P_TASK_CONTENT', 'P_NOTE', 'P_UNIT'].some(id => $v(id)?.trim() !== '');

    if (hasSubtasks || hasSubtemplates || hasFilledFields) {
      apex.message.confirm("–£—Å—ñ –≤–≤–µ–¥–µ–Ω—ñ –¥–∞–Ω—ñ –±—É–¥–µ –æ—á–∏—â–µ–Ω–æ. –í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ —Ç–∏–ø?", function (okPressed) {
        if (okPressed) {
          // –û—á–∏—â–∞—î–º–æ –ø–æ–ª—è —Ñ–æ—Ä–º–∏
          const fieldsToClear = [
            'P_TASK_CONTENT', 'P_NOTE', 'P_UNIT', 'P_PLANNING_DATE_START',
            'P_PLANNING_DATE_END', 'P_PERIOD_MODE', 'P_PERIOD_INTERVAL',
            'P_PERIOD_TIME', 'P_WEEKLY_DAYS', 'P_WEEKLY_TIME',
            'P_DATE_END', 'P_TYPE_ID'
          ];
          fieldsToClear.forEach(id => $s(id, ""));

          // –í–∏–∫–ª–∏–∫–∞—î–º–æ –ø—Ä–æ—Ü–µ—Å –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ–π
          apex.server.process("CLEAR_TASK_SUB_COLLECTIONS", {
            x01: $v('P_TASK_MODE')  // –ø–µ—Ä–µ–¥–∞—î–º–æ task_mode, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
          }, {
            dataType: "json",
            success: function () {
              // –ü—ñ—Å–ª—è –æ—á–∏—â–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó –ø–µ—Ä–µ–º–∏–∫–∞—î–º–æ –≤—Ä—É—á–Ω—É
              overlay.remove(); // –∑–Ω—ñ–º–∞—î–º–æ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
              apex.item("P_TASK_MODE").setValue($v("P_TASK_MODE") === '0' ? '1' : '0');
            },
            error: function () {
              apex.message.alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—á–∏—â–µ–Ω–Ω—ñ –∫–æ–ª–µ–∫—Ü—ñ–π.");
            }
          });
        }
      });
    } else {
      // –Ø–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–æ ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–º–∏–∫–∞—î–º–æ
      overlay.remove();
      apex.item("P_TASK_MODE").setValue($v("P_TASK_MODE") === '0' ? '1' : '0');
    }
  });
});
```

---

### üîÅ PL/SQL Ajax Callback (–Ω–∞–∑–≤–∞: `CLEAR_TASK_SUB_COLLECTIONS`):

```plsql
BEGIN
  IF APEX_COLLECTION.COLLECTION_EXISTS('TASK_SUBTASKS_COLLECTION') THEN
    APEX_COLLECTION.DELETE_COLLECTION('TASK_SUBTASKS_COLLECTION');
  END IF;

  IF APEX_COLLECTION.COLLECTION_EXISTS('TASK_TEMPLATE_SUBTASKS_COLLECTION') THEN
    APEX_COLLECTION.DELETE_COLLECTION('TASK_TEMPLATE_SUBTASKS_COLLECTION');
  END IF;
END;
```

---

üí° **–†–µ–∑—É–ª—å—Ç–∞—Ç**:

* –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –º–æ–∂–µ –≤–∏–ø–∞–¥–∫–æ–≤–æ –ø–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ç–∏–ø —ñ –≤—Ç—Ä–∞—Ç–∏—Ç–∏ –¥–∞–Ω—ñ.
* –û—á–∏—Å—Ç–∫–∞ –∫–æ–ª–µ–∫—Ü—ñ–π —Ç–∞ –ø–æ–ª—ñ–≤ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∑–∞ –∑–≥–æ–¥–æ—é.
* –ö–æ–¥ —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π —ñ –≥–Ω—É—á–∫–∏–π –¥–ª—è –ø–æ–¥–∞–ª—å—à–∏—Ö –¥–æ–ø–æ–≤–Ω–µ–Ω—å.

–•–æ—á–µ—à, —â–æ–± —è –≤–∏–Ω—ñ—Å –ø–µ—Ä–µ–ª—ñ–∫ `fieldsToClear` –≤ –æ–∫—Ä–µ–º—É —Ñ—É–Ω–∫—Ü—ñ—é –∞–±–æ –∑—Ä–æ–±–∏–≤ —ó—ó –≥–ª–æ–±–∞–ª—å–Ω–æ—é –¥–ª—è –ø–µ—Ä–µ—é–∑—É?
