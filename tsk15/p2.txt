–©–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—ñ–≤ —É —Ç–∞–±–ª–∏—Ü—ñ `SIGNATURERIGHTS` –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏, –ø–æ—Ç—Ä—ñ–±–Ω–æ **–ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤** –∑ `TASK_ID` —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º `STAGE_ID` –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ—é.

---

### ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–∏–π `Before Header Process`:

```plsql
BEGIN
  -- üîç –Ø–∫—â–æ –¥–ª—è STAGE_ID = 1 –Ω–µ —ñ—Å–Ω—É—î –∑–∞–ø–∏—Å—É ‚Äî –≤—Å—Ç–∞–≤–ª—è—î–º–æ
  IF NOT EXISTS (
    SELECT 1
    FROM SIGNATURERIGHTS
    WHERE TASK_ID = :P7_TASK_ID
      AND STAGE_ID = 1
  ) THEN
    INSERT INTO SIGNATURERIGHTS (
      TASK_ID, POSITION_ID, DEPARTMENT_ID, UNIT_ID, USER_ID,
      STAGE_ID, SORT_ORDER, SUBTASK_ID, SHIFT_GROUP_ID, SHIFT_TIME_ID
    ) VALUES (
      :P7_TASK_ID,
      :P0_POSITION_ID,
      :P0_DEPARTMENT_ID,
      :P0_UNIT_ID,
      :P0_USER_ID,
      1,
      1,
      NULL,
      NULL,
      NULL
    );
  END IF;

  -- üîç –Ø–∫—â–æ –¥–ª—è STAGE_ID = 3 –Ω–µ —ñ—Å–Ω—É—î –∑–∞–ø–∏—Å—É ‚Äî –≤—Å—Ç–∞–≤–ª—è—î–º–æ
  IF NOT EXISTS (
    SELECT 1
    FROM SIGNATURERIGHTS
    WHERE TASK_ID = :P7_TASK_ID
      AND STAGE_ID = 3
  ) THEN
    INSERT INTO SIGNATURERIGHTS (
      TASK_ID, POSITION_ID, DEPARTMENT_ID, UNIT_ID, USER_ID,
      STAGE_ID, SORT_ORDER, SUBTASK_ID, SHIFT_GROUP_ID, SHIFT_TIME_ID
    ) VALUES (
      :P7_TASK_ID,
      :P0_POSITION_ID,
      :P0_DEPARTMENT_ID,
      :P0_UNIT_ID,
      :P0_USER_ID,
      3,
      1,
      NULL,
      NULL,
      NULL
    );
  END IF;
END;
```

---

### üîç –ü–æ—è—Å–Ω–µ–Ω–Ω—è:

* `IF NOT EXISTS (...) THEN INSERT ...`: –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ–Ω–∞—Ç–∏ –≤—Å—Ç–∞–≤–∫—É **–ª–∏—à–µ —è–∫—â–æ –∑–∞–ø–∏—Å—É —â–µ –Ω–µ–º–∞—î**.
* –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø–æ **TASK\_ID + STAGE\_ID** ‚Äî –æ—Å–Ω–æ–≤–Ω–∏–π –∫—Ä–∏—Ç–µ—Ä—ñ–π –¥—É–±–ª—è.

---

### üß† –î–æ–¥–∞—Ç–∫–æ–≤–æ:

* –Ø–∫—â–æ –¥–ª—è —É–Ω—ñ–∫–∞–ª—å–Ω–æ—Å—Ç—ñ –≤–∞–∂–ª–∏–≤–∞ –≤—Å—è –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è (`TASK_ID`, `STAGE_ID`, `USER_ID`, —Ç–æ—â–æ), —Ä–æ–∑—à–∏—Ä –ø–µ—Ä–µ–≤—ñ—Ä–∫—É:

  ```sql
  WHERE TASK_ID = :P7_TASK_ID
    AND STAGE_ID = 1
    AND USER_ID = :P0_USER_ID
  ```

–•–æ—á–µ—à ‚Äî –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `MERGE` –∞–±–æ –∑—Ä–æ–±–∏—Ç–∏ –ª–æ–≥ –¥–ª—è –∞—É–¥–∏—Ç—É –¥—É–±–ª—é–≤–∞–Ω—å.
