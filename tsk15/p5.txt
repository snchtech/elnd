–©–æ–± —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–ª–µ–∫—Ü—ñ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª–∞ —Ç–≤–æ—î–º—É –∑–∞–ø–∏—Ç—É (`subtask_tree`), —Ç–æ–±—Ç–æ –≤–∫–ª—é—á–∞–ª–∞ `SUBTASK_ORDER`, `PARENT_ID`, `TASK_MODE` —Ç–æ—â–æ, ‚Äî —Ç–≤—ñ–π **`BEFORE HEADER PROCESS`** –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∫–æ–ª–µ–∫—Ü—ñ—ó –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ç—Ä–æ—Ö–∏ –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞—Ç–∏.

---

### ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–∏–π `PL/SQL` –∫–æ–¥ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó

```plsql
BEGIN
  -- –¢—ñ–ª—å–∫–∏ —è–∫—â–æ —â–µ –Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ
  IF NOT APEX_COLLECTION.COLLECTION_EXISTS('TASK_SUBTASKS_COLLECTION') THEN
    APEX_COLLECTION.CREATE_COLLECTION('TASK_SUBTASKS_COLLECTION');

    -- –Ø–∫—â–æ —Ü–µ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è
    IF :P8_TASK_ID IS NOT NULL THEN
      FOR r IN (
        SELECT 
          ID,
          TASK_ID,
          SUBTASK_CONTENT,
          STATUS_ID,
          PLANNING_DATE_END,
          PARENT_ID,
          SUBTASK_ORDER
        FROM TASK_SUBTASKS
        WHERE TASK_ID = :P8_TASK_ID
      ) LOOP
        APEX_COLLECTION.ADD_MEMBER(
          p_collection_name => 'TASK_SUBTASKS_COLLECTION',
          -- –û—Å–Ω–æ–≤–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è
          p_c001 => r.TASK_ID,               -- TASK_ID
          p_c002 => r.SUBTASK_CONTENT,       -- SUBTASK_CONTENT
          p_c003 => r.STATUS_ID,             -- STATUS_ID
          p_c004 => TO_CHAR(r.PLANNING_DATE_END, 'YYYY-MM-DD HH24:MI:SS'), -- PLANNING_DATE_END
          p_c005 => TO_CHAR(r.PARENT_ID),    -- PARENT_ID (–≤–∞–∂–ª–∏–≤–æ —è–∫ string, –±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —É JOIN)
          p_c006 => TO_CHAR(r.SUBTASK_ORDER),-- SUBTASK_ORDER
          -- –î–æ–¥–∞—Ç–∫–æ–≤–æ: —Ä–µ–∂–∏–º –∑–∞–≤–¥–∞–Ω–Ω—è
          p_n001 => :P8_TASK_MODE            -- TASK_MODE
        );
      END LOOP;
    END IF;
  END IF;
END;
```

---

### üîç –ü–æ—è—Å–Ω–µ–Ω–Ω—è:

| –ö–æ–ª–æ–Ω–∫–∞ —É `subtask_tree` CTE | –ü–æ–ª–µ –∫–æ–ª–µ–∫—Ü—ñ—ó | –ö–æ–º–µ–Ω—Ç–∞—Ä                 |
| ---------------------------- | ------------- | ------------------------ |
| `task_id`                    | `p_c001`      | –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∑–∞–≤–¥–∞–Ω–Ω—è   |
| `subtask_content`            | `p_c002`      | –ù–∞–∑–≤–∞ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è        |
| `status_id`                  | `p_c003`      | –°—Ç–∞—Ç—É—Å –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è       |
| `planning_date_end`          | `p_c004`      | –î–∞—Ç–∞                     |
| `parent_id`                  | `p_c005`      | –Ü—î—Ä–∞—Ä—Ö—ñ—è                 |
| `subtask_order`              | `p_c006`      | –ü–æ—Ä—è–¥–æ–∫                  |
| `task_mode`                  | `p_n001`      | 0 ‚Äì –∑–∞–≤–¥–∞–Ω–Ω—è, 1 ‚Äì —à–∞–±–ª–æ–Ω |

---

### üß† –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:

* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π **TO\_CHAR –¥–ª—è –¥–∞—Ç** —ñ `PARENT_ID`, –±–æ –∫–æ–ª–µ–∫—Ü—ñ—ó –≤—Å–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å —è–∫ —Ä—è–¥–∫–∏ –≤ `p_cXXX`.
* –Ø–∫—â–æ —Ö–æ—á–µ—à –¥–æ–¥–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—É –∫–æ–ª–æ–Ω–∫—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `IS_EDITED`, `IS_NEW`, `ACTION_TYPE`) ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π `c007` —ñ –¥–∞–ª—ñ.

---

### ‚è≠ –©–æ –¥–∞–ª—ñ?

* –ó–∞ –ø–æ—Ç—Ä–µ–±–∏ ‚Äî –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ –¥–æ–¥–∞—Ç–∏ **—ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é –¥–ª—è —à–∞–±–ª–æ–Ω—ñ–≤** –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–æ (–∫–æ–ª–∏ `TASK_MODE = 1`).
* –ê —Ç–∞–∫–æ–∂ ‚Äî –ø–æ–∫–∞–∑–∞—Ç–∏ —è–∫ **–æ–±—Ä–æ–±–∏—Ç–∏ —Ü—ñ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–∞–∑–∞–¥ —É –ë–î** (Insert –∞–±–æ Update).

–•–æ—á–µ—à —Ü–µ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏?
