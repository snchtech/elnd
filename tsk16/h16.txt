–û—Å—å –æ–Ω–æ–≤–ª–µ–Ω–∏–π **PL/SQL –∫–æ–¥** –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –Ω–æ–≤–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –∫–æ–ª–µ–∫—Ü—ñ–π, —â–æ –º—ñ—Å—Ç–∏—Ç—å:

* `c001` ‚Äî `task_id`
* `c002` ‚Äî `subtask_content`
* `d001` ‚Äî `planning_date_end`
* `c003` ‚Äî `parent_id`
* `c004` ‚Äî `subtask_order`
* `c005` ‚Äî `status_id`
* `d002` ‚Äî `date_create`
* `d003` ‚Äî `date_update`
* `c006` ‚Äî `creator`
* `c007` ‚Äî `updator`
* `n001` ‚Äî `task_mode`

---

### ‚úÖ **–û–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ–¥ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è TASK –∞–±–æ TEMPLATE —Ç–∞ –≤—Å—Ç–∞–≤–∫–∏ –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å / –ø—ñ–¥—à–∞–±–ª–æ–Ω—ñ–≤**

```plsql
DECLARE
  v_new_id NUMBER;
  l_coll_name VARCHAR2(50);
BEGIN
  IF :P8_TASK_MODE = 0 THEN
    -- üü© –ó–∞–≤–¥–∞–Ω–Ω—è
    v_new_id := TASKS_SEQ.NEXTVAL;

    INSERT INTO TASKS (
      ID, TASK_CONTENT, PLANNING_DATE_START, PLANNING_DATE_END,
      NOTE, TYPE_ID, UNIT_ID, DATE_CREATE
    ) VALUES (
      v_new_id,
      :P8_TASK_CONTENT,
      :P8_PLANNING_DATE_START,
      :P8_PLANNING_DATE_END,
      :P8_NOTE,
      :P8_TYPE_ID,
      :P8_UNIT,
      SYSDATE
    );

    l_coll_name := 'TASK_SUBTASKS_COLLECTION';

  ELSIF :P8_TASK_MODE = 1 THEN
    -- üü¶ –®–∞–±–ª–æ–Ω
    v_new_id := TASK_TEMPLATE_SEQ.NEXTVAL;

    INSERT INTO TASK_TEMPLATES (
      ID, TASK_CONTENT, NOTE, TYPE_ID, UNIT_ID, DATE_CREATE,
      PERIOD_MODE, PERIOD_INTERVAL, PERIOD_TIME, WEEKLY_DAYS, WEEKLY_TIME, DATE_END
    ) VALUES (
      v_new_id,
      :P8_TASK_CONTENT,
      :P8_NOTE,
      :P8_TYPE_ID,
      :P8_UNIT,
      SYSDATE,
      :P8_PERIOD_MODE,
      :P8_PERIOD_INTERVAL,
      :P8_PERIOD_TIME,
      :P8_WEEKLY_DAYS,
      :P8_WEEKLY_TIME,
      :P8_DATE_END
    );

    l_coll_name := 'TASK_TEMPLATE_SUBTASKS_COLLECTION';
  END IF;

  -- üü® –ó–±–µ—Ä—ñ–≥–∞—î–º–æ ID —É P8_TASK_ID –¥–ª—è –ø–æ–¥–∞–ª—å—à–∏—Ö –¥—ñ–π
  :P8_TASK_ID := v_new_id;

  -- üîÅ –í—Å—Ç–∞–≤–∫–∞ –ø—ñ–¥–∑–∞–ø–∏—Å—ñ–≤ –∑ –∫–æ–ª–µ–∫—Ü—ñ—ó
  FOR r IN (
    SELECT *
    FROM APEX_COLLECTIONS
    WHERE COLLECTION_NAME = l_coll_name
      AND NVL(c010, 'ACTIVE') != 'DELETE'
      AND TO_NUMBER(n001) = :P8_TASK_MODE
  ) LOOP

    IF :P8_TASK_MODE = 0 THEN
      -- üü© –ü—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è
      INSERT INTO TASK_SUBTASKS (
        TASK_ID,
        SUBTASK_CONTENT,
        PLANNING_DATE_END,
        PARENT_ID,
        SUBTASK_ORDER,
        STATUS_ID,
        DATE_CREATE,
        DATE_UPDATE,
        CREATOR,
        UPDATOR
      ) VALUES (
        v_new_id,
        r.c002,
        r.d001,
        TO_NUMBER(r.c003),
        TO_NUMBER(r.c004),
        TO_NUMBER(r.c005),
        r.d002,
        r.d003,
        TO_NUMBER(r.c006),
        TO_NUMBER(r.c007)
      );

    ELSIF :P8_TASK_MODE = 1 THEN
      -- üü¶ –ü—ñ–¥—à–∞–±–ª–æ–Ω
      INSERT INTO TASK_TEMPLATE_SUBTASKS (
        TEMPLATE_ID,
        SUBTASK_CONTENT,
        PARENT_ID,
        SUBTASK_ORDER,
        STATUS_ID,
        DATE_CREATE,
        DATE_UPDATE,
        CREATOR,
        UPDATOR
      ) VALUES (
        v_new_id,
        r.c002,
        TO_NUMBER(r.c003),
        TO_NUMBER(r.c004),
        TO_NUMBER(r.c005),
        r.d002,
        r.d003,
        TO_NUMBER(r.c006),
        TO_NUMBER(r.c007)
      );
    END IF;

  END LOOP;

  -- üßπ –û—á–∏—â–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó
  APEX_COLLECTION.DELETE_COLLECTION(l_coll_name);

EXCEPTION
  WHEN OTHERS THEN
    raise_application_error(-20001, '‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è/—à–∞–±–ª–æ–Ω—É: ' || SQLERRM);
END;
```

---

### üìù –ü—Ä–∏–º—ñ—Ç–∫–∏:

* –ü–æ–ª—è `d002`, `d003` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –º–æ–∂—É—Ç—å –±—É—Ç–∏ `SYSDATE` –∞–±–æ `NULL` –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –µ—Ç–∞–ø—É.
* `c006`, `c007` ‚Äî —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `:P0_USER_ID`).
* –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ `NVL(c010, 'ACTIVE') != 'DELETE'` –≤–∏–∫–ª—é—á–∞—î –≤–∏–¥–∞–ª–µ–Ω—ñ –∑–∞–ø–∏—Å–∏.
* `TO_NUMBER()` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —á–∏—Å–ª–æ–≤–∏—Ö –∫–æ–ª–æ–Ω–æ–∫ –∫–æ–ª–µ–∫—Ü—ñ—ó.

–•–æ—á–µ—Ç–µ, —Ç–∞–∫–æ–∂ –ø–æ–∫–∞–∂—É **–≤–µ—Ä—Å—ñ—é –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è** —ñ—Å–Ω—É—é—á–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è –∑ –∫–æ–ª–µ–∫—Ü—ñ—ó –∑ —Ç—ñ—î—é –∂ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é?
