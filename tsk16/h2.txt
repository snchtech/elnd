–û—Å—å –æ–Ω–æ–≤–ª–µ–Ω–∏–π PL/SQL-–∫–æ–¥ –¥–ª—è **—ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∫–æ–ª–µ–∫—Ü—ñ—ó `TASK_SUBTASKS_COLLECTION`**, —è–∫–∏–π:

* –ø—ñ–¥—Ç—Ä–∏–º—É—î –Ω–æ–≤—É **—Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–ª—ñ–≤** –∫–æ–ª–µ–∫—Ü—ñ—ó;
* –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø–æ–≤–Ω—é—î:

  * `DATE_CREATE := SYSDATE`
  * `DATE_UPDATE := NULL`
  * `CREATOR := :P0_USER_ID`
  * `UPDATOR := NULL`
* –ø—ñ–¥—Ç—Ä–∏–º—É—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è **–ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å –∞–±–æ –ø—ñ–¥—à–∞–±–ª–æ–Ω—ñ–≤** –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ `:P8_TASK_MODE` (0 ‚Äî –∑–∞–≤–¥–∞–Ω–Ω—è, 1 ‚Äî —à–∞–±–ª–æ–Ω).

---

### ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ–¥:

```plsql
BEGIN
  IF NOT APEX_COLLECTION.COLLECTION_EXISTS('TASK_SUBTASKS_COLLECTION') THEN
    APEX_COLLECTION.CREATE_COLLECTION('TASK_SUBTASKS_COLLECTION');

    -- –Ø–∫—â–æ —î —ñ—Å–Ω—É—é—á–∏–π –∑–∞–ø–∏—Å (TASK –∞–±–æ TEMPLATE)
    IF :P8_TASK_ID IS NOT NULL THEN

      -- –í–∞—Ä—ñ–∞–Ω—Ç 1: –ó–∞–≤–¥–∞–Ω–Ω—è
      IF :P8_TASK_MODE = 0 THEN
        FOR r IN (
          SELECT 
            TASK_ID,
            SUBTASK_CONTENT,
            PLANNING_DATE_END,
            PARENT_ID,
            SUBTASK_ORDER,
            STATUS_ID
          FROM TASK_SUBTASKS
          WHERE TASK_ID = :P8_TASK_ID
        ) LOOP
          APEX_COLLECTION.ADD_MEMBER(
            p_collection_name => 'TASK_SUBTASKS_COLLECTION',
            p_c001 => r.TASK_ID,
            p_c002 => r.SUBTASK_CONTENT,
            p_c003 => r.PLANNING_DATE_END,
            p_c004 => r.PARENT_ID,
            p_c005 => r.SUBTASK_ORDER,
            p_c006 => r.STATUS_ID,
            p_c007 => SYSDATE,         -- DATE_CREATE
            p_c008 => NULL,            -- DATE_UPDATE
            p_c009 => :P0_USER_ID,     -- CREATOR
            p_c010 => NULL,            -- UPDATOR
            p_n001 => 0                -- TASK_MODE
          );
        END LOOP;

      -- –í–∞—Ä—ñ–∞–Ω—Ç 2: –®–∞–±–ª–æ–Ω–∏
      ELSIF :P8_TASK_MODE = 1 THEN
        FOR r IN (
          SELECT 
            TEMPLATE_ID,
            SUBTASK_CONTENT,
            NULL AS PLANNING_DATE_END, -- –≤—ñ–¥—Å—É—Ç–Ω—î —É —à–∞–±–ª–æ–Ω—ñ–≤
            PARENT_ID,
            SUBTASK_ORDER,
            STATUS_ID
          FROM TASK_TEMPLATE_SUBTASKS
          WHERE TEMPLATE_ID = :P8_TASK_ID
        ) LOOP
          APEX_COLLECTION.ADD_MEMBER(
            p_collection_name => 'TASK_SUBTASKS_COLLECTION',
            p_c001 => r.TEMPLATE_ID,
            p_c002 => r.SUBTASK_CONTENT,
            p_c003 => r.PLANNING_DATE_END,
            p_c004 => r.PARENT_ID,
            p_c005 => r.SUBTASK_ORDER,
            p_c006 => r.STATUS_ID,
            p_c007 => SYSDATE,         -- DATE_CREATE
            p_c008 => NULL,            -- DATE_UPDATE
            p_c009 => :P0_USER_ID,     -- CREATOR
            p_c010 => NULL,            -- UPDATOR
            p_n001 => 1                -- TASK_MODE
          );
        END LOOP;
      END IF;

    END IF;
  END IF;
END;
```

---

### üîÅ –ü—Ä–∏–º—ñ—Ç–∫–∏:

* –¶–µ–π –∫–æ–¥ –≤—Ä–∞—Ö–æ–≤—É—î `:P8_TASK_MODE` —ñ –ø—Ä–∞—Ü—é—î **–¥–ª—è –æ–¥–Ω—ñ—î—ó –∫–æ–ª–µ–∫—Ü—ñ—ó**, —è–∫–∞ –æ–¥–Ω–æ—á–∞—Å–Ω–æ –ø—ñ–¥—Ç—Ä–∏–º—É—î —è–∫ –∑–∞–≤–¥–∞–Ω–Ω—è, —Ç–∞–∫ —ñ —à–∞–±–ª–æ–Ω–∏.
* –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ ‚Äî –º–æ–∂–Ω–∞ —Ä–æ–∑–¥—ñ–ª–∏—Ç–∏ –Ω–∞ –æ–∫—Ä–µ–º—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó –¥–ª—è –∑–∞–≤–¥–∞–Ω—å —ñ —à–∞–±–ª–æ–Ω—ñ–≤ (`TASK_SUBTASKS_COLLECTION`, `TASK_TEMPLATE_SUBTASKS_COLLECTION`), –∞–ª–µ –∑–∞—Ä–∞–∑ —É—Å–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –≤ —î–¥–∏–Ω—ñ–π.

–ì–æ—Ç–æ–≤–∏–π –¥–æ–ø–æ–≤–Ω–∏—Ç–∏ –∫–æ–¥–æ–º –æ—á–∏—â–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ, –∞–±–æ –ª–æ–≥—ñ–∫–æ—é `UPDATE/DELETE`, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ.
