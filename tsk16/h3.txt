–û—Å—å –æ–Ω–æ–≤–ª–µ–Ω–∏–π PL/SQL-–∫–æ–¥, —è–∫–∏–π:

* –ø—Ä–∞—Ü—é—î **–∑ –¥–≤–æ–º–∞ —Ä—ñ–∑–Ω–∏–º–∏ –∫–æ–ª–µ–∫—Ü—ñ—è–º–∏**:

  * `TASK_SUBTASKS_COLLECTION` ‚Äî –¥–ª—è –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å (`TASK_MODE = 0`)
  * `TASK_TEMPLATE_SUBTASKS_COLLECTION` ‚Äî –¥–ª—è –ø—ñ–¥—à–∞–±–ª–æ–Ω—ñ–≤ (`TASK_MODE = 1`)
* **–ø–µ—Ä–µ–≤—ñ—Ä—è—î —ñ—Å–Ω—É–≤–∞–Ω–Ω—è –∫–æ–∂–Ω–æ—ó –∫–æ–ª–µ–∫—Ü—ñ—ó**
* **–æ—á–∏—â–∞—î –∫–æ–ª–µ–∫—Ü—ñ—é, —è–∫—â–æ –≤–æ–Ω–∞ —ñ—Å–Ω—É—î**
* **—Å—Ç–≤–æ—Ä—é—î –∫–æ–ª–µ–∫—Ü—ñ—é –∑–∞–Ω–æ–≤–æ**
* **–∑–∞–ø–æ–≤–Ω—é—î —ó—ó –¥–∞–Ω–∏–º–∏ –∑ —Ç–∞–±–ª–∏—Ü—å** `TASK_SUBTASKS` –∞–±–æ `TASK_TEMPLATE_SUBTASKS`

---

### ‚úÖ –ü–æ–≤–Ω–∏–π –∫–æ–¥

```plsql
BEGIN
  IF :P8_TASK_MODE = 0 THEN
    -- === –†–æ–±–æ—Ç–∞ –∑ TASK_SUBTASKS_COLLECTION ===
    IF APEX_COLLECTION.COLLECTION_EXISTS('TASK_SUBTASKS_COLLECTION') THEN
      APEX_COLLECTION.DELETE_COLLECTION('TASK_SUBTASKS_COLLECTION');
    END IF;
    
    APEX_COLLECTION.CREATE_COLLECTION('TASK_SUBTASKS_COLLECTION');

    IF :P8_TASK_ID IS NOT NULL THEN
      FOR r IN (
        SELECT 
          TASK_ID,
          SUBTASK_CONTENT,
          PLANNING_DATE_END,
          PARENT_ID,
          SUBTASK_ORDER,
          STATUS_ID
        FROM TASK_SUBTASKS
        WHERE TASK_ID = :P8_TASK_ID
      ) LOOP
        APEX_COLLECTION.ADD_MEMBER(
          p_collection_name => 'TASK_SUBTASKS_COLLECTION',
          p_c001 => r.TASK_ID,
          p_c002 => r.SUBTASK_CONTENT,
          p_c003 => r.PLANNING_DATE_END,
          p_c004 => r.PARENT_ID,
          p_c005 => r.SUBTASK_ORDER,
          p_c006 => r.STATUS_ID,
          p_c007 => SYSDATE,         -- DATE_CREATE
          p_c008 => NULL,            -- DATE_UPDATE
          p_c009 => :P0_USER_ID,     -- CREATOR
          p_c010 => NULL,            -- UPDATOR
          p_n001 => 0                -- TASK_MODE
        );
      END LOOP;
    END IF;

  ELSIF :P8_TASK_MODE = 1 THEN
    -- === –†–æ–±–æ—Ç–∞ –∑ TASK_TEMPLATE_SUBTASKS_COLLECTION ===
    IF APEX_COLLECTION.COLLECTION_EXISTS('TASK_TEMPLATE_SUBTASKS_COLLECTION') THEN
      APEX_COLLECTION.DELETE_COLLECTION('TASK_TEMPLATE_SUBTASKS_COLLECTION');
    END IF;
    
    APEX_COLLECTION.CREATE_COLLECTION('TASK_TEMPLATE_SUBTASKS_COLLECTION');

    IF :P8_TASK_ID IS NOT NULL THEN
      FOR r IN (
        SELECT 
          TEMPLATE_ID,
          SUBTASK_CONTENT,
          PARENT_ID,
          SUBTASK_ORDER,
          STATUS_ID
        FROM TASK_TEMPLATE_SUBTASKS
        WHERE TEMPLATE_ID = :P8_TASK_ID
      ) LOOP
        APEX_COLLECTION.ADD_MEMBER(
          p_collection_name => 'TASK_TEMPLATE_SUBTASKS_COLLECTION',
          p_c001 => r.TEMPLATE_ID,
          p_c002 => r.SUBTASK_CONTENT,
          p_c003 => NULL,            -- PLANNING_DATE_END ‚Üí —à–∞–±–ª–æ–Ω –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î
          p_c004 => r.PARENT_ID,
          p_c005 => r.SUBTASK_ORDER,
          p_c006 => r.STATUS_ID,
          p_c007 => SYSDATE,         -- DATE_CREATE
          p_c008 => NULL,            -- DATE_UPDATE
          p_c009 => :P0_USER_ID,     -- CREATOR
          p_c010 => NULL,            -- UPDATOR
          p_n001 => 1                -- TASK_MODE
        );
      END LOOP;
    END IF;
  END IF;
END;
```

---

### üîÅ –©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Ä–∞—Ö—É–≤–∞—Ç–∏:

* `:P8_TASK_MODE` —ñ `:P8_TASK_ID` –º–∞—é—Ç—å –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏—Å—è —è–∫ **page items**
* `:P0_USER_ID` –º–∞—î –±—É—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–º (—á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω–∏–π item –∞–±–æ substitution string)

---

üîî –Ø–∫—â–æ —Ç–∏ —Ç–∞–∫–æ–∂ —Ö–æ—á–µ—à **–≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—é –≤ IG**, –Ω–∞–≥–∞–¥–∞—é, —â–æ –¥–∂–µ—Ä–µ–ª–æ–º IG –º–∞—î –±—É—Ç–∏ `SQL Query` –ø–æ `APEX_COLLECTIONS`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

```sql
SELECT * FROM APEX_COLLECTIONS WHERE COLLECTION_NAME = 'TASK_SUBTASKS_COLLECTION'
```

–ì–æ—Ç–æ–≤–∏–π –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è–º —Ü—ñ—î—ó –∫–æ–ª–µ–∫—Ü—ñ—ó –¥–æ IG –∞–±–æ –∑ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º –∑–∞–ø–∏—Å—ñ–≤ —É –ë–î.
