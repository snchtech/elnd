–©–æ–± **–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π `SUBTASK_ORDER`** –≤ –∫–æ–ª–µ–∫—Ü—ñ—è—Ö `APEX_COLLECTIONS` (–∞ –Ω–µ –≤ —Ç–∞–±–ª–∏—Ü—è—Ö), –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–º—ñ–Ω–∏—Ç–∏ SQL-–∑–∞–ø–∏—Ç –¥–æ —Ç–∞–±–ª–∏—Ü—ñ –Ω–∞ **–≤–∏–±—ñ—Ä–∫—É —á–µ—Ä–µ–∑ `SELECT ... FROM TABLE(...)`** –∑ `apex_collections`.

–û—Å—å —è–∫ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ **–¥–ª—è –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å** —ñ **–ø—ñ–¥—à–∞–±–ª–æ–Ω—ñ–≤** (–∫–æ–ª–µ–∫—Ü—ñ–π `TASK_SUBTASKS_COLLECTION` —ñ `TASK_TEMPLATE_SUBTASKS_COLLECTION`):

---

### ‚úÖ –î–ª—è –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å (TASK\_SUBTASKS\_COLLECTION)

```plsql
DECLARE
  v_next_order NUMBER;
BEGIN
  SELECT NVL(MAX(TO_NUMBER(c005)), 0) + 1
  INTO v_next_order
  FROM apex_collections
  WHERE collection_name = 'TASK_SUBTASKS_COLLECTION'
    AND TO_NUMBER(c001) = :P6_TASK_ID -- TASK_ID
    AND NVL(TO_NUMBER(c004), 0) = NVL(:P6_PARENT_ID, 0)
    AND NVL(c010, 'ACTIVE') != 'DELETE'; -- –ù–µ –≤—Ä–∞—Ö–æ–≤—É—î–º–æ –≤–∏–¥–∞–ª–µ–Ω—ñ

  :P6_SUBTASK_ORDER := v_next_order;
END;
```

---

### ‚úÖ –î–ª—è –ø—ñ–¥—à–∞–±–ª–æ–Ω—ñ–≤ (TASK\_TEMPLATE\_SUBTASKS\_COLLECTION)

```plsql
DECLARE
  v_next_order NUMBER;
BEGIN
  SELECT NVL(MAX(TO_NUMBER(c005)), 0) + 1
  INTO v_next_order
  FROM apex_collections
  WHERE collection_name = 'TASK_TEMPLATE_SUBTASKS_COLLECTION'
    AND TO_NUMBER(c001) = :P6_TASK_ID -- TEMPLATE_ID
    AND NVL(TO_NUMBER(c004), 0) = NVL(:P6_PARENT_ID, 0)
    AND NVL(c010, 'ACTIVE') != 'DELETE';

  :P6_SUBTASK_ORDER := v_next_order;
END;
```

---

### üìå –ü–æ—è—Å–Ω–µ–Ω–Ω—è

* `c001` ‚Äî TASK\_ID –∞–±–æ TEMPLATE\_ID
* `c004` ‚Äî PARENT\_ID
* `c005` ‚Äî SUBTASK\_ORDER
* `c010` ‚Äî –º—ñ—Ç–∫–∞ `DELETE` (—ñ–≥–Ω–æ—Ä—É—î–º–æ –≤–∏–¥–∞–ª–µ–Ω—ñ)
* `TO_NUMBER(...)` ‚Äî –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ, –±–æ –∫–æ–ª–æ–Ω–∫–∏ `cXXX` —Ç–∏–ø—É VARCHAR2

---

–¶–µ–π –∫–æ–¥ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤ `PL/SQL Function Body` –∞–±–æ —è–∫ –æ–∫—Ä–µ–º–∏–π `Before Submit` –ø—Ä–æ—Ü–µ—Å, —â–æ–± –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ—é –≤ –∫–æ–ª–µ–∫—Ü—ñ—é. –ì–æ—Ç–æ–≤–∏–π –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é —Ü—å–æ–≥–æ –∫–æ–¥—É –≤ –ø–æ—Ç–æ—á–Ω—É –ª–æ–≥—ñ–∫—É –∫–Ω–æ–ø–æ–∫ —á–∏ —Ñ–æ—Ä–º.
