–û—Å—å –ø—Ä–∏–∫–ª–∞–¥ SQL-–∑–∞–ø–∏—Ç—É –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–≤—ñ—Ç—É –∑–∞ —à–∞–±–ª–æ–Ω–∞–º–∏ –∑–∞–≤–¥–∞–Ω—å, —è–∫–∏–π –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤–∞—à—ñ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ñ, –≤–∫–ª—é—á–Ω–æ –∑ –ø—ñ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ—é –ø—ñ–¥—à–∞–±–ª–æ–Ω—ñ–≤, –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ—Å—Ç—é, –∞–≤—Ç–æ—Ä–æ–º, –≤–∏–∫–æ–Ω–∞–≤—Ü—è–º–∏ —Ç–æ—â–æ:

---

## ‚úÖ **SQL-–∑–∞–ø–∏—Ç (–º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è View)**

```sql
SELECT
    tt.ID AS TEMPLATE_ID,

    -- 1. –õ—ñ–Ω–∫ –Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω—É –∫–∞—Ä—Ç–∫—É
    '<a href="javascript:void(0);" onclick="openTemplateDetail(' || tt.ID || ')">' ||
    '<span class="fa fa-info-circle"></span></a>' AS LINK_ICON,

    -- 2. UNIT
    u.NAME AS UNIT_NAME,

    -- 3. –ó–º—ñ—Å—Ç –∑–∞–≤–¥–∞–Ω–Ω—è –∞–±–æ —Å–ø–∏—Å–æ–∫ –ø—ñ–¥—à–∞–±–ª–æ–Ω—ñ–≤
    CASE 
        WHEN tt.TYPE_ID = 0 THEN tt.TASK_CONTENT
        ELSE (
            SELECT LISTAGG('<li>' || sts.SUBTASK_CONTENT || '</li>', '')
            WITHIN GROUP (ORDER BY sts.SUBTASK_ORDER)
            FROM TASK_TEMPLATE_SUBTASK sts
            WHERE sts.TEMPLATE_ID = tt.ID
        )
    END AS TASK_DESCRIPTION_HTML,

    -- 4. –•—Ç–æ —Å—Ç–≤–æ—Ä–∏–≤
    (
        SELECT '<span class="task_creator">' ||
               NVL(pos.NAME, '') || ', ' || NVL(dep.NAME, '') || ', ' || NVL(u2.USERNAME, '') || 
               '</span>'
        FROM USER_TABLE u2
        LEFT JOIN POSITION_TABLE pos ON pos.ID = u2.POSITION_ID
        LEFT JOIN DEPARTMENT_TABLE dep ON dep.ID = u2.DEPARTMENT_ID
        WHERE u2.ID = tt.CREATOR_ID
        FETCH FIRST ROW ONLY
    ) AS CREATOR_INFO,

    -- 5. –í–∏–∫–æ–Ω–∞–≤—Ü—ñ (STAGES_ID = 2, TASK_ID –∑–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ TEMPLATE_ID)
    (
        SELECT LISTAGG(
            '<span class="task_creator">' || 
            NVL(pos.NAME, '') || ', ' || NVL(dep.NAME, '') || ', ' || NVL(u2.USERNAME, '') || '</span>' ||
            COALESCE((
                SELECT '<span class="signer_info">' || us.USERNAME || ', ' || TO_CHAR(h.SIGNER_DATE, 'DD.MM.YYYY HH24:MI') || '</span>'
                FROM SIGNATUREHISTORY h
                JOIN USERS us ON us.ID = h.SIGNER_BY
                WHERE h.SIGNRIGHT_ID = sr2.ID
                FETCH FIRST ROW ONLY
            ), ''),
        ' <br> ') 
        FROM SIGNATURERIGHTS sr2
        LEFT JOIN POSITION_TABLE pos ON pos.ID = sr2.POSITION_ID
        LEFT JOIN DEPARTMENT_TABLE dep ON dep.ID = sr2.DEPARTMENT_ID
        LEFT JOIN USER_TABLE u2 ON u2.ID = sr2.USER_ID
        WHERE sr2.SUBTASK_ID IN (
            SELECT ID FROM TASK_TEMPLATE_SUBTASK WHERE TEMPLATE_ID = tt.ID
        ) AND sr2.STAGES_ID = 2
    ) AS EXECUTOR_INFO,

    -- 6. –°—Ç–∞—Ç—É—Å
    st.NAME AS STATUS_NAME,

    -- 7. –ü—ñ–¥—Ä–æ–∑–¥—ñ–ª
    dep.NAME AS DEPARTMENT_NAME,

    -- 8. –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ—Å—Ç—å
    CASE
        WHEN tt.PERIOD_MODE = 1 THEN 
            '<b>–ö–æ–∂–Ω—ñ</b> ' || tt.PERIOD_INTERVAL || ' –¥–Ω—ñ–≤ –æ ' || TO_CHAR(tt.PERIOD_TIME, 'HH24:MI')
        WHEN tt.PERIOD_MODE = 2 THEN 
            '<b>–©–æ</b> ' || tt.WEEKLY_DAY || ' –æ ' || tt.WEEKLY_TIMES
        ELSE NULL
    END AS PERIOD_INFO_HTML,

    -- 9. –ù–∞—Å—Ç—É–ø–Ω–∞ –¥–∞—Ç–∞ –∑–∞–ø—É—Å–∫—É
    TO_CHAR(tt.NEXT_RUN_DATE, 'DD.MM.YYYY') AS NEXT_RUN_DATE,

    -- 10. –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
    TO_CHAR(tt.DATE_END, 'DD.MM.YYYY') AS DATE_END

FROM TASK_TEMPLATES tt
LEFT JOIN UNIT u ON u.ID = tt.UNIT_ID
LEFT JOIN STATUS_TABLE st ON st.ID = tt.STATUS_ID
LEFT JOIN DEPARTMENT_TABLE dep ON dep.ID = tt.DEPARTMENT_ID;
```

---

## üìå –ö–æ—Ä–æ—Ç–∫–æ –ø—Ä–æ –∫–ª—é—á–æ–≤—ñ —á–∞—Å—Ç–∏–Ω–∏:

| –ü–æ–ª–µ                    | –û–ø–∏—Å                                                                |
| ----------------------- | ------------------------------------------------------------------- |
| `TASK_DESCRIPTION_HTML` | –í–∏–≤–æ–¥–∏—Ç—å HTML-—Å–ø–∏—Å–æ–∫ –ø—ñ–¥—à–∞–±–ª–æ–Ω—ñ–≤ –∞–±–æ –æ—Å–Ω–æ–≤–Ω–∏–π –≤–º—ñ—Å—Ç                 |
| `CREATOR_INFO`          | –ê–≤—Ç–æ—Ä —à–∞–±–ª–æ–Ω—É (–ø–æ–∑–∏—Ü—ñ—è, –≤—ñ–¥–¥—ñ–ª, —ñ–º‚Äô—è)                               |
| `EXECUTOR_INFO`         | –ü–µ—Ä–µ–ª—ñ–∫ –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤ –∑ –ø—ñ–¥–ø–∏—Å–∞–º–∏, —è–∫—â–æ —î                              |
| `PERIOD_INFO_HTML`      | –î–∏–Ω–∞–º—ñ—á–Ω–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –æ–ø–∏—Å –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–æ—Å—Ç—ñ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ `PERIOD_MODE` |
| `NEXT_RUN_DATE`         | –ü–æ–∫–∏ —â–æ NULL ‚Äî –±—É–¥–µ —Ä–æ–∑—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏—Å—å –æ–∫—Ä–µ–º–æ                          |
| `LINK_ICON`             | –ö–ª—ñ–∫ –ø–æ —ñ–∫–æ–Ω—Ü—ñ –≤–∏–∫–ª–∏–∫–∞—î `openTemplateDetail(id)`                    |

---

üîß –Ø–∫—â–æ —É –≤–∞—Å —î —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞ –¥–ª—è `openTemplateDetail`, –∞–±–æ –ª–æ–≥—ñ–∫–∞ –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫—É `NEXT_RUN_DATE`, –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ –æ–∫—Ä–µ–º–æ. –¢–∞–∫–æ–∂ –≥–æ—Ç–æ–≤–∏–π —Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ `CREATE OR REPLACE VIEW` –¥–ª—è —Ü—å–æ–≥–æ –∑–∞–ø–∏—Ç—É.
