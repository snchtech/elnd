–û—Å—å –ø—Ä–∏–∫–ª–∞–¥ –≥–æ—Ç–æ–≤–æ—ó PL/SQL-—Ñ—É–Ω–∫—Ü—ñ—ó `sanitize_html_content`, —è–∫–∞:

* ‚ùå –≤–∏–¥–∞–ª—è—î **–Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ —Ç–µ–≥–∏** (`<script>`, `<iframe>`, `<object>`, `<embed>`, —Ç–æ—â–æ)
* ‚úÖ –∑–∞–ª–∏—à–∞—î **–ª–∏—à–µ –±–µ–∑–ø–µ—á–Ω—ñ —Ç–µ–≥–∏**: `<b>`, `<i>`, `<br>`, `<ul>`, `<ol>`, `<li>`, `<span>`, `<p>`, `<div>`, `<strong>`, `<em>`
* üõ° –∑–∞—Ö–∏—â–∞—î –≤—ñ–¥ XSS –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ `Escape = No` —É –∑–≤—ñ—Ç–∞—Ö

---

## ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó `sanitize_html_content`

```sql
CREATE OR REPLACE FUNCTION sanitize_html_content(p_input IN VARCHAR2)
  RETURN VARCHAR2
IS
  v_result VARCHAR2(32767) := p_input;
BEGIN
  IF v_result IS NULL THEN
    RETURN NULL;
  END IF;

  -- 1. –í–∏–¥–∞–ª–∏—Ç–∏ –ø–æ–≤–Ω—ñ—Å—Ç—é <script>, <iframe>, <object>, <embed>, <style>, <link>
  v_result := REGEXP_REPLACE(v_result, '<(script|iframe|object|embed|style|link)[^>]*>.*?</\1>', '', 1, 0, 'in');

  -- 2. –í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ —Ç–µ–≥–∏, —è–∫—ñ –Ω–µ –≤—Ö–æ–¥—è—Ç—å –¥–æ whitelist
  v_result := REGEXP_REPLACE(v_result, '</?(?!b|i|br|ul|ol|li|span|p|div|strong|em)[a-zA-Z0-9]+[^>]*>', '', 1, 0, 'i');

  -- 3. –ü—Ä–∏–±—Ä–∞—Ç–∏ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ JS-–∞—Ç—Ä–∏–±—É—Ç–∏ (onload, onclick, etc.)
  v_result := REGEXP_REPLACE(v_result, '\s+on[a-z]+="[^"]*"', '', 1, 0, 'i');
  v_result := REGEXP_REPLACE(v_result, '\s+on[a-z]+=''', '', 1, 0, 'i'); -- –≤–∞—Ä—ñ–∞–Ω—Ç –∑ –æ–¥–∏–Ω–∞—Ä–Ω–∏–º–∏ –ª–∞–ø–∫–∞–º–∏

  -- 4. –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ javascript: —É href/src
  v_result := REGEXP_REPLACE(v_result, '(href|src)\s*=\s*["'']?javascript:[^"'' >]+', '\1="#"', 1, 0, 'i');

  RETURN v_result;
END sanitize_html_content;
/
```

---

## üß™ –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —É –ø—Ä–æ—Ü–µ—Å—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:

```plsql
:P_TASK_CONTENT := sanitize_html_content(:P_TASK_CONTENT);
```

---

## üìã –ü—Ä–∏–∫–ª–∞–¥ –¥–æ/–ø—ñ—Å–ª—è

| –í–≤–µ–¥–µ–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º:                                                            | –ó–±–µ—Ä–µ–∂–µ–Ω–æ —è–∫:                         |
| -------------------------------------------------------------------------------- | ------------------------------------- |
| `<script>alert(1)</script><b>–≤–∞–∂–ª–∏–≤–æ</b><a href="javascript:alert(1)">click</a>` | `<b>–≤–∞–∂–ª–∏–≤–æ</b><a href="#">click</a>` |
| `<div onclick="steal()">—Ç–µ–∫—Å—Ç</div>`                                             | `<div>—Ç–µ–∫—Å—Ç</div>`                    |
| `<i>italic</i><iframe src="evil.com"></iframe>`                                  | `<i>italic</i>`                       |

---

## üõ° –î–æ–¥–∞—Ç–∫–æ–≤–æ:

–Ø–∫—â–æ —Ö–æ—á–µ—à –¥–æ–∑–≤–æ–ª–∏—Ç–∏ —ñ–Ω—à—ñ —Ç–µ–≥–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `<a>` –∑ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏) ‚Äî –Ω–∞–ø–∏—à–∏, —ñ —è –¥–æ–¥–∞–º –æ–±—Ä–æ–±–∫—É.

---

üîî –ì–æ—Ç–æ–≤–∏–π –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∏–Ω–µ—Å—Ç–∏ —Ü–µ –≤ `PACKAGE` –∞–±–æ —Ä–æ–∑—à–∏—Ä–∏—Ç–∏ –æ–±—Ä–æ–±–∫—É —Å—Ç–∏–ª—ñ–≤, –∞—Ç—Ä–∏–±—É—Ç—ñ–≤, —Ç–æ—â–æ.
