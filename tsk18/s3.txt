–©–æ–± —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –±–∞–∂–∞–Ω—É –ª–æ–≥—ñ–∫—É —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è **–∫–æ–ª–æ–Ω–∫–∏ —Å—Ç–∞—Ç—É—Å—É** –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –∑–≤—ñ—Ç—ñ –∂—É—Ä–Ω–∞–ª—É –∑–∞–≤–¥–∞–Ω—å, –º–∏ –º–æ–∂–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ **–∫–æ—Ä–µ–ª—å–æ–≤–∞–Ω–∏–π –ø—ñ–¥–∑–∞–ø–∏—Ç** —ñ–∑ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º `SIGNATUREHISTORY.NEW_STATUS_ID` (—è–∫—â–æ —î) ‚Äî —ñ–Ω–∞–∫—à–µ –±—Ä–∞—Ç–∏ `TASKS.STATUS_ID`.

---

### ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–∏–π SQL-—Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–ª—è `STATUS_NAME`

```sql
(
  SELECT s2.NAME
  FROM SIGNATUREHISTORY h
  JOIN SIGNATURERIGHTS r ON r.ID = h.SIGNRIGHT_ID AND r.TASK_ID = t.ID
  JOIN STATUS_TABLE s2 ON s2.ID = h.NEW_STATUS_ID
  WHERE h.NEW_STATUS_ID IS NOT NULL
  AND r.TASK_ID = t.ID
  AND r.STAGES_ID = (
    SELECT MAX(r2.STAGES_ID)
    FROM SIGNATUREHISTORY h2
    JOIN SIGNATURERIGHTS r2 ON r2.ID = h2.SIGNRIGHT_ID
    WHERE r2.TASK_ID = t.ID AND h2.NEW_STATUS_ID IS NOT NULL
  )
  FETCH FIRST ROW ONLY
)
-- –Ø–∫—â–æ –≤ SIGNATUREHISTORY –Ω–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤ ‚Äî –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ TASKS.STATUS_ID —è–∫ –∑–∞–ø–∞—Å–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç
AS STATUS_NAME_FINAL
```

> –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, —â–æ–± –≥–∞—Ä–∞–Ω—Ç—É–≤–∞—Ç–∏ fallback, –º–æ–∂–Ω–∞ –æ–±–≥–æ—Ä–Ω—É—Ç–∏ —É `COALESCE()`:

```sql
COALESCE((
  SELECT s2.NAME
  FROM SIGNATUREHISTORY h
  JOIN SIGNATURERIGHTS r ON r.ID = h.SIGNRIGHT_ID AND r.TASK_ID = t.ID
  JOIN STATUS_TABLE s2 ON s2.ID = h.NEW_STATUS_ID
  WHERE h.NEW_STATUS_ID IS NOT NULL
  AND r.STAGES_ID = (
    SELECT MAX(r2.STAGES_ID)
    FROM SIGNATUREHISTORY h2
    JOIN SIGNATURERIGHTS r2 ON r2.ID = h2.SIGNRIGHT_ID
    WHERE r2.TASK_ID = t.ID AND h2.NEW_STATUS_ID IS NOT NULL
  )
  FETCH FIRST ROW ONLY
), st.NAME) AS STATUS_NAME_FINAL
```

---

### üîé –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:

1. **–ü—ñ–¥–∑–∞–ø–∏—Ç** –±–µ—Ä–µ –∑ `SIGNATUREHISTORY` –∑–∞–ø–∏—Å –∑ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–º `STAGES_ID`, —è–∫–∏–π –º–∞—î `NEW_STATUS_ID`.
2. –î–æ —Ü—å–æ–≥–æ –∑–∞–ø–∏—Å—É –ø—Ä–∏—î–¥–Ω—É—î—Ç—å—Å—è `STATUS_TABLE`, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ `NAME`.
3. –Ø–∫—â–æ –∂–æ–¥–Ω–æ–≥–æ —Ç–∞–∫–æ–≥–æ –∑–∞–ø–∏—Å—É –Ω–µ–º–∞—î, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `TASKS.STATUS_ID` ‚Üí `st.NAME`.

---

üîß **–ü–µ—Ä–µ–¥—É–º–æ–≤–∏:**

* –£ `FROM` —á–∞—Å—Ç–∏–Ω—ñ –≤–∞—à–æ–≥–æ –∑–∞–ø–∏—Ç—É –º–∞—î –±—É—Ç–∏ `JOIN STATUS_TABLE st ON st.ID = t.STATUS_ID`.

---

–ì–æ—Ç–æ–≤–∏–π –¥–æ–ø–æ–º–æ–≥—Ç–∏ –π –∑ –ø–æ–¥—ñ–±–Ω–æ—é –ª–æ–≥—ñ–∫–æ—é –¥–ª—è —ñ–Ω—à–∏—Ö –∫–æ–ª–æ–Ω–æ–∫ ‚Äî –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `—Ñ–∞–∫—Ç–∏—á–Ω–∞ –¥–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è`, —è–∫—â–æ —Ç—Ä–µ–±–∞ –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ `SIGNATUREHISTORY` –¥–ª—è `stage = 3`.
