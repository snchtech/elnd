–û–∫–µ–π! –î–∞–≤–∞–π—Ç–µ –æ–Ω–æ–≤–∏–º–æ —Ñ—É–Ω–∫—Ü—ñ—é `GET_NEXT_RUN_DATE` —Ç–∞–∫, —â–æ–± –≤–æ–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–ª–∞ **–ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω—É –ª–æ–≥—ñ–∫—É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω—É –∑ –Ω–æ–≤–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `PERIOD_START_DATE`**.

---

## ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è `GET_NEXT_RUN_DATE`

–¶—è —Ñ—É–Ω–∫—Ü—ñ—è:

* –ø—Ä–∞—Ü—é—î –¥–ª—è `PERIOD_MODE = 1` (—á–µ—Ä–µ–∑ –∫–æ–∂–Ω—ñ N –¥–Ω—ñ–≤ –∑ —á–∞—Å—É —Å—Ç–∞—Ä—Ç—É)
* –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–∞–π–±–ª–∏–∂—á—É –¥–∞—Ç—É –∑–∞–ø—É—Å–∫—É **–ø—ñ—Å–ª—è `SYSDATE`**
* –≤—Ä–∞—Ö–æ–≤—É—î `PERIOD_START_DATE`, `PERIODIC_INTERVAL`, `PERIODIC_TIME`, `PERIOD_END_TIME`

---

### üîß PL/SQL: –§—É–Ω–∫—Ü—ñ—è `GET_NEXT_RUN_DATE`

```sql
CREATE OR REPLACE FUNCTION GET_NEXT_RUN_DATE (
    p_period_start_date  IN DATE,
    p_period_interval    IN NUMBER,
    p_period_time        IN DATE,
    p_period_end_time    IN DATE DEFAULT NULL
) RETURN DATE IS
    v_next_run DATE;
    v_now      DATE := SYSDATE;
    v_i        NUMBER := 0;
    v_candidate DATE;
BEGIN
  IF p_period_start_date IS NULL OR p_period_interval IS NULL OR p_period_time IS NULL THEN
    RETURN NULL;
  END IF;

  LOOP
    -- –ö–æ–∂–Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∞ –¥–∞—Ç–∞ = —Å—Ç–∞—Ä—Ç + i * —ñ–Ω—Ç–µ—Ä–≤–∞–ª + —á–∞—Å
    v_candidate := TRUNC(p_period_start_date + v_i * p_period_interval)
                   + TO_NUMBER(TO_CHAR(p_period_time, 'SSSSS')) / 86400;

    -- –Ø–∫—â–æ –∑–Ω–∞–π—à–ª–∏ –¥–∞—Ç—É –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ
    IF v_candidate > v_now THEN
      -- –Ø–∫—â–æ –∑–∞–¥–∞–Ω–∞ –¥–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ –æ–±–º–µ–∂–µ–Ω–Ω—è
      IF p_period_end_time IS NOT NULL AND v_candidate > p_period_end_time THEN
        RETURN NULL;
      END IF;

      v_next_run := v_candidate;
      EXIT;
    END IF;

    v_i := v_i + 1;

    -- –ë–µ–∑–ø–µ—á–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤ —Ä–∞–∑—ñ –¥—É–∂–µ –¥–∞–ª–µ–∫–æ–≥–æ —Ü–∏–∫–ª—É
    IF v_i > 10000 THEN
      RETURN NULL;
    END IF;
  END LOOP;

  RETURN v_next_run;
END GET_NEXT_RUN_DATE;
/
```

---

## üì• –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

```sql
SELECT GET_NEXT_RUN_DATE(
    PERIOD_START_DATE,
    PERIODIC_INTERVAL,
    PERIODIC_TIME,
    PERIOD_END_TIME
) AS NEXT_RUN_DATE
FROM TASK_TEMPLATES
WHERE ID = :TEMPLATE_ID;
```

---

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç:

| –°—Ç–∞—Ä—Ç: `01.06.2025` | –Ü–Ω—Ç–µ—Ä–≤–∞–ª: `3 –¥–Ω—ñ` | –ß–∞—Å: `08:00` | SYSDATE: `07.06.2025 10:30` | –†–µ–∑—É–ª—å—Ç–∞—Ç: `10.06.2025 08:00` |
| ------------------- | ----------------- | ------------ | --------------------------- | ----------------------------- |

---

üîî –Ø–∫—â–æ —Ç–∏ —Ö–æ—á–µ—à **–≤–±—É–¥—É–≤–∞—Ç–∏ —Ü–µ —É `JOB` –∞–±–æ `UPDATE`**, –¥–∞–π –∑–Ω–∞—Ç–∏ ‚Äî —è –ø—ñ–¥–≥–æ—Ç—É—é –±–ª–æ–∫ –¥–ª—è –º–∞—Å–æ–≤–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è `NEXT_RUN_DATE` —É `TASK_TEMPLATES`.
