–©–æ–± —Ñ—É–Ω–∫—Ü—ñ—è `GET_NEXT_RUN_DATE` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∞—Ü—é–≤–∞–ª–∞ –∑ –∫—ñ–ª—å–∫–æ–º–∞ –¥–Ω—è–º–∏ —Ç–∏–∂–Ω—è —É —Ñ–æ—Ä–º–∞—Ç—ñ `'1:4:6'`, –ø–æ—Ç—Ä—ñ–±–Ω–æ:

1. –ó–∞–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `p_weekly_day` –∑ `NUMBER` –Ω–∞ `VARCHAR2`.
2. –†–æ–∑–ø–∞—Ä—Å–∏—Ç–∏ —Ä—è–¥–æ–∫ `p_weekly_day` —É –º–∞—Å–∏–≤ —á–∏—Å–µ–ª.
3. –û–±—á–∏—Å–ª–∏—Ç–∏ –Ω–∞–π–±–ª–∏–∂—á—É –¥–∞—Ç—É —Å–µ—Ä–µ–¥ —É—Å—ñ—Ö –ø–µ—Ä–µ–¥–∞–Ω–∏—Ö –¥–Ω—ñ–≤ —Ç–∏–∂–Ω—è.

–û—Å—å –æ–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ–¥ —Ñ—É–Ω–∫—Ü—ñ—ó:

```plsql
FUNCTION GET_NEXT_RUN_DATE (
  p_period_mode     IN NUMBER,
  p_period_interval IN NUMBER DEFAULT NULL,
  p_period_time     IN DATE DEFAULT NULL,
  p_period_start    IN DATE DEFAULT NULL,
  p_weekly_day      IN VARCHAR2 DEFAULT NULL,
  p_weekly_times    IN DATE DEFAULT NULL
) RETURN DATE IS

  v_now           DATE := SYSDATE;
  v_next_run      DATE := NULL;
  v_temp_time     DATE;
  v_best_time     DATE := NULL;
  v_day           NUMBER;
  v_days_ahead    NUMBER;

BEGIN
  IF p_period_mode = 1 THEN
    -- –Ü–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–∏–π —Ä–µ–∂–∏–º
    IF p_period_interval IS NOT NULL AND p_period_time IS NOT NULL THEN
      IF p_period_start IS NOT NULL THEN
        v_next_run := TRUNC(p_period_start) + p_period_interval + TO_NUMBER(TO_CHAR(p_period_time, 'SSSSS')) / 86400;
      ELSE
        v_next_run := TRUNC(v_now) + p_period_interval + TO_NUMBER(TO_CHAR(p_period_time, 'SSSSS')) / 86400;
      END IF;
    END IF;

  ELSIF p_period_mode = 2 THEN
    -- –©–æ—Ç–∏–∂–Ω–µ–≤–∏–π —Ä–µ–∂–∏–º
    IF p_weekly_day IS NOT NULL AND p_weekly_times IS NOT NULL THEN
      FOR val IN (
        SELECT TO_NUMBER(REGEXP_SUBSTR(p_weekly_day, '[^:]+', 1, LEVEL)) AS day_num
        FROM dual
        CONNECT BY REGEXP_SUBSTR(p_weekly_day, '[^:]+', 1, LEVEL) IS NOT NULL
      ) LOOP
        v_day := val.day_num;
        v_days_ahead := MOD((v_day + 7 - TO_CHAR(v_now, 'D')), 7);

        -- –Ø–∫—â–æ –¥–µ–Ω—å —Å—å–æ–≥–æ–¥–Ω—ñ, –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∞—Å
        IF v_days_ahead = 0 THEN
          v_temp_time := TRUNC(v_now) + TO_NUMBER(TO_CHAR(p_weekly_times, 'SSSSS')) / 86400;
          IF v_temp_time <= v_now THEN
            v_days_ahead := 7;
          END IF;
        END IF;

        v_temp_time := TRUNC(v_now) + v_days_ahead + TO_NUMBER(TO_CHAR(p_weekly_times, 'SSSSS')) / 86400;

        IF v_best_time IS NULL OR v_temp_time < v_best_time THEN
          v_best_time := v_temp_time;
        END IF;
      END LOOP;

      v_next_run := v_best_time;
    END IF;

  END IF;

  RETURN v_next_run;
END GET_NEXT_RUN_DATE;
```

‚úÖ **–©–æ –≤—Ä–∞—Ö–æ–≤–∞–Ω–æ**:

* –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ñ–æ—Ä–º–∞—Ç—É `1:4:6` –¥–ª—è `p_weekly_day`;
* –≤–∏–±—ñ—Ä –Ω–∞–π–±–ª–∏–∂—á–æ—ó –¥–∞—Ç–∏ –∑–∞–ø—É—Å–∫—É;
* –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —á–∞—Å—É `p_weekly_times` –¥–ª—è –≤—Å—ñ—Ö –¥–Ω—ñ–≤.

üîí **–ë–µ–∑–ø–µ–∫–∞**: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `REGEXP_SUBSTR` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥—É ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å —Ç–∏–ø—ñ–≤.

–î–æ–¥–∞—Ç–∫–æ–≤–æ:

* —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ, –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ —Ü–µ –≤ –ø—Ä–æ—Ü–µ—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è/–æ–Ω–æ–≤–ª–µ–Ω–Ω—è `NEXT_RUN_DATE` —É `TASK_TEMPLATES`.
