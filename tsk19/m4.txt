–û—Å—å PL/SQL-–ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –¥–ª—è **–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–∞–ø–∏—Å—ñ–≤ –∑ APEX\_COLLECTIONS —É –±–∞–∑—É –¥–∞–Ω–∏—Ö**, —è–∫–∞ –ø—Ä–∞—Ü—é—î **–ø—ñ—Å–ª—è –¥—É–±–ª—é–≤–∞–Ω–Ω—è** (–ø—ñ—Å–ª—è —Ç–æ–≥–æ —è–∫ —Ç–∏ –Ω–∞—Ç–∏—Å–∫–∞—î—à "–ó–±–µ—Ä–µ–≥—Ç–∏" –Ω–æ–≤—É –∫–æ–ø—ñ—é):

---

### ‚úÖ **1. –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å (`TASK_SUBTASKS_COLLECTION`) —É —Ç–∞–±–ª–∏—Ü—é `TASK_SUBTASKS`**

```plsql
DECLARE
  v_new_id NUMBER := :P6_NEW_TASK_ID; -- –∞–±–æ –ø–µ—Ä–µ–¥–∞–π —á–µ—Ä–µ–∑ APEX_APPLICATION.G_X03
  v_new_subtask_id NUMBER;
BEGIN
  FOR r IN (
    SELECT *
    FROM APEX_COLLECTIONS
    WHERE COLLECTION_NAME = 'TASK_SUBTASKS_COLLECTION'
      AND c001 = v_new_id
      AND c008 = 'NEW'
  )
  LOOP
    SELECT SEQ_TSKTRACK_SUBTSK.NEXTVAL INTO v_new_subtask_id FROM DUAL;

    INSERT INTO TASK_SUBTASKS (
      ID,
      TASK_ID,
      SUBTASK_CONTENT,
      STATUS_ID,
      PLANNING_DATE_END,
      PARENT_ID,
      SUBTASK_ORDER,
      DATE_CREATE,
      DATE_UPDATE,
      CREATOR,
      UPDATOR,
      TERM_DAYS
    ) VALUES (
      v_new_subtask_id,
      v_new_id,
      r.c002,
      r.c005,
      r.d001,
      r.c003,
      r.c004,
      r.d002,
      SYSDATE,
      r.c006,
      r.c007,
      r.n002
    );
  END LOOP;
END;
```

---

### ‚úÖ **2. –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—ñ–¥—à–∞–±–ª–æ–Ω—ñ–≤ (`TASK_TEMPLATE_SUBTASKS_COLLECTION`) —É `TASK_TEMPLATE_SUBTASKS`**

```plsql
DECLARE
  v_new_id NUMBER := :P6_NEW_TEMPLATE_ID; -- –∞–±–æ —á–µ—Ä–µ–∑ APEX_APPLICATION.G_X03
  v_new_subtemplate_id NUMBER;
BEGIN
  FOR r IN (
    SELECT *
    FROM APEX_COLLECTIONS
    WHERE COLLECTION_NAME = 'TASK_TEMPLATE_SUBTASKS_COLLECTION'
      AND c001 = v_new_id
      AND c008 = 'NEW'
  )
  LOOP
    SELECT SEQ_TSKTRACK_SUBTSK_TEMPLATES.NEXTVAL INTO v_new_subtemplate_id FROM DUAL;

    INSERT INTO TASK_TEMPLATE_SUBTASKS (
      ID,
      TEMPLATE_ID,
      SUBTASK_CONTENT,
      STATUS_ID,
      PARENT_ID,
      SUBTASK_ORDER,
      DATE_CREATE,
      DATE_UPDATE,
      CREATOR,
      UPDATOR,
      TERM_DAYS
    ) VALUES (
      v_new_subtemplate_id,
      v_new_id,
      r.c002,
      r.c005,
      r.c003,
      r.c004,
      r.d002,
      SYSDATE,
      r.c006,
      r.c007,
      r.n002
    );
  END LOOP;
END;
```

---

### üìå –í–∞–∂–ª–∏–≤—ñ –º–æ–º–µ–Ω—Ç–∏:

* `c001` ‚Äî –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ –Ω–æ–≤–∏–π `TASK_ID` / `TEMPLATE_ID` –ø—ñ—Å–ª—è –¥—É–±–ª—é–≤–∞–Ω–Ω—è.
* `c008 = 'NEW'` ‚Äî –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –º–∏ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ –Ω–æ–≤—ñ –∑–∞–ø–∏—Å–∏.
* `SEQ_...` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è ID.
* –î–ª—è `DELETE` –∞–±–æ `UPDATE` —Ä–µ–∞–ª—ñ–∑—É–π –∞–Ω–∞–ª–æ–≥—ñ—á–Ω—ñ –±–ª–æ–∫–∏ –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ.

---

### üîÑ –Ø–∫ –≤–∏–∫–ª–∏–∫–∞—Ç–∏:

* –¶—ñ –ø—Ä–æ—Ü–µ—Å–∏ –¥–æ–¥–∞—é—Ç—å—Å—è —è–∫ **"PL/SQL Code" Server Process** –ø—ñ—Å–ª—è –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∏ "–ó–±–µ—Ä–µ–≥—Ç–∏" (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —É –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ).
* –¢–∞–∫–æ–∂ –º–æ–∂–µ—à –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —ó—Ö —á–µ—Ä–µ–∑ `apex.server.process` —É JS –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ `apex.navigation.dialog.close`.

---

–•–æ—á–µ—à ‚Äî –º–æ–∂—É –ø–æ–∫–∞–∑–∞—Ç–∏ —â–µ –π JS-–∫–æ–¥ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≥–æ–ª–æ–≤–Ω–æ–≥–æ –∑–≤—ñ—Ç—É –ø—ñ—Å–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç–∞.
