–¢–∞–∫, –∑ —Ç–∞–∫–æ—é —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é –ë–î –º–æ–∂–Ω–∞ –ª–µ–≥–∫–æ **–ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏, —Ö—Ç–æ –æ–∑–Ω–∞–π–æ–º–ª—é–≤–∞–≤—Å—è –∑ –∑–∞–≤–¥–∞–Ω–Ω—è–º–∏ –ø—Ä–æ—Ç—è–≥–æ–º –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –¥–≤–æ—Ö –∑–º—ñ–Ω**.  

---

## **–Ø–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—ñ –æ–∑–Ω–∞–π–æ–º–∏–ª–∏—Å—è –∑ –∑–∞–≤–¥–∞–Ω–Ω—è–º–∏ —É –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –¥–≤—ñ –∑–º—ñ–Ω–∏?**  

**–û—Å–Ω–æ–≤–Ω–∞ —ñ–¥–µ—è**:  
- –í–∏–∑–Ω–∞—á–∞—î–º–æ **–ø–æ—Ç–æ—á–Ω—É –∑–º—ñ–Ω—É** (`GET_CURRENT_SHIFT()`).  
- –í–∏–∑–Ω–∞—á–∞—î–º–æ **–ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –¥–≤—ñ –∑–º—ñ–Ω–∏**, —è–∫—ñ –±—É–ª–∏ –ø–µ—Ä–µ–¥ –ø–æ—Ç–æ—á–Ω–æ—é.  
- –í–∏–∫–æ–Ω—É—î–º–æ `SELECT` –∑ —Ç–∞–±–ª–∏—Ü—ñ `TASK_ACKNOWLEDGEMENT`, —Ñ—ñ–ª—å—Ç—Ä—É—é—á–∏ `shift_date` —Ç–∞ `shift_number`.  

---

### **1. –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –¥–≤–æ—Ö –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –∑–º—ñ–Ω**  

```sql
CREATE OR REPLACE FUNCTION GET_PREVIOUS_SHIFTS
RETURN SYS.ODCINUMBERLIST IS
    v_current_shift NUMBER;
    v_prev_shifts SYS.ODCINUMBERLIST := SYS.ODCINUMBERLIST();
BEGIN
    v_current_shift := GET_CURRENT_SHIFT(); -- –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω—É –∑–º—ñ–Ω—É

    -- –õ–æ–≥—ñ–∫–∞ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –¥–≤–æ—Ö –∑–º—ñ–Ω
    IF v_current_shift = 1 THEN
        v_prev_shifts.EXTEND(2);
        v_prev_shifts(1) := 3; -- –¢—Ä–µ—Ç—è –∑–º—ñ–Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –¥–Ω—è
        v_prev_shifts(2) := 2; -- –î—Ä—É–≥–∞ –∑–º—ñ–Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –¥–Ω—è
    ELSIF v_current_shift = 2 THEN
        v_prev_shifts.EXTEND(2);
        v_prev_shifts(1) := 1; -- –ü–µ—Ä—à–∞ –∑–º—ñ–Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ
        v_prev_shifts(2) := 3; -- –¢—Ä–µ—Ç—è –∑–º—ñ–Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –¥–Ω—è
    ELSIF v_current_shift = 3 THEN
        v_prev_shifts.EXTEND(2);
        v_prev_shifts(1) := 2; -- –î—Ä—É–≥–∞ –∑–º—ñ–Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ
        v_prev_shifts(2) := 1; -- –ü–µ—Ä—à–∞ –∑–º—ñ–Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ
    END IF;

    RETURN v_prev_shifts;
END;
/
```
‚úÖ **–©–æ —Ä–æ–±–∏—Ç—å —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è?**  
- –ü–æ–≤–µ—Ä—Ç–∞—î **—Å–ø–∏—Å–æ–∫ –¥–≤–æ—Ö –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –∑–º—ñ–Ω** —É –≤–∏–≥–ª—è–¥—ñ –º–∞—Å–∏–≤—É (`SYS.ODCINUMBERLIST`).  

---

### **2. –ó–∞–ø–∏—Ç –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—ñ –æ–∑–Ω–∞–π–æ–º–ª—é–≤–∞–ª–∏—Å—è –∑ –∑–∞–≤–¥–∞–Ω–Ω—è–º–∏ —É –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –¥–≤—ñ –∑–º—ñ–Ω–∏**
```sql
SELECT 
    ta.user_id, 
    u.username, 
    ta.task_id, 
    t.task_content, 
    ta.shift_date, 
    ta.shift_number, 
    ta.acknowledged_at
FROM TASK_ACKNOWLEDGEMENT ta
JOIN USERS u ON ta.user_id = u.id
JOIN TASKS t ON ta.task_id = t.id
WHERE ta.shift_number IN (SELECT * FROM TABLE(GET_PREVIOUS_SHIFTS()))
    AND ta.shift_date >= TRUNC(SYSDATE) - CASE 
        WHEN GET_CURRENT_SHIFT() = 1 THEN 1 -- –Ø–∫—â–æ –∑–∞—Ä–∞–∑ 1 –∑–º—ñ–Ω–∞, —Ç–æ –¥–∏–≤–∏–º–æ—Å—è –∑–∞ –≤—á–æ—Ä–∞
        ELSE 0 -- –Ü–Ω–∞–∫—à–µ —Ç—ñ–ª—å–∫–∏ —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—ñ –∑–º—ñ–Ω–∏
    END
ORDER BY ta.acknowledged_at DESC;
```

---

## **–Ø–∫ –ø—Ä–∞—Ü—é—î —Ü–µ–π –∑–∞–ø–∏—Ç?**
1. **–í–∏–∑–Ω–∞—á–∞—î –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –¥–≤—ñ –∑–º—ñ–Ω–∏** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `GET_PREVIOUS_SHIFTS()`.
2. **–§—ñ–ª—å—Ç—Ä—É—î –∑–∞–ø–∏—Å–∏ –≤ `TASK_ACKNOWLEDGEMENT`**, –¥–µ:
   - `shift_number` –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –¥–≤–æ–º –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º –∑–º—ñ–Ω–∞–º.
   - `shift_date` –≤—Ä–∞—Ö–æ–≤—É—î **–≤—á–æ—Ä–∞—à–Ω—ñ–π –¥–µ–Ω—å**, —è–∫—â–æ –∑–∞—Ä–∞–∑ –ø–µ—Ä—à–∞ –∑–º—ñ–Ω–∞.
3. **–û–±‚Äô—î–¥–Ω—É—î –¥–∞–Ω—ñ –∑ —Ç–∞–±–ª–∏—Ü—è–º–∏ `USERS` —ñ `TASKS`**, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —ñ–º–µ–Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —ñ –∫–æ–Ω—Ç–µ–Ω—Ç –∑–∞–≤–¥–∞–Ω—å.
4. **–°–æ—Ä—Ç—É—î –∑–∞ `acknowledged_at DESC`**, —â–æ–± –Ω–∞–π–Ω–æ–≤—ñ—à—ñ –æ–∑–Ω–∞–π–æ–º–ª–µ–Ω–Ω—è –±—É–ª–∏ –∑–≤–µ—Ä—Ö—É.

---

## **–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É –∑–∞–ø–∏—Ç—É**
| user_id | username   | task_id | task_content       | shift_date | shift_number | acknowledged_at       |
|---------|-----------|---------|--------------------|------------|--------------|-----------------------|
| 12      | –Ü–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ | 101     | –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–≤—ñ—Ç    | 2025-03-18 | 3            | 2025-03-18 23:30:10  |
| 15      | –û–∫—Å–∞–Ω–∞ –õ–∏—Å | 102     | –í–∏–∫–æ–Ω–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è | 2025-03-18 | 2            | 2025-03-18 16:05:45  |
| 7       | –ê–Ω–¥—Ä—ñ–π –†–æ–º | 103     | –í–∏–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–º–∏–ª–∫–∏  | 2025-03-17 | 3            | 2025-03-17 23:45:30  |

---
## **–í–∏—Å–Ω–æ–≤–æ–∫**
‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –±–µ–∑ –∑–º—ñ–Ω**  
‚úÖ **–ó–∞–ø–∏—Ç–∏ –ª–µ–≥–∫–æ –æ—Ç—Ä–∏–º—É—é—Ç—å –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–∞–Ω—ñ**  
‚úÖ **–§—É–Ω–∫—Ü—ñ—è `GET_PREVIOUS_SHIFTS()` –¥–æ–∑–≤–æ–ª—è—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—á–∏—Å–ª—é–≤–∞—Ç–∏ –∑–º—ñ–Ω–∏**  
‚úÖ **–õ–æ–≥—ñ–∫–∞ –∑–∞–ø–∏—Ç—É –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—Ä–∞—Ö–æ–≤—É—î –∑–º—ñ–Ω—É –¥–Ω—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥—ñ –º—ñ–∂ –¥–∞—Ç–∞–º–∏**  

–ó–∞–≤–¥—è–∫–∏ —Ç–∞–∫—ñ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ñ, –≤–∏ –ª–µ–≥–∫–æ –º–æ–∂–µ—Ç–µ **–≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏, —Ö—Ç–æ –æ–∑–Ω–∞–π–æ–º–ª—é–≤–∞–≤—Å—è —ñ–∑ –∑–∞–≤–¥–∞–Ω–Ω—è–º–∏ —É –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –¥–≤–æ—Ö –∑–º—ñ–Ω–∞—Ö** —Ç–∞ –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ª–æ–≥. üöÄ