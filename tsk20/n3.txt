–î—É–∂–µ –¥–æ–±—Ä–µ! –Ø–∫—â–æ —Ç–∏ **–Ω–µ –ø–ª–∞–Ω—É—î—à –ø—Ä–∏–≤‚Äô—è–∑—É–≤–∞—Ç–∏ –¥–Ω—ñ —Ç–∏–∂–Ω—è –¥–æ –ø—ñ–¥—à–∞–±–ª–æ–Ω—ñ–≤**, –∞ –ª–∏—à–µ —Ö–æ—á–µ—à, —â–æ–± —à–∞–±–ª–æ–Ω `TASK_TEMPLATE` –º–∞–≤ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é **–≤ —è–∫—ñ –¥–Ω—ñ —Ç–∏–∂–Ω—è –π–æ–≥–æ –∑–∞–ø—É—Å–∫–∞—Ç–∏**, —Ç–æ **–Ω–∞–π–∫—Ä–∞—â–µ —Ä—ñ—à–µ–Ω–Ω—è ‚Äî —Ü–µ –≤–∏–Ω–µ—Å–µ–Ω–Ω—è –¥–Ω—ñ–≤ —Ç–∏–∂–Ω—è –≤ –æ–∫—Ä–µ–º—É —Ç–∞–±–ª–∏—Ü—é**, –ø–æ–≤‚Äô—è–∑–∞–Ω—É –∑ `TASK_TEMPLATES`.

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:

### **1. –¢–∞–±–ª–∏—Ü—è –¥–Ω—ñ–≤ —Ç–∏–∂–Ω—è –¥–ª—è —à–∞–±–ª–æ–Ω—ñ–≤**

```sql
CREATE TABLE TASK_TEMPLATE_WEEKDAYS (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TEMPLATE_ID NUMBER NOT NULL,
    WEEKDAY NUMBER(1) NOT NULL CHECK (WEEKDAY BETWEEN 1 AND 7),
    CONSTRAINT FK_TTW_TEMPLATE
      FOREIGN KEY (TEMPLATE_ID)
      REFERENCES TASK_TEMPLATES(ID)
      ON DELETE CASCADE
);
```

* –û–¥–∏–Ω —à–∞–±–ª–æ–Ω (`TASK_TEMPLATES.ID`) –º–æ–∂–µ –º–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –∑–∞–ø–∏—Å—ñ–≤ —É —Ü—ñ–π —Ç–∞–±–ª–∏—Ü—ñ ‚Äî –ø–æ –æ–¥–Ω–æ–º—É –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –æ–±—Ä–∞–Ω–æ–≥–æ –¥–Ω—è —Ç–∏–∂–Ω—è.

---

### **2. –Ø–∫ —Ü–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤ APEX**

#### ‚úÖ `Checkbox` item: `P6_WEEKDAYS`

* Return values: `1`, `2`, ..., `7`
* Display values: `–ù–µ–¥—ñ–ª—è`, `–ü–æ–Ω–µ–¥—ñ–ª–æ–∫`, ..., `–°—É–±–æ—Ç–∞`

#### ‚úÖ –ü—Ä–æ—Ü–µ—Å –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è (PL/SQL):

```plsql
BEGIN
  DELETE FROM TASK_TEMPLATE_WEEKDAYS WHERE TEMPLATE_ID = :P6_ID;

  FOR i IN 1 .. APEX_UTIL.STRING_TO_TABLE(:P6_WEEKDAYS).COUNT LOOP
    INSERT INTO TASK_TEMPLATE_WEEKDAYS (TEMPLATE_ID, WEEKDAY)
    VALUES (:P6_ID, TO_NUMBER(APEX_UTIL.STRING_TO_TABLE(:P6_WEEKDAYS)(i)));
  END LOOP;
END;
```

---

### **3. –Ø–∫ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Ü—ñ –¥–Ω—ñ —É PL/SQL (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —É job)**

```plsql
FOR day_rec IN (
  SELECT WEEKDAY
  FROM TASK_TEMPLATE_WEEKDAYS
  WHERE TEMPLATE_ID = v_template_id
)
LOOP
  -- –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –¥–Ω—è —Ç–∏–∂–Ω—è: day_rec.WEEKDAY
  -- –ú–æ–∂–µ—à –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –¥–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫—É
END LOOP;
```

–ê–±–æ –∑—ñ–±—Ä–∞—Ç–∏ —è–∫ —Å–ø–∏—Å–æ–∫:

```sql
SELECT LISTAGG(WEEKDAY, ':') WITHIN GROUP (ORDER BY WEEKDAY)
INTO v_weekdays
FROM TASK_TEMPLATE_WEEKDAYS
WHERE TEMPLATE_ID = :template_id;
```

---

## üîÑ –ß–æ–º—É –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —É VARCHAR2?

| –í–∏–ø–∞–¥–æ–∫             | –ü—Ä–æ–±–ª–µ–º–∞                                      |
| ------------------- | --------------------------------------------- |
| `'1:3:6'`           | –ù–µ —ñ–Ω–¥–µ–∫—Å—É—î—Ç—å—Å—è, –Ω–µ –º–æ–∂–Ω–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø—Ä–∏—î–¥–Ω–∞—Ç–∏ |
| CSV-—Ä—è–¥–æ–∫           | –ü–æ—Ç—Ä—ñ–±–Ω–æ –ø–∞—Ä—Å–∏—Ç–∏ –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ     |
| –ù–µ–º–æ–∂–ª–∏–≤—ñ—Å—Ç—å JOIN-—É | –ù–µ –ø—Ä–∏—î–¥–Ω–∞—î—à —ñ–Ω—à—ñ —Å–ª–æ–≤–Ω–∏–∫–∏ –¥–ª—è –Ω–∞–∑–≤ –¥–Ω—ñ–≤ —Ç–æ—â–æ |

---

## üèÅ –ü—ñ–¥—Å—É–º–æ–∫:

| –ü–∞—Ä–∞–º–µ—Ç—Ä         | –í–∞—Ä—ñ–∞–Ω—Ç                                                 |
| ---------------- | ------------------------------------------------------- |
| –ú—ñ—Å—Ü–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è | `TASK_TEMPLATE_WEEKDAYS`                                |
| –ó–≤‚Äô—è–∑–æ–∫          | `TEMPLATE_ID ‚Üí TASK_TEMPLATES.ID`                       |
| –¢–∏–ø –¥–∞–Ω–∏—Ö        | `WEEKDAY NUMBER(1)` –∑ `CHECK (BETWEEN 1 AND 7)`         |
| –£–≤‚Äô—è–∑–∫–∞ –≤ APEX   | `Checkbox` item + `APEX_UTIL.STRING_TO_TABLE`           |
| –ü–µ—Ä–µ–≤–∞–≥–∏         | –ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ—Ç–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó, –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ JOIN-—ñ–≤ |

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ, –º–æ–∂—É —Ç–∞–∫–æ–∂ –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑:

* —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è–º `view`, —â–æ –ø—ñ–¥—Ç—è–≥—É—î –Ω–∞–∑–≤–∏ –¥–Ω—ñ–≤ —Ç–∏–∂–Ω—è;
* –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º —Ç–≤–æ—î—ó —Ñ—É–Ω–∫—Ü—ñ—ó `GET_NEXT_RUN_DATE`, —â–æ–± –ø—Ä–∞—Ü—é–≤–∞–ª–∞ –∑ —Ü—ñ—î—é —Ç–∞–±–ª–∏—Ü–µ—é –Ω–∞–ø—Ä—è–º—É.
