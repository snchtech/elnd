–©–æ–± –Ω–∞–¥—ñ–π–Ω–æ —Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ **–≤—Å—ñ –∑–º—ñ–Ω–∏** –≤ `TASKS`, `TASK_TEMPLATES`, `TASK_SUBTASKS`, `TASK_TEMPLATE_SUBTASKS`, —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è —Å—Ç–≤–æ—Ä–∏—Ç–∏ **—É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω—É —Å–∏—Å—Ç–µ–º—É –ª–æ–≥—É–≤–∞–Ω–Ω—è**, —è–∫–∞:

1. **–ó–∞–ø–∏—Å—É—î —Ö—Ç–æ, –∫–æ–ª–∏ —ñ —â–æ –∑–º—ñ–Ω–∏–≤**.
2. **–ù–µ –¥—É–±–ª—é—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–∂–Ω–æ—ó —Ç–∞–±–ª–∏—Ü—ñ –ø–æ–≤–Ω—ñ—Å—Ç—é**.
3. **–î–∞—î –∑–º–æ–≥—É –≤—ñ–¥—Å—Ç–µ–∂–∏—Ç–∏ –∑–º—ñ–Ω–µ–Ω—ñ –ø–æ–ª—è, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ "–∑–∞–ø–∏—Å –¥–æ/–ø—ñ—Å–ª—è"**.

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### 1. `TASK_CHANGE_LOG` ‚Äì –æ—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥-—Ç–∞–±–ª–∏—Ü—è

```sql
CREATE TABLE TASK_CHANGE_LOG (
  ID              NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  LOG_DATE        DATE DEFAULT SYSDATE,
  USER_ID         VARCHAR2(50),
  OBJECT_TYPE     VARCHAR2(20), -- 'TASK', 'TEMPLATE', 'SUBTASK', 'SUBTEMPLATE'
  OBJECT_ID       NUMBER,       -- ID –∑–º—ñ–Ω–µ–Ω–æ–≥–æ –æ–±‚Äô—î–∫—Ç–∞
  ACTION_TYPE     VARCHAR2(10), -- 'INSERT', 'UPDATE', 'DELETE'
  FIELD_NAME      VARCHAR2(100),
  OLD_VALUE       CLOB,
  NEW_VALUE       CLOB
);
```

> –¶–µ –¥–æ–∑–≤–æ–ª—è—î **–∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ —Ç—ñ –ø–æ–ª—è, —è–∫—ñ –¥—ñ–π—Å–Ω–æ –∑–º—ñ–Ω–µ–Ω—ñ**, —ñ –ª–µ–≥–∫–æ –≤–∏–≤–æ–¥–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –∑–º—ñ–Ω.

---

### 2. üîß **–¢—Ä–∏–≥–µ—Ä –¥–ª—è `TASKS`**

```sql
CREATE OR REPLACE TRIGGER TRG_TASKS_LOG
AFTER UPDATE ON TASKS
FOR EACH ROW
DECLARE
  v_user VARCHAR2(50);
BEGIN
  v_user := NVL(sys_context('APEX$SESSION','APP_USER'), USER);

  -- –ø—Ä–∏–∫–ª–∞–¥ –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—è
  IF :OLD.TASK_CONTENT IS DISTINCT FROM :NEW.TASK_CONTENT THEN
    INSERT INTO TASK_CHANGE_LOG (USER_ID, OBJECT_TYPE, OBJECT_ID, ACTION_TYPE, FIELD_NAME, OLD_VALUE, NEW_VALUE)
    VALUES (v_user, 'TASK', :NEW.ID, 'UPDATE', 'TASK_CONTENT', :OLD.TASK_CONTENT, :NEW.TASK_CONTENT);
  END IF;

  -- repeat for other fields...
END;
```

---

### 3. üîß –ê–Ω–∞–ª–æ–≥—ñ—á–Ω—ñ —Ç—Ä–∏–≥–µ—Ä–∏ –¥–ª—è:

* `TASK_TEMPLATES` ‚Üí `'TEMPLATE'`
* `TASK_SUBTASKS` ‚Üí `'SUBTASK'`
* `TASK_TEMPLATE_SUBTASKS` ‚Üí `'SUBTEMPLATE'`

> –í—Å—ñ —Ü—ñ —Ç—Ä–∏–≥–µ—Ä–∏ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ —à–∞–±–ª–æ–Ω–Ω–∏–º–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é PL/SQL –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∫–æ–¥—É.

---

## üì¶ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ ‚Äì –¥—É–±–ª—é—é—á—ñ —Ç–∞–±–ª–∏—Ü—ñ

–Ø–∫—â–æ —Ç–æ–±—ñ –≤–∞–∂–ª–∏–≤–æ –º–∞—Ç–∏ **–ø–æ–≤–Ω–∏–π –∑–Ω—ñ–º–æ–∫ —Å—Ç–∞–Ω—É** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è –∞—É–¥–∏—Ç—É –∞–±–æ —ñ—Å—Ç–æ—Ä—ñ—ó), —Ç–æ–¥—ñ –≤–∞—Ä—Ç–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ª–æ–≥-—Ç–∞–±–ª–∏—Ü—ñ –Ω–∞ –∫—à—Ç–∞–ª—Ç:

* `TASKS_LOG`
* `TASK_TEMPLATES_LOG`
* `TASK_SUBTASKS_LOG`
* `TASK_TEMPLATE_SUBTASKS_LOG`

–ó –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏:

```sql
ACTION_TYPE    VARCHAR2(10),
LOG_DATE       DATE,
USER_ID        VARCHAR2(50)
```

–Ü –∫–æ–ø—ñ—é–≤–∞—Ç–∏ **–≤—Å—ñ –ø–æ–ª—è** –ø—Ä–∏ INSERT/UPDATE/DELETE.

–ê–ª–µ –º—ñ–Ω—É—Å–∏:

* –≤–∞–∂–∫–æ —à—É–∫–∞—Ç–∏, —è–∫—ñ —Å–∞–º–µ –ø–æ–ª—è –∑–º—ñ–Ω–∏–ª–∏—Å—è;
* –±–∞–≥–∞—Ç–æ –¥—É–±–ª—å–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö.

---

## üîç –í–∏—Å–Ω–æ–≤–æ–∫

| –ü—ñ–¥—Ö—ñ–¥                 | –ü–µ—Ä–µ–≤–∞–≥–∏                                            | –ù–µ–¥–æ–ª—ñ–∫–∏                                 |
| ---------------------- | --------------------------------------------------- | ---------------------------------------- |
| **Log –Ω–∞ —Ä—ñ–≤–Ω—ñ –ø–æ–ª—ñ–≤** | –õ–µ–≥–∫–∏–π –∞—É–¥–∏—Ç, –º—ñ–Ω—ñ–º—É–º –∑–∞–π–≤–∏—Ö –¥–∞–Ω–∏—Ö, –∑—Ä–æ–∑—É–º—ñ–ª–∏–π diff | –ë—ñ–ª—å—à–µ —Ç—Ä–∏–≥–µ—Ä–Ω–æ—ó –ª–æ–≥—ñ–∫–∏                  |
| **–î—É–±–ª—é—é—á—ñ —Ç–∞–±–ª–∏—Ü—ñ**   | –ü–æ–≤–Ω–∞ —ñ—Å—Ç–æ—Ä—ñ—è –∑–∞–ø–∏—Å—ñ–≤                               | –ó–∞–π–≤–µ –¥—É–±–ª—é–≤–∞–Ω–Ω—è, —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å –ø–æ—à—É–∫—É –∑–º—ñ–Ω |

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è

–î–ª—è —Ç–≤–æ—î—ó –∑–∞–¥–∞—á—ñ:

* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π **—É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω—É `TASK_CHANGE_LOG`** —Ç–∞–±–ª–∏—Ü—é.
* –°—Ç–≤–æ—Ä–∏ **4 —Ç—Ä–∏–≥–µ—Ä–∏** (`TASKS`, `TASK_TEMPLATES`, `TASK_SUBTASKS`, `TASK_TEMPLATE_SUBTASKS`) –∑ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è–º –ø–æ–ª—ñ–≤.
* –£ —Ä–∞–∑—ñ –ø–æ—Ç—Ä–µ–±–∏ ‚Äî –¥–æ–¥–∞–π –æ–∫—Ä–µ–º—É –∫–æ–ª–æ–Ω–∫—É `CHANGE_REASON` –∞–±–æ JSON-–ø–æ–ª–µ –∑ –¥–æ–¥–∞—Ç–∫–æ–≤–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é.

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ ‚Äî –º–æ–∂—É –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥ –ø–æ–≤–Ω–æ–≥–æ —Ç—Ä–∏–≥–µ—Ä–∞ –Ω–∞ `TASKS` –∞–±–æ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –¥–ª—è –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—å.
