–¢–∞–∫, —Ç–∏ –ø—Ä–∞–≤–∏–π ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π `PLSQL Dynamic Content` —Ä–µ–≥—ñ–æ–Ω –≤ Oracle APEX **–Ω–µ –º–∞—î –≤–±—É–¥–æ–≤–∞–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó `refresh()`**, —è–∫ –∑–≤–∏—á–∞–π–Ω—ñ –∑–≤—ñ—Ç–∏. –ê–ª–µ —î –∫—ñ–ª—å–∫–∞ **–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏—Ö —Å–ø–æ—Å–æ–±—ñ–≤ –æ–Ω–æ–≤–∏—Ç–∏ –π–æ–≥–æ –≤—Ä—É—á–Ω—É**, **–≤ —Ç–æ–º—É —á–∏—Å–ª—ñ –π –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤** –ø—ñ—Å–ª—è –∑–º—ñ–Ω —É –∑–∞–≤–¥–∞–Ω–Ω—è—Ö.

---

## üîß –í–ê–†–Ü–ê–ù–¢ 1: –û–Ω–æ–≤–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ AJAX callback + `apex.server.process`

### üîπ 1. –ó–∞–º—ñ—Å—Ç—å `PLSQL Dynamic Content`, —Å—Ç–≤–æ—Ä–∏ **Static Region –∑ `Static ID` = `tabsRegion`**

–Ü –∑–∞–ª–∏—à HTML —É –Ω—å–æ–º—É –ø–æ—Ä–æ–∂–Ω—ñ–º:

```html
<div id="tabsRegionContent"></div>
```

---

### üîπ 2. –°—Ç–≤–æ—Ä–∏ **Ajax Callback Process**, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `GET_TASK_TAB_COUNTS`

```plsql
DECLARE
  v_planned_cnt   NUMBER;
  v_shift_cnt     NUMBER;
  v_problem_cnt   NUMBER;
BEGIN
  SELECT COUNT(*) INTO v_planned_cnt
  FROM TASKS t
  WHERE t.STATUS_ID <> 14;

  SELECT COUNT(*) INTO v_shift_cnt
  FROM TASKS t
  WHERE
    (t.PLANNING_DATE_START < :PXX_SHIFT_END AND 
     (t.ACTUAL_DATE_END IS NULL OR t.ACTUAL_DATE_END > :PXX_SHIFT_START))
    OR (t.PLANNING_DATE_END BETWEEN :PXX_SHIFT_START AND :PXX_SHIFT_END);

  SELECT COUNT(*) INTO v_problem_cnt
  FROM TASKS t
  WHERE
    (t.PLANNING_DATE_END < SYSDATE AND t.ACTUAL_DATE_END IS NULL)
    OR EXISTS (
      SELECT 1
      FROM DICT_APP_CONFIRM_LIST d
      WHERE d.PAGE_LIST_ID = t.PAGE_LIST_ID
        AND NOT EXISTS (
          SELECT 1
          FROM SIGNATURERIGHTS r
          WHERE r.TASK_ID = t.ID AND r.STAGES_ID = d.STAGE
        )
    );

  -- –í–∏–≤–æ–¥–∏–º–æ HTML –±–ª–æ–∫
  APEX_JSON.OPEN_OBJECT;
  APEX_JSON.WRITE('html', '
    <button type="button" class="t-Button" onclick="setTab(''PLANNED'')">
      –ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ <span class="circle-badge planned">' || v_planned_cnt || '</span>
    </button>
    <button type="button" class="t-Button" onclick="setTab(''SHIFT'')">
      –ù–∞ –∑–º—ñ–Ω—É <span class="circle-badge shift">' || v_shift_cnt || '</span>
    </button>
    <button type="button" class="t-Button" onclick="setTab(''PROBLEM'')">
      –ü—Ä–æ–±–ª–µ–º–Ω—ñ <span class="circle-badge problem">' || v_problem_cnt || '</span>
    </button>
    <button type="button" class="t-Button" onclick="setTab(''ARCHIVE'')">–ê—Ä—Ö—ñ–≤</button>
  ');
  APEX_JSON.CLOSE_OBJECT;
END;
```

---

### üîπ 3. JavaScript —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:

```javascript
function refreshTabsRegion() {
  apex.server.process("GET_TASK_TAB_COUNTS", {
    pageItems: "#PXX_SHIFT_START,#PXX_SHIFT_END"
  }, {
    dataType: "json",
    success: function(data) {
      $("#tabsRegionContent").html(data.html);
    },
    error: function(e) {
      console.error("Error loading tabs content", e);
    }
  });
}
```

---

### üîπ 4. –í–∏–∫–ª–∏–∫ `refreshTabsRegion()`:

* –ü—ñ—Å–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è/–≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è –≤ –ø—Ä–æ—Ü–µ—Å—ñ (—á–µ—Ä–µ–∑ Success JavaScript)
* –ü—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (–≤ `Execute when Page Loads`)

```javascript
refreshTabsRegion();
```

---

## ‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏ —Ü—å–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É:

* –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è —Ä–µ–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å.
* –ù–µ –ø–æ—Ç—Ä–µ–±—É—î –ø–æ–≤–Ω–æ–≥–æ `page refresh`.
* –ü–æ–≤–Ω—ñ—Å—Ç—é –∫–∞—Å—Ç–æ–º—ñ–∑–æ–≤–∞–Ω–∏–π HTML —ñ –∑–æ–≤–Ω—ñ—à–Ω—ñ–π –≤–∏–≥–ª—è–¥.

---

## üìù –î–æ–¥–∞—Ç–∫–æ–≤–æ: —è–∫—â–æ —Ö–æ—á–µ—à, —â–æ–± —Ü–µ–π –±–ª–æ–∫ –ø—Ä–∞—Ü—é–≤–∞–≤ —Ç–∞–∫–æ–∂ —É –∑–≤–∏—á–∞–π–Ω–æ–º—É `PLSQL Dynamic Content` —Ä–µ–≥—ñ–æ–Ω—ñ:

–¢–æ–¥—ñ –º–æ–∂–µ—à:

* –ü–æ–º—ñ—Å—Ç–∏—Ç–∏ –π–æ–≥–æ —É `HTML region`
* –í–∏–≤–æ–¥–∏—Ç–∏ —á–µ—Ä–µ–∑ `apex.server.process(...)` –∞–±–æ `apex.region('tabsRegion').refresh()` –ø—ñ—Å–ª—è –¥—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
* –ê–ª–µ –≤ —Ç–∞–∫–æ–º—É —Ä–∞–∑—ñ –∫—Ä–∞—â–µ –≤—Å–µ –∂ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø–µ—Ä—à–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –≤–∏—â–µ (HTML –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä + AJAX).

---

–•–æ—á–µ—à, —â–æ–± —è —Å—Ñ–æ—Ä–º—É–≤–∞–≤ —Ç–æ–±—ñ –≥–æ—Ç–æ–≤—É –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—é: —Ä–µ–≥—ñ–æ–Ω + –ø—Ä–æ—Ü–µ—Å + JS ‚Äî –Ω–∞ —Ç–≤–æ—ó–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ?
