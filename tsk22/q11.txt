–¶–µ –¥—É–∂–µ –≥–∞—Ä–Ω–æ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–∞—á–∞, —è–∫–∞ —Å—Ç–æ—Å—É—î—Ç—å—Å—è **–¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–æ–º**, –≤—Ä–∞—Ö–æ–≤—É—é—á–∏ **–ø–æ—Å–∞–¥–∏, –∑–∞–º—ñ—â–µ–Ω–Ω—è, –≤—ñ–¥–¥—ñ–ª–∏ —Ç–∞ –∑–º—ñ–Ω–∏**. –ù–∏–∂—á–µ –ø–æ–¥–∞—é –∞–Ω–∞–ª—ñ–∑ —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó, —è–∫—ñ –≤—Ä–∞—Ö–æ–≤—É—é—Ç—å —è–∫ **–≥–Ω—É—á–∫—ñ—Å—Ç—å**, —Ç–∞–∫ —ñ **–ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ—Å—Ç—å —Å–∏—Å—Ç–µ–º–∏** –≤ Oracle APEX:

---

## üîë –ö–ª—é—á–æ–≤—ñ –ø–æ–Ω—è—Ç—Ç—è —É –≤–∞—à—ñ–π –º–æ–¥–µ–ª—ñ:

1. **3 –ì—Ä—É–ø–∏ –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤:**

   * **–ì—Ä—É–ø–∞ 1** ‚Äî *–ü–æ—Å–∞–¥–∞ + –í—ñ–¥–¥—ñ–ª + Unit*
   * **–ì—Ä—É–ø–∞ 2** ‚Äî *–ö–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á*
   * **–ì—Ä—É–ø–∞ 3** ‚Äî *–ó–º—ñ–Ω–∞ (Shift)*

2. **–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ —Ä–æ–ª—ñ**: `editor`, `moderator`, ‚Ä¶ ‚Äî –∫–µ—Ä—É—é—Ç—å **–º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –∑–º—ñ–Ω**.

3. **Access Control** ‚Äî –º–∞—î –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏:

   * –¥–∏–Ω–∞–º—ñ—á–Ω—ñ –ø–æ—Å–∞–¥–æ–≤—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏,
   * —Ç–∏–º—á–∞—Å–æ–≤–µ –∑–∞–º—ñ—â–µ–Ω–Ω—è,
   * –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è UI-–µ–ª–µ–º–µ–Ω—Ç—ñ–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∫–Ω–æ–ø–∫–∏ "–ü—ñ–¥–ø–∏—Å–∞—Ç–∏").

---

## üîß –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è

### ‚úÖ 1. –¢–∞–±–ª–∏—Ü—è `ACCESS_CONTROL` (–ø–æ—Å–∞–¥–æ–≤—ñ –¥–æ—Å—Ç—É–ø–∏)

```sql
CREATE TABLE ACCESS_CONTROL (
  ID               NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  ACCESS_TYPE      VARCHAR2(10),   -- 'POSITION', 'USER', 'SHIFT'
  POSITION_ID      NUMBER,         -- –¥–ª—è ACCESS_TYPE = 'POSITION'
  DEPARTMENT_ID    NUMBER,
  UNIT_ID          NUMBER,
  USER_ID          NUMBER,         -- –¥–ª—è ACCESS_TYPE = 'USER'
  SHIFT_CODE       VARCHAR2(10),   -- –¥–ª—è ACCESS_TYPE = 'SHIFT'
  ACTIVE_FROM      DATE DEFAULT SYSDATE,
  ACTIVE_TO        DATE,
  CREATED_BY       VARCHAR2(100),
  CREATED_AT       DATE DEFAULT SYSDATE
);
```

* –ú–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –≤—Å—ñ—Ö —Ç—Ä—å–æ—Ö –≥—Ä—É–ø –¥–æ—Å—Ç—É–ø—É.
* –í–∏ –¥–æ–¥–∞—î—Ç–µ –∑–∞–ø–∏—Å —ñ–∑ `ACCESS_TYPE = 'USER'` –¥–ª—è –≥—Ä—É–ø–∏ 2, `'POSITION'` –¥–ª—è –≥—Ä—É–ø–∏ 1 —Ç–æ—â–æ.
* –î–æ–¥–∞–π—Ç–µ `VIEW`, —è–∫–∏–π –ø–æ–≤–µ—Ä—Ç–∞—î *–ø–æ—Ç–æ—á–Ω—ñ* –∞–∫—Ç–∏–≤–Ω—ñ —Ä–æ–ª—ñ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –¥–∞—Ç–∏.

---

### ‚úÖ 2. –¢–∞–±–ª–∏—Ü—è `ACCESS_SUBSTITUTION` (–∑–∞–º—ñ—â–µ–Ω–Ω—è)

```sql
CREATE TABLE ACCESS_SUBSTITUTION (
  ID              NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  REPLACER_ID     NUMBER,    -- —Ö—Ç–æ –∑–∞–º—ñ—â–∞—î
  ORIGINAL_ID     NUMBER,    -- –∫–æ–≥–æ –∑–∞–º—ñ—â–∞—î
  VALID_FROM      DATE DEFAULT SYSDATE,
  VALID_TO        DATE,
  CREATED_AT      DATE DEFAULT SYSDATE
);
```

* –ü—ñ–¥ —á–∞—Å –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç—Ä–µ–±–∞ **–≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ —Ç–∞–∫–æ–∂ –∑–∞–º—ñ—â—É–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤**, —è–∫—â–æ –∑–∞—Ä–∞–∑ –¥—ñ—î –∑–∞–º—ñ—â–µ–Ω–Ω—è.
* –£ UI –º–æ–∂–Ω–∞ –¥–∞—Ç–∏ –∫–Ω–æ–ø–∫—É "–ó–∞–º—ñ—â–∞—Ç–∏" ‚Üí –≤–∏–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ‚Üí –¥–æ–¥–∞—î—Ç—å—Å—è –∑–∞–ø–∏—Å —É —Ü—é —Ç–∞–±–ª–∏—Ü—é.

---

### ‚úÖ 3. –í–∏–≥–ª—è–¥ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –¥–æ—Å—Ç—É–ø—É `V_USER_EFFECTIVE_ACCESS`

```sql
-- –¶–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–∞—î –≤—Å—ñ –ø–æ—Å–∞–¥–∏, –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∏, —à–∏—Ñ—Ç–∏, —è–∫—ñ –º–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—Ä—è–º–æ –∞–±–æ —á–µ—Ä–µ–∑ –∑–∞–º—ñ—â–µ–Ω–Ω—è
CREATE OR REPLACE VIEW V_USER_EFFECTIVE_ACCESS AS
SELECT u.USERNAME, ac.*
FROM USERS u
LEFT JOIN ACCESS_SUBSTITUTION s
  ON s.REPLACER_ID = u.ID
  AND SYSDATE BETWEEN s.VALID_FROM AND NVL(s.VALID_TO, SYSDATE + 3650)
JOIN ACCESS_CONTROL ac
  ON ac.ACCESS_TYPE = 'USER'
 AND (ac.USER_ID = u.ID OR ac.USER_ID = s.ORIGINAL_ID)
WHERE SYSDATE BETWEEN NVL(ac.ACTIVE_FROM, SYSDATE - 3650) AND NVL(ac.ACTIVE_TO, SYSDATE + 3650)

UNION

SELECT u.USERNAME, ac.*
FROM USERS u
JOIN ACCESS_CONTROL ac
  ON ac.ACCESS_TYPE = 'POSITION'
 AND ac.POSITION_ID = u.POSITION_ID
 AND ac.DEPARTMENT_ID = u.DEPARTMENT_ID
 AND ac.UNIT_ID = u.UNIT_ID
WHERE SYSDATE BETWEEN NVL(ac.ACTIVE_FROM, SYSDATE - 3650) AND NVL(ac.ACTIVE_TO, SYSDATE + 3650);
```

---

## üìå –ü–µ—Ä–µ–≤–∞–≥–∏ –ø—ñ–¥—Ö–æ–¥—É

| –ü–∞—Ä–∞–º–µ—Ç—Ä             | –û–ø–∏—Å                                                                                                |
| -------------------- | --------------------------------------------------------------------------------------------------- |
| üîÅ **–ê–∫—Ç—É–∞–ª—å–Ω—ñ—Å—Ç—å**  | –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –¥–∏–Ω–∞–º—ñ—á–Ω—ñ –ø–æ–ª—è `POSITION_ID`, `DEPARTMENT_ID` ‚Äî –Ω–µ –ø–æ—Ç—Ä–µ–±—É—î –¥—É–±–ª—é–≤–∞–Ω–Ω—è –≤—Å—ñ—î—ó —ñ—î—Ä–∞—Ä—Ö—ñ—ó. |
| üîß **–ì–Ω—É—á–∫—ñ—Å—Ç—å**     | –ü—ñ–¥—Ç—Ä–∏–º—É—î –≥—Ä—É–ø–∏, —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω—ñ —Ä–æ–ª—ñ, –∑–∞–º—ñ—â–µ–Ω–Ω—è.                                                     |
| üîí **–ë–µ–∑–ø–µ—á–Ω—ñ—Å—Ç—å**   | –í—Å–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –Ω–∞ —Ä—ñ–≤–Ω—ñ –ë–î.                                                                       |
| üìÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å —á–∞—Å—É** | –ó–∞–º—ñ—â–µ–Ω–Ω—è —ñ —Ä–æ–ª—ñ –¥—ñ—é—Ç—å —É –≤–∫–∞–∑–∞–Ω–∏–π –ø–µ—Ä—ñ–æ–¥.                                                           |
| üìã **APEX-friendly** | –ú–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `APEX_UTIL.CURRENT_USER`, `:APP_USER` –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–∞–≤.                     |

---

## ‚ùì–Ø–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —É APEX

1. **–§–æ—Ä–º–∞ –≤–∏–±–æ—Ä—É –≤–∏–∫–æ–Ω–∞–≤—Ü—è** ‚Äî –¥–∞—î –≤–∏–±—Ä–∞—Ç–∏:

   * –ü–Ü–ë –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (`GROUP 2`)
   * –ü–æ—Å–∞–¥—É + –≤—ñ–¥–¥—ñ–ª + unit (`GROUP 1`)
   * –ó–º—ñ–Ω—É (`GROUP 3`) ‚Äî –æ–ø–∏—à–µ—Ç–µ –æ–∫—Ä–µ–º–æ

2. **–ü—Ä–∏ —Ä–µ–Ω–¥–µ—Ä—ñ –∫–Ω–æ–ø–∫–∏ –≤ UI**:

   * –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ `V_USER_EFFECTIVE_ACCESS`, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –ø—Ä–∞–≤–æ (–±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∞–±–æ —á–µ—Ä–µ–∑ –∑–∞–º—ñ—â–µ–Ω–Ω—è).
   * –Ø–∫—â–æ –º–∞—î ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É, —ñ–Ω–∞–∫—à–µ ‚Äî —Å—Ç–∞—Ç—É—Å "–†–æ–∑–≥–ª—è–¥–∞—î", "–í —Ä–æ–±–æ—Ç—ñ", —Ç–æ—â–æ.

---

## üß† –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏

* **–ù–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –æ–∫—Ä–µ–º–∏—Ö –≤—ñ–¥–¥—ñ–ª—ñ–≤ —É `ACCESS_CONTROL`**, —è–∫—â–æ —É –≤–∞—Å —É–∂–µ —î –≤—ñ–¥–¥—ñ–ª–∏ –≤ `USERS` ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π `DEPARTMENT_ID` –Ω–∞–ø—Ä—è–º—É.
* **–ü–æ—Å–∞–¥–∏ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –∂–æ—Ä—Å—Ç–∫–æ —É –∫–æ–Ω—Ç—Ä–æ–ª—ñ –¥–æ—Å—Ç—É–ø—É** ‚Äî –∫—Ä–∞—â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `POSITION_ID`, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–∏–π –¥–æ `USERS`.

---

–Ø–∫—â–æ —Ü–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤–∞—à—ñ–π –ª–æ–≥—ñ—Ü—ñ ‚Äî —è –º–æ–∂—É:

* –Ω–∞–ø–∏—Å–∞—Ç–∏ SQL-—Ñ—É–Ω–∫—Ü—ñ—é `IS_USER_ALLOWED(p_task_id, p_user_id)` –∞–±–æ
* –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑ –¥–∏–Ω–∞–º—ñ—á–Ω–æ—é —É–º–æ–≤–æ—é –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–Ω–æ–ø–∫–∏ —É APEX (PL/SQL expression –∞–±–æ server-side condition).

–ß–∏ —Ä—É—Ö–∞—î–º–æ—Å—å –¥–∞–ª—ñ —É —Ü—å–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É?
