–û—Å—å –ø—Ä–∏–∫–ª–∞–¥ **PL/SQL –ø—Ä–æ—Ü–µ—Å—É**, —è–∫–∏–π **–≤—Å—Ç–∞–≤–ª—è—î –∑–∞–ø–∏—Å –∞–Ω—É–ª—é–≤–∞–Ω–Ω—è –≤—Ä—É—á–Ω—É –≤ `SIGNATUREHISTORY`** (–µ—Ç–∞–ø `STAGE_ID = 6`, —Å—Ç–∞—Ç—É—Å `STATUS_ID = 14`), –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤ –ø—Ä–æ—Ü–µ—Å—ñ `ANUL_TASK`:

```plsql
DECLARE
  v_user_id   VARCHAR2(50) := :APP_USER;
  v_task_id   NUMBER := :P6_TASK_ID;
  v_note      VARCHAR2(4000) := :P6_CANCEL_REASON;
  v_stage_id  NUMBER := 6; -- –ï—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è / –∞–Ω—É–ª—é–≤–∞–Ω–Ω—è
BEGIN
  INSERT INTO SIGNATUREHISTORY (
    TASK_ID,
    STAGE_ID,
    USER_ID,
    STATUS_ID,
    ACTION_DATE,
    NOTE
  ) VALUES (
    v_task_id,
    v_stage_id,
    v_user_id,
    14, -- —Å—Ç–∞—Ç—É—Å –∞–Ω—É–ª—å–æ–≤–∞–Ω–æ
    SYSDATE,
    v_note
  );
END;
```

---

### ‚úÖ –í–∞–∂–ª–∏–≤—ñ –º–æ–º–µ–Ω—Ç–∏:

* `:P6_TASK_ID` ‚Äî –º–∞—î –±—É—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–π item –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –∞–±–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏—Å—è —á–µ—Ä–µ–∑ `apex.server.process(..., {x01, x02})`.
* `:P6_CANCEL_REASON` ‚Äî –ø—Ä–∏—á–∏–Ω–∞, —è–∫—É —Ç–∏ –∑–±–∏—Ä–∞–≤ –∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
* –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ, –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∫–æ–≤–æ –≤—Å—Ç–∞–≤–∏—Ç–∏ –∑–∞–ø–∏—Å —É `SIGNATURERIGHTS`, —è–∫—â–æ –π–æ–≥–æ —Ç–∞–º —â–µ –Ω–µ–º–∞—î:

```plsql
BEGIN
  -- —è–∫—â–æ —â–µ –Ω–µ —ñ—Å–Ω—É—î –ø—Ä–∞–≤–∞ –Ω–∞ –µ—Ç–∞–ø 6, —Å—Ç–≤–æ—Ä–∏—Ç–∏ –π–æ–≥–æ
  INSERT INTO SIGNATURERIGHTS (TASK_ID, STAGES_ID)
  SELECT v_task_id, v_stage_id
  FROM dual
  WHERE NOT EXISTS (
    SELECT 1 FROM SIGNATURERIGHTS
    WHERE TASK_ID = v_task_id AND STAGES_ID = v_stage_id
  );
END;
```

---

### üß© –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤ APEX:

* –ó—Ä–æ–±–∏ **–ø—ñ—Å–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è** –∞–Ω—É–ª—é–≤–∞–Ω–Ω—è (—á–µ—Ä–µ–∑ `customConfirmDialog`) –≤–∏–∫–ª–∏–∫:

```javascript
apex.server.process('ANUL_TASK', {
  x01: $v('P6_TASK_ID'),
  x02: $v('P6_CANCEL_REASON')
}, {
  success: function () {
    apex.message.showPageSuccess('–ó–∞–≤–¥–∞–Ω–Ω—è –∞–Ω—É–ª—å–æ–≤–∞–Ω–æ.');
    apex.region('task-report').refresh();
  }
});
```

–Ü –≤ –ø—Ä–æ—Ü–µ—Å—ñ `ANUL_TASK`:

```plsql
DECLARE
  v_task_id   NUMBER := APEX_APPLICATION.G_X01;
  v_reason    VARCHAR2(4000) := APEX_APPLICATION.G_X02;
BEGIN
  UPDATE TASKS
  SET STATUS_ID = 14
  WHERE ID = v_task_id;

  INSERT INTO SIGNATUREHISTORY (
    TASK_ID, STAGE_ID, USER_ID, STATUS_ID, ACTION_DATE, NOTE
  ) VALUES (
    v_task_id, 6, :APP_USER, 14, SYSDATE, v_reason
  );

  -- –î–æ–¥–∞—Ç–∏ SIGNATURERIGHTS —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
  INSERT INTO SIGNATURERIGHTS (TASK_ID, STAGES_ID)
  SELECT v_task_id, 6 FROM dual
  WHERE NOT EXISTS (
    SELECT 1 FROM SIGNATURERIGHTS WHERE TASK_ID = v_task_id AND STAGES_ID = 6
  );
END;
```

–ì–æ—Ç–æ–≤–æ ‚úÖ
–¶–µ –¥–æ–∑–≤–æ–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ **—Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ –∞–Ω—É–ª—é–≤–∞–Ω–Ω—è –Ω–∞–≤—ñ—Ç—å –¥–ª—è –Ω–µ–∑–∞–ø–æ–≤–Ω–µ–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤** —ñ –≤–∏–≤–æ–¥–∏—Ç–∏ `actual_date_end` —á–µ—Ä–µ–∑ `SIGNATUREHISTORY`.
