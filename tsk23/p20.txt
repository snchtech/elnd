üî• –î—É–∂–µ —Ü—ñ–∫–∞–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è! –î–∞–≤–∞–π —Ä–æ–∑–±–µ—Ä–µ–º–æ **—è–∫ –∑—Ä–æ–±–∏—Ç–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —à–∏—Ñ—Ä –∑–∞–≤–¥–∞–Ω–Ω—è –≤ –∑–∞–¥–∞–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ**, –ø–æ—á–∏–Ω–∞—é—á–∏ –Ω—É–º–µ—Ä–∞—Ü—ñ—é —Å–ø–æ—á–∞—Ç–∫—É –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ä–æ–∫—É.

---

## üéØ **–§–æ—Ä–º–∞—Ç —à–∏—Ñ—Ä—É**

```
<–†–Ü–ö>-‚Ññ<–Ω–æ–º–µ—Ä —É —Ä–æ—Ü—ñ>-<DEPARTMENT_ID>
```

üëâ –ù–∞–ø—Ä–∏–∫–ª–∞–¥:

```
2025-‚Ññ3-27
```

–¥–µ:

* 2025 ‚Äî —Ä—ñ–∫ PLANNING\_DATE\_START (–∞–±–æ SYSDATE –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ)
* ‚Ññ3 ‚Äî –ø–æ—Ä—è–¥–∫–æ–≤–∏–π –Ω–æ–º–µ—Ä –∑–∞–≤–¥–∞–Ω–Ω—è –≤ —Ü—å–æ–º—É —Ä–æ—Ü—ñ
* 27 ‚Äî department\_id

---

## ‚úÖ **–†—ñ—à–µ–Ω–Ω—è**

üëâ **–ö—Ä–∞—â–µ –∑–∞ –≤—Å–µ —Ñ–æ—Ä–º—É–≤–∞—Ç–∏ —à–∏—Ñ—Ä —É —Ç—Ä–∏–≥–µ—Ä—ñ –ø—Ä–∏ –≤—Å—Ç–∞–≤—Ü—ñ.**
–ë–æ:

* —Ç–∏ –∑–∞–±–µ–∑–ø–µ—á–∏—à —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å
* –∑–±–µ—Ä–µ–∂–µ—à —à–∏—Ñ—Ä –æ–¥—Ä–∞–∑—É –≤ —Ç–∞–±–ª–∏—Ü—ñ

---

## üöÄ **–ü—Ä–∏–∫–ª–∞–¥ —Ç—Ä–∏–≥–µ—Ä–∞**

### üîπ –î–æ–¥–∞–π –∫–æ–ª–æ–Ω–∫—É –≤ —Ç–∞–±–ª–∏—Ü—é:

```sql
ALTER TABLE TASKS ADD (TASK_CODE VARCHAR2(50));
```

---

### üîπ –°—Ç–≤–æ—Ä–∏ —Ç—Ä–∏–≥–µ—Ä

```sql
CREATE OR REPLACE TRIGGER TRG_TASKS_GENERATE_CODE
BEFORE INSERT ON TASKS
FOR EACH ROW
DECLARE
  v_year NUMBER;
  v_seq_in_year NUMBER;
BEGIN
  -- –í–∏–∑–Ω–∞—á–∞—î–º–æ —Ä—ñ–∫ (–º–æ–∂–Ω–∞ PLANNING_DATE_START –∞–±–æ SYSDATE)
  v_year := EXTRACT(YEAR FROM NVL(:NEW.PLANNING_DATE_START, SYSDATE));

  -- –†–∞—Ö—É—î–º–æ —Å–∫—ñ–ª—å–∫–∏ –≤–∂–µ —î –∑–∞–≤–¥–∞–Ω—å –≤ —Ü—å–æ–º—É —Ä–æ—Ü—ñ
  SELECT NVL(MAX(TO_NUMBER(REGEXP_SUBSTR(TASK_CODE, '[0-9]+', 1, 2))), 0) + 1
  INTO v_seq_in_year
  FROM TASKS
  WHERE EXTRACT(YEAR FROM NVL(PLANNING_DATE_START, SYSDATE)) = v_year;

  -- –§–æ—Ä–º—É—î–º–æ TASK_CODE
  :NEW.TASK_CODE := v_year || '-‚Ññ' || v_seq_in_year || '-' || :NEW.DEPARTMENT_ID;
END;
```

---

## ‚ö† **–í–∞–∂–ª–∏–≤–æ**

üëâ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `REGEXP_SUBSTR` —â–æ–± –¥—ñ—Å—Ç–∞—Ç–∏ –ø–æ—Ä—è–¥–∫–æ–≤–∏–π –Ω–æ–º–µ—Ä —ñ–∑ TASK\_CODE.
üëâ –Ø–∫—â–æ –≤ —Ç–µ–±–µ —î –∫–æ–ª–æ–Ω–∫–∞ `CREATED_DATE` –∞–±–æ —ñ–Ω—à–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–∞ –¥–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è ‚Äî –∫—Ä–∞—â–µ —Ä–∞—Ö—É–≤–∞—Ç–∏ –ø–æ –Ω—ñ–π, –Ω—ñ–∂ –ø–æ `PLANNING_DATE_START`.
üëâ –î–ª—è –≤–∏—Å–æ–∫–æ–≥–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫—Ä–∞—â–µ –æ–∫—Ä–µ–º—É —Ç–∞–±–ª–∏—Ü—é/sequence –¥–ª—è —Ä–æ–∫—É, –±–æ –ø—Ä–∏ –≤–µ–ª–∏–∫—ñ–π –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –≤—Å—Ç–∞–≤–æ–∫ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≥–æ–Ω–∫–∏ (race condition).

---

## ‚úÖ **–í–∏–≤–µ–¥–µ–Ω–Ω—è —É IR**

–£ —Ç–≤–æ—î–º—É SQL –∑–∞–ø–∏—Ç—ñ –¥–ª—è Interactive Report –ø—Ä–æ—Å—Ç–æ –¥–æ–¥–∞—î—à –∫–æ–ª–æ–Ω–∫—É:

```sql
TASK_CODE AS "–®–∏—Ñ—Ä –∑–∞–≤–¥–∞–Ω–Ω—è"
```

---

## üí° **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –∑ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—é –Ω–∞ —Ä—ñ–∫**

–©–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ race condition:
1Ô∏è‚É£ –°—Ç–≤–æ—Ä–∏—Ç–∏ –æ–∫—Ä–µ–º—É —Ç–∞–±–ª–∏—Ü—é –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –Ω–∞ —Ä—ñ–∫:

```sql
CREATE TABLE TASK_CODE_SEQ (
  YEAR NUMBER,
  LAST_SEQ NUMBER,
  PRIMARY KEY (YEAR)
);
```

2Ô∏è‚É£ –£ —Ç—Ä–∏–≥–µ—Ä—ñ:

* –ø–µ—Ä–µ–≤—ñ—Ä—è—î—à —á–∏ —î –∑–∞–ø–∏—Å –¥–ª—è —Ä–æ–∫—É
* –æ–Ω–æ–≤–ª—é—î—à LAST\_SEQ —ñ –±–µ—Ä–µ—à –Ω–æ–≤–∏–π –Ω–æ–º–µ—Ä

---

## üìù **–ü—ñ–¥—Å—É–º–æ–∫**

‚úÖ –¢—Ä–∏–≥–µ—Ä –≥–µ–Ω–µ—Ä—É—î TASK\_CODE –æ–¥—Ä–∞–∑—É –ø—Ä–∏ –≤—Å—Ç–∞–≤—Ü—ñ
‚úÖ –§–æ—Ä–º–∞—Ç: `2025-‚Ññ3-27`
‚úÖ IR –≤–∏–≤–æ–¥–∏—Ç—å TASK\_CODE
‚úÖ –î–ª—è –≤–∏—Å–æ–∫–æ–≥–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫—Ä–∞—â–µ –æ–∫—Ä–µ–º–∞ —Ç–∞–±–ª–∏—Ü—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –Ω–æ–º–µ—Ä–∞ –ø–æ —Ä–æ–∫–∞—Ö

---

üöÄ –•–æ—á–µ—à ‚Äî —è –ø—ñ–¥–≥–æ—Ç—É—é –ø–æ–≤–Ω—É —Å—Ö–µ–º—É –∑ —Ç–∞–±–ª–∏—Ü–µ—é TASK\_CODE\_SEQ + –≥–æ—Ç–æ–≤–∏–π —Ç—Ä–∏–≥–µ—Ä? –ù–∞–ø–∏—à–∏!
