üîπ **–î—É–∂–µ –≥–∞—Ä–Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—è ‚Äî –≤–æ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∞, –≥–Ω—É—á–∫–∞ —ñ –≤–ø–∏—à–µ—Ç—å—Å—è —É –≤–∞—à—É —Å–∏—Å—Ç–µ–º—É!**
–î–∞–≤–∞–π—Ç–µ –æ—Ñ–æ—Ä–º–∏–º–æ —É—Å–µ –∞–∫—É—Ä–∞—Ç–Ω–æ –ø–æ –ø—É–Ω–∫—Ç–∞—Ö.

---

## ‚úÖ **1Ô∏è‚É£ –¢–∞–±–ª–∏—Ü—è –∑–∞–º—ñ—â–µ–Ω–Ω—è**

### –ü—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω–∞ –Ω–∞–∑–≤–∞

–ú–æ–∂–ª–∏–≤—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –Ω–∞–∑–≤–∏ —Ç–∞–±–ª–∏—Ü—ñ:

* `USER_SUBSTITUTION`
* `USER_DELEGATION`
* `USER_REPLACEMENT`
* `USER_ACTING_ROLE`

üí° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:**
`USER_SUBSTITUTION` ‚Äî –∫–æ—Ä–æ—Ç–∫–æ, –∑—Ä–æ–∑—É–º—ñ–ª–æ, —Ç–æ—á–Ω–æ –ø–µ—Ä–µ–¥–∞—î –∑–º—ñ—Å—Ç.

---

### SQL —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ

```sql
CREATE TABLE user_substitution (
  id               NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id_original  NUMBER NOT NULL,  -- –∫–æ–≥–æ –∑–∞–º—ñ—â–∞—é—Ç—å (user_id –∑ USERS)
  username_original VARCHAR2(100),    -- –∫–æ–≥–æ –∑–∞–º—ñ—â–∞—é—Ç—å (–¥–ª—è –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ/—à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É)
  user_id_replacer  NUMBER NOT NULL,  -- —Ö—Ç–æ –∑–∞–º—ñ—â–∞—î (user_id –∑ USERS)
  date_create       DATE DEFAULT SYSDATE,
  date_end          DATE,             -- –¥–∞—Ç–∞ –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è –∑–∞–º—ñ—â–µ–Ω–Ω—è (NULL = –¥—ñ—î)
  created_by        VARCHAR2(100),    -- —Ö—Ç–æ –¥–æ–¥–∞–≤ –∑–∞–º—ñ—â–µ–Ω–Ω—è
  note              VARCHAR2(4000)    -- –∫–æ–º–µ–Ω—Ç–∞—Ä (–æ–ø—Ü—ñ–π–Ω–æ, –∑—Ä—É—á–Ω–æ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è)
);
```

---

### –©–æ –≤–∏ –º–æ–≥–ª–∏ –Ω–µ –≤—Ä–∞—Ö—É–≤–∞—Ç–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó):

‚úÖ **`date_create` + `created_by`** ‚Äî –¥–ª—è —ñ—Å—Ç–æ—Ä—ñ—ó —Ö—Ç–æ —ñ –∫–æ–ª–∏ —Å—Ç–≤–æ—Ä–∏–≤ –∑–∞–º—ñ—â–µ–Ω–Ω—è.
‚úÖ **`note`** ‚Äî –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—Ä–∏—á–∏–Ω–∞ –∑–∞–º—ñ—â–µ–Ω–Ω—è).
‚úÖ **–£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–Ω–¥–µ–∫—Å**

```sql
CREATE UNIQUE INDEX uq_user_substitution_active
ON user_substitution(user_id_original, user_id_replacer)
WHERE date_end IS NULL;
```

–¶–µ –¥–æ–∑–≤–æ–ª—è—î —É–Ω–∏–∫–Ω—É—Ç–∏ –¥—É–±–ª—é –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–º—ñ—â–µ–Ω–Ω—è –¥–ª—è —Ç—ñ—î—ó –∂ –ø–∞—Ä–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.

‚úÖ **–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è –Ω–∞ –º–∞–π–±—É—Ç–Ω—î**

* –ú–æ–∂–Ω–∞ –±—É–¥–µ –¥–æ–¥–∞—Ç–∏ `date_start`, —è–∫—â–æ –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É –∑–∞—Ö–æ—á–µ—Ç–µ —Å—Ç—Ä–æ–∫–∏ –∑–∞–º—ñ—â–µ–Ω–Ω—è.

---

## ‚úÖ **2Ô∏è‚É£ –Ø–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤ APEX (before header)**

### üîπ –ü—Ä–æ—Ü–µ—Å –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º—ñ—â–µ–Ω–Ω—è

–£ `Before Header` (–≥–ª–æ–±–∞–ª—å–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∞–±–æ –Ω–∞ –ø–æ—Ç—Ä—ñ–±–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ):

```plsql
DECLARE
  l_user_id_original  NUMBER;
  l_username_original VARCHAR2(100);
  l_position_id       NUMBER;
  l_department_id     NUMBER;
  l_unit_id           NUMBER;
BEGIN
  -- –ó–Ω–∞—Ö–æ–¥–∏–º–æ –∑–∞–º—ñ—â–µ–Ω–Ω—è –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
  SELECT user_id_original, username_original
  INTO l_user_id_original, l_username_original
  FROM user_substitution
  WHERE user_id_replacer = :P0_USER_ID
    AND (date_end IS NULL OR date_end > SYSDATE)
    AND ROWNUM = 1; -- –Ø–∫—â–æ –ø—Ä–∏–ø—É—Å—Ç–∏–º–æ –æ–¥–Ω–µ –∑–∞–º—ñ—â–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–µ

  -- –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ item
  :P0_NEW_USER_ID := l_user_id_original;
  :P0_NEW_USERNAME := l_username_original;

  -- –í–∏—Ç—è–≥—É—î–º–æ –∑ USERS –¥–∞–Ω—ñ –∑–∞–º—ñ—â—É–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
  SELECT position_id, department_id
  INTO :P0_NEW_POSITION_ID, :P0_NEW_DEPARTMENT_ID
  FROM users
  WHERE id = l_user_id_original;

  -- Unit –∑ APEX Access Control
  BEGIN
    SELECT REPLACE(role_static_id, 'U_', '')
    INTO :P0_NEW_UNIT_ID
    FROM apex_appl_acl_user_roles
    WHERE application_id = :APP_ID
      AND user_name = l_username_original
      AND role_static_id LIKE 'U\_%' ESCAPE '\'
      AND ROWNUM = 1;
  EXCEPTION
    WHEN NO_DATA_FOUND THEN
      :P0_NEW_UNIT_ID := NULL;
  END;

EXCEPTION
  WHEN NO_DATA_FOUND THEN
    -- –ó–∞–º—ñ—â–µ–Ω–Ω—è –Ω–µ–º–∞—î
    :P0_NEW_USER_ID := NULL;
    :P0_NEW_USERNAME := NULL;
    :P0_NEW_POSITION_ID := NULL;
    :P0_NEW_DEPARTMENT_ID := NULL;
    :P0_NEW_UNIT_ID := NULL;
END;
```

---

### üîπ –í–ø–ª–∏–≤ –Ω–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å

‚úÖ **Read-only / Editable**

* –Ø–∫—â–æ `P0_NEW_USER_ID` **–Ω–µ NULL** ‚Üí –ø–æ–∫–∞–∑—É—î–º–æ select editable (–¥–æ–∑–≤–æ–ª—è—î–º–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏, –±–æ —î –ø—Ä–∞–≤–æ –Ω–∞ –∑–∞–º—ñ—â–µ–Ω–Ω—è).
* –Ø–∫—â–æ `P0_NEW_USER_ID` **NULL** ‚Üí –ø–æ–∫–∞–∑—É—î–º–æ select —É read-only.

–ú–æ–∂–Ω–∞ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ Dynamic Action:

* Condition ‚Üí `:P0_NEW_USER_ID IS NOT NULL`
* Action ‚Üí set `Editable`
* Else ‚Üí set `Read-only`

---

## ‚úâ –ü—ñ–¥—Å—É–º–æ–∫

| –ü–æ–ª–µ                   | –î–∂–µ—Ä–µ–ª–æ –¥–∞–Ω–∏—Ö                                       |
| ---------------------- | --------------------------------------------------- |
| `P0_NEW_USER_ID`       | `user_substitution.user_id_original`                |
| `P0_NEW_USERNAME`      | `user_substitution.username_original`               |
| `P0_NEW_POSITION_ID`   | `users.position_id` –∑–∞ –∑–∞–º—ñ—â—É–≤–∞–Ω–∏–º                  |
| `P0_NEW_DEPARTMENT_ID` | `users.department_id` –∑–∞ –∑–∞–º—ñ—â—É–≤–∞–Ω–∏–º                |
| `P0_NEW_UNIT_ID`       | Access Control —Ä–æ–ª—å `U_...` –∑–∞ –∑–∞–º—ñ—â—É–≤–∞–Ω–∏–º username |

---

## üöÄ –ì–æ—Ç–æ–≤–∏–π –¥–æ–ø–æ–º–æ–≥—Ç–∏:

üëâ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç–∏ –≤—Å—Ç–∞–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö.
üëâ –ü—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ APEX dynamic action –∞–±–æ server process –¥–ª—è —Ü—ñ—î—ó –ª–æ–≥—ñ–∫–∏.
üëâ –ê–±–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ view, —â–æ–± —Å–ø—Ä–æ—Å—Ç–∏—Ç–∏ –≤–∏–±—ñ—Ä–∫–∏ –¥–ª—è –ø—ñ–¥–ø–∏—Å—É.

–ß–∏ —Ö–æ—á–µ—Ç–µ —â–æ—Å—å —ñ–∑ —Ü—å–æ–≥–æ? üòä
