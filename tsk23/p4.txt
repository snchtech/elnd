üöÄ **–í–∏ –¥—É–∂–µ –≥—Ä–∞–º–æ—Ç–Ω–æ –ø—Ä–æ–¥—É–º–∞–ª–∏ –ø—ñ–¥—Ö—ñ–¥!**
–î–∞–≤–∞–π—Ç–µ —è –π–æ–≥–æ –≤–ø–æ—Ä—è–¥–∫—É—é —ñ –∑–∞–ø—Ä–æ–ø–æ–Ω—É—é —É—Ç–æ—á–Ω–µ–Ω–Ω—è –π –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Ç–∞–±–ª–∏—Ü—ñ + –ª–æ–≥—ñ–∫—É –¥–ª—è where.

---

## ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ñ –¥–æ—Å—Ç—É–ø—ñ–≤ (–ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è)**

```sql
CREATE TABLE task_access_control (
  id               NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id          NUMBER,            -- —è–∫—â–æ –¥–æ—Å—Ç—É–ø —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏–π (NULL —è–∫—â–æ –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω)
  position_id      NUMBER,            -- —è–∫—â–æ –¥–æ—Å—Ç—É–ø –ø–æ –ø–æ—Å–∞–¥—ñ (NULL —è–∫—â–æ –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω)
  department_id    NUMBER,            -- —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–µ –æ–±–º–µ–∂–µ–Ω–Ω—è –ø–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—É (NULL —è–∫—â–æ –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω)
  unit_id          NUMBER,            -- —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–µ –æ–±–º–µ–∂–µ–Ω–Ω—è –ø–æ —é–Ω—ñ—Ç—É (NULL —è–∫—â–æ –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω)
  access_level     NUMBER NOT NULL,   -- —Ä—ñ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø—É (1, 2, 3)
  date_create      DATE DEFAULT SYSDATE,
  created_by       VARCHAR2(100),
  note             VARCHAR2(4000)     -- –¥–ª—è –æ–ø–∏—Å—É (–æ–ø—Ü—ñ–π–Ω–æ)
);
```

---

## ‚úÖ **–©–æ –¥–æ–¥–∞–≤ —ñ —á–æ–º—É**

| –ü–æ–ª–µ / –æ—Å–æ–±–ª–∏–≤—ñ—Å—Ç—å                                              | –ß–æ–º—É –≤–∞—Ä—Ç–æ –¥–æ–¥–∞—Ç–∏                                                                                 |
| --------------------------------------------------------------- | ------------------------------------------------------------------------------------------------- |
| `unit_id`                                                       | –í–∏ —Ö–æ—á–µ—Ç–µ –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ unit –≤ –¥–µ—è–∫–∏—Ö –¥–æ—Å—Ç—É–ø–∞—Ö.                                                     |
| `date_create`, `created_by`, `note`                             | –î–ª—è —ñ—Å—Ç–æ—Ä—ñ—ó —Ç–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è, —è–∫ —ñ —É –≤–∞—à—ñ–π —Ç–∞–±–ª–∏—Ü—ñ –∑–∞–º—ñ—â–µ–Ω–Ω—è.                                   |
| `NULLABLE` –¥–ª—è user\_id, position\_id, department\_id, unit\_id | –î–æ–∑–≤–æ–ª—è—î –±—É–¥—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –≥–Ω—É—á–∫–æ: –¥–æ—Å—Ç—É–ø –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ user, –¥–ª—è position+dept, –¥–ª—è unit —Ç–æ—â–æ.  |
| **–£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–Ω–¥–µ–∫—Å**                                           | –ù–∞–ø—Ä–∏–∫–ª–∞–¥ –Ω–∞ (user\_id, position\_id, department\_id, unit\_id, access\_level) —â–æ–± —É–Ω–∏–∫–∞—Ç–∏ –¥—É–±–ª—é. |

---

## ‚úÖ **–õ–æ–≥—ñ–∫–∞ –¥–æ—Å—Ç—É–ø—ñ–≤ (–ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤–∞—à–∏—Ö —Ä—ñ–≤–Ω—ñ–≤)**

| Access level | –©–æ –±–∞—á–∏—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á                                                                                      |
| ------------ | --------------------------------------------------------------------------------------------------------- |
| 1            | –í–°–Ü –∑–∞–≤–¥–∞–Ω–Ω—è (–±–µ–∑ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ –ø–æ –∑–∞–¥–∞—á–∞–º), + –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ —Å–≤–æ—ó Signaturerights –∑–∞–ø–∏—Å–∏ (task\_id –¥–µ –≤—ñ–Ω —î)     |
| 2            | –ó–∞–≤–¥–∞–Ω–Ω—è –ø–æ position/unit/department –∑–≥—ñ–¥–Ω–æ –∑–∞–ø–∏—Å—É –≤ task\_access\_control + —Ç—ñ, –¥–µ –≤—ñ–Ω —É Signaturerights |
| 3            | –ó–∞–≤–¥–∞–Ω–Ω—è, –¥–µ –≤—ñ–Ω —î –≤ Signaturerights (—Ç–æ–±—Ç–æ –ª–∏—à–µ —Ç—ñ, –¥–µ –≤—ñ–Ω —É—á–∞—Å–Ω–∏–∫)                                      |

---

## ‚úÖ **Where –¥–ª—è –∑–≤—ñ—Ç—É (–±–∞–∑–æ–≤–∞ —ñ–¥–µ—è)**

### 1Ô∏è‚É£ Access level = 1 (–Ω–µ–º–∞—î —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ –ø–æ –∑–∞–≤–¥–∞–Ω–Ω—è–º)

```sql
WHERE 1=1
  OR EXISTS (
    SELECT 1 FROM signaturerights sr
    WHERE sr.task_id = t.id
      AND sr.user_id = :P0_USER_ID
      AND sr.status <> 11
  )
```

---

### 2Ô∏è‚É£ Access level = 2

```sql
WHERE (
    (:P0_POSITION_ID IS NOT NULL AND t.position_id = :P0_POSITION_ID)
    AND (:P0_DEPARTMENT_ID IS NULL OR t.department_id = :P0_DEPARTMENT_ID)
    AND (:P0_UNIT_ID IS NULL OR t.unit_id = :P0_UNIT_ID)
  )
  OR EXISTS (
    SELECT 1 FROM signaturerights sr
    WHERE sr.task_id = t.id
      AND sr.user_id = :P0_USER_ID
      AND sr.status <> 11
  )
```

---

### 3Ô∏è‚É£ Access level = 3

```sql
WHERE EXISTS (
  SELECT 1 FROM signaturerights sr
  WHERE sr.task_id = t.id
    AND sr.user_id = :P0_USER_ID
    AND sr.status <> 11
)
```

---

## ‚úÖ **–©–æ —â–µ –≤—Ä–∞—Ö—É–≤–∞—Ç–∏**

### 1Ô∏è‚É£ –ú–Ω–æ–∂–∏–Ω–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø—É

üîπ –Ø–∫—â–æ –¥–ª—è –æ–¥–Ω–æ–≥–æ user\_id —î –∫—ñ–ª—å–∫–∞ –∑–∞–ø–∏—Å—ñ–≤ —É task\_access\_control (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–æ –ø–æ—Å–∞–¥—ñ –π –ø–æ —é–Ω—ñ—Ç—É), —Ç—Ä–µ–±–∞ –±—É–¥–µ:

* –∞–±–æ –±—Ä–∞—Ç–∏ –Ω–∞–π–±—ñ–ª—å—à –∑–∞–≥–∞–ª—å–Ω–∏–π (min(access\_level)),
* –∞–±–æ –æ–±‚Äô—î–¥–Ω—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞.

üí° –ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ `priority` –ø–æ–ª–µ ‚Äî —â–æ–± —è–≤–Ω–æ –≤–∫–∞–∑–∞—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∞–≤–∏–ª–∞.

---

### 2Ô∏è‚É£ –î–∏–Ω–∞–º—ñ—á–Ω–∞ –ø–æ–±—É–¥–æ–≤–∞ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤

–©–æ–± avoid hardcoding, –∫—Ä–∞—â–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é:

```plsql
FUNCTION get_user_access_level(p_user_id NUMBER) RETURN NUMBER
```

—è–∫–∞ –≤—ñ–¥–¥–∞—Å—Ç—å access\_level –¥–ª—è user\_id –Ω–∞ –ø—ñ–¥—Å—Ç–∞–≤—ñ –∑–∞–ø–∏—Å—ñ–≤.

---

### 3Ô∏è‚É£ View –¥–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ

```sql
CREATE OR REPLACE VIEW v_task_user_access AS
SELECT
  t.id AS task_id,
  ac.access_level,
  t.position_id,
  t.department_id,
  t.unit_id
FROM tasks t
JOIN task_access_control ac
  ON (
    (ac.user_id = :P0_USER_ID OR ac.user_id IS NULL)
    AND (ac.position_id = t.position_id OR ac.position_id IS NULL)
    AND (ac.department_id = t.department_id OR ac.department_id IS NULL)
    AND (ac.unit_id = t.unit_id OR ac.unit_id IS NULL)
  )
```

–ü–æ—Ç—ñ–º –¥–µ—â–æ —Å–ø—Ä–æ—Å—Ç–∏—Ç—å –∑–≤—ñ—Ç.

---

## ‚úÖ **–ü—ñ–¥—Å—É–º–æ–∫: —â–æ –≤–∏ –≤—Ä–∞—Ö—É–≤–∞–ª–∏ –¥—É–∂–µ –¥–æ–±—Ä–µ**

‚úî –Ü—î—Ä–∞—Ä—Ö—ñ—á–Ω—ñ—Å—Ç—å –¥–æ—Å—Ç—É–ø—ñ–≤ (user ‚Üí pos ‚Üí dep ‚Üí unit)
‚úî –ì–Ω—É—á–∫—ñ —Ä—ñ–≤–Ω—ñ –¥–æ—Å—Ç—É–ø—É
‚úî –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ signaturerights

---

## üöÄ –ì–æ—Ç–æ–≤–∏–π –ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏:

üëâ SQL –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ + —ñ–Ω–¥–µ–∫—Å—ñ–≤
üëâ PL/SQL —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è access\_level
üëâ –ü—Ä–∏–∫–ª–∞–¥ –∑–∞–ø–∏—Ç—É –¥–ª—è —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–≤—ñ—Ç—É

–ù–∞–ø–∏—à—ñ—Ç—å, —â–æ –≤–∏–±—Ä–∞—Ç–∏! üòä
