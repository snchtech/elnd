üîπ **–ß—É–¥–æ–≤–æ, –¥–∞–≤–∞–π—Ç–µ –ø–æ–±—É–¥—É—î–º–æ –ø—Ä–∏–∫–ª–∞–¥ –∑–∞–ø–∏—Ç—É –¥–ª—è —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–≤—ñ—Ç—É**, —è–∫–∏–π —Ä–µ–∞–ª—ñ–∑—É—î –≤–∞—à—É –∫–æ–Ω—Ü–µ–ø—Ü—ñ—é –¥–æ—Å—Ç—É–ø—ñ–≤ (1, 2, 3 —Ä—ñ–≤–µ–Ω—å) —ñ —ñ–Ω—Ç–µ–≥—Ä—É—î `TASKS`, `TASK_ACCESS_CONTROL`, `SIGNATURERIGHTS`.

---

## ‚úÖ **–ü—Ä–∏–∫–ª–∞–¥ SQL –∑–∞–ø–∏—Ç—É –¥–ª—è –∑–≤—ñ—Ç—É**

```sql
SELECT t.*
FROM tasks t
WHERE EXISTS (
  SELECT 1
  FROM task_access_control ac
  WHERE (
          -- Access Level 1: –±–∞—á–∏—Ç—å —É—Å–µ + –∑–∞–≤–¥–∞–Ω–Ω—è, –¥–µ –≤—ñ–Ω —É—á–∞—Å–Ω–∏–∫ (—á–µ—Ä–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π OR –≤ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–º—É –∑–∞–ø–∏—Ç—ñ)
          ac.access_level = 1
          AND (
              ac.user_id = :P0_USER_ID
              OR (ac.position_id IS NOT NULL AND ac.position_id = :P0_POSITION_ID)
              OR (ac.position_id IS NULL)
          )
        )
     OR (
          -- Access Level 2: —Ñ—ñ–ª—å—Ç—Ä–∏ –ø–æ –ø–æ–ª—è–º
          ac.access_level = 2
          AND (
            (ac.position_id IS NULL OR ac.position_id = :P0_POSITION_ID)
            AND (ac.department_id IS NULL OR ac.department_id = :P0_DEPARTMENT_ID)
            AND (ac.unit_id IS NULL OR ac.unit_id = :P0_UNIT_ID)
          )
          AND (
            ac.user_id IS NULL OR ac.user_id = :P0_USER_ID
          )
        )
     OR (
          -- Access Level 3: –≤–∏–∫–ª—é—á–Ω–æ –∑–∞–≤–¥–∞–Ω–Ω—è –¥–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ñ—ñ–≥—É—Ä—É—î
          ac.access_level = 3
          AND ac.user_id = :P0_USER_ID
        )
  AND ROWNUM = 1  -- –¥–ª—è –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è EXISTS
)
OR EXISTS (
  -- –î–ª—è Access Level 3 —ñ —è–∫ –¥–æ–¥–∞—Ç–∫–æ–≤–∞ —É–º–æ–≤–∞ –¥–ª—è Access Level 1 —Ç–∞ 2
  SELECT 1
  FROM signaturerights sr
  WHERE sr.task_id = t.id
    AND sr.user_id = :P0_USER_ID
    AND sr.status <> 11
);
```

---

## üîë **–ü–æ—è—Å–Ω–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏**

‚úÖ **Access Level 1**

* –ü–æ–≤–µ—Ä—Ç–∞—î –≤—Å—ñ –∑–∞–≤–¥–∞–Ω–Ω—è (–±–µ–∑ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó), —è–∫—â–æ —î –ø—Ä–∞–≤–∏–ª–æ –∑ access\_level = 1 –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ –π–æ–≥–æ –ø–æ–∑–∏—Ü—ñ—ó.
* –î–æ–¥–∞—Ç–∫–æ–≤–æ –≤ OR –¥–æ–¥–∞—î–º–æ signaturerights ‚Äî —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —î —É—á–∞—Å–Ω–∏–∫–æ–º.

‚úÖ **Access Level 2**

* –ü–æ–≤–µ—Ä—Ç–∞—î –∑–∞–≤–¥–∞–Ω–Ω—è, —è–∫—â–æ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å position\_id, department\_id, unit\_id (—è–∫—â–æ –≤–æ–Ω–∏ –≤–∫–∞–∑–∞–Ω—ñ –≤ –ø—Ä–∞–≤–∏–ª—ñ).
* –ú–æ–∂–µ –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ user\_id, —è–∫—â–æ –≤–∏ —è–≤–Ω–æ –≤–∫–∞–∑–∞–ª–∏ –¥–æ—Å—Ç—É–ø –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ user.

‚úÖ **Access Level 3**

* –ü–æ–≤–µ—Ä—Ç–∞—î –∑–∞–≤–¥–∞–Ω–Ω—è, –¥–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —î –≤ signaturerights.

---

## üöÄ **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è**

üëâ –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ ‚Äî —Ü–µ–π –∑–∞–ø–∏—Ç –º–æ–∂–Ω–∞ –≤–∏–Ω–µ—Å—Ç–∏ –≤ **VIEW**, —â–æ–± APEX –ø—Ä–∞—Ü—é–≤–∞–≤ —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç–∏–π select.

üëâ –ú–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ PL/SQL —Ñ—É–Ω–∫—Ü—ñ—é:

```sql
FUNCTION user_has_task_access(p_task_id NUMBER, p_user_id NUMBER) RETURN BOOLEAN
```

—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏:

```sql
WHERE user_has_task_access(t.id, :P0_USER_ID) = TRUE
```

—Ü–µ —Å–ø—Ä–æ—Å—Ç–∏—Ç—å –∑–≤—ñ—Ç.

---

## üí° **–ü—Ä–∏–∫–ª–∞–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –≤ APEX**

–£ –∑–≤—ñ—Ç—ñ:

```sql
SELECT *
FROM (
  <—Ü–µ–π –∑–∞–ø–∏—Ç>
)
```

–∞–±–æ:

```sql
SELECT *
FROM v_user_tasks_for_report
```

—è–∫—â–æ –≤–∏–Ω–µ—Å—Ç–∏ –≤ view.

---

## üöÄ –•–æ—á–µ—Ç–µ:

üëâ –Ø –ø—ñ–¥–≥–æ—Ç—É—é —Ü–µ–π –∑–∞–ø–∏—Ç —è–∫ view?
üëâ –ù–∞–ø–∏—à—É —Ñ—É–Ω–∫—Ü—ñ—é `user_has_task_access`?
üëâ –ó–≥–µ–Ω–µ—Ä—É—é —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è –ø—Ä–∏–∫–ª–∞–¥—É?

–ù–∞–ø–∏—à—ñ—Ç—å ‚Äî –ø—ñ–¥–≥–æ—Ç—É—é! üòä
