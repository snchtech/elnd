üöÄ **–î–∞–≤–∞–π—Ç–µ —Å—Ç–≤–æ—Ä–∏–º–æ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω—É PL/SQL-—Ñ—É–Ω–∫—Ü—ñ—é**, —è–∫–∞:
‚úÖ –≤–∏–∑–Ω–∞—á–∏—Ç—å **access\_level** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ `TASK_ACCESS_CONTROL`
‚úÖ –≤—Ä–∞—Ö—É—î user\_id, position\_id, department\_id, unit\_id
‚úÖ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è –≤ item'–∏ –Ω–∞ global page: `P0_ACCESS_LEVEL`, `P0_ACL_POSITION_ID`, `P0_ACL_DEPARTMENT_ID`, `P0_ACL_UNIT_ID`

---

## ‚úÖ **PL/SQL FUNCTION**

```plsql
CREATE OR REPLACE FUNCTION get_user_access_level (
  p_user_id        NUMBER,
  p_position_id    NUMBER,
  p_department_id  NUMBER,
  p_unit_id        NUMBER
) RETURN NUMBER IS
  l_access_level   NUMBER := 3; -- –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –Ω–∞–π–Ω–∏–∂—á–∏–π —Ä—ñ–≤–µ–Ω—å
BEGIN
  -- –®—É–∫–∞—î–º–æ –Ω–∞–π–±—ñ–ª—å—à –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏–π —Ä—ñ–≤–µ–Ω—å (min access_level)
  SELECT MIN(access_level)
  INTO l_access_level
  FROM task_access_control
  WHERE (user_id = p_user_id OR user_id IS NULL)
    AND (position_id = p_position_id OR position_id IS NULL)
    AND (department_id = p_department_id OR department_id IS NULL)
    AND (unit_id = p_unit_id OR unit_id IS NULL);

  -- –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ item'–∏ –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
  :P0_ACCESS_LEVEL := l_access_level;

  -- –î–ª—è –Ω–∞–æ—á–Ω–æ—Å—Ç—ñ —Ç–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –∑–±–µ—Ä–µ–≥—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—é –∑–Ω–∞–π–¥–µ–Ω—É –∑–≤'—è–∑–∫—É (–¥–ª—è debug –∞–±–æ UI)
  SELECT MAX(NVL(position_id, -1)),
         MAX(NVL(department_id, -1)),
         MAX(NVL(unit_id, -1))
  INTO :P0_ACL_POSITION_ID, :P0_ACL_DEPARTMENT_ID, :P0_ACL_UNIT_ID
  FROM task_access_control
  WHERE (user_id = p_user_id OR user_id IS NULL)
    AND (position_id = p_position_id OR position_id IS NULL)
    AND (department_id = p_department_id OR department_id IS NULL)
    AND (unit_id = p_unit_id OR unit_id IS NULL)
    AND access_level = l_access_level;

  RETURN l_access_level;

EXCEPTION
  WHEN NO_DATA_FOUND THEN
    -- –Ø–∫—â–æ –¥–æ—Å—Ç—É–ø—ñ–≤ –Ω–µ–º–∞—î ‚Äî —Å—Ç–∞–≤–∏–º–æ 3 (—Ç—ñ–ª—å–∫–∏ —Å–≤–æ—ó –∑–∞–≤–¥–∞–Ω–Ω—è)
    :P0_ACCESS_LEVEL := 3;
    :P0_ACL_POSITION_ID := NULL;
    :P0_ACL_DEPARTMENT_ID := NULL;
    :P0_ACL_UNIT_ID := NULL;
    RETURN 3;

  WHEN OTHERS THEN
    -- –£ —Ä–∞–∑—ñ –ø–æ–º–∏–ª–∫–∏ ‚Äî –Ω–∞ –≤—Å—è–∫ –≤–∏–ø–∞–¥–æ–∫ —Ç–µ–∂ –æ–±–º–µ–∂—É—î–º–æ –¥–æ—Å—Ç—É–ø
    :P0_ACCESS_LEVEL := 3;
    :P0_ACL_POSITION_ID := NULL;
    :P0_ACL_DEPARTMENT_ID := NULL;
    :P0_ACL_UNIT_ID := NULL;
    RETURN 3;
END;
/
```

---

## ‚úÖ **–Ø–∫ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —É Before Header (–Ω–∞ Global Page)**

```plsql
DECLARE
  l_level NUMBER;
BEGIN
  l_level := get_user_access_level(
                p_user_id       => NVL(:P0_NEW_USER_ID, :P0_USER_ID),
                p_position_id   => NVL(:P0_NEW_POSITION_ID, :P0_POSITION_ID),
                p_department_id => NVL(:P0_NEW_DEPARTMENT_ID, :P0_DEPARTMENT_ID),
                p_unit_id       => NVL(:P0_NEW_UNIT_ID, :P0_UNIT_ID)
             );
END;
```

üí° **NVL –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –∑–∞–º—ñ—â–µ–Ω–Ω—è** ‚Äî —è–∫—â–æ —î –∑–∞–º—ñ—â–µ–Ω–Ω—è, –±–µ—Ä–µ–º–æ –Ω–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è, —è–∫—â–æ –Ω—ñ ‚Äî —Å–≤–æ—ó.

---

## ‚úÖ **Item'–∏ —è–∫—ñ –≤–∏ –∑–±–µ—Ä—ñ–≥–∞—î—Ç–µ**

| Item                   | –©–æ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è                                |
| ---------------------- | ---------------------------------------------- |
| `P0_ACCESS_LEVEL`      | –≤–∏–∑–Ω–∞—á–µ–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø—É                      |
| `P0_ACL_POSITION_ID`   | –ø–æ–∑–∏—Ü—ñ—è –∑ –¥–æ—Å—Ç—É–ø—É (–¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–±–æ debug) |
| `P0_ACL_DEPARTMENT_ID` | –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∑ –¥–æ—Å—Ç—É–ø—É                          |
| `P0_ACL_UNIT_ID`       | unit –∑ –¥–æ—Å—Ç—É–ø—É                                 |

---

## üöÄ **–Ø–∫ —Ü–µ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –≤ APEX**

1Ô∏è‚É£ –î–æ–¥–∞–π—Ç–µ **Before Header** –ø—Ä–æ—Ü–µ—Å –Ω–∞ Global Page (Page 0).
2Ô∏è‚É£ –í–∏–∫–ª–∏—á—ñ—Ç—å —Ñ—É–Ω–∫—Ü—ñ—é —è–∫ —É –ø—Ä–∏–∫–ª–∞–¥—ñ –≤–∏—â–µ.
3Ô∏è‚É£ –£ –∑–≤—ñ—Ç–∞—Ö —ñ –ª–æ–≥—ñ—Ü—ñ Where –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `:P0_ACCESS_LEVEL` —Ç–∞ —ñ–Ω—à—ñ –∑–Ω–∞—á–µ–Ω–Ω—è.

---

## üí° **–•–æ—á–µ—Ç–µ?**

üëâ –Ø –º–æ–∂—É:

* –ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ —Ç–µ—Å—Ç–æ–≤–∏–π –≤–∏–∫–ª–∏–∫ + –¥–∞–Ω—ñ –¥–ª—è `TASK_ACCESS_CONTROL`;
* –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑ —à–∞–±–ª–æ–Ω–æ–º Where –¥–ª—è –≤–∞—à–æ–≥–æ –∑–≤—ñ—Ç—É –∑ —Ü–∏–º `P0_ACCESS_LEVEL`;
* —Å—Ç–≤–æ—Ä–∏—Ç–∏ View –¥–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ.

–ù–∞–ø–∏—à—ñ—Ç—å! üòä
