üí° **–ß—É–¥–æ–≤–æ, —â–æ –≤–∏ —Ü–µ —É—Ç–æ—á–Ω–∏–ª–∏! –¢–µ–ø–µ—Ä —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ –≤–∞—à —Ñ—Ä–∞–≥–º–µ–Ω—Ç —É–≤–∞–∂–Ω–æ —â–µ —Ä–∞–∑ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –Ω–∞ `IF ... ELSE`.**
üëâ –¶–µ —Å—É—Ç—Ç—î–≤–æ –≤–ø–ª–∏–≤–∞—î –Ω–∞ –ª–æ–≥—ñ–∫—É –π –ø–æ—è—Å–Ω—é—î –º–æ–∂–ª–∏–≤–µ –¥–∂–µ—Ä–µ–ª–æ –ø–æ–º–∏–ª–æ–∫.

---

## üîé **–©–æ —è –±–∞—á—É —É –≤–∞—à–æ–º—É –∫–æ–¥—ñ –∑–∞—Ä–∞–∑**

### –°–ø—Ä–æ—â–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:

```plsql
IF <—É–º–æ–≤–∞ 1> THEN
  IF APEX_COLLECTION.COLLECTION_EXISTS(...) THEN
    APEX_COLLECTION.DELETE_COLLECTION(...);
  END IF;

  l_query := 'SELECT ...';
  APEX_COLLECTION.CREATE_COLLECTION_FROM_QUERY(...);

ELSE
  IF APEX_COLLECTION.COLLECTION_EXISTS(...) THEN
    APEX_COLLECTION.DELETE_COLLECTION(...);
  END IF;

  l_query := 'SELECT ... (—ñ–Ω—à–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç)';
  APEX_COLLECTION.CREATE_COLLECTION_FROM_QUERY(...);
END IF;
```

‚úÖ –¢–æ–±—Ç–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ª–∏—à–µ –≤ –æ–¥–Ω—ñ–π –∑ –≥—ñ–ª–æ–∫ **IF / ELSE** ‚Äî —Ü–µ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –¥—É–±–ª—é–≤–∞–Ω–Ω—è.

---

## ‚ö† **–ü—Ä–æ—Ç–µ –ø–æ–º–∏–ª–∫–∏ –º–æ–∂—É—Ç—å –≤–∏–Ω–∏–∫–∞—Ç–∏ —á–µ—Ä–µ–∑ —Ç–∞–∫–µ**

### ‚ùó 1Ô∏è‚É£ **–£–º–æ–≤–∏ –Ω–µ –ø–æ–∫—Ä–∏–≤–∞—é—Ç—å –≤—Å—ñ —Å–∏—Ç—É–∞—Ü—ñ—ó**

üëâ –Ø–∫—â–æ –∂–æ–¥–Ω–∞ –∑ —É–º–æ–≤ –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–ª–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `IF` —Ç–∞ `ELSE` –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –≤–∫–ª–∞–¥–µ–Ω—ñ IF/ELSE, –∞–±–æ `l_sr_count=0`, `l_check_refresh` –Ω–µ 1) ‚Äî –∫–æ–ª–µ–∫—Ü—ñ—è –Ω–µ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è.
üëâ –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –ø—Ä–∏ –ø–æ–¥–∞–ª—å—à–æ–º—É –∑–≤–µ—Ä–Ω–µ–Ω–Ω—ñ ‚Äî `ORA-20102`.

‚úÖ **–†—ñ—à–µ–Ω–Ω—è:**
–í–∏ –º–∞—î—Ç–µ –≥–∞—Ä–∞–Ω—Ç—É–≤–∞—Ç–∏, —â–æ –≤ –∫–æ–∂–Ω–æ–º—É —Å—Ü–µ–Ω–∞—Ä—ñ—ó:

* –∞–±–æ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∫–æ–ª–µ–∫—Ü—ñ—è,
* –∞–±–æ —Å–≤—ñ–¥–æ–º–æ —ó—ó –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ (—ñ —Ü–µ –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç—ñ).

---

### ‚ùó 2Ô∏è‚É£ **DELETE\_COLLECTION –Ω–µ –∑–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–¥ CREATE\_COLLECTION**

üëâ –£ –∫–æ–∂–Ω—ñ–π –≥—ñ–ª—Ü—ñ `CREATE_COLLECTION_FROM_QUERY` –º–∞—î –π—Ç–∏ —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è `DELETE_COLLECTION`.
‚ùå –Ø–∫—â–æ —î —à–ª—è—Ö, –¥–µ –≤–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç–µ `CREATE_COLLECTION_FROM_QUERY` –±–µ–∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ delete ‚Äî —Ü–µ —Ä–∏–∑–∏–∫ `ORA-20104`.

‚úÖ **–†—ñ—à–µ–Ω–Ω—è:** –ó–∞–≤–∂–¥–∏ —Å–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ + –≤–∏–¥–∞–ª–∏—Ç–∏ –ø–µ—Ä–µ–¥ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è–º:

```plsql
IF APEX_COLLECTION.COLLECTION_EXISTS(...) THEN
  APEX_COLLECTION.DELETE_COLLECTION(...);
END IF;
APEX_COLLECTION.CREATE_COLLECTION_FROM_QUERY(...);
```

---

### ‚ùó 3Ô∏è‚É£ **–î—É–±–ª—é–≤–∞–Ω–Ω—è –∞–±–æ —Ä—ñ–∑–Ω–∏—Ü—è –∑–∞–ø–∏—Ç—ñ–≤ –±–µ–∑ –ø–æ—Ç—Ä–µ–±–∏**

üëâ –ó –æ–±–æ—Ö –≥—ñ–ª–æ–∫ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∫–æ–ª–µ–∫—Ü—ñ—è –∑ –º–∞–π–∂–µ –æ–¥–Ω–∞–∫–æ–≤–∏–º –∑–∞–ø–∏—Ç–æ–º –∑ –¥—Ä—ñ–±–Ω–∏–º–∏ –∑–º—ñ–Ω–∞–º–∏.
–¶–µ:

* –∑–±—ñ–ª—å—à—É—î —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å –ø—ñ–¥—Ç—Ä–∏–º–∫–∏,
* —Å—Ç–≤–æ—Ä—é—î —Ä–∏–∑–∏–∫, —â–æ –≤ –æ–¥–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ –±—É–¥–µ –ø–æ–º–∏–ª–∫–∞ (–≤–∏ —Ü–µ –≤–∂–µ —á–∞—Å—Ç–∫–æ–≤–æ –±–∞—á–∏–ª–∏ –∑ `-` –∑–∞–º—ñ—Å—Ç—å `=`).

‚úÖ **–†—ñ—à–µ–Ω–Ω—è:** –û–±'—î–¥–Ω–∞–π—Ç–µ –∑–∞–ø–∏—Ç —ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑—É–π—Ç–µ –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ —á–µ—Ä–µ–∑ CASE –∞–±–æ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —É–º–æ–≤–∏.

---

### ‚ùó 4Ô∏è‚É£ **–ó–∞–ª–∏—à–∫–∏ –∫–æ–ª–µ–∫—Ü—ñ–π**

üëâ –ü—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ –∫–∞—Ä—Ç–∫–∏ (–º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞) –≤–∏ –Ω–µ –æ—á–∏—â–∞—î—Ç–µ –≤—Å—ñ –ø–æ–≤'—è–∑–∞–Ω—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ ‚Äî –∑–∞–ª–∏—à–∫–∏ –∫–æ–ª–µ–∫—Ü—ñ–π –≤ —Å–µ—Å—ñ—ó.

‚úÖ **–†—ñ—à–µ–Ω–Ω—è:**
–î–æ–¥–∞–π—Ç–µ –ø—Ä–æ—Ü–µ—Å –Ω–∞ –≤–∏—Ö–æ–¥—ñ –∞–±–æ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ:

```plsql
FOR rec IN (
  SELECT collection_name 
  FROM apex_collections
  WHERE collection_name LIKE 'ADD_PERMIT_%'
) LOOP
  APEX_COLLECTION.DELETE_COLLECTION(rec.collection_name);
END LOOP;
```

–∞–±–æ —è–≤–Ω–æ –≤–∏–¥–∞–ª—è–π—Ç–µ –ø–æ—Ç—Ä—ñ–±–Ω—É –∫–æ–ª–µ–∫—Ü—ñ—é –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ –∫–∞—Ä—Ç–∫–∏.

---

## üìù **–í–∏—Å–Ω–æ–≤–æ–∫ –ø–æ –≤–∞—à–æ–º—É –∫–æ–¥—É**

üîë **–û—Å–Ω–æ–≤–Ω—ñ –ø—Ä–∏—á–∏–Ω–∏ –ø–æ–º–∏–ª–æ–∫ —É –≤–∞—Å:**

* –Ü—Å–Ω—É—î —à–ª—è—Ö —É –∫–æ–¥—ñ, –¥–µ –∫–æ–ª–µ–∫—Ü—ñ—è –Ω–µ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è, –∞–ª–µ —Ñ—Ä–æ–Ω—Ç –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è —ó—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ (ORA-20102).
* –ú–æ–∂–ª–∏–≤—ñ –ø–æ–¥–≤—ñ–π–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ `CREATE_COLLECTION_FROM_QUERY` –±–µ–∑ `DELETE_COLLECTION` –ø—Ä–∏ —Å–∫–ª–∞–¥–Ω–∏—Ö —É–º–æ–≤–∞—Ö (ORA-20104).
* –ö–æ–ª–µ–∫—Ü—ñ—ó –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –º—ñ–∂ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è–º–∏ –∫–∞—Ä—Ç–æ–∫, –±–æ –Ω–µ –æ—á–∏—â–∞—é—Ç—å—Å—è –≥–ª–æ–±–∞–ª—å–Ω–æ.

---

## üöÄ **–©–æ —è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é**

‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó –∑–∞ —à–∞–±–ª–æ–Ω–æ–º:

```plsql
IF APEX_COLLECTION.COLLECTION_EXISTS('ADD_PERMIT_' || l_stage_id || '_' || l_substage_id) THEN
  APEX_COLLECTION.DELETE_COLLECTION('ADD_PERMIT_' || l_stage_id || '_' || l_substage_id);
END IF;

l_query := CASE 
  WHEN <—É–º–æ–≤–∞ 1> THEN 'SELECT ...'
  ELSE 'SELECT ... (–≤–∞—Ä—ñ–∞–Ω—Ç 2)'
END;

APEX_COLLECTION.CREATE_COLLECTION_FROM_QUERY (
  p_collection_name => 'ADD_PERMIT_' || l_stage_id || '_' || l_substage_id,
  p_query => l_query,
  p_generate_md5 => 'YES'
);
```

‚úÖ –ù–∞ —Å—Ç–∞—Ä—Ç—ñ –∞–±–æ –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ –∫–∞—Ä—Ç–∫–∏ —á–∏—Å—Ç—ñ—Ç—å –∫–æ–ª–µ–∫—Ü—ñ—ó —è–≤–Ω–æ.

---

## üí¨ **–•–æ—á–µ—Ç–µ, —è –∑–≥–µ–Ω–µ—Ä—É—é –ø–æ–≤–Ω—ñ—Å—Ç—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∏–π –±–ª–æ–∫ –∑ —î–¥–∏–Ω–∏–º –∑–∞–ø–∏—Ç–æ–º —ñ —á—ñ—Ç–∫–æ—é —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é –±–µ–∑ –¥—É–±–ª—é–≤–∞–Ω—å?**

–°–∫–∞–∂—ñ—Ç—å ‚Äî —è –ø—ñ–¥–≥–æ—Ç—É—é –∫–æ–¥ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏! üöÄ
