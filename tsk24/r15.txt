üí° **–ß—É–¥–æ–≤–æ –ø–æ—è—Å–Ω–µ–Ω–æ –∑–∞–≤–¥–∞–Ω–Ω—è! –Ø –ø—ñ–¥–≥–æ—Ç—É–≤–∞–≤ –¥–ª—è –≤–∞—Å —á—ñ—Ç–∫–∏–π –ø–ª–∞–Ω —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó + –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç PL/SQL-–∫–æ–¥—É, —â–æ–± —É—Å–µ –ø—Ä–∞—Ü—é–≤–∞–ª–æ –∫–æ—Ä–µ–∫—Ç–Ω–æ.**

---

## üöÄ **–©–æ —Ç—Ä–µ–±–∞ –∑—Ä–æ–±–∏—Ç–∏**

‚úÖ –í –∫—É—Ä—Å–æ—Ä `confirm_list` –¥–æ–¥–∞—Ç–∏:

* `l_subtask_id`
* `l_task_mode`

‚úÖ –ü—Ä–∏ –ø–æ–±—É–¥–æ–≤—ñ HTML:

* –Ø–∫—â–æ `stage = 4` ‚Üí –¥–æ–¥–∞—î–º–æ –±–ª–æ–∫ –∑ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è–º (—è–∫—â–æ –≤–æ–Ω–æ —î).

‚úÖ –û—Ç—Ä–∏–º–∞—Ç–∏ —Ç–µ–∫—Å—Ç –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è:

* –Ø–∫—â–æ `l_task_mode = 0` ‚Üí –∑ `TASK_SUBTASKS`
* –Ø–∫—â–æ `l_task_mode = 1` ‚Üí –∑ `TASK_SUBTASK_TEMPLATES`

---

## ‚ö° **–ü–µ—Ä–µ–ø–∏—Å–∞–Ω–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏**

```plsql
-- FETCH –∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏ –ø–æ–ª—è–º–∏
FETCH confirm_list INTO 
  l_list_id, 
  l_list_position, 
  l_list_department, 
  l_list_unit,
  l_sg_history_id, 
  l_sg_lastname, 
  l_sg_firstname, 
  l_sg_fth, 
  l_sg_posada, 
  l_sg_department, 
  l_sg_date,
  l_subtask_id,     -- –¥–æ–¥–∞–π—Ç–µ —É SELECT –∫—É—Ä—Å–æ—Ä–∞
  l_task_mode;      -- –¥–æ–¥–∞–π—Ç–µ —É SELECT –∫—É—Ä—Å–æ—Ä–∞

EXIT WHEN confirm_list%NOTFOUND;

-- –§–æ—Ä–º—É–≤–∞–Ω–Ω—è dep/unit
IF l_list_department IS NOT NULL AND l_list_unit IS NOT NULL THEN
  l_dep_unit := '<span class="l-dep-unit">(' || l_list_department || '/' || l_list_unit || ')</span>';
ELSIF l_list_department IS NOT NULL THEN
  l_dep_unit := '<span class="l-dep-unit">(' || l_list_department || ')</span>';
ELSIF l_list_unit IS NOT NULL THEN
  l_dep_unit := '<span class="l-dep-unit">(' || l_list_unit || ')</span>';
ELSE
  l_dep_unit := '';
END IF;

-- –Ø–∫—â–æ –Ω–µ–º–∞—î position/department/unit, –∞–ª–µ —î tab_no ‚Äî —Ç—è–≥–Ω–µ–º–æ –∑ USERS
IF l_list_position IS NULL AND l_list_department IS NULL AND l_list_unit IS NULL AND l_tab_no IS NOT NULL THEN
  BEGIN
    SELECT u.POSITION_NAME, d.DEPARTMENT_NAME
    INTO l_user_pos, l_user_dep
    FROM USERS u
    LEFT JOIN DEPARTMENT d ON d.ID = u.DEPARTMENT_ID
    WHERE u.TAB_NO = l_tab_no;
  EXCEPTION
    WHEN NO_DATA_FOUND THEN
      l_user_pos := '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ—Å–∞–¥–∞';
      l_user_dep := '–ù–µ–≤—ñ–¥–æ–º–∏–π –≤—ñ–¥–¥—ñ–ª';
  END;
ELSE
  l_user_pos := l_list_position;
  l_user_dep := NULL; -- –≤–∂–µ –≤–∏–≤–µ–ª–∏ —á–µ—Ä–µ–∑ l_dep_unit
END IF;

-- –ì–æ—Ç—É—î–º–æ —Ç–µ–∫—Å—Ç –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
DECLARE
  l_subtask_content VARCHAR2(4000);
BEGIN
  l_subtask_content := '';
  IF l_current_stage = 4 AND l_subtask_id IS NOT NULL THEN
    IF l_task_mode = 0 THEN
      SELECT subtask_content INTO l_subtask_content 
      FROM TASK_SUBTASKS 
      WHERE id = l_subtask_id;
    ELSIF l_task_mode = 1 THEN
      SELECT subtask_content INTO l_subtask_content 
      FROM TASK_SUBTASK_TEMPLATES 
      WHERE id = l_subtask_id;
    END IF;
  END IF;
EXCEPTION
  WHEN NO_DATA_FOUND THEN
    l_subtask_content := '';
END;

-- –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è HTML
HTP.P('<div class="confirm-cart-item">');
HTP.P('<div class="c-cart-signer">');

IF l_list_position IS NOT NULL OR l_list_department IS NOT NULL OR l_list_unit IS NOT NULL THEN
  HTP.P('<span class="l-list-position">' || NVL(l_list_position, '') || '</span>' || NVL(l_dep_unit, ''));
ELSE
  HTP.P('<span class="l-list-position">' || l_user_pos || '</span><span class="l-dep-unit">(' || l_user_dep || ')</span>');
END IF;

-- –î–æ–¥–∞—î–º–æ –±–ª–æ–∫ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
IF l_current_stage = 4 AND l_subtask_content IS NOT NULL THEN
  HTP.P('<span class="sbtsk-ttl">–î–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:</span> <span class="sbtsk-txt">' || l_subtask_content || '</span>');
END IF;

HTP.P('</div>'); -- –∑–∞–∫—Ä–∏—Ç—Ç—è c-cart-signer
```

---

## ‚úÖ **–©–æ –∑–º—ñ–Ω–∏–ª–æ—Å—å**

‚úÖ –î–æ–¥–∞–Ω–æ `l_subtask_id`, `l_task_mode` —É –∫—É—Ä—Å–æ—Ä + FETCH.
‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –æ–∫—Ä–µ–º–∏–π –±–ª–æ–∫ –¥–ª—è –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è (—è–∫—â–æ stage = 4 —ñ —î –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è).
‚úÖ –ë–ª–æ–∫ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –±–µ–∑–ø–µ—á–Ω–∏–π (–≤–∏–Ω—è—Ç–∫–∏ –æ–±—Ä–æ–±–ª–µ–Ω—ñ).
‚úÖ HTML —á—ñ—Ç–∫–æ –¥–æ–¥–∞—î —Ä—è–¥–æ–∫ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –ª–∏—à–µ —Ç–∞–º, –¥–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ.

---

## üí° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è**

üìå –ù–µ –∑–∞–±—É–¥—å—Ç–µ:

* –£ –∫—É—Ä—Å–æ—Ä—ñ `confirm_list` –¥–æ–¥–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ `c`-–ø–æ–ª—è –∑ APEX\_COLLECTION —É `FETCH`.
* –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ –¥–∞–Ω—ñ –ø—Ä–æ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è —î –≤ –∫–æ–ª–µ–∫—Ü—ñ—ó –∞–±–æ –¥–æ–ø–æ–≤–Ω–∏—Ç–∏ —ó—Ö –ø—Ä–∏ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó.

---

## üí¨ **–•–æ—á–µ—Ç–µ, —è –∑–≥–µ–Ω–µ—Ä—É—é –ø–æ–≤–Ω–∏–π –±–ª–æ–∫ —ñ–∑ SELECT –¥–ª—è –∫—É—Ä—Å–æ—Ä–∞ –π –≥–æ—Ç–æ–≤–∏–º HTML –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏?**

–ù–∞–ø–∏—à—ñ—Ç—å ‚Äî –ø—ñ–¥–≥–æ—Ç—É—é –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —É –≤–∞—à –∫–æ–¥! üöÄ
