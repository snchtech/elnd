üí° **–î–æ–±—Ä–µ! –Ø –ø—ñ–¥–≥–æ—Ç—É–≤–∞–≤ –¥–ª—è —Ç–µ–±–µ –æ–Ω–æ–≤–ª–µ–Ω–∏–π –∑–∞–ø–∏—Ç, —è–∫–∏–π:**
‚úÖ –î—ñ—Å—Ç–∞—î `TASK_CONTENT` (–ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è/–ø—ñ–¥—à–∞–±–ª–æ–Ω–∏) –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ `SR_TASK_MODE`.
‚úÖ –ê–∫—É—Ä–∞—Ç–Ω–æ –≤–±—É–¥–æ–≤–∞–Ω–∏–π —É —Ç–≤–æ—é –≤–∏–±—ñ—Ä–∫—É.
‚úÖ –ü—Ä–∞—Ü—é—î –∑ `sr.SUBTASK_ID`.

---

## üöÄ **–û–Ω–æ–≤–ª–µ–Ω–∏–π SQL**

```sql
SELECT 
  p1.SPR_DOLZNOST,
  sd.SHORT_NAME,
  un.NAME,
  sr.STAGES_ID,
  sr.SORT_ORDER,
  sr.TASK_ID,
  sr.USER_TABNO,
  sr.POSITION_ID,
  sr.DEPARTMENT_ID,
  sr.UNIT_ID,
  sr.ID AS SRID,
  ht.ID AS HTID,
  p.FAMILIA AS L_NAME,
  p.IMYA AS F_NAME,
  p.OTCHESTVO AS M_NAME,
  p.SPR_DOLZNOST AS POSADA,
  p.TSEH_SHORT AS DEPART,
  TO_CHAR(ht.SDATE, 'dd.mm.yyyy hh24:mi:ss') AS SIGN_DATE,
  sr.SUBTASK_ID,
  sr.SR_TASK_MODE,
  -- –í–∏—Ç—è–≥ TASK_CONTENT
  CASE 
    WHEN sr.SR_TASK_MODE = 0 THEN 
      (SELECT t.SUBTASK_CONTENT 
       FROM TASK_SUBTASKS t 
       WHERE t.ID = sr.SUBTASK_ID)
    WHEN sr.SR_TASK_MODE = 1 THEN 
      (SELECT t.SUBTASK_CONTENT 
       FROM TASK_SUBTASK_TEMPLATES t 
       WHERE t.ID = sr.SUBTASK_ID)
    ELSE NULL
  END AS TASK_CONTENT
FROM 
  TaskTracker.SIGNATURERIGHTS@TO_TASKTRACKER10 sr
LEFT JOIN 
  TaskTracker.Dict_App_Confirm_List@TO_TASKTRACKER10 d
  ON sr.Stages_Id = d.ID
LEFT JOIN 
  kbs.PERSONAL@TO_TASKTRACKER10 p1
  ON p1.DOLZNOST = sr.Position_Id
LEFT JOIN 
  kbs.SPR_DEPARTMENT@TO_TASKTRACKER10 sd
  ON sd.ID = sr.DEPARTMENT_ID
LEFT JOIN 
  TaskTracker.DICT_UNIT@TO_TASKTRACKER10 un
  ON sr.UNIT_ID = un.ID
LEFT JOIN 
  TaskTracker.SIGNATUREHISTORY@TO_TASKTRACKER10 ht
  ON sr.ID = ht.SIGNRIGHT_ID
LEFT JOIN 
  kbs.PERSONAL@TO_TASKTRACKER10 p
  ON p.TAB_NO = ht.SIGNER_BY
WHERE 
  sr.TASK_ID = :l_source_id
  AND d.PARENT_STAGE_ID IS NOT NULL
  AND sr.STAGES_ID = :l_substage_id
  AND p.PRIZNAK IS NULL
  AND p1.PRIZNAK IS NULL
  AND sd.DATE_END IS NULL
  AND sd.SPRDEPARTMENT_ID IS NULL
ORDER BY 
  d.ID, sr.STAGES_ID, sr.SORT_ORDER
```

---

## ‚ö° **–ö–ª—é—á–æ–≤—ñ –∑–º—ñ–Ω–∏**

‚úÖ –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ `TASK_CONTENT`, —è–∫–µ –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `CASE`.
‚úÖ –£–º–æ–≤–Ω–æ –ø—ñ–¥—Ç—è–≥—É—î—Ç—å—Å—è –∑ `TASK_SUBTASKS` –∞–±–æ `TASK_SUBTASK_TEMPLATES`.
‚úÖ –ê–∫—É—Ä–∞—Ç–Ω–æ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ —É —Ç–≤—ñ–π –∑–∞–ø–∏—Ç ‚Äî –±–µ–∑ –∑–∞–π–≤–∏—Ö –≥—Ä—É–ø—É–≤–∞–Ω—å (–±–æ —Ç–µ–ø–µ—Ä `GROUP BY` –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω, —è–∫—â–æ –Ω–µ–º–∞—î –∞–≥—Ä–µ–≥–∞—Ü—ñ–π).

---

## üí° **–ü—Ä–∏–º—ñ—Ç–∫–∏**

‚ö† **–Ø–∫—â–æ —É —Ç–µ–±–µ –±—É–ª–∏ –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó (SUM, COUNT) ‚Äî —Ç—Ä–µ–±–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ `GROUP BY` —ñ –≤—Ä–∞—Ö—É–≤–∞—Ç–∏ `TASK_CONTENT` –≤ –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —á–µ—Ä–µ–∑ MAX).**
‚ö† **–ü–µ—Ä–µ–≤—ñ—Ä, —á–∏ —î —ñ–Ω–¥–µ–∫—Å–∏ –Ω–∞ `TASK_SUBTASKS.ID` —Ç–∞ `TASK_SUBTASK_TEMPLATES.ID` –¥–ª—è —à–≤–∏–¥–∫–æ—ó —Ä–æ–±–æ—Ç–∏ –ø—ñ–¥–∑–∞–ø–∏—Ç—ñ–≤.**

---

## üí¨ **–•–æ—á–µ—à, —â–æ–± —è –ø—ñ–¥–≥–æ—Ç—É–≤–∞–≤ —Ü–µ–π –∑–∞–ø–∏—Ç —É –≤–∏–≥–ª—è–¥—ñ –∫–æ–¥—É –¥–ª—è APEX Collection –∞–±–æ PL/SQL –±–ª–æ–∫—É?**

–ù–∞–ø–∏—à–∏ ‚Äî —è –∑–≥–µ–Ω–µ—Ä—É—é –ø–æ–≤–Ω—ñ—Å—Ç—é –≥–æ—Ç–æ–≤–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç! üöÄ
