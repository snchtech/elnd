üí° **–î—É–∂–µ –≥—Ä–∞–º–æ—Ç–Ω–æ —Å—Ñ–æ—Ä–º—É–ª—å–æ–≤–∞–Ω–æ –∑–∞–≤–¥–∞–Ω–Ω—è, —ñ —á—É–¥–æ–≤–æ, —â–æ —Ç–∏ –¥—É–º–∞—î—à –ø—Ä–æ –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å —ñ —á–∏—Å—Ç–æ—Ç—É —Å—Ç—Ä—É–∫—Ç—É—Ä–∏! –î–∞–≤–∞–π —Ä–æ–∑–±–µ—Ä–µ–º–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç —ñ –∑–∞–ø—Ä–æ–ø–æ–Ω—É—é –≥–æ—Ç–æ–≤–∏–π DDL.**

---

## üöÄ **–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ—Ç–æ—á–Ω–æ—ó —Å—Ö–µ–º–∏**

üëâ –í–æ–Ω–∞ –ø–µ—Ä–µ–¥–±–∞—á–∞–ª–∞ **—Å—Ç–∞—Ç–∏—á–Ω–µ –∑–∞–º—ñ—â–µ–Ω–Ω—è** ‚Äî –æ–¥–∏–Ω –∑–∞–ø–∏—Å = –æ–¥–Ω–µ –∞–∫—Ç–∏–≤–Ω–µ –∑–∞–º—ñ—â–µ–Ω–Ω—è.
üëâ –ê —Ç–µ–ø–µ—Ä –ø–æ—Ç—Ä—ñ–±–Ω–æ:
‚úÖ –ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤–µ –∑–∞–º—ñ—â–µ–Ω–Ω—è (—Ä—ñ–∑–Ω—ñ –ø–µ—Ä—ñ–æ–¥–∏).
‚úÖ –§—ñ–∫—Å—É–≤–∞—Ç–∏ **—á–∞—Å –ø–æ—á–∞—Ç–∫—É —Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è** (–∞ –Ω–µ —Ç—ñ–ª—å–∫–∏ –¥–∞—Ç—É).
‚úÖ –ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞–º—ñ—â–µ–Ω–Ω—è –Ω–µ —Ç—ñ–ª—å–∫–∏ –ø–æ –ª—é–¥–∏–Ω—ñ, –∞–ª–µ –π –ø–æ —Ä–æ–ª—ñ (posada / department / unit).

---

## üí° **–ü—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥**

### 1Ô∏è‚É£ **–û—Å–Ω–æ–≤–Ω–∞ —Ç–∞–±–ª–∏—Ü—è**

```sql
CREATE TABLE user_substitution (
  id                 NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  tab_no_original     NUMBER,                -- –∫–æ–≥–æ –∑–∞–º—ñ—â–∞—é—Ç—å (–º–æ–∂–µ –±—É—Ç–∏ NULL –ø—Ä–∏ –∑–∞–º—ñ—â–µ–Ω–Ω—ñ –ø–æ—Å–∞–¥–∏)
  username_original   VARCHAR2(100),         -- –¥–ª—è –∫–µ—à—É (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
  tab_no_replacer     NUMBER NOT NULL,       -- —Ö—Ç–æ –∑–∞–º—ñ—â–∞—î
  position_id         NUMBER,                -- —è–∫—â–æ –∑–∞–º—ñ—â–µ–Ω–Ω—è –ø–æ –ø–æ—Å–∞–¥—ñ (optional)
  department_id       NUMBER,                -- —è–∫—â–æ –∑–∞–º—ñ—â–µ–Ω–Ω—è –ø–æ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É
  unit_id             NUMBER,                -- —è–∫—â–æ –∑–∞–º—ñ—â–µ–Ω–Ω—è –ø–æ unit
  date_start          DATE DEFAULT SYSDATE,  -- –¥–∞—Ç–∞ + —á–∞—Å –ø–æ—á–∞—Ç–∫—É –∑–∞–º—ñ—â–µ–Ω–Ω—è
  date_end            DATE,                  -- –¥–∞—Ç–∞ + —á–∞—Å –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è
  created_by          VARCHAR2(100),
  note                VARCHAR2(4000)
);
```

‚úÖ `tab_no_original` + `position_id` + `department_id` + `unit_id` ‚Üí —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∞ —Å—Ö–µ–º–∞:

* —è–∫—â–æ `tab_no_original` –ù–ï NULL ‚Üí –∑–∞–º—ñ—â–µ–Ω–Ω—è –ª—é–¥–∏–Ω–∏.
* —è–∫—â–æ `tab_no_original` NULL ‚Üí –∑–∞–º—ñ—â–µ–Ω–Ω—è –ø–æ –ø–æ—Å–∞–¥—ñ / –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É / unit.

---

### 2Ô∏è‚É£ **–î–æ–¥–∞–π —ñ–Ω–¥–µ–∫—Å–∏ –¥–ª—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ**

```sql
CREATE INDEX idx_subst_active
ON user_substitution (tab_no_original, position_id, department_id, unit_id, date_start, date_end);

CREATE INDEX idx_subst_replacer
ON user_substitution (tab_no_replacer, date_start, date_end);
```

üëâ –¶–µ –¥–æ–∑–≤–æ–ª–∏—Ç—å —à–≤–∏–¥–∫–æ —à—É–∫–∞—Ç–∏ –∑–∞–º—ñ—â–µ–Ω–Ω—è –¥–ª—è:

* –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
* –ø–æ—Å–∞–¥–∏ / –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É
* –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É

---

### 3Ô∏è‚É£ **–ü—ñ–¥ —á–∞—Å —Ä–æ–±–æ—Ç–∏**

üëâ –õ–æ–≥—ñ–∫–∞ –Ω–∞ —Ä—ñ–≤–Ω—ñ –∑–∞–ø–∏—Ç—ñ–≤:

```sql
WHERE
(
  (tab_no_original = :user_tabno)
  OR
  (tab_no_original IS NULL AND position_id = :pos_id AND department_id = :dep_id AND unit_id = :unit_id)
)
AND :current_date BETWEEN date_start AND NVL(date_end, :current_date)
```

‚úÖ –î–∞—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–µ –∑–∞–º—ñ—â–µ–Ω–Ω—è –ø–æ –ª—é–¥–∏–Ω—ñ –∞–±–æ –ø–æ —Ä–æ–ª—ñ.

---

## ‚ö° **–ß–æ–º—É —Ü–µ –∫—Ä–∞—â–µ**

‚úÖ –ì–Ω—É—á–∫–æ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤—Å—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó (–ª—é–¥–∏–Ω–∞ / —Ä–æ–ª—å / –∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω–æ).
‚úÖ –ú–æ–∂–Ω–∞ —Ä–æ–∑—à–∏—Ä—é–≤–∞—Ç–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–æ–¥–∞—Ç–∏ –∫–æ–ª–æ–Ω–∫—É –¥–ª—è —Ä–æ–ª–µ–π).
‚úÖ –ü—Ä–æ—Å—Ç–∞ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è.

---

## üî• **–ü—Ä–∏–∫–ª–∞–¥ –∑–∞–ø–∏—Ç—É –¥–ª—è —Ä–æ–±–æ—Ç–∏ –¥–æ–¥–∞—Ç–∫—É**

```sql
SELECT *
FROM user_substitution
WHERE 
(
  (tab_no_original = :target_tab_no)
  OR
  (tab_no_original IS NULL AND position_id = :pos_id AND department_id = :dep_id AND unit_id = :unit_id)
)
AND :current_date BETWEEN date_start AND NVL(date_end, :current_date)
ORDER BY date_start DESC;
```

---

## üí¨ **–•–æ—á–µ—à, —â–æ–± —è –ø—ñ–¥–≥–æ—Ç—É–≤–∞–≤ –≥–æ—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ –∑ —É—Å—ñ–º–∞ —ñ–Ω–¥–µ–∫—Å–∞–º–∏ –∞–±–æ –ø—Ä–∏–∫–ª–∞–¥ –ø–∞–∫–µ—Ç–∞ –¥–ª—è —Ä–æ–±–æ—Ç–∏ —ñ–∑ –∑–∞–º—ñ—â–µ–Ω–Ω—è–º–∏?**

–ù–∞–ø–∏—à–∏ ‚Äî —è –∑—Ä–æ–±–ª—é! üöÄ
