üí° **–ß—É–¥–æ–≤–æ! –î–∞–≤–∞–π –æ–Ω–æ–≤–∏–º–æ —Ç–≤—ñ–π PL/SQL-–∫–æ–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –Ω–æ–≤–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Ç–∞–±–ª–∏—Ü—ñ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –¥—ñ–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç + —á–∞—Å—É.
–Ø –æ–¥—Ä–∞–∑—É –∑—Ä–æ–±–ª—é –π–æ–≥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –Ω–∞–¥—ñ–π–Ω–∏–º –¥–ª—è —Ä–æ–±–æ—Ç–∏ –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ.**

---

## üöÄ **–û–Ω–æ–≤–ª–µ–Ω–∏–π PL/SQL –¥–ª—è Before Header –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ**

```plsql
DECLARE
  l_tab_no_original   NUMBER;
  l_username_original VARCHAR2(100);
  l_position_id       NUMBER;
  l_department_id     NUMBER;
  l_unit_id           NUMBER;
BEGIN
  -- –®—É–∫–∞—î–º–æ –∞–∫—Ç–∏–≤–Ω–µ –∑–∞–º—ñ—â–µ–Ω–Ω—è –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (replacer)
  SELECT tab_no_original, username_original
  INTO l_tab_no_original, l_username_original
  FROM user_substitution
  WHERE tab_no_replacer = :P0_USER_ID
    AND SYSDATE BETWEEN date_start AND NVL(date_end, SYSDATE + 1)
    AND ROWNUM = 1;

  -- –ó–∞–ø–∏—Å—É—î–º–æ –¥–∞–Ω—ñ –∑–∞–º—ñ—â—É–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ item
  :P0_NEW_USER_ID := l_tab_no_original;
  :P0_NEW_USERNAME := l_username_original;

  -- –í–∏—Ç—è–≥—É—î–º–æ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ –∑ USERS
  SELECT position_id, department_id, unit_id
  INTO :P0_NEW_POSITION_ID, :P0_NEW_DEPARTMENT_ID, :P0_NEW_UNIT_ID
  FROM users
  WHERE tab_no = l_tab_no_original;

EXCEPTION
  WHEN NO_DATA_FOUND THEN
    -- –ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–º—ñ—â–µ–Ω–Ω—è ‚Äî –æ–±–Ω—É–ª—è—î–º–æ –≤—Å—ñ item
    :P0_NEW_USER_ID := NULL;
    :P0_NEW_USERNAME := NULL;
    :P0_NEW_POSITION_ID := NULL;
    :P0_NEW_DEPARTMENT_ID := NULL;
    :P0_NEW_UNIT_ID := NULL;
END;
```

---

## üîë **–©–æ –∑–º—ñ–Ω–∏–ª–æ—Å—å**

‚úÖ –£–º–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∑–∞–º—ñ—â–µ–Ω–Ω—è:

```sql
SYSDATE BETWEEN date_start AND NVL(date_end, SYSDATE + 1)
```

üëâ –ü—ñ–¥—Ç—Ä–∏–º—É—î –≤—ñ–¥–∫—Ä–∏—Ç—ñ –∑–∞–º—ñ—â–µ–Ω–Ω—è (–±–µ–∑ `date_end`).
üëâ –í—Ä–∞—Ö–æ–≤—É—î —è–∫ –¥–∞—Ç—É, —Ç–∞–∫ —ñ —á–∞—Å (–±–æ `SYSDATE` –º—ñ—Å—Ç–∏—Ç—å —ñ —á–∞—Å).

‚úÖ –ü—ñ–¥—Ç—è–≥—É—î—Ç—å—Å—è –ø–æ–≤–Ω–∏–π –Ω–∞–±—ñ—Ä –¥–∞–Ω–∏—Ö –∑ `USERS`.
‚úÖ –í—Å–µ –æ–±–≥–æ—Ä–Ω—É—Ç–æ –≤ `EXCEPTION`, —â–æ–± –Ω–µ –±—É–ª–æ –ø–æ–º–∏–ª–æ–∫ –ø—Ä–∏ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –∑–∞–º—ñ—â–µ–Ω–Ω—è.

---

## ‚ö° **–Ø–∫ –ø—Ä–∞—Ü—é—î**

üëâ –ü—Ä–∏ –≤—Ö–æ–¥—ñ:

* –Ø–∫—â–æ —î –∞–∫—Ç–∏–≤–Ω–µ –∑–∞–º—ñ—â–µ–Ω–Ω—è ‚Äî –ø—ñ–¥—Å—Ç–∞–≤–ª—è—î—Ç—å—Å—è –∑–∞–º—ñ—â—É–≤–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á.
* –Ø–∫—â–æ –Ω–µ–º–∞—î ‚Äî item –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –ø—É—Å—Ç–∏–º–∏.

üëâ –ù–∞–¥–∞–ª—ñ –¥–æ–¥–∞—Ç–æ–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î:

* **:P0\_NEW\_USER\_ID** –∑–∞–º—ñ—Å—Ç—å **:P0\_USER\_ID** (—è–∫—â–æ —î –∑–∞–º—ñ—â–µ–Ω–Ω—è).

---

## üí° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó**

‚úÖ **–Ü–Ω–¥–µ–∫—Å –¥–ª—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ**:

```sql
CREATE INDEX idx_user_subst_replacer_dates
ON user_substitution (tab_no_replacer, date_start, date_end);
```

‚úÖ –Ø–∫—â–æ —Ö–æ—á–µ—à —â–µ —à–≤–∏–¥—à–µ ‚Äî –¥–æ–¥–∞—Ç–∏ –∫–æ–ª–æ–Ω–∫—É `is_active` –∑ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–º –≤–∏–≥–ª—è–¥–æ–º –∞–±–æ –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–æ —É –≤‚Äô—é—Ö—É (–∞–ª–µ —Ü–µ –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ).

---

## üí¨ **–•–æ—á–µ—à, —â–æ–± —è –ø—ñ–¥–≥–æ—Ç—É–≤–∞–≤:**

* SQL –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—É?
* –ü—Ä–∏–∫–ª–∞–¥ –≤‚Äô—é—Ö–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –∑–∞–º—ñ—â–µ–Ω–Ω—è–º–∏?
* –ü—Ä–∏–∫–ª–∞–¥ —è–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ \:P0\_NEW\_USER\_ID —É —Ç–≤–æ—ó—Ö –∑–∞–ø–∏—Ç–∞—Ö?

–ù–∞–ø–∏—à–∏ ‚Äî —è –∑–≥–µ–Ω–µ—Ä—É—é! üöÄ
