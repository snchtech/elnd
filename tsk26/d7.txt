üí° **–û—Å—å —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π SQL, —è–∫–∏–π –ø–æ–≤–Ω—ñ—Å—Ç—é –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Ç–≤–æ—ó–º –≤–∏–º–æ–≥–∞–º –¥–ª—è Access Level 1, 2, 3. –Ø –ø—Ä–∏–±—Ä–∞–≤ –∑–∞–π–≤—ñ –≥–ª–æ–±–∞–ª—å–Ω—ñ —É–º–æ–≤–∏ –¥–ª—è level 1 —Ç–∞ –∑–±–µ—Ä—ñ–≥ –ª–æ–≥—ñ–∫—É –¥–ª—è —ñ–Ω—à–∏—Ö —Ä—ñ–≤–Ω—ñ–≤.**

---

## üöÄ **–§—ñ–Ω–∞–ª—å–Ω–∏–π SQL**

```sql
SELECT t.*
FROM tasks t
WHERE EXISTS (
  SELECT 1
  FROM task_access_control ac
  WHERE 
    (
      -- Access Level 1: —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –ø—Ä–∞–≤–∏–ª–æ —è–≤–Ω–æ –≤–∫–∞–∑–∞–Ω–µ –¥–ª—è user_id –∞–±–æ position_id
      ac.access_level = 1
      AND (
        ac.user_id = :P0_USER_ID
        OR ac.position_id = :P0_POSITION_ID
      )
    )
    OR
    (
      -- Access Level 2: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ –ø–æ–ª—è–º
      ac.access_level = 2
      AND (
        (ac.position_id IS NULL OR ac.position_id = :P0_POSITION_ID)
        AND (ac.department_id IS NULL OR ac.department_id = :P0_DEPARTMENT_ID)
        AND (ac.unit_id IS NULL OR ac.unit_id = :P0_UNIT_ID)
      )
      AND (
        ac.user_id IS NULL OR ac.user_id = :P0_USER_ID
      )
    )
    OR
    (
      -- Access Level 3: —è–∫—â–æ —è–≤–Ω–æ –≤–∫–∞–∑–∞–Ω–æ user_id (—Ö–æ—á–∞ –æ—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ –¥–ª—è level 3 —á–µ—Ä–µ–∑ signaturerights –æ–∫—Ä–µ–º–æ)
      ac.access_level = 3
      AND ac.user_id = :P0_USER_ID
    )
    AND t.id = ac.task_id  -- —è–∫—â–æ task_id —î –≤ task_access_control (—è–∫—â–æ —É —Ç–µ–±–µ task_id —Ç–∞–º –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è)
    AND ROWNUM = 1
)
OR EXISTS (
  -- Access Level 3 —á–µ—Ä–µ–∑ signaturerights –∞–±–æ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –¥–æ—Å—Ç—É–ø
  SELECT 1
  FROM signaturerights sr
  WHERE sr.task_id = t.id
    AND sr.user_id = :P0_USER_ID
    AND sr.status <> 11
);
```

---

## üîë **–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ**

‚úÖ `Access Level 1` ‚Äî –ø—Ä–∞–≤–∏–ª–æ —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –ª–∏—à–µ —è–∫—â–æ user\_id –∞–±–æ position\_id —è–≤–Ω–æ –≤–∫–∞–∑–∞–Ω—ñ.
‚úÖ `Access Level 2` ‚Äî –≥–Ω—É—á–∫–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø–æ –ø–æ–ª—è–º.
‚úÖ `Access Level 3` ‚Äî OR EXISTS –ø–æ signaturerights –≥–∞—Ä–∞–Ω—Ç—É—î –¥–æ—Å—Ç—É–ø, —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —î —É—á–∞—Å–Ω–∏–∫–æ–º.

üëâ **–Ø–∫—â–æ —É —Ç–µ–±–µ –≤ `task_access_control` –Ω–µ–º–∞—î –ø–æ–ª—è `task_id`, –ø—Ä–∏–±–µ—Ä–∏ —Ä—è–¥–æ–∫**

```sql
AND t.id = ac.task_id
```

—ñ –∑–≤ º—è–∑–æ–∫ –∑–∞–±–µ–∑–ø–µ—á—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∑–∞ –ª–æ–≥—ñ–∫–æ—é —Ä—ñ–≤–Ω—ñ–≤ –¥–æ—Å—Ç—É–ø—É + signaturerights.

---

## ‚ö° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è**

‚úÖ –î–æ–¥–∞–π —ñ–Ω–¥–µ–∫—Å–∏ –Ω–∞:

```sql
(task_id) —É signaturerights
(user_id) —É signaturerights
(user_id, position_id, department_id, unit_id, access_level) —É task_access_control
```

—â–æ–± –∑–∞–ø–∏—Ç –ø—Ä–∞—Ü—é–≤–∞–≤ —à–≤–∏–¥–∫–æ.

---

## üí¨ **–•–æ—á–µ—à, —â–æ–± —è –ø—ñ–¥–≥–æ—Ç—É–≤–∞–≤ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ –∞–±–æ —à–∞–±–ª–æ–Ω view –¥–ª—è —Ü—å–æ–≥–æ –∑–∞–ø–∏—Ç—É?**

–ù–∞–ø–∏—à–∏ ‚Äî —è –∑–≥–µ–Ω–µ—Ä—É—é! üöÄ
