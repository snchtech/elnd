üí° **–î—É–∂–µ —á—ñ—Ç–∫–æ —Å—Ñ–æ—Ä–º—É–ª—å–æ–≤–∞–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è! –î–∞–≤–∞–π —è –æ–¥—Ä–∞–∑—É –¥–∞–º –≥–æ—Ç–æ–≤–µ —Ä—ñ—à–µ–Ω–Ω—è, —è–∫–µ –¥–æ–∑–≤–æ–ª–∏—Ç—å —Ç–æ–±—ñ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∑–±–µ—Ä–µ–≥—Ç–∏ —ñ—Å–Ω—É—é—á—É –ª–æ–≥—ñ–∫—É –±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É, —ñ –±—É–¥–µ –≥–Ω—É—á–∫–æ –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ —Ä–µ–∂–∏–º –∑–∞–º—ñ—â–µ–Ω–Ω—è.**

---

## üöÄ **–ö–ª—é—á–æ–≤–∞ —ñ–¥–µ—è**

üëâ –¢–∏ –º–∞—î—à –ø–µ—Ä–µ–º–∏–∫–∞—Ç–∏ –¥–∂–µ—Ä–µ–ª–æ –¥–∞–Ω–∏—Ö (–æ—Ä–∏–≥—ñ–Ω–∞–ª —á–∏ –∑–∞–º—ñ—â–µ–Ω–Ω—è) –Ω–∞ —Ä—ñ–≤–Ω—ñ item-–ø–µ—Ä–µ–º—ñ–Ω–Ω–∏—Ö —É –∑–∞–ø–∏—Ç—ñ.
üëâ –¶–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –ø—Ä—è–º–æ —É SQL –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `CASE` –∞–±–æ `DECODE`, –∞–±–æ —â–µ –∫—Ä–∞—â–µ ‚Äî —á–µ—Ä–µ–∑ `WITH` –±–ª–æ–∫ (CTE).

---

## ‚ö° **–ü—Ä–∏–∫–ª–∞–¥ –∑ WITH –±–ª–æ–∫–æ–º**

```sql
WITH user_ctx AS (
  SELECT
    CASE WHEN :P0_SUBSTITUTION_MODE = 1 THEN :P0_NEW_USER_ID ELSE :P0_USER_ID END AS user_id,
    CASE WHEN :P0_SUBSTITUTION_MODE = 1 THEN :P0_NEW_POSITION_ID ELSE :P0_POSITION_ID END AS position_id,
    CASE WHEN :P0_SUBSTITUTION_MODE = 1 THEN :P0_NEW_DEPARTMENT_ID ELSE :P0_DEPARTMENT_ID END AS department_id,
    CASE WHEN :P0_SUBSTITUTION_MODE = 1 THEN :P0_NEW_UNIT_ID ELSE :P0_UNIT_ID END AS unit_id
  FROM dual
)
SELECT t.*
FROM tasks t, user_ctx uc
WHERE EXISTS (
  SELECT 1
  FROM task_access_control ac
  WHERE (
          -- Access Level 1
          ac.access_level = 1
          AND (
              ac.user_id = uc.user_id
              OR (ac.position_id IS NOT NULL AND ac.position_id = uc.position_id)
          )
        )
     OR (
          -- Access Level 2
          ac.access_level = 2
          AND (
            (ac.position_id IS NULL OR ac.position_id = uc.position_id)
            AND (ac.department_id IS NULL OR ac.department_id = uc.department_id)
            AND (ac.unit_id IS NULL OR ac.unit_id = uc.unit_id)
          )
          AND (
            ac.user_id IS NULL OR ac.user_id = uc.user_id
          )
        )
     OR (
          -- Access Level 3
          ac.access_level = 3
          AND ac.user_id = uc.user_id
        )
  AND ROWNUM = 1
)
OR EXISTS (
  SELECT 1
  FROM signaturerights sr, user_ctx uc2
  WHERE sr.task_id = t.id
    AND sr.user_id = uc2.user_id
    AND sr.status <> 11
);
```

---

## üîë **–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è**

‚úÖ `WITH user_ctx` –≤–∏–∑–Ω–∞—á–∞—î ‚Äú–∞–∫—Ç—É–∞–ª—å–Ω—ñ‚Äù –¥–∞–Ω—ñ –¥–ª—è —Ü—å–æ–≥–æ –∑–∞–ø–∏—Ç—É:

* —è–∫—â–æ `:P0_SUBSTITUTION_MODE = 1` ‚Üí –±–µ—Ä–µ—Ç—å—Å—è –∑–∞–º—ñ—â–µ–Ω–Ω—è
* —è–∫—â–æ `:P0_SUBSTITUTION_MODE = 0` ‚Üí –±–µ—Ä–µ—Ç—å—Å—è –¥–∞–Ω—ñ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

‚úÖ –ü–æ—Ç—ñ–º —É—Å—ñ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –π–¥—É—Ç—å —á–µ—Ä–µ–∑ —Ü—ñ –∑–Ω–∞—á–µ–Ω–Ω—è (`uc.user_id`, `uc.position_id`, ‚Ä¶).

---

## ‚ö° **–ß–æ–º—É —Ü–µ –∑—Ä—É—á–Ω–æ**

‚úÖ –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –º—ñ–Ω—è—Ç–∏ –±–∞–≥–∞—Ç–æ –∫–æ–¥—É –≤ –∑–∞–ø–∏—Ç—ñ.
‚úÖ –ü—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –±—É–¥—å-—è–∫–∞ –ª–æ–≥—ñ–∫–∞ –∑–∞–º—ñ—â–µ–Ω–Ω—è, —â–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ item.
‚úÖ –®–≤–∏–¥–∫–æ –º–∞—Å—à—Ç–∞–±—É—î—Ç—å—Å—è (–ø–æ—Ç—Ä—ñ–±–Ω–æ –ª–∏—à–µ –∑–º—ñ–Ω–∏—Ç–∏ `WITH` –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ –¥–æ–¥–∞—Ç–∏ —â–µ –¥–∞–Ω—ñ).

---

## üí¨ **–•–æ—á–µ—à, —â–æ–± —è –ø—ñ–¥–≥–æ—Ç—É–≤–∞–≤ –≥–æ—Ç–æ–≤–∏–π —à–∞–±–ª–æ–Ω –¥–ª—è APEX View –∑ —Ü–∏–º –∑–∞–ø–∏—Ç–æ–º —á–∏ –≤–∞—Ä—ñ–∞–Ω—Ç —ñ–∑ bind-–ø–µ—Ä–µ–º—ñ–Ω–Ω–∏–º–∏ –¥–ª—è PL/SQL –ø—Ä–æ—Ü–µ–¥—É—Ä–∏?**

–ù–∞–ø–∏—à–∏ ‚Äî —è –∑–≥–µ–Ω–µ—Ä—É—é! üöÄ
