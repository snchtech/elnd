–¢–∏ —Ö–æ—á–µ—à —Å—Ç–≤–æ—Ä–∏—Ç–∏ **select item —É –≤–∏–≥–ª—è–¥—ñ –ø–µ—Ä–µ–º–∏–∫–∞—á–∞ –º—ñ–∂ –ø–æ—Ç–æ—á–Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º —ñ –∑–∞–º—ñ—â—É–≤–∞–Ω–∏–º**, –∑ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–º –¥–∂–µ—Ä–µ–ª–æ–º –¥–∞–Ω–∏—Ö —Ç–∞ –ª–æ–≥—ñ–∫–æ—é read-only –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –∑–∞–º—ñ—â–µ–Ω–Ω—è.

---

## ‚úÖ –û—á—ñ–∫—É–≤–∞–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞:

| –£–º–æ–≤–∞                              | –ó–Ω–∞—á–µ–Ω–Ω—è select'–∞                           | –î–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å |
| ---------------------------------- | ------------------------------------------- | ----------- |
| –ù–µ–º–∞—î –∑–∞–ø–∏—Å—É –≤ `user_substitution` | `USERNAME (–ü–û–°–ê–î–ê)` –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞   | Read-only   |
| –Ñ –∑–∞–º—ñ—â–µ–Ω–Ω—è                        | –í–∏–±—ñ—Ä –º—ñ–∂:                                  | Editable    |
|                                    | - `USERNAME (–ü–û–°–ê–î–ê)` –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ |             |
|                                    | - `USERNAME (–ü–û–°–ê–î–ê)` –∑–∞–º—ñ—â—É–≤–∞–Ω–æ–≥–æ          |             |

---

## üìå –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤ Oracle APEX

### 1. **Item:** `P0_SELECT_USER_ROLE`

* –¢–∏–ø: **Select List**
* Display Null: **No**
* Save Session State: **Yes**

---

### 2. **SQL Query (dynamic LOV):**

```sql
SELECT 
  u.username || ' (' || p.name || ')' AS display_value,
  u.id AS return_value
FROM users u
JOIN positions p ON u.position_id = p.id
WHERE u.id = :P0_USER_ID

UNION

SELECT 
  us.username_original || ' (' || p.name || ')' AS display_value,
  uo.id AS return_value
FROM user_substitution us
JOIN users uo ON uo.tab_no = us.tab_no_original
JOIN positions p ON uo.position_id = p.id
WHERE us.tab_no_replacer = :P0_USER_ID
  AND SYSDATE BETWEEN us.date_start AND NVL(us.date_end, SYSDATE + 1)
```

üîé –ü–æ—è—Å–Ω–µ–Ω–Ω—è:

* –ü–µ—Ä—à–∏–π `SELECT` ‚Äì –ø–æ—Ç–æ—á–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á.
* `UNION` ‚Äì –¥–æ–¥–∞—î –∑–∞–º—ñ—â–µ–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫—â–æ —Ç–∞–∫–∏–π —î.
* `return_value` ‚Äì `user.id`, —è–∫–∏–π –±—É–¥–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ.
* `display_value` ‚Äì —Ñ–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç.

---

### 3. **Default –∑–Ω–∞—á–µ–Ω–Ω—è:**

–£ `Default Value`:

```plsql
RETURN :P0_USER_ID;
```

---

### 4. **Read-only –ª–æ–≥—ñ–∫–∞:**

–î–æ–¥–∞—î–º–æ **Dynamic Action (DA)**:

* **Event:** Page Load
* **True Condition:**

  ```sql
  SELECT 1 FROM user_substitution
  WHERE tab_no_replacer = :P0_USER_ID
    AND SYSDATE BETWEEN date_start AND NVL(date_end, SYSDATE + 1)
  ```

  (—Ç–∏–ø = SQL Expression)
* **True Action:** Enable `P0_SELECT_USER_ROLE`
* **False Action:** Disable (Read-Only)

---

### üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (Client-Side Logic):

–£ `DA ‚Üí JavaScript Expression` (—è–∫—â–æ –Ω–µ —Ö–æ—á–µ—à SQL-–≤–∏—Ä–∞–∑—É):

```javascript
return $v('P0_NEW_USER_ID') !== '';
```

---

### üß† –í–∞–∂–ª–∏–≤–æ:

* –£—Å—ñ item'–∏ —Ç–∏–ø—É `user_id`, `username`, `position_id` —Ç–æ—â–æ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ **–∑–∞–ø–æ–≤–Ω–µ–Ω—ñ –≤ `Before Header` –Ω–∞ Global Page**, —è–∫ –º–∏ —Ä–µ–∞–ª—ñ–∑—É–≤–∞–ª–∏ —Ä–∞–Ω—ñ—à–µ.
* –Ø–∫—â–æ —Ö–æ—á–µ—à –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤–∏–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —Ç–æ `P0_SELECT_USER_ROLE` –º–∞—î –±—É—Ç–∏ —á–∞—Å—Ç–∏–Ω–æ—é –ª–æ–≥—ñ–∫–∏ —É—Å—ñ—Ö –∑–∞–ø–∏—Ç—ñ–≤ (`WITH user_ctx AS (...)`).

---

### üîö –ü—ñ—Å–ª—è –≤–∏–±–æ—Ä—É:

–ú–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ `P0_USER_ID` –Ω–∞ `:P0_SELECT_USER_ROLE`, –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ–π item –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ—ó –ª–æ–≥—ñ–∫–∏.

–•–æ—á–µ—à ‚Äî –ø—ñ–¥–∫–∞–∂—É —è–∫ –ø–µ—Ä–µ–±—É–¥—É–≤–∞—Ç–∏ `user_ctx` –ø—ñ–¥ —Ü–µ–π item.
