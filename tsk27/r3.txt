–©–æ–± **–¥–∏–Ω–∞–º—ñ—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ `P0_SUBSTITUTION_MODE`** –ø—Ä–∏ –∑–º—ñ–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è `P0_SELECT_USER_ROLE`, –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º:

* —á–∏ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –¥–æ—Ä—ñ–≤–Ω—é—î** `:P0_USER_ID`, –∞–±–æ
* **–π–æ–≥–æ –ø–æ—Å–∞–¥–∞ / –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—î** –∑ –ø–æ—Ç–æ—á–Ω–∏–º–∏ `:P0_CUR_POSITION_ID`, `:P0_CUR_DEPARTMENT_ID`,
  –º–æ–∂–Ω–∞ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ü–µ —á–µ—Ä–µ–∑ **Dynamic Action (DA)** –Ω–∞ –∑–º—ñ–Ω—É select'–∞.

---

## ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

### 1. **–°—Ç–≤–æ—Ä—é—î–º–æ DA:**

* **Name:** `Detect Substitution Mode`
* **Event:** `Change`
* **Selection Type:** `Item`
* **Item:** `P0_SELECT_USER_ROLE`

---

### 2. **True Action:** *PL/SQL Code*

* **Action Type:** `Set Value`
* **Set Type:** `PL/SQL Function Body`
* **Affected Item:** `P0_SUBSTITUTION_MODE`

```plsql
DECLARE
  l_selected_user_id    NUMBER := :P0_SELECT_USER_ROLE;
  l_position_id         NUMBER;
  l_department_id       NUMBER;
BEGIN
  -- –Ø–∫—â–æ –≤–∏–±—Ä–∞–Ω–æ —Å–µ–±–µ, —Ç–æ –∑–∞–º—ñ—â–µ–Ω–Ω—è –≤–∏–º–∫–Ω–µ–Ω–µ
  IF l_selected_user_id = :P0_USER_ID THEN
    RETURN 0;
  END IF;

  -- –û—Ç—Ä–∏–º–∞—î–º–æ –ø–æ–∑–∏—Ü—ñ—é —ñ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –≤–∏–±—Ä–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
  SELECT position_id, department_id
  INTO l_position_id, l_department_id
  FROM users
  WHERE id = l_selected_user_id;

  -- –Ø–∫—â–æ –ø–æ–∑–∏—Ü—ñ—è —Ç–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å ‚Äî —Ü–µ –ø–æ—Ç–æ—á–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á (–±–µ–∑ –∑–∞–º—ñ—â–µ–Ω–Ω—è)
  IF l_position_id = :P0_CUR_POSITION_ID AND l_department_id = :P0_CUR_DEPARTMENT_ID THEN
    RETURN 0;
  END IF;

  -- –í —ñ–Ω—à–æ–º—É –≤–∏–ø–∞–¥–∫—É ‚Äî –∞–∫—Ç–∏–≤—É—î–º–æ –∑–∞–º—ñ—â–µ–Ω–Ω—è
  RETURN 1;
END;
```

---

### 3. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:**

* **Fire on Page Load:** ‚ùå (–≤—ñ–¥–∫–ª—é—á–µ–Ω–æ)
* **Items to Submit:**

  * `P0_SELECT_USER_ROLE`
  * `P0_USER_ID`
  * `P0_CUR_POSITION_ID`
  * `P0_CUR_DEPARTMENT_ID`

---

## üí° –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:

* –Ø–∫—â–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∑–≤–æ–ª—è—î, –∑–∞–º—ñ—Å—Ç—å `users.position_id` —ñ `department_id` –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ —Ç–∞–∫–æ–∂ `unit_id`, –¥–æ–¥–∞–≤—à–∏ –π–æ–≥–æ –≤ `SELECT` —ñ –≤ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è.
* –Ø–∫—â–æ –ø–ª–∞–Ω—É—î—à –ø—ñ–¥—Ç—Ä–∏–º–∫—É –º–∞—Å–æ–≤–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ –∑–∞–º—ñ—â–µ–Ω–Ω—è, –¥–µ –æ–¥–∏–Ω user –∑–∞–º—ñ—â–∞—î –æ–¥—Ä–∞–∑—É –∫—ñ–ª—å–∫–æ—Ö ‚Äî –º–æ–∂–Ω–∞ —Ä–æ–∑—à–∏—Ä–∏—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –∑–∞ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∑ `user_substitution`.

---

–•–æ—á–µ—à ‚Äî –º–æ–∂—É –¥–æ–¥–∞—Ç–∏ —â–µ –π `unit_id` –¥–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏.
