–¶—ñ–ª–∫–æ–º –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —ñ **–æ–±“ë—Ä—É–Ω—Ç–æ–≤–∞–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥** ‚Äî –≤–∏–Ω–µ—Å–µ–Ω–Ω—è `access_level` –≤ –æ–∫—Ä–µ–º—É —Ç–∞–±–ª–∏—Ü—é `task_access_level_type`. –¶–µ:

‚úÖ –ù–æ—Ä–º–∞–ª—ñ–∑—É—î –¥–∞–Ω—ñ (–≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î 2-–π –Ω–æ—Ä–º–∞–ª—å–Ω—ñ–π —Ñ–æ—Ä–º—ñ)
‚úÖ –î–∞—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –¥–æ–¥–∞–≤–∞—Ç–∏ –æ–ø–∏—Å–∏ (`note`) –¥–æ –∫–æ–∂–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è –¥–æ—Å—Ç—É–ø—É
‚úÖ –î–∞—î –∑–º–æ–≥—É –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –∞–±–æ –Ω–∞–∑–≤–∏ —Ä—ñ–≤–Ω—ñ–≤ —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–æ
‚úÖ –ü–æ–ª–µ–≥—à—É—î –ø—ñ–¥—Ç—Ä–∏–º–∫—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —É —Ñ–æ—Ä–º—ñ `select list` –º–æ–∂–Ω–∞ –±—Ä–∞—Ç–∏ –∑ —Ü—ñ—î—ó —Ç–∞–±–ª–∏—Ü—ñ)

---

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—å:

```sql
-- –¢–∏–ø–∏ –¥–æ—Å—Ç—É–ø—ñ–≤
CREATE TABLE task_access_level_type (
  id           NUMBER PRIMARY KEY,
  access_level NUMBER NOT NULL,
  note         VARCHAR2(400)
);

-- –û—Å–Ω–æ–≤–Ω–∞ —Ç–∞–±–ª–∏—Ü—è –¥–æ—Å—Ç—É–ø—ñ–≤
CREATE TABLE task_access_control (
  id               NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id          NUMBER,
  position_id      NUMBER,
  department_id    NUMBER,
  unit_id          NUMBER,
  access_level_id  NUMBER NOT NULL,  -- FK –Ω–∞ task_access_level_type
  date_create      DATE DEFAULT SYSDATE,
  created_by       VARCHAR2(100),
  note             VARCHAR2(4000)
);
```

> **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è**: —Ç–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ `FOREIGN KEY (access_level_id) REFERENCES task_access_level_type(id)`.

---

## üì• –ü—Ä–∏–∫–ª–∞–¥ –¥–∞–Ω–∏—Ö —É `task_access_level_type`

| ID | access\_level | note                       |
| -- | ------------- | -------------------------- |
| 1  | 1             | –ü–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø              |
| 2  | 2             | –î–æ—Å—Ç—É–ø –ø–æ –ø–æ—Å–∞–¥—ñ / –≤—ñ–¥–¥—ñ–ª—É |
| 3  | 3             | –õ–∏—à–µ –æ—Å–æ–±–∏—Å—Ç—ñ –∑–∞–≤–¥–∞–Ω–Ω—è     |

---

## ‚úÖ –ü—Ä–∏–∫–ª–∞–¥ SELECT –∑ WHERE –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø—É

–¢–µ–ø–µ—Ä –∑–∞–º—ñ—Å—Ç—å `ac.access_level` –º–∏ –ø—Ä–∏—î–¥–Ω—É—î–º–æ—Å—è –¥–æ —Ç–∞–±–ª–∏—Ü—ñ `task_access_level_type`.

```sql
WITH user_ctx AS (
  SELECT
    CASE WHEN :P0_SUBSTITUTION_MODE = 1 THEN :P0_NEW_USER_ID ELSE :P0_USER_ID END AS user_id,
    CASE WHEN :P0_SUBSTITUTION_MODE = 1 THEN :P0_NEW_POSITION_ID ELSE :P0_POSITION_ID END AS position_id,
    CASE WHEN :P0_SUBSTITUTION_MODE = 1 THEN :P0_NEW_DEPARTMENT_ID ELSE :P0_DEPARTMENT_ID END AS department_id,
    CASE WHEN :P0_SUBSTITUTION_MODE = 1 THEN :P0_NEW_UNIT_ID ELSE :P0_UNIT_ID END AS unit_id
  FROM dual
)
SELECT t.*
FROM tasks t, user_ctx uc
WHERE EXISTS (
  SELECT 1
  FROM task_access_control ac
  JOIN task_access_level_type al ON al.id = ac.access_level_id
  WHERE (
          -- Access Level 1
          al.access_level = 1
          AND (
              ac.user_id = uc.user_id
              OR (ac.position_id IS NOT NULL AND ac.position_id = uc.position_id)
          )
        )
     OR (
          -- Access Level 2
          al.access_level = 2
          AND (
            (ac.position_id IS NULL OR ac.position_id = uc.position_id)
            AND (ac.department_id IS NULL OR ac.department_id = uc.department_id)
            AND (ac.unit_id IS NULL OR ac.unit_id = uc.unit_id)
          )
          AND (
            ac.user_id IS NULL OR ac.user_id = uc.user_id
          )
        )
     OR (
          -- Access Level 3
          al.access_level = 3
          AND ac.user_id = uc.user_id
        )
  AND ROWNUM = 1
)
OR EXISTS (
  SELECT 1
  FROM signaturerights sr
  WHERE sr.task_id = t.id
    AND sr.user_id = uc.user_id
    AND sr.status <> 11
);
```

---

## üîé –ü–æ—è—Å–Ω–µ–Ω–Ω—è:

* –ú–∏ –ø—Ä–∏—î–¥–Ω—É—î–º–æ —Ç–∞–±–ª–∏—Ü—é `task_access_level_type` –ø–æ `access_level_id`.
* –ü–æ–ª–µ `access_level` –≤ –Ω—ñ–π ‚Äî **—á–∏—Å–ª–æ–≤–µ** (1, 2, 3), —è–∫–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ –ª–æ–≥—ñ—Ü—ñ.
* –¶–µ –¥–æ–∑–≤–æ–ª—è—î –ª–µ–≥–∫–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –æ–ø–∏—Å–∏ —Ä—ñ–≤–Ω—ñ–≤, –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ —ó—Ö —É LOV, —ñ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –¥—É–±–ª—ñ–∫–∞—Ç–∏ –æ–ø–∏—Å—ñ–≤ —É –∫–æ–∂–Ω–æ–º—É —Ä—è–¥–∫—É `task_access_control`.

---

## üìå –í–∏—Å–Ω–æ–≤–æ–∫:

–ü—ñ–¥—Ö—ñ–¥ **–ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–ø—Ä–∞–≤–¥–∞–Ω–∏–π** —ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î **best practices**:

* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –æ–∫—Ä–µ–º—É —Ç–∞–±–ª–∏—Ü—é –¥–ª—è —Ä—ñ–≤–Ω—ñ–≤ –¥–æ—Å—Ç—É–ø—É.
* –ü—Ä–∏ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—ñ –ª–æ–≥—ñ–∫–∏ WHERE ‚Äî –ø—Ä–∏—î–¥–Ω—É–π —Ü—é —Ç–∞–±–ª–∏—Ü—é —á–µ—Ä–µ–∑ JOIN.
* –í UI (—Ñ–æ—Ä–º—ñ) –º–æ–∂–Ω–∞ –≤–∏–≤–æ–¥–∏—Ç–∏ –æ–ø–∏—Å (`note`) –≤ LOV, –∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ `access_level_id`.

–•–æ—á–µ—à ‚Äî –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑ APEX LOV –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ü—ñ—î—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏.
