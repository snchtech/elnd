–î—è–∫—É—é –∑–∞ —É—Ç–æ—á–Ω–µ–Ω–Ω—è. –£ —Ç–≤–æ—î–º—É –∑–∞–ø–∏—Ç—ñ —î –¥–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏, —è–∫—ñ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å –ø–æ–º–∏–ª–∫–∏ –≤ Oracle APEX:

---

### ‚ùå **1. –ù–µ –±–∞—á–∏—Ç—å `t.id` –≤ –ø—ñ–¥–∑–∞–ø–∏—Ç—ñ EXISTS:**

> –¶–µ –∫–ª–∞—Å–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ —É SQL: –≤ –¥—Ä—É–≥–æ–º—É `EXISTS` —Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à `t.id`, –∞–ª–µ **–Ω–µ –ø—ñ–¥–∫–ª—é—á–∞—î—à –æ—Å–Ω–æ–≤–Ω—É —Ç–∞–±–ª–∏—Ü—é `tasks` –¥–æ –ø—ñ–¥–∑–∞–ø–∏—Ç—É —è–≤–Ω–æ**, —è–∫ —Ü–µ –∑—Ä–æ–±–ª–µ–Ω–æ –≤ –ø–µ—Ä—à–æ–º—É EXISTS —á–µ—Ä–µ–∑ `FROM tasks t`.

### ‚ùå **2. –ü–æ–ª—è `status` –Ω–µ–º–∞—î –≤ `signaturerights`:**

> –Ø–∫—â–æ `status` —î –≤ `signaturehistory`, —Ç–æ–¥—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∞–±–æ:

* –ø—Ä–∏—î–¥–Ω—É–≤–∞—Ç–∏ `signaturehistory` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —á–µ—Ä–µ–∑ `JOIN` –∞–±–æ `EXISTS`)
* –∞–±–æ –ø—Ä–∏–±—Ä–∞—Ç–∏ —É–º–æ–≤—É `sr.status <> 11`, —è–∫—â–æ –≤–æ–Ω–∞ –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω–∞

---

## ‚úÖ **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –∑–∞–ø–∏—Ç—É:**

```sql
SELECT t.*
FROM tasks t
WHERE EXISTS (
  SELECT 1
  FROM task_access_control ac
  WHERE 
    (
      -- Access Level 1
      ac.access_level = 1
      AND (
        ac.user_id = :P0_USER_ID
        OR ac.position_id = :P0_POSITION_ID
      )
    )
    OR
    (
      -- Access Level 2
      ac.access_level = 2
      AND (
        (ac.position_id IS NULL OR ac.position_id = :P0_POSITION_ID)
        AND (ac.department_id IS NULL OR ac.department_id = :P0_DEPARTMENT_ID)
        AND (ac.unit_id IS NULL OR ac.unit_id = :P0_UNIT_ID)
      )
      AND (
        ac.user_id IS NULL OR ac.user_id = :P0_USER_ID
      )
    )
    OR
    (
      -- Access Level 3
      ac.access_level = 3
      AND ac.user_id = :P0_USER_ID
    )
    AND ac.task_id = t.id  -- –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –≤ task_access_control —î task_id
    AND ROWNUM = 1
)
OR EXISTS (
  -- –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ SIGNATUREHISTORY (–Ω–µ signaturerights!)
  SELECT 1
  FROM signaturehistory sh
  WHERE sh.task_id = t.id
    AND sh.signer_by = :P0_USER_ID
    AND sh.status <> 11
);
```

---

## üîß –Ø–∫—â–æ `signaturehistory` –Ω–µ –º—ñ—Å—Ç–∏—Ç—å `task_id`, –∞ –º–∞—î –ª–∏—à–µ `signright_id` ‚Üí –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—Ä–∏—î–¥–Ω–∞—Ç–∏ `signaturerights`:

```sql
OR EXISTS (
  SELECT 1
  FROM signaturehistory sh
  JOIN signaturerights sr ON sr.id = sh.signright_id
  WHERE sr.task_id = t.id
    AND sh.signer_by = :P0_USER_ID
    AND sh.status <> 11
)
```

---

## üìù –†–µ–∑—é–º–µ:

| –ü—Ä–æ–±–ª–µ–º–∞                    | –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è                                                  |
| --------------------------- | ------------------------------------------------------------ |
| `t.id` –Ω–µ –≤–∏–¥–Ω–æ –≤ –ø—ñ–¥–∑–∞–ø–∏—Ç—ñ | –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π `EXISTS` –∑ `tasks t` –∞–±–æ –∑—Ä–æ–±–∏ JOIN —É –ø—ñ–¥–∑–∞–ø–∏—Ç—ñ |
| `sr.status` –Ω–µ —ñ—Å–Ω—É—î        | –ü–µ—Ä–µ–Ω–µ—Å–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É `status` –≤ `signaturehistory`             |
| –ó–≤'—è–∑–æ–∫ –º—ñ–∂ —Ç–∞–±–ª–∏—Ü—è–º–∏       | `sr.id = sh.signright_id` —è–∫—â–æ `status` –≤ `signaturehistory` |

–•–æ—á–µ—à ‚Äî –¥–æ–ø–æ–º–æ–∂—É –∑ –ø–æ–±—É–¥–æ–≤–æ—é –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ SQL –ø—ñ–¥ –∑–∞–º—ñ—â–µ–Ω–Ω—è (user\_ctx) –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º access level.
