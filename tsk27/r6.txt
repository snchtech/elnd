–©–æ–± **–ø–æ—î–¥–Ω–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –¥–æ—Å—Ç—É–ø—É** (`task_access_control` + `signaturerights`) –∑ —É–∂–µ –Ω–∞—è–≤–Ω–∏–º–∏ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏ `:PXX_TAB_MODE` —É —Ç–≤–æ—î–º—É SQL –¥–ª—è Interactive Report ‚Äî –ø–æ—Ç—Ä—ñ–±–Ω–æ **–∑–≥—Ä—É–ø—É–≤–∞—Ç–∏ —É–º–æ–≤–∏ –≤ `WHERE`** —Ç–∞–∫, —â–æ–± –±—É–ª–æ:

> **(–î–æ—Å—Ç—É–ø –¥–æ–∑–≤–æ–ª–µ–Ω–æ)** –Ü **(–§—ñ–ª—å—Ç—Ä–∏ –ø–æ —Ç–∞–±—É–ª—è—Ü—ñ—ó: planned/shift/problem/archive)**

---

## ‚úÖ –Ø–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç–∏ —É–º–æ–≤—É –¥–æ—Å—Ç—É–ø—É

–û–±–µ—Ä–Ω–∏ –ø–æ—Ç–æ—á–Ω—ñ —É–º–æ–≤–∏ —Ç–∞–±—É–ª—è—Ü—ñ—ó –≤ –¥—É–∂–∫–∏ —Ç–∞ –¥–æ–¥–∞–π `AND (...—É–º–æ–≤–∞ –¥–æ—Å—Ç—É–ø—É...)` –ø—ñ—Å–ª—è –Ω–∏—Ö.

### üîß –û–Ω–æ–≤–ª–µ–Ω–∏–π `WHERE`-–±–ª–æ–∫:

```sql
WHERE
(
  (:PXX_TAB_MODE = 'PLANNED')

  OR (:PXX_TAB_MODE = 'SHIFT'
      AND (
        (t.PLANNING_DATE_START < :PXX_SHIFT_END AND (t.ACTUAL_DATE_END IS NULL OR t.ACTUAL_DATE_END > :PXX_SHIFT_START)) OR
        (t.PLANNING_DATE_END BETWEEN :PXX_SHIFT_START AND :PXX_SHIFT_END)
      )
     )

  OR (:PXX_TAB_MODE = 'PROBLEM'
      AND (
        (t.PLANNING_DATE_END < SYSDATE AND t.ACTUAL_DATE_END IS NULL)
        OR EXISTS (
          SELECT 1
          FROM DICT_APP_CONFIRM_LIST d
          WHERE d.PAGE_LIST_ID = t.PAGE_LIST_ID
            AND NOT EXISTS (
              SELECT 1
              FROM SIGNATURERIGHTS r
              WHERE r.TASK_ID = t.ID AND r.STAGES_ID = d.STAGE
            )
        )
      )
     )

  OR (:PXX_TAB_MODE = 'ARCHIVE' AND t.STATUS_ID = 14)
)

AND (
  EXISTS (
    SELECT 1
    FROM task_access_control ac
    WHERE 
      (
        ac.access_level = 1
        AND (
          ac.user_id = :P0_USER_ID
          OR ac.position_id = :P0_POSITION_ID
        )
      )
      OR
      (
        ac.access_level = 2
        AND (
          (ac.position_id IS NULL OR ac.position_id = :P0_POSITION_ID)
          AND (ac.department_id IS NULL OR ac.department_id = :P0_DEPARTMENT_ID)
          AND (ac.unit_id IS NULL OR ac.unit_id = :P0_UNIT_ID)
        )
        AND (
          ac.user_id IS NULL OR ac.user_id = :P0_USER_ID
        )
      )
      OR
      (
        ac.access_level = 3
        AND ac.user_id = :P0_USER_ID
      )
      AND ac.task_id = t.id
      AND ROWNUM = 1
  )
  OR EXISTS (
    SELECT 1
    FROM signaturerights sr
    WHERE sr.task_id = t.id
      AND sr.user_id = :P0_USER_ID
      -- –≤–∏–¥–∞–ª–µ–Ω–æ —É–º–æ–≤—É sr.status, —è–∫—â–æ —ó—ó –Ω–µ —ñ—Å–Ω—É—î
  )
)
```

---

## üìù –ü–æ—Ä–∞–¥–∏:

1. **–ü–∞–º‚Äô—è—Ç–∞–π**: `WHERE (...) AND (...)` ‚Äî —Ü–µ –ª–æ–≥—ñ—á–Ω–µ `–Ü`, —Ç–æ–º—É –¥–æ—Å—Ç—É–ø ‚Äî —Ü–µ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–∞ —É–º–æ–≤–∞.
2. **–û–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –æ–±–≥–æ—Ä–Ω–∏** –≤—Å—ñ `OR` —Ñ—ñ–ª—å—Ç—Ä–∏ –≤ –¥—É–∂–∫–∏, —â–æ–± –ª–æ–≥—ñ–∫–∞ –Ω–µ –ø–æ—Ä—É—à–∏–ª–∞—Å—å.
3. –Ø–∫—â–æ —Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à **–∑–∞–º—ñ—â–µ–Ω–Ω—è**, –∑–∞–º—ñ–Ω–∏ `:P0_USER_ID`, `:P0_POSITION_ID` —Ç–æ—â–æ –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ `user_ctx` –∞–±–æ `NVL()`-–ø—ñ–¥—Ö–æ–¥–æ–º (—è–∫ –º–∏ —Ä–∞–Ω—ñ—à–µ –æ–±–≥–æ–≤–æ—Ä—é–≤–∞–ª–∏).

---

–Ø–∫—â–æ —Ç—Ä–µ–±–∞ ‚Äî –ø–æ–∫–∞–∂—É –≤–∞—Ä—ñ–∞–Ω—Ç —á–µ—Ä–µ–∑ `WITH user_ctx` –¥–ª—è –≤—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –∑–∞–º—ñ—â–µ–Ω–Ω—è –ø—Ä—è–º–æ –≤ —Ü—å–æ–º—É –∑–∞–ø–∏—Ç—ñ.
