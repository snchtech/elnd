–¢–≤–æ—î –∑–∞–ø–∏—Ç–∞–Ω–Ω—è —Å—Ç–æ—Å—É—î—Ç—å—Å—è –¥–≤–æ—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤:

---

### ‚úÖ **1. –Ø–∫—â–æ `:P0_SELECT_USER_ROLE` ‚Äî `NULL`, –∞–ª–µ —î –¥–∞–Ω—ñ `P0_NEW_POSITION_ID`, `P0_NEW_DEPARTMENT_ID`, `P0_NEW_UNIT_ID`**

–£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É ‚Äî –º–∏ –Ω–µ –∑–Ω–∞—î–º–æ `user_id` –∑–∞–º—ñ—â—É–≤–∞–Ω–æ–≥–æ –Ω–∞–ø—Ä—è–º—É, –∞–ª–µ –∑–Ω–∞—î–º–æ, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–º—ñ—â–∞—î –∫–æ–≥–æ—Å—å —ñ–∑ —Ç–∞–∫–∏–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏. –ù–∞–º —Ç—Ä–µ–±–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –≤–æ–Ω–∏ –≤—ñ–¥—Ä—ñ–∑–Ω—è—é—Ç—å—Å—è –≤—ñ–¥ **–ø–æ—Ç–æ—á–Ω–∏—Ö**.

---

### ‚úÖ **2. –Ø–∫—â–æ `position + department + unit` —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å ‚Äî —è–∫ –≤–∏–∑–Ω–∞—á–∏—Ç–∏, —â–æ —Ü–µ –∑–∞–º—ñ—â–µ–Ω–Ω—è**

–¶–µ —Å–∫–ª–∞–¥–Ω–æ, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–∏–≥–ª—è–¥–∞—î, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á ¬´—Å–∞–º —Å–µ–±–µ –∑–∞–º—ñ—â–∞—î¬ª. –í —Ç–∞–∫–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö **best practice** ‚Äì –º–∞—Ç–∏ **—É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∑–∞–º—ñ—â—É–≤–∞–Ω–æ–≥–æ (–Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –Ω–µ `user_id`)**, –∞–±–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ `ORIGINAL_USER_ID` —É —Å–µ—Å—ñ–π–Ω–æ–º—É item (–Ω–∞–ø—Ä., `P0_NEW_USER_ID`) –ø—ñ—Å–ª—è `Page Load`.

---

## üîß **–û–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ–¥ (–¥–ª—è –æ–±–æ—Ö –≤–∏–ø–∞–¥–∫—ñ–≤):**

```plsql
DECLARE
  l_selected_user_id    NUMBER := :P0_SELECT_USER_ROLE;
  l_cur_position_id     NUMBER := :P0_CUR_POSITION_ID;
  l_cur_department_id   NUMBER := :P0_CUR_DEPARTMENT_ID;
  l_cur_unit_id         NUMBER := :P0_CUR_UNIT_ID;

  l_target_position_id  NUMBER;
  l_target_department_id NUMBER;
  l_target_unit_id       NUMBER;
BEGIN
  -- –í–∞—Ä—ñ–∞–Ω—Ç 1: –í–∏–±—Ä–∞–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
  IF l_selected_user_id IS NOT NULL THEN
    IF l_selected_user_id = :P0_USER_ID THEN
      RETURN 0; -- —Å–µ–±–µ –≤–∏–±—Ä–∞–≤ ‚Äî –±–µ–∑ –∑–∞–º—ñ—â–µ–Ω–Ω—è
    END IF;

    SELECT position_id, department_id, unit_id
    INTO l_target_position_id, l_target_department_id, l_target_unit_id
    FROM users
    WHERE id = l_selected_user_id;

  -- –í–∞—Ä—ñ–∞–Ω—Ç 2: –ó–∞–º—ñ—â–µ–Ω–Ω—è –ø–æ pos+dep+unit (–±–µ–∑ user_id)
  ELSIF :P0_NEW_POSITION_ID IS NOT NULL THEN
    l_target_position_id := :P0_NEW_POSITION_ID;
    l_target_department_id := :P0_NEW_DEPARTMENT_ID;
    l_target_unit_id := :P0_NEW_UNIT_ID;

    -- –î–æ–¥–∞—Ç–∫–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞: —è–∫—â–æ —Ü—ñ –∑–Ω–∞—á–µ–Ω–Ω—è —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å —ñ–∑ –ø–æ—Ç–æ—á–Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º ‚Äî –∑–∞–º—ñ—â–µ–Ω–Ω—è –Ω–µ –∞–∫—Ç–∏–≤–Ω–µ
    IF l_target_position_id = l_cur_position_id
       AND l_target_department_id = l_cur_department_id
       AND NVL(l_target_unit_id, -1) = NVL(l_cur_unit_id, -1)
    THEN
      RETURN 0;
    END IF;

  ELSE
    RETURN 0; -- –Ω—ñ—á–æ–≥–æ –Ω–µ –≤–∏–±—Ä–∞–Ω–æ ‚Äî –∑–∞–º—ñ—â–µ–Ω–Ω—è –Ω–µ –∞–∫—Ç–∏–≤–Ω–µ
  END IF;

  -- –Ø–∫—â–æ —Å—é–¥–∏ –¥—ñ–π—à–ª–∏ ‚Äî —Ü–µ –∑–∞–º—ñ—â–µ–Ω–Ω—è
  RETURN 1;
END;
```

---

## ‚úÖ –©–æ —Ç—É—Ç —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ:

1. –Ø–∫—â–æ –≤–∏–±—Ä–∞–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ `user_id` —ñ –π–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∏.
2. –Ø–∫—â–æ `user_id` –Ω–µ –≤–∏–±—Ä–∞–Ω–æ ‚Äî –∞–Ω–∞–ª—ñ–∑—É—î–º–æ `P0_NEW_POSITION_ID`, `P0_NEW_DEPARTMENT_ID`, `P0_NEW_UNIT_ID`.
3. –Ø–∫—â–æ —Ü—ñ –ø–æ–ª—è –∑–±—ñ–≥–∞—é—Ç—å—Å—è –∑ –ø–æ—Ç–æ—á–Ω–∏–º–∏ ‚Äî –∑–∞–º—ñ—â–µ–Ω–Ω—è **–Ω–µ –∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è**.
4. –Ø–∫—â–æ —Ä—ñ–∑–Ω—ñ ‚Äî —Ü–µ –∑–∞–º—ñ—â–µ–Ω–Ω—è.

---

## üí° –î–æ–¥–∞—Ç–∫–æ–≤–∞ –ø–æ—Ä–∞–¥–∞:

–î–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ –∑–∞–º—ñ—â–µ–Ω–Ω—è (–æ—Å–æ–±–ª–∏–≤–æ –±–µ–∑ `user_id`), —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è:

* –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤ `P0_NEW_USER_ID` –±—É–¥—å-—è–∫–∏–π —É–º–æ–≤–Ω–∏–π ID –∞–±–æ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –∫–ª—é—á –∑ —Ç–∞–±–ª–∏—Ü—ñ `user_substitution`, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ `user_id` —Ç–∞–º `NULL`.
* –ê–±–æ –º–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω–µ –ø–æ–ª–µ `substitution_id`, —â–æ–± –≤–∏–∑–Ω–∞—á–∞—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–µ—Å—ñ—ó (–Ω–µ —Ç—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ role select item).

---

üîî –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ, –º–æ–∂—É –ø–æ–∫–∞–∑–∞—Ç–∏, —è–∫ –æ–Ω–æ–≤–∏—Ç–∏ DA –∞–±–æ –ª–æ–≥—ñ–∫—É `Page Load`, —â–æ–± –≤–æ–Ω–∞ —Ç–∞–∫–æ–∂ –ø—Ä–∞—Ü—é–≤–∞–ª–∞ –∑ —Ü–∏–º –ø—ñ–¥—Ö–æ–¥–æ–º.
