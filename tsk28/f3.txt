–û—Å—å –æ–Ω–æ–≤–ª–µ–Ω–∏–π PL/SQL-–∫–æ–¥ –¥–ª—è `Page Load` (–∞–±–æ –¥–∏–Ω–∞–º—ñ—á–Ω–æ—ó –¥—ñ—ó), —è–∫–∏–π –≤—Ä–∞—Ö–æ–≤—É—î —Å–∏—Ç—É–∞—Ü—ñ—é:

* —è–∫—â–æ –≤ `user_substitution` `tab_no_original IS NULL` ‚Üí —Ç–æ–¥—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ `:P0_NEW_USER_ID := 1` (–¥–ª—è –∑–∞–º—ñ—â–µ–Ω–Ω—è –∑–∞ **–ø–æ–∑–∏—Ü—ñ—î—é/–¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–º/—é–Ω—ñ—Ç–æ–º**);
* —è–∫—â–æ `tab_no_original IS NOT NULL` ‚Üí –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ `:P0_NEW_USER_ID := tab_no_original` (—Ç–æ–±—Ç–æ –∑–∞–º—ñ—â–µ–Ω–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞);
* —è–∫—â–æ –∑–∞–ø–∏—Å—É –≤–∑–∞–≥–∞–ª—ñ –Ω–µ–º–∞—î ‚Üí –æ–±–Ω—É–ª—è—î–º–æ –≤—Å—ñ item.

---

### ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–∏–π PL/SQL-–∫–æ–¥:

```plsql
DECLARE
  l_tab_no_original   NUMBER;
  l_username_original VARCHAR2(100);
  l_position_id       NUMBER;
  l_department_id     NUMBER;
  l_unit_id           NUMBER;
BEGIN
  -- –®—É–∫–∞—î–º–æ –∞–∫—Ç–∏–≤–Ω–µ –∑–∞–º—ñ—â–µ–Ω–Ω—è –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (replacer)
  SELECT 
    NVL(tab_no_original, 1),  -- —è–∫—â–æ NULL, —Ç–æ –∑–∞–º—ñ—â–µ–Ω–Ω—è –ø–æ –ø–æ—Å–∞–¥—ñ
    username_original
  INTO 
    l_tab_no_original,
    l_username_original
  FROM user_substitution
  WHERE tab_no_replacer = :P0_USER_ID
    AND SYSDATE BETWEEN date_start AND NVL(date_end, SYSDATE + 1)
    AND ROWNUM = 1;

  -- –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ item
  :P0_NEW_USER_ID := l_tab_no_original;
  :P0_NEW_USERNAME := l_username_original;

  -- –Ø–∫—â–æ tab_no_original –Ω–µ null ‚Üí –≤–∏—Ç—è–≥—É—î–º–æ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ –∑ USERS
  IF l_tab_no_original != 1 THEN
    SELECT position_id, department_id, unit_id
    INTO :P0_NEW_POSITION_ID, :P0_NEW_DEPARTMENT_ID, :P0_NEW_UNIT_ID
    FROM users
    WHERE tab_no = l_tab_no_original;
  ELSE
    -- –Ü–Ω–∞–∫—à–µ ‚Äî —Ü–µ –∑–∞–º—ñ—â–µ–Ω–Ω—è –ø–æ –ø–æ—Å–∞–¥—ñ, –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É, unit ‚Äî –±–µ—Ä–µ–º–æ —è–∫ —É –∑–∞–º—ñ—â—É–≤–∞—á–∞
    :P0_NEW_POSITION_ID := :P0_CUR_POSITION_ID;
    :P0_NEW_DEPARTMENT_ID := :P0_CUR_DEPARTMENT_ID;
    :P0_NEW_UNIT_ID := :P0_CUR_UNIT_ID;
  END IF;

EXCEPTION
  WHEN NO_DATA_FOUND THEN
    -- –ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–º—ñ—â–µ–Ω–Ω—è ‚Äî –æ–±–Ω—É–ª—è—î–º–æ –≤—Å—ñ item
    :P0_NEW_USER_ID := NULL;
    :P0_NEW_USERNAME := NULL;
    :P0_NEW_POSITION_ID := NULL;
    :P0_NEW_DEPARTMENT_ID := NULL;
    :P0_NEW_UNIT_ID := NULL;
END;
```

---

### üîé –ü–æ—è—Å–Ω–µ–Ω–Ω—è:

* `NVL(tab_no_original, 1)` –¥–æ–∑–≤–æ–ª—è—î –≤–∏—è–≤–∏—Ç–∏ –∑–∞–º—ñ—â–µ–Ω–Ω—è –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ `tab_no_original` –Ω–µ –≤–∫–∞–∑–∞–Ω–æ.
* –ó–Ω–∞—á–µ–Ω–Ω—è `1` —Ç–∏ –º–æ–∂–µ—à —É–º–æ–≤–Ω–æ –≤–≤–∞–∂–∞—Ç–∏ "service constant" –¥–ª—è –∑–∞–º—ñ—â–µ–Ω–Ω—è –ø–æ –ø–æ–ª—è—Ö, –Ω–µ –ø–æ user.
* `:P0_NEW_*` item –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –ª–∏—à–µ –∫–æ–ª–∏ `:P0_SUBSTITUTION_MODE = 1`.

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ, –º–æ–∂—É —Ç–∞–∫–æ–∂ –ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π `DA` –¥–ª—è –∑–º—ñ–Ω–∏ `P0_SUBSTITUTION_MODE` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ –∑ `select`.
