–¢–∞–∫, —Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø–∏—Å–∞–≤ —Å–∏—Ç—É–∞—Ü—ñ—é: –∫–æ–ª–∏ `tab_no_original IS NULL OR = 1`, —Ç–æ–±—Ç–æ –∑–∞–º—ñ—â–µ–Ω–Ω—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –Ω–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –∞ –¥–ª—è –ø–µ–≤–Ω–æ—ó **–ø–æ—Å–∞–¥–∏ + –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É + —é–Ω—ñ—Ç—É**, —Ç–æ `:P0_NEW_USER_ID` —Ç–∞ `:P0_NEW_USERNAME` –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è `NULL`, –∞ –æ—Ç `:P0_NEW_POSITION_ID`, `:P0_NEW_DEPARTMENT_ID`, `:P0_NEW_UNIT_ID` –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ **–Ω–∞ –æ—Å–Ω–æ–≤—ñ –∑–∞–ø–∏—Å—É –≤ `user_substitution`**.

---

### ‚úÖ –û–ù–û–í–õ–ï–ù–ò–ô –ö–û–î:

```plsql
DECLARE
  l_tab_no_original   NUMBER;
  l_username_original VARCHAR2(100);
  l_position_id       NUMBER;
  l_department_id     NUMBER;
  l_unit_id           NUMBER;
  l_exists            BOOLEAN := FALSE;
BEGIN
  -- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: —á–∏ —î –∑–∞–º—ñ—â–µ–Ω–Ω—è
  SELECT CASE WHEN COUNT(*) > 0 THEN TRUE ELSE FALSE END
  INTO l_exists
  FROM user_substitution
  WHERE tab_no_replacer = :P0_USER_ID
    AND SYSDATE BETWEEN date_start AND NVL(date_end, SYSDATE + 1);

  IF l_exists THEN
    -- –û—Å–Ω–æ–≤–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ (–º–æ–∂–µ –±—É—Ç–∏ –∞–±–æ –ø–æ user, –∞–±–æ –ø–æ –ø–æ—Å–∞–¥—ñ)
    SELECT 
      tab_no_original,
      username_original,
      position_id,
      department_id,
      unit_id
    INTO 
      l_tab_no_original,
      l_username_original,
      l_position_id,
      l_department_id,
      l_unit_id
    FROM user_substitution
    WHERE tab_no_replacer = :P0_USER_ID
      AND SYSDATE BETWEEN date_start AND NVL(date_end, SYSDATE + 1)
      AND ROWNUM = 1;

    -- –Ø–∫—â–æ —Ç–∞–±. –Ω–æ–º–µ—Ä —î (–∑–∞–º—ñ—â–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞)
    IF l_tab_no_original IS NOT NULL AND l_tab_no_original != 1 THEN
      :P0_NEW_USER_ID := l_tab_no_original;
      :P0_NEW_USERNAME := l_username_original;

      -- –í–∏—Ç—è–≥—É—î–º–æ –ø–æ–∑–∏—Ü—ñ—é, –≤—ñ–¥–¥—ñ–ª, —é–Ω—ñ—Ç –∑ USERS
      SELECT position_id, department_id, unit_id
      INTO :P0_NEW_POSITION_ID, :P0_NEW_DEPARTMENT_ID, :P0_NEW_UNIT_ID
      FROM users
      WHERE tab_no = l_tab_no_original;

    ELSE
      -- –ó–∞–º—ñ—â–µ–Ω–Ω—è –ø–æ –ø–æ—Å–∞–¥—ñ/–≤—ñ–¥–¥—ñ–ª—É/—é–Ω—ñ—Ç—É
      :P0_NEW_USER_ID := NULL;
      :P0_NEW_USERNAME := NULL;
      :P0_NEW_POSITION_ID := l_position_id;
      :P0_NEW_DEPARTMENT_ID := l_department_id;
      :P0_NEW_UNIT_ID := l_unit_id;
    END IF;

  ELSE
    -- –ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–º—ñ—â–µ–Ω–Ω—è
    :P0_NEW_USER_ID := NULL;
    :P0_NEW_USERNAME := NULL;
    :P0_NEW_POSITION_ID := NULL;
    :P0_NEW_DEPARTMENT_ID := NULL;
    :P0_NEW_UNIT_ID := NULL;
  END IF;
END;
```

---

### üü¢ –©–æ –≤—Ä–∞—Ö–æ–≤–∞–Ω–æ:

* –Ø–∫—â–æ –∑–∞–º—ñ—â–µ–Ω–Ω—è **–ø–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É** (—Ç–æ–±—Ç–æ `tab_no_original IS NOT NULL AND != 1`) ‚Äî –æ—Ç—Ä–∏–º—É—î–º–æ –≤—Å—ñ –¥–∞–Ω—ñ –∑ —Ç–∞–±–ª–∏—Ü—ñ `USERS`.
* –Ø–∫—â–æ –∑–∞–º—ñ—â–µ–Ω–Ω—è **–ø–æ –ø–æ—Å–∞–¥—ñ / –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—É / —é–Ω—ñ—Ç—É** ‚Äî —Ü—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –±–µ—Ä–µ–º–æ –∑ —Ç–∞–±–ª–∏—Ü—ñ `user_substitution`.
* –Ø–∫—â–æ –Ω–µ–º–∞—î –∑–∞–ø–∏—Å—É ‚Äî –≤—Å—ñ –ø–æ–ª—è –æ–±–Ω—É–ª—è—é—Ç—å—Å—è.

---

üîî **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –Ø–∫—â–æ —Ç–∏ —Ö–æ—á–µ—à —É –º–∞–π–±—É—Ç–Ω—å–æ–º—É –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –¥–µ–∫—ñ–ª—å–∫–∞ –∑–∞–º—ñ—â–µ–Ω—å –æ–¥–Ω–æ—á–∞—Å–Ω–æ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É + –ø–æ –ø–æ—Å–∞–¥—ñ), —Ç—Ä–µ–±–∞ –±—É–¥–µ –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –∞–±–æ —Ä–µ–∞–ª—ñ–∑–æ–≤—É–≤–∞—Ç–∏ —è–∫ `FOR LOOP` –∑ –ø—Ä–∏–æ—Ä—ñ—Ç–µ—Ç–∞–º–∏. –ê–ª–µ –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è –≤—Å–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.
