–¢–∏ —Å—Ç–∏–∫–∞—î—à—Å—è –∑ —Å–∏—Ç—É–∞—Ü—ñ—î—é, –∫–æ–ª–∏ –ø—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è `CASE ... AS STATUS_LABEL_PROBLEM` —É `SELECT`, —Ç–≤—ñ–π –∑–≤—ñ—Ç –ø–æ—á–∏–Ω–∞—î –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ **–∑–∞–ø–∏—Å–∏ –∑ —ñ–Ω—à–∏—Ö –≤—ñ–¥–¥—ñ–ª—ñ–≤**, —Ö–æ—á–∞ –≤ `WHERE` –∑–∞–ª–∏—à–∏–≤—Å—è —Ç–æ–π —Å–∞–º–∏–π —Ñ—ñ–ª—å—Ç—Ä –ø–æ `task_access_control`.

üîç **–ü—Ä–∏—á–∏–Ω–∞ –≤ —Ç–æ–º—É, —â–æ**:
—É `SELECT` —Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à –≤–∫–ª–∞–¥–µ–Ω—ñ –∑–∞–ø–∏—Ç–∏ –¥–æ `DICT_APP_CONFIRM_LIST` —ñ `SIGNATURERIGHTS`, **–∞–ª–µ –±–µ–∑ –∂–æ–¥–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø—É –¥–æ —Ü–∏—Ö –∑–∞–≤–¥–∞–Ω—å**. –û—Ç–∂–µ, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —Ä—è–¥–æ–∫ `tasks t` –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å `WHERE`, **–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ `SELECT` –º–æ–∂–µ —Å–ø—Ä–∏—á–∏–Ω–∏—Ç–∏ –¥–∂–æ–π–Ω –∞–±–æ –∑–∞–ø–∏—Ç —á–µ—Ä–µ–∑ `VIEW`, —è–∫–∏–π –≤–∏–π–º–∞—î –≤—Å—ñ –∑–∞–ø–∏—Å–∏**. –¶–µ –º–æ–∂–ª–∏–≤–æ, —è–∫—â–æ —Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à APEX Interactive Report, —è–∫–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ–¥–∞—î `row count` –∞–±–æ `COUNT(*) OVER()` –¥–ª—è pagination, –∞–±–æ –≥–µ–Ω–µ—Ä—É—î —ñ–Ω—à—ñ –∑–∞–ø–∏—Ç–∏ –Ω–∞ —Ä—ñ–≤–Ω—ñ `WITH`.

---

## üîß –Ø–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥—ñ—è—Ç–∏:

### ‚úÖ –í–∞—Ä—ñ–∞–Ω—Ç 1: –í–∏–Ω–µ—Å—Ç–∏ –ª–æ–≥—ñ–∫—É `status_label_problem` —É –ø—ñ–¥–∑–∞–ø–∏—Ç (inline view)

–°—Ç–≤–æ—Ä–∏ `WITH` –∞–±–æ –ø—ñ–¥–∑–∞–ø–∏—Ç, –¥–µ –≤–∂–µ **—Ñ—ñ–ª—å—Ç—Ä—É—î—à –ø–æ –¥–æ—Å—Ç—É–ø—É**, —ñ —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è —Ü—å–æ–≥–æ –¥–æ–¥–∞—î—à `CASE`:

```sql
WITH tasks_with_access AS (
  SELECT t.*
  FROM tasks t
  WHERE
    -- –¢–≤—ñ–π –ø–æ–≤–Ω–∏–π —Ñ—ñ–ª—å—Ç—Ä –ø–æ tab_mode
    (
      (:PXX_TAB_MODE = 'PLANNED')
      OR ...
    )
    AND (
      EXISTS (
        SELECT 1
        FROM task_access_control ac
        WHERE 
          (
            ac.access_level = 1 AND (
              ac.user_id = :P0_USER_ID
              OR ac.position_id = :P0_POSITION_ID
            )
          )
          OR (
            ac.access_level = 2 AND (
              (ac.position_id IS NULL OR ac.position_id = :P0_POSITION_ID)
              AND (ac.department_id IS NULL OR ac.department_id = :P0_DEPARTMENT_ID)
              AND (ac.unit_id IS NULL OR ac.unit_id = :P0_UNIT_ID)
            ) AND (ac.user_id IS NULL OR ac.user_id = :P0_USER_ID)
          )
          OR (ac.access_level = 3 AND ac.user_id = :P0_USER_ID)
          AND ac.task_id = t.id
          AND ROWNUM = 1
      )
      OR EXISTS (
        SELECT 1
        FROM signaturerights sr
        WHERE sr.task_id = t.id
          AND sr.user_id = :P0_USER_ID
      )
    )
)
SELECT t.*,
  CASE
    WHEN :PXX_TAB_MODE = 'PROBLEM' THEN
      CASE
        WHEN (t.PLANNING_DATE_END < SYSDATE AND t.ACTUAL_DATE_END IS NULL)
             OR EXISTS (...) THEN
          -- –¢–≤–æ—è –ª–æ–≥—ñ–∫–∞ –∑ —ñ–∫–æ–Ω–∫–∞–º–∏
          '<span class="t-Icon ...">'
        ELSE NULL
      END
    ELSE NULL
  END AS status_label_problem
FROM tasks_with_access t
```

### ‚úÖ –í–∞—Ä—ñ–∞–Ω—Ç 2: –û–±–≥–æ—Ä–Ω—É—Ç–∏ –≤—Å—ñ –≤–∫–ª–∞–¥–µ–Ω—ñ `EXISTS` —É `CASE` –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –¥–æ—Å—Ç—É–ø—É (—Å–∫–ª–∞–¥–Ω–æ –π –≤–∞–∂–∫–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏)

---

## üìå –í–∏—Å–Ω–æ–≤–æ–∫

‚ùó **–ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ `WHERE`, –∞ –≤ —Ç–æ–º—É, —â–æ –≤ `SELECT` –ø—ñ–¥—Ç—è–≥—É—é—Ç—å—Å—è –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä—è–¥–∫–∏, —è–∫—ñ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —Ñ—ñ–ª—å—Ç—Ä –¥–æ—Å—Ç—É–ø—É**.

**–†—ñ—à–µ–Ω–Ω—è:** –ø–æ–≤–Ω—ñ—Å—Ç—é **–≤—ñ–¥–æ–∫—Ä–µ–º–∏—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –¥–æ—Å—Ç—É–ø—É** —É CTE –∞–±–æ –ø—ñ–¥–∑–∞–ø–∏—Ç, —ñ –≤–∂–µ –¥–∞–ª—ñ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∑ "–¥–æ–∑–≤–æ–ª–µ–Ω–∏–º–∏" –∑–∞–ø–∏—Å–∞–º–∏.

–Ø–∫—â–æ —Ö–æ—á–µ—à ‚Äî —è –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ —Ç–æ–±—ñ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ –≤–µ—Å—å SQL –ø–æ–≤–Ω—ñ—Å—Ç—é –∑ `WITH`, —ñ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ –≤–∫–ª–∞–¥–∫—É `status_label_problem` —è–∫ –æ–∫—Ä–µ–º—É –∫–æ–ª–æ–Ω–∫—É.
