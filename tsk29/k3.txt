–©–æ–± **–∫–æ—Ä–µ–∫—Ç–Ω–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó –∑–Ω–∞—á–µ–Ω—å** (`POSITION`, `DEPARTMENT`, `USERNAME`) **–±–µ–∑ –∑–∞–π–≤–∏—Ö –∫–æ–º –∞–±–æ –ø—Ä–æ–±—ñ–ª—ñ–≤**, –ø–æ—Ç—Ä—ñ–±–Ω–æ:

---

### ‚úÖ 1. **–ó–±–∏—Ä–∞—Ç–∏ –æ–∫—Ä–µ–º—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –Ω–∞ NULL**, –∞ –ø–æ—Ç—ñ–º –æ–±‚Äô—î–¥–Ω—É–≤–∞—Ç–∏ —ó—Ö —á–µ—Ä–µ–∑ `LISTAGG`.

---

### üîÑ –û–Ω–æ–≤–ª–µ–Ω–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–ª—è `LISTAGG`:

```sql
SELECT LISTAGG(
  '<span class="task_creator">' || 
    RTRIM(
      CASE WHEN pos.NAME IS NOT NULL THEN pos.NAME || ', ' ELSE '' END ||
      CASE WHEN dep.NAME IS NOT NULL THEN dep.NAME || ', ' ELSE '' END ||
      NVL(u2.USERNAME, '')
    , ', ') ||  -- –í–∏–¥–∞–ª—è—î –∑–∞–π–≤—É –∫–æ–º—É
  '</span>' ||

  CASE 
    WHEN sr2.USER_ID IS NOT NULL THEN
      (
        SELECT 
          CASE 
            WHEN h.SIGNER_BY = sr2.USER_ID THEN 
              '<span class="signer_info">' || TO_CHAR(h.SIGNER_DATE, 'DD.MM.YYYY HH24:MI') || '</span>'
            ELSE 
              '<span class="signer_info">–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å: ' || us.USERNAME || ', ' || TO_CHAR(h.SIGNER_DATE, 'DD.MM.YYYY HH24:MI') || '</span>'
          END
        FROM SIGNATUREHISTORY h
        JOIN USER_TABLE us ON us.ID = h.SIGNER_BY
        WHERE h.SIGNRIGHT_ID = sr2.ID
        FETCH FIRST ROW ONLY
      )
    ELSE
      (
        SELECT '<span class="signer_info">' || us.USERNAME || ', ' || TO_CHAR(h.SIGNER_DATE, 'DD.MM.YYYY HH24:MI') || '</span>'
        FROM SIGNATUREHISTORY h
        JOIN USER_TABLE us ON us.ID = h.SIGNER_BY
        WHERE h.SIGNRIGHT_ID = sr2.ID
        FETCH FIRST ROW ONLY
      )
  END,
  ' <br> '
)
FROM SIGNATURERIGHTS sr2
LEFT JOIN POSITION_TABLE pos ON pos.ID = sr2.POSITION_ID
LEFT JOIN DEPARTMENT_TABLE dep ON dep.ID = sr2.DEPARTMENT_ID
LEFT JOIN USER_TABLE u2 ON u2.ID = sr2.USER_ID
WHERE sr2.TASK_ID = t.ID AND sr2.STAGES_ID = 2
```

---

### üß† –ü–æ—è—Å–Ω–µ–Ω–Ω—è:

* `CASE WHEN ... THEN ... || ', ' ELSE '' END` ‚Äî –¥–æ–¥–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è –ª–∏—à–µ —è–∫—â–æ –≤–æ–Ω–æ –Ω–µ NULL.
* `RTRIM(..., ', ')` ‚Äî –ø—Ä–∏–±–∏—Ä–∞—î –∑–∞–π–≤—É –∫–æ–º—É —ñ –ø—Ä–æ–±—ñ–ª —É –∫—ñ–Ω—Ü—ñ, —è–∫—â–æ —î.
* –¢–∞–∫–∏–º —á–∏–Ω–æ–º —Ç–∏ —É–Ω–∏–∫–Ω–µ—à:

  * `", USERNAME"`
  * `"POSITION, , DEPARTMENT"`
  * –∞–±–æ –ø—Ä–æ—Å—Ç–æ `", , "`.

---

–•–æ—á–µ—à —â–µ –ø–æ–∫—Ä–∞—â–∏—Ç–∏ ‚Äî –º–æ–∂—É –∑—Ä–æ–±–∏—Ç–∏ –≤–µ—Ä—Å—ñ—é, —è–∫–∞ –∑–±–∏—Ä–∞—î —Ü—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ –º–∞—Å–∏–≤ —ñ —Å–∫–ª–µ—é—î —á–µ—Ä–µ–∑ `apex_string.join` –∞–±–æ —ñ–Ω—à—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –¥–ª—è Oracle 19+.
