–î–æ–±—Ä–µ! –†–æ–∑–ø–∏—à—É –¥–µ—Ç–∞–ª—å–Ω–æ, —è–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–æ–≤–Ω–∏–π —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –æ–∑–Ω–∞–π–æ–º–ª–µ–Ω–Ω—è –∑ –∑–∞–≤–¥–∞–Ω–Ω—è–º —É Oracle APEX.

---

## üîß **1. –†–æ–ª—å —É APEX Access Control: `shift_personal`**

–£ **Shared Components ‚Üí Access Control ‚Üí Roles**, –¥–æ–¥–∞–π—Ç–µ –Ω–æ–≤—É —Ä–æ–ª—å:

* Static ID: `SHIFT_PERSONAL`
* Name: `shift_personal`

---

## üü¶ **2. –°—Ç–≤–æ—Ä—ñ—Ç—å item –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª—ñ**

**Item:** `P0_HAS_SHIFT_ROLE`
**–¢–∏–ø:** `Hidden`
**–ü–æ—á–∞—Ç–∫–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è (Before Header):**

```plsql
:P0_HAS_SHIFT_ROLE := CASE
  WHEN APEX_ACL.HAS_ROLE(:APP_ID, 'SHIFT_PERSONAL') = 'Y' THEN 'Y'
  ELSE 'N'
END;
```

---

## üü© **3. –ö–Ω–æ–ø–∫–∞ ‚Äú–û–∑–Ω–∞–π–æ–º–ª–µ–Ω–∏–π‚Äù –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –∑–∞–≤–¥–∞–Ω–Ω—è**

**–ö–Ω–æ–ø–∫–∞:**

* –ù–∞–∑–≤–∞: `–û–∑–Ω–∞–π–æ–º–ª–µ–Ω–∏–π`
* Static ID: `btn_task_viewed`
* Action: **Submit Page**
* Server Condition ‚Üí PL/SQL Expression:

```plsql
(
  :P0_HAS_SHIFT_ROLE = 'N'
  AND NOT EXISTS (
    SELECT 1 FROM TASK_VIEWED
     WHERE TASK_ID = :P6_TASK_ID AND USER_ID = :P0_USER_ID
  )
)
OR
(
  :P0_HAS_SHIFT_ROLE = 'Y'
  AND NOT EXISTS (
    SELECT 1 FROM TASK_VIEWED
     WHERE TASK_ID = :P6_TASK_ID
       AND USER_ID = :P0_USER_ID
       AND DATE_VIEWED BETWEEN :P6_SHIFT_START_DATE AND :P6_SHIFT_END_DATE
  )
)
```

---

## ‚úÖ **4. –ü—Ä–æ—Ü–µ—Å –∑–∞–ø–∏—Å—É `TASK_VIEWED`**

**–°—Ç–≤–æ—Ä—ñ—Ç—å APEX Process** –ø—ñ—Å–ª—è —Å–∞–±–º—ñ—Ç—É —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (–∞–±–æ –Ω–∞ –∫–Ω–æ–ø–∫—É):

* –ù–∞–∑–≤–∞: `Insert Task View`
* –¢–∏–ø: PL/SQL
* –£–º–æ–≤–∏ –∑–∞–ø—É—Å–∫—É: When Button Pressed = `btn_task_viewed`

```plsql
BEGIN
  INSERT INTO TASK_VIEWED (USER_ID, TASK_ID, DATE_VIEWED)
  VALUES (:P0_USER_ID, :P6_TASK_ID, SYSDATE);
END;
```

---

## üü® **5. –í–∏–≤–µ–¥–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó "–û–∑–Ω–∞–π–æ–º–ª–µ–Ω–∏–π..."**

### –°—Ç–≤–æ—Ä—ñ—Ç—å HTML-–≤–∏—Ä–∞–∑ –∞–±–æ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π PL/SQL —Ä–µ–≥—ñ–æ–Ω:

```plsql
DECLARE
  l_viewed_date DATE;
  l_user_name   VARCHAR2(100);
BEGIN
  SELECT tv.DATE_VIEWED, u.USERNAME
  INTO l_viewed_date, l_user_name
  FROM TASK_VIEWED tv
  JOIN USERS u ON u.ID = tv.USER_ID
  WHERE tv.TASK_ID = :P6_TASK_ID
    AND tv.USER_ID = :P0_USER_ID
    AND (
      (:P0_HAS_SHIFT_ROLE = 'Y' AND tv.DATE_VIEWED BETWEEN :P6_SHIFT_START_DATE AND :P6_SHIFT_END_DATE)
      OR :P0_HAS_SHIFT_ROLE = 'N'
    )
    FETCH FIRST ROW ONLY;

  HTP.P('<div class="task-viewed-info">–û–∑–Ω–∞–π–æ–º–ª–µ–Ω–∏–π ' || l_user_name || ', ' || TO_CHAR(l_viewed_date, 'DD.MM.YYYY HH24:MI') || '</div>');

EXCEPTION
  WHEN NO_DATA_FOUND THEN
    NULL;
END;
```

---

## üß™ **6. –Ø–∫ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏:**

1. –î–æ–¥–∞–π—Ç–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É —Ä–æ–ª—å `SHIFT_PERSONAL` —É Access Control.
2. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å `P0_USER_ID` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —á–µ—Ä–µ–∑ Login Process –∞–±–æ —É `Before Header`).
3. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å `P6_TASK_ID`, `P6_SHIFT_START_DATE`, `P6_SHIFT_END_DATE` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤ `Before Header` –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø–æ—Ç–æ—á–Ω—É –∑–º—ñ–Ω—É).
4. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É ‚Äú–û–∑–Ω–∞–π–æ–º–ª–µ–Ω–∏–π‚Äù.
5. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–∞–ø–∏—Å —É —Ç–∞–±–ª–∏—Ü—ñ `TASK_VIEWED`.
6. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –∫–Ω–æ–ø–∫–∞ –∑–Ω–∏–∫–∞—î –∑–≥—ñ–¥–Ω–æ –∑ –ª–æ–≥—ñ–∫–æ—é.

---

–ì–æ—Ç–æ–≤–∏–π –¥–æ–¥–∞—Ç–∏ JavaScript –∞–±–æ –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ —á–µ—Ä–µ–∑ AJAX, —è–∫—â–æ —Ö–æ—á–µ—à –±–µ–∑ —Å–∞–±–º—ñ—Ç—É —Å—Ç–æ—Ä—ñ–Ω–∫–∏. –°–∫–∞–∂–∏, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ!
