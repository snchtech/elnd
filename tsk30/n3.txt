–û—Å—å —è–∫ –º–æ–∂–Ω–∞ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª "–û–∑–Ω–∞–π–æ–º–ª–µ–Ω–Ω—è —ñ–∑ –≤—Å—ñ–º–∞" –≤ Oracle APEX:

---

### üîß **1. –ö–Ω–æ–ø–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –∑–≤—ñ—Ç—É**

* **–ù–∞–∑–≤–∞:** `btn_view_all_tasks`

* **–£–º–æ–≤–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è:**

  ```plsql
  APEX_ACL.HAS_ROLE(:APP_ID, 'SHIFT_PERSONAL') = 'Y'
  ```

* **Dynamic Action:**

  * **Event:** Click
  * **True Action:** Execute JavaScript Code

    ```js
    apex.navigation.dialog('f?p=&APP_ID.:XX_VIEWALL:APP_SESSION', {
      title: "–û–∑–Ω–∞–π–æ–º–ª–µ–Ω–Ω—è —ñ–∑ –∑–º—ñ–Ω–Ω–∏–º–∏ –∑–∞–≤–¥–∞–Ω–Ω—è–º–∏",
      height: "auto",
      width: "1000",
      modal: true
    });
    ```

---

### üìÑ **2. –ú–æ–¥–∞–ª—å–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ `XX_VIEWALL`**

#### üìå **Items –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ:**

* `PXX_USER_ID` ‚Äî –∑–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è –∑ `P0_USER_ID`
* `PXX_SHIFT_START` ‚Äî `P6_SHIFT_START_DATE`
* `PXX_SHIFT_END` ‚Äî `P6_SHIFT_END_DATE`

---

### üìä **3. –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π –∑–≤—ñ—Ç/IG**

#### SQL-–∑–∞–ø–∏—Ç –¥–ª—è IG:

```sql
SELECT 
  t.ID as TASK_ID,
  '–ó–º—ñ–Ω–∞ ' || TO_CHAR(:PXX_SHIFT_START, 'DD.MM.YYYY HH24:MI') || ' ‚Äî ' || TO_CHAR(:PXX_SHIFT_END, 'HH24:MI') AS TASK_SHIFT,
  CASE 
    WHEN t.TASK_TYPE = 2 THEN 
      (SELECT LISTAGG(st.SUBTASK_CONTENT, '; ') WITHIN GROUP (ORDER BY st.SUBTASK_ORDER)
       FROM TASK_SUBTASKS st 
       WHERE st.TASK_ID = t.ID)
    ELSE 
      t.TASK_CONTENT
  END AS TASK_CONTENT,
  t.PLANNING_DATE_START,
  t.PLANNING_DATE_END,
  'f?p=&APP_ID.:6:&SESSION.::&DEBUG.:6:P6_TASK_ID:' || t.ID AS LINK_TO_DETAILS
FROM TASKS t
WHERE NOT EXISTS (
    SELECT 1 
    FROM TASK_VIEWED v 
    WHERE v.TASK_ID = t.ID AND v.USER_ID = :PXX_USER_ID 
      AND v.DATE_VIEWED BETWEEN :PXX_SHIFT_START AND :PXX_SHIFT_END
)
```

#### –ö–æ–ª–æ–Ω–∫–∏:

* `TASK_SHIFT`
* `TASK_CONTENT`
* `PLANNING_DATE_START`
* `PLANNING_DATE_END`
* `LINK_TO_DETAILS` ‚Üí —è–∫ –∫–Ω–æ–ø–∫–∞ –∑ —ñ–∫–æ–Ω–∫–æ—é "–¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ"
* `SELECTED_ROW` ‚Üí checkbox (manual checkbox via `apex_item.checkbox2`)

---

### ‚úÖ **4. –ö–Ω–æ–ø–∫–∞ "–û–∑–Ω–∞–π–æ–º–ª–µ–Ω–Ω—è" –ø—ñ–¥ IG**

* **–ù–∞–∑–≤–∞:** `btn_confirm_viewed`

* **Dynamic Action ‚Üí PL/SQL Process:**

  ```plsql
  FOR i IN 1..APEX_APPLICATION.G_F01.COUNT LOOP
    INSERT INTO TASK_VIEWED (ID, USER_ID, TASK_ID, DATE_VIEWED)
    VALUES (TASK_VIEWED_SEQ.NEXTVAL, :PXX_USER_ID, APEX_APPLICATION.G_F01(i), SYSDATE);
  END LOOP;
  ```

* **–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**

  * `G_F01` ‚Äî —Ü–µ –º–∞—Å–∏–≤ ID –∑–∞–≤–¥–∞–Ω—å, –æ—Ç—Ä–∏–º–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ checkbox.
  * Checkbox –º–∞—î –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏—Å—å —á–µ—Ä–µ–∑ `apex_item.checkbox2(1, t.ID, 'class="select-task"')`

* **–î–æ–¥–∞—Ç–∫–æ–≤–æ:**

  * –ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è ‚Äî –∑–∞–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ (`Execute JavaScript` ‚Üí `apex.navigation.dialog.close(true);`)

---

üîÅ **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è:**

* –í–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ `APEX_COLLECTION` –¥–ª—è –∑–±–æ—Ä—É ID, —è–∫—â–æ –æ–±—Ä–æ–±–∫–∞ –±—É–¥–µ —É—Å–∫–ª–∞–¥–Ω—é–≤–∞—Ç–∏—Å—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–æ–¥–∞–≤–∞–Ω–Ω—è –æ–∑–Ω–∞–π–æ–º–ª–µ–Ω–Ω—è –∑ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è–º–∏).

---

üîí **–ë–µ–∑–ø–µ–∫–∞:**

* –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–ª—ñ `shift_personal` –º–∞—î –≤—ñ–¥–±—É–≤–∞—Ç–∏—Å—å —É `Before Header` –∞–±–æ `Authorization Scheme` –¥–ª—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ `XX_VIEWALL`.

---

–•–æ—á–µ—Ç–µ ‚Äî —è –º–æ–∂—É –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –≥–æ—Ç–æ–≤–∏–π SQL —Ç–∞ JavaScript –¥–ª—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ `XX_VIEWALL`.
