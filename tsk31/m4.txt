–û—Å—å —Ä–æ–±–æ—á–∏–π **PL/SQL –∫–æ–¥**, —è–∫–∏–π –≤–∏–∫–æ–Ω—É—î –ª–æ–≥—ñ–∫—É –≤ –¥–≤–∞ –µ—Ç–∞–ø–∏:

1. –í–∏–∑–Ω–∞—á–∞—î, **—á–∏ —î –∑–∞–ø–∏—Å user\_id** –≤ `SIGNATURERIGHTS`, —ñ –≤–∏–∫–æ–Ω—É—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π `SELECT`:

   * –Ø–∫—â–æ `user_id` —î ‚Üí —à—É–∫–∞—î –¥–∞–Ω—ñ –≤ `USERS`
   * –Ø–∫—â–æ `user_id` –Ω–µ–º–∞—î ‚Üí —à—É–∫–∞—î –∑–±—ñ–≥ –ø–æ `position`, `department`, —ñ **–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ –ø–æ `uchastok`**

2. –ü—ñ—Å–ª—è –≤–∏–±—ñ—Ä–∫–∏ –∑–Ω–∞—á–µ–Ω—å –∑ —Ç–∞–±–ª–∏—Ü—ñ `USERS`, **–ø–æ—Ä—ñ–≤–Ω—é—î —ó—Ö –∑ –¥–∞–Ω–∏–º–∏ –∑—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –∑–∞–º—ñ—â–µ–Ω–Ω—è)**

---

### ‚úÖ –†–æ–±–æ—á–∏–π PL/SQL –∫–æ–¥

```plsql
DECLARE
    v_dolznost        USERS.DOLZNOST%TYPE;
    v_tseh_id         USERS.TSEH_ID%TYPE;
    v_uchastok        USERS.UCHASTOK%TYPE;
    v_kategoria_otiz  USERS.KATEGORIA_OTIZ%TYPE;

    v_user_id         SIGNATURERIGHTS.USER_ID%TYPE := :P6_USER_ID; -- SIGNATURERIGHTS.USER_ID
    v_position_id     SIGNATURERIGHTS.POSITION_ID%TYPE := :P6_POSITION_ID;
    v_department_id   SIGNATURERIGHTS.DEPARTMENT_ID%TYPE := :P6_DEPARTMENT_ID;
    v_uchastok_cond   SIGNATURERIGHTS.UCHASTOK%TYPE := :P6_UCHASTOK;

    -- –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –∑–∞–º—ñ—â–µ–Ω–Ω—è)
    v_cur_position_id   NUMBER := NVL(:P0_NEW_POSITION_ID, :P0_CURRENT_POSITION_ID);
    v_cur_department_id NUMBER := NVL(:P0_NEW_DEPARTMENT_ID, :P0_CURRENT_DEPARTMENT_ID);
    v_cur_uchastok      VARCHAR2(100) := NVL(:P0_NEW_UCHASTOK, :P0_CURRENT_UCHASTOK);
    v_cur_kategoria     NUMBER := NVL(:P0_NEW_KATEGORIYA_OTIZ, :P0_CURRENT_KATEGORIYA_OTIZ);

    v_show_button BOOLEAN := FALSE;
BEGIN
    IF v_user_id IS NOT NULL THEN
        -- üîπ –í–∏–ø–∞–¥–æ–∫ 1: user_id –∑–∞–¥–∞–Ω–∏–π ‚Äî –ø—Ä—è–º–µ –∑—ñ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è
        SELECT t.DOLZNOST, t.TSEH_ID, t.UCHASTOK, t.KATEGORIA_OTIZ
        INTO v_dolznost, v_tseh_id, v_uchastok, v_kategoria_otiz
        FROM USERS t
        WHERE t.ID = v_user_id
          AND t.PRIZNAK IS NULL;

    ELSE
        -- üîπ –í–∏–ø–∞–¥–æ–∫ 2: –Ω–µ–º–∞—î user_id ‚Üí –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ –ø–æ—Å–∞–¥—ñ + –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—É + optional uchastok
        SELECT t.DOLZNOST, t.TSEH_ID, t.UCHASTOK, t.KATEGORIA_OTIZ
        INTO v_dolznost, v_tseh_id, v_uchastok, v_kategoria_otiz
        FROM USERS t
        WHERE t.PRIZNAK IS NULL
          AND t.DOLZNOST = v_position_id
          AND t.TSEH_ID = v_department_id
          AND (
                v_uchastok_cond IS NULL OR t.UCHASTOK = v_uchastok_cond
              )
          AND ROWNUM = 1;
    END IF;

    -- üîπ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ —Å–ø—ñ–≤–ø–∞–¥—ñ–Ω–Ω—è –∑ –ø–æ—Ç–æ—á–Ω–∏–º/–∑–∞–º—ñ—â–µ–Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º
    IF v_cur_department_id = v_tseh_id
       AND v_cur_position_id = v_dolznost
       AND (v_uchastok_cond IS NULL OR v_cur_uchastok = v_uchastok)
       AND v_kategoria_otiz = 1 THEN

        v_show_button := TRUE;

    END IF;

    -- üîπ –†–µ–Ω–¥–µ—Ä–∏–º–æ –∫–Ω–æ–ø–∫—É
    IF v_show_button THEN
        HTP.P('<button id="sign-byname-btn" class="byname-signature-button">–í—ñ–¥–º—ñ—Ç–∫–∞ –≤—ñ–¥ —ñ–º–µ–Ω—ñ</button>');
    END IF;

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        NULL; -- –Ω—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏–º–æ
    WHEN OTHERS THEN
        HTP.P('<span class="error">–ü–æ–º–∏–ª–∫–∞: ' || SQLERRM || '</span>');
END;
```

---

### ‚úÖ –©–æ —Ä–æ–±–∏—Ç—å —Ü–µ–π –∫–æ–¥:

| –ö—Ä–æ–∫ | –î—ñ—è                                                                                                 |
| ---- | --------------------------------------------------------------------------------------------------- |
| 1Ô∏è‚É£  | –ü–µ—Ä–µ–≤—ñ—Ä—è—î: `SIGNATURERIGHTS.USER_ID` —î ‚Üí –ø—Ä—è–º–µ –∑—ñ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –∑ `USERS`                                |
| 2Ô∏è‚É£  | –Ø–∫—â–æ `USER_ID` –≤—ñ–¥—Å—É—Ç–Ω—ñ–π ‚Üí –ø—ñ–¥–±–∏—Ä–∞—î `USERS` –ø–æ `POSITION_ID`, `DEPARTMENT_ID`, `UCHASTOK` (–æ–ø—Ü—ñ–π–Ω–æ) |
| 3Ô∏è‚É£  | –ü–æ—Ä—ñ–≤–Ω—é—î –≤–∏–±—Ä–∞–Ω—ñ –¥–∞–Ω—ñ –∑ `P0_CURRENT_*` –∞–±–æ `P0_NEW_*`                                               |
| 4Ô∏è‚É£  | –Ø–∫—â–æ –≤—Å—ñ —É–º–æ–≤–∏ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è ‚Üí –≤–∏–≤–æ–¥–∏—Ç—å –∫–Ω–æ–ø–∫—É ‚Äú–í—ñ–¥–º—ñ—Ç–∫–∞ –≤—ñ–¥ —ñ–º–µ–Ω—ñ‚Äù                                   |

---

üîî **–ó–∞ –ø–æ—Ç—Ä–µ–±–∏ –º–æ–∂—É –≤–∏–Ω–µ—Å—Ç–∏ —Ü–µ–π –∫–æ–¥ —É `FUNCTION`, —è–∫–∞ –ø–æ–≤–µ—Ä—Ç–∞—î `BOOLEAN`, –∞–±–æ –Ω–∞–≤—ñ—Ç—å –æ–∫—Ä–µ–º—É `procedure`, —â–æ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –∫–Ω–æ–ø–∫—É, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ.**
