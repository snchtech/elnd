–©–æ–± –≤—Ä–∞—Ö—É–≤–∞—Ç–∏ `UCHASTOK` —ñ–∑ —Ç–∞–±–ª–∏—Ü—ñ `SIGNATURERIGHTS` –ø—Ä–∏ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ, —á–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏ –∫–Ω–æ–ø–∫—É **"–í—ñ–¥–º—ñ—Ç–∫–∏"**, –ø–æ—Ç—Ä—ñ–±–Ω–æ:

---

### üîß **1. –î–æ–¥–∞—Ç–∏ –ø–æ–ª–µ `l_list_uchastok` –¥–æ –∫—É—Ä—Å–æ—Ä–∞ `confirm_list`**

–û—Å–∫—ñ–ª—å–∫–∏ –ø–æ–ª–µ `UCHASTOK` –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ `c017`, –¥–æ–¥–∞–π –¥–æ `OPEN confirm_list`:

```sql
OPEN confirm_list FOR 
  SELECT SEQ_ID, c001, c002, c003, c009, c010, c011, c012, c008, c014, c015, c016, c017
  FROM APEX_collections
  WHERE collection_name = 'CONFIRM_CART_' || l_stage_id || '_' || l_substage_id
    AND c004 = l_substage_id
  ORDER BY TO_NUMBER(c006);
```

–Ü –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ `FETCH` –¥–æ–¥–∞–π:

```plsql
FETCH confirm_list INTO 
  l_list_id, l_list_position, l_list_department, l_list_unit,
  l_list_position_id, l_list_department_id, l_list_unit_id,
  l_signature_id, l_list_tab_no, l_task_mode, l_subtask_content,
  l_subtask_id, l_list_uchastok;
```

---

### üîß **2. –î–æ–¥–∞—Ç–∏ –∑–º—ñ–Ω–Ω—É –¥–ª—è `UCHASTOK` –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:**

```plsql
l_current_user_uchastok_g1 VARCHAR2(255);
```

–Ü —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–π —ó—ó:

```plsql
l_current_user_uchastok_g1 := CASE 
  WHEN :P0_SUBSTITUTION_MODE = 1 THEN :P0_NEW_UCHASTOK
  ELSE :P0_CUR_USER_UCHASTOK 
END;
```

---

### üîß **3. –î–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É `UCHASTOK` –¥–æ –±–ª–æ–∫—É `IF` –∑ `l_is_role`**

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —É –±–ª–æ—Ü—ñ –∑ **–ø–æ–∑–∏—Ü—ñ—è + –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç** –∑–∞–º—ñ–Ω–∏:

```plsql
l_is_role := l_is_position AND l_is_department;
```

–ù–∞:

```plsql
IF l_list_uchastok IS NULL THEN
  l_is_role := l_is_position AND l_is_department;
ELSE
  l_is_role := l_is_position AND l_is_department AND (l_list_uchastok = l_current_user_uchastok_g1);
END IF;
```

–¢–∞–∫ —Å–∞–º–æ –¥–ª—è —ñ–Ω—à–∏—Ö –∫–æ–º–±—ñ–Ω–∞—Ü—ñ–π (–ø–æ–∑–∏—Ü—ñ—è + –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç + –±–ª–æ–∫, –ø–æ–∑–∏—Ü—ñ—è —Ç—ñ–ª—å–∫–∏ —ñ —Ç.–¥.), –¥–µ –≤—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è `UCHASTOK`.

---

### ‚úÖ –ü—Ä–∏–∫–ª–∞–¥: –¥–æ–ø–æ–≤–Ω–µ–Ω–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–ª—è `position_id + department_id`

```plsql
IF l_list_position_id IS NOT NULL AND l_list_department_id IS NOT NULL AND l_list_unit_id IS NULL THEN
  IF l_list_position_id = l_current_user_position_g1 THEN
    l_is_position := true;
  ELSE
    l_is_position := false;
  END IF;

  IF l_list_department_id = l_current_user_department_g1 THEN
    l_is_department := true;
  ELSE
    l_is_department := false;
  END IF;

  IF l_list_uchastok IS NULL THEN
    l_is_role := l_is_position AND l_is_department;
  ELSE
    l_is_role := l_is_position AND l_is_department AND (l_list_uchastok = l_current_user_uchastok_g1);
  END IF;
```

---

### üìå –ü–æ—Ä–∞–¥–∞

–©–æ–± –∑–º–µ–Ω—à–∏—Ç–∏ –¥—É–±–ª—ñ–∫–∞—Ç –∫–æ–¥—É, –º–æ–∂–µ—à –≤–∏–Ω–µ—Å—Ç–∏ –ª–æ–≥—ñ–∫—É –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è `uchastok` —É —Ñ—É–Ω–∫—Ü—ñ—é:

```plsql
FUNCTION is_uchastok_match(p_val VARCHAR2, p_user_val VARCHAR2) RETURN BOOLEAN IS
BEGIN
  RETURN (p_val IS NULL OR p_val = p_user_val);
END;
```

–Ü –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:

```plsql
l_is_role := l_is_position AND l_is_department AND is_uchastok_match(l_list_uchastok, l_current_user_uchastok_g1);
```

---

–ì–æ—Ç–æ–≤–∏–π –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∞–¥–∞–ø—Ç—É–≤–∞—Ç–∏ —ñ–Ω—à—ñ –±–ª–æ–∫–∏ (–∑ unit, –∑ tab\_no) –∑–∞ –ø–æ—Ç—Ä–µ–±–æ—é.
