–©–æ–± –¥–æ–¥–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –π –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–Ω–æ–ø–∫–∏ **¬´–í—ñ–¥–º—ñ—Ç–∫–∞ –≤—ñ–¥ —ñ–º–µ–Ω—ñ¬ª** –≤ –æ—Å–Ω–æ–≤–Ω–∏–π PL/SQL-–∫–æ–¥ (–¥–µ –±—É–¥—É—î—Ç—å—Å—è –∫–∞—Ä—Ç–∫–∞ –≤—ñ–¥–º—ñ—Ç–∫–∏), –Ω–∞–π–∫—Ä–∞—â–µ –≤–±—É–¥—É–≤–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É **–ø—ñ—Å–ª—è –ø–æ–±—É–¥–æ–≤–∏ –æ—Å–Ω–æ–≤–Ω–æ—ó –∫–Ω–æ–ø–∫–∏ "–í—ñ–¥–º—ñ—Ç–∫–∞"**, —É —á–∞—Å—Ç–∏–Ω—ñ, –¥–µ `l_is_role = true`, —Ç–æ–±—Ç–æ –≤ –º–µ–∂–∞—Ö –∫–æ–∂–Ω–æ—ó –≥—ñ–ª–∫–∏ `IF`.

### ‚úÖ –©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ:

1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –ø–æ—Ç–æ—á–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î **—Ä–æ–ª—å `EXTEND_SIGN`**.
2. –Ø–∫—â–æ –º–∞—î, —ñ –π–æ–≥–æ `DEPARTMENT_ID = SIGNATURERIGHTS.DEPARTMENT_ID` —Ç–∞ `POSITION_ID ‚â† 2206 AND ‚â† 2246` ‚Äî –≤–∏–∫–ª–∏–∫–∞—î–º–æ `PL/SQL`-–±–ª–æ–∫ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫–Ω–æ–ø–∫–∏ **"–í—ñ–¥–º—ñ—Ç–∫–∞ –≤—ñ–¥ —ñ–º–µ–Ω—ñ"**.

---

### üîß –Ø–∫ –≤—Å—Ç–∞–≤–∏—Ç–∏:

–í—Å—Ç–∞–≤–ª—è—î–º–æ –Ω–∏–∂—á–µ –∫–æ–∂–Ω–æ–≥–æ –º—ñ—Å—Ü—è, –¥–µ –±—É–¥—É—î—Ç—å—Å—è –æ—Å–Ω–æ–≤–Ω–∞ –∫–Ω–æ–ø–∫–∞ `confirm-signature-button`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

```plsql
IF l_is_role AND l_count_cb = 0 THEN
    HTP.P('<button id="signature-btn" data-signature-id="'|| l_signature_id || '" class="confirm-signature-button">' || l_substage_btn_text || '</button>');
    l_count_cb := l_count_cb + 1;

    -- üîπ –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É "–í—ñ–¥–º—ñ—Ç–∫–∞ –≤—ñ–¥ —ñ–º–µ–Ω—ñ"
    DECLARE
        v_dolznost        NUMBER;
        v_tseh_id         NUMBER;
        v_uchastok        VARCHAR2(100);
        v_kategoria_otiz  NUMBER;

        v_user_id         NUMBER := l_list_tab_no; -- SIGNATURERIGHTS.USER_ID
        v_position_id     NUMBER := l_list_position_id;
        v_department_id   NUMBER := l_list_department_id;
        v_uchastok_cond   VARCHAR2(100); -- —è–∫—â–æ —î –≤ SIGNATURERIGHTS

        v_cur_position_id   NUMBER := l_current_user_position_g1;
        v_cur_department_id NUMBER := l_current_user_department_g1;
        v_cur_uchastok      VARCHAR2(100) := NVL(:P0_NEW_UCHASTOK, :P0_CURRENT_UCHASTOK);
        v_cur_kategoria     NUMBER := NVL(:P0_NEW_KATEGORIYA_OTIZ, :P0_CURRENT_KATEGORIYA_OTIZ);

        v_show_button BOOLEAN := FALSE;
    BEGIN
        IF v_user_id IS NOT NULL THEN
            SELECT t.DOLZNOST, t.TSEH_ID, t.UCHASTOK, t.KATEGORIA_OTIZ
            INTO v_dolznost, v_tseh_id, v_uchastok, v_kategoria_otiz
            FROM USERS t
            WHERE t.TAB_NO = v_user_id
              AND t.PRIZNAK IS NULL;
        ELSE
            SELECT t.DOLZNOST, t.TSEH_ID, t.UCHASTOK, t.KATEGORIA_OTIZ
            INTO v_dolznost, v_tseh_id, v_uchastok, v_kategoria_otiz
            FROM USERS t
            WHERE t.PRIZNAK IS NULL
              AND t.DOLZNOST = v_position_id
              AND t.TSEH_ID = v_department_id
              AND (v_uchastok_cond IS NULL OR t.UCHASTOK = v_uchastok_cond)
              AND ROWNUM = 1;
        END IF;

        IF v_cur_department_id = v_tseh_id
           AND v_cur_position_id = v_dolznost
           AND (v_uchastok_cond IS NULL OR v_cur_uchastok = v_uchastok)
           AND v_kategoria_otiz = 1
           AND APEX_ACL.HAS_USER_ROLE(:APP_ID, :APP_USER, 'EXTEND_SIGN')
           AND v_cur_position_id NOT IN (2206, 2246) THEN

            v_show_button := TRUE;
        END IF;

        IF v_show_button THEN
            HTP.P('<button id="sign-byname-btn" data-signature-id="'|| l_signature_id || '" class="byname-signature-button">–í—ñ–¥–º—ñ—Ç–∫–∞ –≤—ñ–¥ —ñ–º–µ–Ω—ñ</button>');
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN NULL;
        WHEN OTHERS THEN
            HTP.P('<span class="error">–ü–æ–º–∏–ª–∫–∞: ' || SQLERRM || '</span>');
    END;
```

---

### ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

* –ü—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏ —Ü—å–æ–≥–æ –∫–æ–¥—É ‚Äî –±–∞–∂–∞–Ω–æ **—É–Ω—ñ—Ñ—ñ–∫—É–≤–∞—Ç–∏ –π–æ–≥–æ –≤ –æ–∫—Ä–µ–º—É —Ñ—É–Ω–∫—Ü—ñ—é**, —è–∫—â–æ –ø–æ–≤—Ç–æ—Ä—é—î—Ç—å—Å—è.
* –í—Ä–∞—Ö—É–π, —â–æ `:P0_NEW_UCHASTOK` —ñ `:P0_CURRENT_UCHASTOK` –º–∞—é—Ç—å –±—É—Ç–∏ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –≤ `Global Page`.

---

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ ‚Äî —è –º–æ–∂—É –æ–∫—Ä–µ–º–æ –≤–∏–¥—ñ–ª–∏—Ç–∏ —Ü–µ–π –∫–æ–¥ —É —Ñ—É–Ω–∫—Ü—ñ—é —Ç–∏–ø—É `RETURN VARCHAR2` –∞–±–æ PL/SQL-–ø—Ä–æ—Ü–µ–¥—É—Ä—É, —è–∫—É –ø–æ—Ç—ñ–º –≤—Å—Ç–∞–≤–∏—à —á–µ—Ä–µ–∑ `htp.p`. –ù–∞–ø–∏—à–∏, —è–∫—â–æ —Ö–æ—á–µ—à –æ—Ñ–æ—Ä–º–∏—Ç–∏ –∫–æ–º–ø–∞–∫—Ç–Ω–æ.
