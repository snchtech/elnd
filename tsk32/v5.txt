–û—Å—å —è–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ **—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó —á–µ—Ä–µ–∑ AJAX** –∑–∞–º—ñ—Å—Ç—å `Before Header`, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è —Å–µ—Å—ñ—ó:

---

## ‚úÖ **–ü—Ä–∏–∫–ª–∞–¥: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó —á–µ—Ä–µ–∑ AJAX Process**

---

### üîπ 1. **–°—Ç–≤–æ—Ä–∏ AJAX-–ø—Ä–æ—Ü–µ—Å**

1. –£ **Shared Components ‚Üí Processes** (–∞–±–æ –ø—Ä—è–º–æ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ)
2. –¢–∏–ø: `PL/SQL`
3. –ù–∞–∑–≤–∞: `CREATE_CONFIRM_CART_COLLECTION`
4. –ö–æ–¥:

```plsql
DECLARE
    l_query VARCHAR2(4000);
BEGIN
    -- –ü—ñ–¥—Å—Ç–∞–≤–ª—è—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (ITEMS)
    -- –ù–∞–ø—Ä–∏–∫–ª–∞–¥: P5_TASK_ID, P5_STAGE_ID, P5_SUBSTAGE_ID
    l_query := '
        SELECT p.short_name,
               dp.short_name,
               un.name,
               sr.STAGES_ID,
               NULL,
               sr.SORT_ORDER,
               sr.TASK_ID,
               sr.USER_TABNO,
               sr.POSITION_ID,
               sr.DEPARTMENT_ID,
               sr.UNIT_ID,
               sr.ID
          FROM TaskTracker.SIGNATURERIGHTS@TO_TASKTRACKER10 sr
          LEFT JOIN TaskTracker.Dict_App_Confirm_List@TO_TASKTRACKER10 d
            ON sr.Stages_Id = d.id
          LEFT JOIN TaskTracker.POSADA_FOR_CONFIRMLIST_V@TO_TASKTRACKER10 p
            ON sr.Position_Id = p.kod
          LEFT JOIN TaskTracker.DEPART_CONFIRMLIST_V@TO_TASKTRACKER10 dp
            ON sr.department_id = dp.id
          LEFT JOIN TaskTracker.DICT_UNIT@TO_TASKTRACKER10 un
            ON sr.unit_id = un.id
         WHERE sr.TASK_ID = ' || TO_NUMBER(:P5_TASK_ID) || '
           AND d.parent_stage_id IS NOT NULL
           AND sr.STAGES_ID = ' || TO_NUMBER(:P5_SUBSTAGE_ID) || '
         ORDER BY d.id, sr.Stages_Id, sr.sort_order';

    -- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó
    IF APEX_COLLECTION.COLLECTION_EXISTS(p_collection_name => 'CONFIRM_CART_' || :P5_STAGE_ID || '_' || :P5_SUBSTAGE_ID) THEN
        APEX_COLLECTION.DELETE_COLLECTION(p_collection_name => 'CONFIRM_CART_' || :P5_STAGE_ID || '_' || :P5_SUBSTAGE_ID);
    END IF;

    APEX_COLLECTION.CREATE_COLLECTION_FROM_QUERY(
        p_collection_name => 'CONFIRM_CART_' || :P5_STAGE_ID || '_' || :P5_SUBSTAGE_ID,
        p_query           => l_query,
        p_generate_md5    => 'YES'
    );
END;
```

> ‚ö†Ô∏è –ó–∞–º—ñ–Ω—ñ—Ç—å `:P5_TASK_ID`, `:P5_STAGE_ID`, `:P5_SUBSTAGE_ID` –Ω–∞ —Å–≤–æ—ó item-–∏, —è–∫—â–æ –≤–æ–Ω–∏ —ñ–Ω—à—ñ

---

### üîπ 2. **–î–æ–¥–∞–π Dynamic Action –Ω–∞ Page Load –∞–±–æ –∫–Ω–æ–ø–∫—É**

* **Event**: `Page Load` (–∞–±–æ `Click` –∫–Ω–æ–ø–∫–∏)
* **True Action**: `Execute PL/SQL Code (AJAX Callback)`

  * **PL/SQL Code**:

    ```plsql
    NULL;
    ```
  * **AJAX Identifier**: `CREATE_CONFIRM_CART_COLLECTION`
  * **Page Items to Submit**: `P5_TASK_ID, P5_STAGE_ID, P5_SUBSTAGE_ID`
  * **Items to Return**: –Ω—ñ—á–æ–≥–æ

---

### üîπ 3. **–ü—ñ—Å–ª—è –≤–∏–∫–ª–∏–∫—É ‚Äì –æ–Ω–æ–≤–∏ —Ä–µ–≥—ñ–æ–Ω**

* –î–æ–¥–∞–π –¥—Ä—É–≥—É –¥—ñ—é –¥–æ —Ü—å–æ–≥–æ –∂ DA:

  * **Action**: `Refresh`
  * **Selection Type**: `Region`
  * **Region**: –æ–±–µ—Ä–∏ —Ç–æ–π, —â–æ –ø–æ–±—É–¥–æ–≤–∞–Ω–∏–π –Ω–∞ –∫–æ–ª–µ–∫—Ü—ñ—ó `CONFIRM_CART_*`

---

### üîπ 4. **–ü—Ä–∏–±–µ—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó –∑ Before Header**

* –í–∏–¥–∞–ª–∏ –∞–±–æ –≤–∏–º–∫–Ω–∏ —Å—Ç–∞—Ä–∏–π `Before Header` PL/SQL

---

## üîÅ –†–µ–∑—É–ª—å—Ç–∞—Ç:

* –ö–æ–ª–µ–∫—Ü—ñ—è —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è **—á–µ—Ä–µ–∑ AJAX** –ª–∏—à–µ –∫–æ–ª–∏ —Ç–∏ —è–≤–Ω–æ —ó—ó –≤–∏–∫–ª–∏–∫–∞—î—à
* –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–µ –±–ª–æ–∫—É—î —Å–µ—Å—ñ—é
* –ú–æ–∂–µ—à –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —ó—ó –Ω–∞–≤—ñ—Ç—å –ø—ñ–∑–Ω—ñ—à–µ, –ø—ñ—Å–ª—è —Ç–æ–≥–æ —è–∫ –æ—Å–Ω–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–ª–∞—Å—å

---

## üîß –ë–æ–Ω—É—Å: –Ø–∫—â–æ –∫–æ–ª–µ–∫—Ü—ñ–π –±–∞–≥–∞—Ç–æ

* –ó—Ä–æ–±–∏ AJAX-–ø—Ä–æ—Ü–µ—Å —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–º: –ø–µ—Ä–µ–¥–∞–≤–∞–π `STAGE_ID`, `SUBSTAGE_ID` —è–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
* –í–∏–∫–ª–∏–∫–∞–π –π–æ–≥–æ —É —Ü–∏–∫–ª—ñ —á–µ—Ä–µ–∑ JavaScript –∞–±–æ –æ–∫—Ä–µ–º–æ –Ω–∞ –∫–ª—ñ–∫–∏

---

–Ø–∫—â–æ —Å–∫–∞–∂–µ—à, —è–∫–∞ —Å–∞–º–µ —É —Ç–µ–±–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `TASK_ID`, `STAGE_ID`, `SUBSTAGE_ID` –∞–±–æ –±–ª–æ–∫—ñ–≤ ‚Äî —è –º–æ–∂—É –∞–¥–∞–ø—Ç—É–≤–∞—Ç–∏ —Ü–µ–π –ø—Ä–∏–∫–ª–∞–¥ –¥–æ —Ç–≤–æ–≥–æ –∫–æ–¥—É.
