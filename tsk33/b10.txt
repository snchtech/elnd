–¢–∞–∫, —Ç–≤–æ—è —Ñ—É–Ω–∫—Ü—ñ—è –≤–∂–µ –≤—Ä–∞—Ö–æ–≤—É—î **–ª–∏—à–µ –æ–¥–∏–Ω `SOURCE_ID`** ‚Äî –≤–æ–Ω–∞ **–¥–æ–¥–∞—î –≤—Å—ñ —Ä—è–¥–∫–∏ –∑ –æ–¥–Ω–∞–∫–æ–≤–∏–º `SOURCE_ID`**, —è–∫—â–æ **—Ö–æ—á–∞ –± –æ–¥–∏–Ω –∑ –Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Ñ—ñ–ª—å—Ç—Ä–∞–º**.

–¢–µ–ø–µ—Ä –¥–æ–æ–ø—Ä–∞—Ü—é—î–º–æ —ó—ó —Ç–∞–∫, —â–æ–± –ø—Ä–∏ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∞ `department`, —Ç–∞–∫–æ–∂ –ø–µ—Ä–µ–≤—ñ—Ä—è–≤—Å—è `SR_DEPARTMENT_ID`, **—è–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞**, —è–∫—â–æ `DEPARTMENT_ID` –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î.

---

## ‚úÖ –©–æ —Ç—Ä–µ–±–∞ –∑–º—ñ–Ω–∏—Ç–∏:

1. –£ –º—ñ—Å—Ü—è—Ö, –¥–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è `DEPARTMENT_ID`, –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ç–∞–∫–æ–∂ `SR_DEPARTMENT_ID`
2. –Ø–∫—â–æ **—Ö–æ—á –æ–¥–Ω–µ –∑ –Ω–∏—Ö** –¥–æ—Ä—ñ–≤–Ω—é—î –∑–Ω–∞—á–µ–Ω–Ω—é `department` ‚Üí —Ü–µ `matches = true`

---

## üîß –û–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è:

```javascript
function filterData(data, position, department, unit) {
  const uniqueSourceIDs = new Set();
  const result = [];

  // Step 1: Loop through the data and collect items with matching filters
  data.forEach(el => {
    // Skip already processed SOURCE_IDs
    if (uniqueSourceIDs.has(el.SOURCE_ID)) {
      return;
    }

    let matches = true;

    // Apply position filter if provided
    if (position !== null && position !== undefined) {
      matches = matches && el.POSITION_ID === position;
    }

    // Apply department filter with extended logic
    if (department !== null && department !== undefined) {
      const depMatch = el.DEPARTMENT_ID === department;
      const srDepMatch = el.SR_DEPARTMENT_ID !== null && el.SR_DEPARTMENT_ID === department;
      matches = matches && (depMatch || srDepMatch);
    }

    // Apply unit filter if provided
    if (unit !== null && unit !== undefined) {
      matches = matches && el.U_ID === unit;
    }

    // If the current item matches, add only the matching items with the same SOURCE_ID
    if (matches) {
      data.forEach(item => {
        if (item.SOURCE_ID === el.SOURCE_ID) {
          let itemMatches = true;

          if (position !== null && position !== undefined) {
            itemMatches = itemMatches && item.POSITION_ID === position;
          }

          if (department !== null && department !== undefined) {
            const depMatch = item.DEPARTMENT_ID === department;
            const srDepMatch = item.SR_DEPARTMENT_ID !== null && item.SR_DEPARTMENT_ID === department;
            itemMatches = itemMatches && (depMatch || srDepMatch);
          }

          if (unit !== null && unit !== undefined) {
            itemMatches = itemMatches && item.U_ID === unit;
          }

          if (itemMatches) {
            result.push(item);
          }
        }
      });

      // Mark the SOURCE_ID as processed
      uniqueSourceIDs.add(el.SOURCE_ID);
    }
  });

  return result;
}
```

---

## ‚úÖ –ü—Ä–∏–∫–ª–∞–¥ –ø–æ–≤–µ–¥—ñ–Ω–∫–∏:

```js
const data = [
  { SOURCE_ID: 681, POSITION_ID: null, DEPARTMENT_ID: null, U_ID: 1, SR_DEPARTMENT_ID: 1100 },
  { SOURCE_ID: 681, POSITION_ID: null, DEPARTMENT_ID: 1100, U_ID: null, SR_DEPARTMENT_ID: null },
  { SOURCE_ID: 681, POSITION_ID: 654, DEPARTMENT_ID: 1100, U_ID: 2, SR_DEPARTMENT_ID: null },
  { SOURCE_ID: 100, POSITION_ID: 854, DEPARTMENT_ID: 1100, U_ID: 1, SR_DEPARTMENT_ID: null },
  { SOURCE_ID: 101, POSITION_ID: 812, DEPARTMENT_ID: null, U_ID: 2, SR_DEPARTMENT_ID: 1100 },
];

const filtered = filterData(data, null, 1100, null);
console.log(filtered);
```

> –£ —Ü—å–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ –±—É–¥—É—Ç—å –≤—Ä–∞—Ö–æ–≤–∞–Ω—ñ –≤—Å—ñ –∑–∞–ø–∏—Å–∏ –∑ `SOURCE_ID = 681`, —è–∫—â–æ —Ö–æ—á–∞ –± –æ–¥–∏–Ω –∑ –Ω–∏—Ö –º–∞—î `DEPARTMENT_ID = 1100` **–∞–±–æ** `SR_DEPARTMENT_ID = 1100`.

---

## üìå –ü–æ—è—Å–Ω–µ–Ω–Ω—è:

| –ü–æ–ª–µ            | –£–º–æ–≤–∞ –¥–ª—è `matches`                                                                        |
| --------------- | ------------------------------------------------------------------------------------------ |
| `POSITION_ID`   | –¢–æ—á–Ω–µ —Å–ø—ñ–≤–ø–∞–¥—ñ–Ω–Ω—è                                                                          |
| `DEPARTMENT_ID` | `DEPARTMENT_ID === department` **–∞–±–æ** `SR_DEPARTMENT_ID === department`                   |
| `U_ID`          | –¢–æ—á–Ω–µ —Å–ø—ñ–≤–ø–∞–¥—ñ–Ω–Ω—è                                                                          |
| `SOURCE_ID`     | –Ø–∫—â–æ —Ö–æ—á –æ–¥–∏–Ω –∑–∞–ø–∏—Å –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î ‚Äî –±–µ—Ä–µ–º–æ **–≤—Å—ñ** –∑ —Ç–∞–∫–∏–º `SOURCE_ID`, –∞–ª–µ —Ñ—ñ–ª—å—Ç—Ä—É—î–º–æ —â–µ —Ä–∞–∑ |

---

–•–æ—á–µ—à ‚Äî –º–æ–∂—É –∞–¥–∞–ø—Ç—É–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —á–µ—Ä–µ–∑ `Array.filter()` –∞–±–æ –∑—Ä–æ–±–∏—Ç–∏ –≤–µ—Ä—Å—ñ—é –∑ –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫–æ–º –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∑–±—ñ–≥—ñ–≤ –ø–æ –∫–æ–∂–Ω–æ–º—É —Ñ—ñ–ª—å—Ç—Ä—É.
