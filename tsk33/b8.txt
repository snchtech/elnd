–ß—É–¥–æ–≤–µ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è ‚Äî —Ç–∏ —á—ñ—Ç–∫–æ –ø—ñ–¥–º—ñ—Ç–∏–≤ —Å—É—Ç—å: –∑–∞–ø–∏—Ç –¥–æ `SIGNATURERIGHTS@TO_TASKTRACKER10` –∑ –∫—ñ–ª—å–∫–æ–º–∞ `LEFT JOIN` + `dblink` –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è **0.250‚Äì0.300 —Å–µ–∫—É–Ω–¥**, —â–æ –¥–ª—è APEX (–æ—Å–æ–±–ª–∏–≤–æ —è–∫—â–æ –∫–æ–ª–µ–∫—Ü—ñ—è —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –≤ `Before Header`) ‚Äî **–º–æ–∂–µ —Å–ø—Ä–∏—á–∏–Ω—è—Ç–∏ –∑–∞–≤–∏—Å–∞–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∞–±–æ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –±–ª–æ–∫—É–≤–∞–Ω—å**.

---

## ‚ùì –ß–∏ –¥–æ–ø–æ–º–æ–∂–µ –ø—Ä–æ–º—ñ–∂–Ω–∞ –≤—Å—Ç–∞–≤–∫–∞ –≤ —Ç–∏–º—á–∞—Å–æ–≤—É —Ç–∞–±–ª–∏—Ü—é?

### ‚úÖ **–¢–ê–ö, –¥–æ–ø–æ–º–æ–∂–µ —É 2 –≤–∞–∂–ª–∏–≤–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö:**

---

### üîπ **1. –Ø–∫—â–æ —Ç–∏ –≤–∏–∫–æ–Ω—É—î –æ–¥–∏–Ω —ñ —Ç–æ–π —Å–∞–º–∏–π —Å–∫–ª–∞–¥–Ω–∏–π –∑–∞–ø–∏—Ç –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤ —É —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ `PL/SQL` –±–ª–æ–∫—É**

> –ù–∞–ø—Ä–∏–∫–ª–∞–¥:

* 1 —Ä–∞–∑ –≤–∏–∫–ª–∏–∫–∞—î—à —É `CREATE_COLLECTION_FROM_QUERY`
* 2 —Ä–∞–∑ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—à –¥–∞–Ω—ñ –Ω–∞ —Ä—ñ–≤–Ω—ñ –ª–æ–≥—ñ–∫–∏

‚û°Ô∏è **–£ —Ç–∞–∫–æ–º—É –≤–∏–ø–∞–¥–∫—É –≤–∏–≥—ñ–¥–Ω–æ** —Å–ø–æ—á–∞—Ç–∫—É –≤—Å—Ç–∞–≤–∏—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É `GTT`, –∞ –ø–æ—Ç—ñ–º —á–∏—Ç–∞—Ç–∏ –∑ –Ω–µ—ó.

---

### üîπ **2. –Ø–∫—â–æ APEX "—á–µ–∫–∞—î" –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤–≥–æ–≥–æ SQL –≤ –º–æ–º–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä—É —Å—Ç–æ—Ä—ñ–Ω–∫–∏**

> –ù–∞–ø—Ä–∏–∫–ª–∞–¥: `APEX_COLLECTION.CREATE_COLLECTION_FROM_QUERY` –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤ `Before Header`, —ñ —Ü–µ–π –∑–∞–ø–∏—Ç –¥–æ–≤–≥–∏–π

‚û°Ô∏è **–Ø–∫—â–æ –∑–∞–º—ñ–Ω–∏—Ç–∏ —Ü–µ –Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—é –≤—Å—Ç–∞–≤–∫—É `INSERT INTO TMP_SIGNRIGHTS` + —á–∏—Ç–∞–Ω–Ω—è –∑ `GTT`,** —Ç–æ:

* üîÅ –º–æ–∂–Ω–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ `INSERT /*+ APPEND */` —É –æ–∫—Ä–µ–º–æ–º—É AJAX-–ø—Ä–æ—Ü–µ—Å—ñ
* ‚úÖ —É `CREATE_COLLECTION_FROM_QUERY` –≤–∂–µ —à–≤–∏–¥–∫–æ —á–∏—Ç–∞—î—Ç—å—Å—è –∑ –ª–æ–∫–∞–ª—å–Ω–æ—ó —Ç–∏–º—á–∞—Å–æ–≤–æ—ó —Ç–∞–±–ª–∏—Ü—ñ
* ‚è± –∑–∞–≥–∞–ª—å–Ω–µ –≤—Ä–∞–∂–µ–Ω–Ω—è "—Å—Ç–æ—Ä—ñ–Ω–∫–∞ –≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è —à–≤–∏–¥—à–µ"

---

## üöÄ –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è:

| –ü—ñ–¥—Ö—ñ–¥                                                        | –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä—ñ | –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è APEX  | –ü—Ä–∏–¥–∞—Ç–Ω–∏–π –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó |
| ------------------------------------------------------------- | ---------------------- | ---------------- | ------------------------- |
| `CREATE_COLLECTION_FROM_QUERY (–¥–æ–≤–≥–∏–π SQL)`                   | ‚ùå –ß–µ–∫–∞—î –¥–æ–≤–≥–æ          | ‚ö†Ô∏è –ú–æ–∂–ª–∏–≤—ñ       | –ù—ñ                        |
| `INSERT INTO TMP` ‚Üí `CREATE_FROM_QUERY`                       | ‚úÖ –ú–µ–Ω—à–µ                | ‚úÖ –ú–µ–Ω—à–µ —Ä–∏–∑–∏–∫—É   | –¢–∞–∫                       |
| AJAX: —Å–ø–æ—á–∞—Ç–∫—É `INSERT`, –ø–æ—Ç—ñ–º `CREATE_COLLECTION_FROM_QUERY` | ‚úÖ –ü–ª–∞–≤–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è  | ‚úÖ –ë–µ–∑ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ           |

---

## üîß –©–æ —Ä–æ–±–∏—Ç–∏ —É —Ç–≤–æ—î–º—É –≤–∏–ø–∞–¥–∫—É:

### ‚úÖ **1. –°—Ç–≤–æ—Ä–∏ TMP-—Ç–∞–±–ª–∏—Ü—é:**

```sql
CREATE GLOBAL TEMPORARY TABLE TMP_SIGNRIGHTS (
  POSADA_SHORT_NAME VARCHAR2(255),
  DEPART_SHORT_NAME VARCHAR2(255),
  UNIT_NAME          VARCHAR2(255),
  STAGES_ID          NUMBER,
  SORT_ORDER         NUMBER,
  TASK_ID            NUMBER,
  USER_TABNO         VARCHAR2(100),
  POSITION_ID        NUMBER,
  DEPARTMENT_ID      NUMBER,
  UNIT_ID            NUMBER,
  SIGNRIGHT_ID       NUMBER
)
ON COMMIT DELETE ROWS;
```

---

### ‚úÖ **2. –í—Å—Ç–∞–≤ –¥–∞–Ω—ñ —Ç—É–¥–∏ —á–µ—Ä–µ–∑ `INSERT /*+ APPEND */ SELECT ...`**

```plsql
INSERT /*+ APPEND */ INTO TMP_SIGNRIGHTS
SELECT
  p.short_name,
  dp.short_name,
  un.name,
  sr.STAGES_ID,
  sr.SORT_ORDER,
  sr.TASK_ID,
  sr.USER_TABNO,
  sr.POSITION_ID,
  sr.DEPARTMENT_ID,
  sr.UNIT_ID,
  sr.ID
FROM TaskTracker.SIGNATURERIGHTS@TO_TASKTRACKER10 sr
LEFT JOIN TaskTracker.Dict_App_Confirm_List@TO_TASKTRACKER10 d
  ON sr.Stages_Id = d.id
LEFT JOIN TaskTracker.POSADA_FOR_CONFIRMLIST_V@TO_TASKTRACKER10 p
  ON sr.Position_Id = p.kod
LEFT JOIN TaskTracker.DEPART_CONFIRMLIST_V@TO_TASKTRACKER10 dp
  ON sr.department_id = dp.id
LEFT JOIN TaskTracker.DICT_UNIT@TO_TASKTRACKER10 un
  ON sr.unit_id = un.id
WHERE sr.TASK_ID = :P_TASK_ID
  AND d.parent_stage_id IS NOT NULL
  AND sr.STAGES_ID = :P_SUBSTAGE_ID;
```

---

### ‚úÖ **3. –°—Ç–≤–æ—Ä–∏ –∫–æ–ª–µ–∫—Ü—ñ—é –Ω–∞ –æ—Å–Ω–æ–≤—ñ TMP:**

```plsql
BEGIN
  IF APEX_COLLECTION.COLLECTION_EXISTS('CONFIRM_CART') THEN
    APEX_COLLECTION.DELETE_COLLECTION('CONFIRM_CART');
  END IF;

  APEX_COLLECTION.CREATE_COLLECTION_FROM_QUERY(
    p_collection_name => 'CONFIRM_CART',
    p_query => '
      SELECT
        POSADA_SHORT_NAME   AS c001,
        DEPART_SHORT_NAME   AS c002,
        UNIT_NAME           AS c003,
        STAGES_ID           AS c004,
        NULL                AS c005,
        SORT_ORDER          AS c006,
        TASK_ID             AS c007,
        USER_TABNO          AS c008,
        POSITION_ID         AS c009,
        DEPARTMENT_ID       AS c010,
        UNIT_ID             AS c011,
        SIGNRIGHT_ID        AS c012
      FROM TMP_SIGNRIGHTS',
    p_generate_md5 => 'YES'
  );
END;
```

---

## üß† –í–∏—Å–Ω–æ–≤–æ–∫:

| –Ø–∫—â–æ...                                             | –¢–æ...                                                          |
| --------------------------------------------------- | -------------------------------------------------------------- |
| –¢–≤—ñ–π –∑–∞–ø–∏—Ç **–ø–æ–≤—ñ–ª—å–Ω–∏–π**, —Å–∫–ª–∞–¥–Ω–∏–π, —á–µ—Ä–µ–∑ `@dblink` | ‚úÖ –†–æ–∑—É–º–Ω–æ —Ä–æ–∑–¥—ñ–ª–∏—Ç–∏ –Ω–∞ `INSERT INTO TMP` + `CREATE_COLLECTION` |
| –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è **–ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä—ñ**      | üîÅ –ú–æ–∂–Ω–∞ –≤–∏–Ω–µ—Å—Ç–∏ –≤ AJAX –∞–±–æ –ø—ñ–∑–Ω—ñ–π –≤–∏–∫–ª–∏–∫                      |
| –î–∞–Ω—ñ –±—É–¥—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤                | ‚úÖ TMP-—Ç–∞–±–ª–∏—Ü—è –¥–æ–∑–≤–æ–ª—è—î —É–Ω–∏–∫–Ω—É—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤             |

---

üîî –•–æ—á–µ—à ‚Äî –º–æ–∂—É –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø–æ–≤–Ω–∏–π –ø–∞–∫–µ—Ç (–≤—Å—Ç–∞–≤–∫–∞ –≤ TMP + —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó + –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è JSON/HTML) –∞–±–æ –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ —É –≤–∏–≥–ª—è–¥—ñ AJAX-–≤–∏–∫–ª–∏–∫—É –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.
