–û—Å—å **–ø–æ–≤–Ω–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è**, —è–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è APEX collection —á–µ—Ä–µ–∑ AJAX**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ç–∏–º—á–∞—Å–æ–≤—É —Ç–∞–±–ª–∏—Ü—é (GTT) ‚Äî —É —Ç–≤–æ—î–º—É –≤–∏–ø–∞–¥–∫—É –¥–ª—è `SIGNATURERIGHTS`.

---

## ‚úÖ **–ó–∞–¥–∞—á–∞:**

> –î–æ–≤–≥–∏–π –∑–∞–ø–∏—Ç (—ñ–∑ JOIN-–∞–º–∏ –ø–æ DBLINK) –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –æ–∫—Ä–µ–º–æ —á–µ—Ä–µ–∑ AJAX, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Ç—Ä–∞–ø–ª—è—î –≤ `TMP_SIGNRIGHTS`, –∞ –ø–æ—Ç—ñ–º —Ñ–æ—Ä–º—É—î—Ç—å—Å—è `APEX_COLLECTION`, —è–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –±–µ–∑ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è —Ä–µ–Ω–¥–µ—Ä—É.

---

## üîß **1. –°—Ç–≤–æ—Ä–∏ —Ç–∏–º—á–∞—Å–æ–≤—É —Ç–∞–±–ª–∏—Ü—é**

```sql
CREATE GLOBAL TEMPORARY TABLE TMP_SIGNRIGHTS (
  POSADA_SHORT_NAME   VARCHAR2(255),
  DEPART_SHORT_NAME   VARCHAR2(255),
  UNIT_NAME           VARCHAR2(255),
  STAGES_ID           NUMBER,
  SORT_ORDER          NUMBER,
  TASK_ID             NUMBER,
  USER_TABNO          VARCHAR2(100),
  POSITION_ID         NUMBER,
  DEPARTMENT_ID       NUMBER,
  UNIT_ID             NUMBER,
  SIGNRIGHT_ID        NUMBER
)
ON COMMIT DELETE ROWS;
```

---

## üîß **2. –°—Ç–≤–æ—Ä–∏ AJAX Callback Process**

–£ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ (–∞–±–æ —É Global Page):

* **–ù–∞–∑–≤–∞:** `LOAD_CONFIRM_COLLECTION`
* **Type:** PL/SQL
* **Code:**

```plsql
DECLARE
  l_task_id       NUMBER := APEX_APPLICATION.G_X01;
  l_substage_id   NUMBER := APEX_APPLICATION.G_X02;
BEGIN
  -- –û—á–∏—Å—Ç–∫–∞ TMP (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
  DELETE FROM TMP_SIGNRIGHTS;

  -- –í—Å—Ç–∞–≤–∫–∞ —É —Ç–∏–º—á–∞—Å–æ–≤—É —Ç–∞–±–ª–∏—Ü—é
  INSERT /*+ APPEND */ INTO TMP_SIGNRIGHTS (
    POSADA_SHORT_NAME,
    DEPART_SHORT_NAME,
    UNIT_NAME,
    STAGES_ID,
    SORT_ORDER,
    TASK_ID,
    USER_TABNO,
    POSITION_ID,
    DEPARTMENT_ID,
    UNIT_ID,
    SIGNRIGHT_ID
  )
  SELECT
    p.short_name,
    dp.short_name,
    un.name,
    sr.STAGES_ID,
    sr.SORT_ORDER,
    sr.TASK_ID,
    sr.USER_TABNO,
    sr.POSITION_ID,
    sr.DEPARTMENT_ID,
    sr.UNIT_ID,
    sr.ID
  FROM TaskTracker.SIGNATURERIGHTS@TO_TASKTRACKER10 sr
  LEFT JOIN TaskTracker.Dict_App_Confirm_List@TO_TASKTRACKER10 d
    ON sr.Stages_Id = d.id
  LEFT JOIN TaskTracker.POSADA_FOR_CONFIRMLIST_V@TO_TASKTRACKER10 p
    ON sr.Position_Id = p.kod
  LEFT JOIN TaskTracker.DEPART_CONFIRMLIST_V@TO_TASKTRACKER10 dp
    ON sr.department_id = dp.id
  LEFT JOIN TaskTracker.DICT_UNIT@TO_TASKTRACKER10 un
    ON sr.unit_id = un.id
  WHERE sr.TASK_ID = l_task_id
    AND d.parent_stage_id IS NOT NULL
    AND sr.STAGES_ID = l_substage_id;

  -- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó
  IF APEX_COLLECTION.COLLECTION_EXISTS('CONFIRM_CART_' || l_substage_id) THEN
    APEX_COLLECTION.DELETE_COLLECTION('CONFIRM_CART_' || l_substage_id);
  END IF;

  APEX_COLLECTION.CREATE_COLLECTION_FROM_QUERY(
    p_collection_name => 'CONFIRM_CART_' || l_substage_id,
    p_query => '
      SELECT
        POSADA_SHORT_NAME AS c001,
        DEPART_SHORT_NAME AS c002,
        UNIT_NAME         AS c003,
        STAGES_ID         AS c004,
        NULL              AS c005,
        SORT_ORDER        AS c006,
        TASK_ID           AS c007,
        USER_TABNO        AS c008,
        POSITION_ID       AS c009,
        DEPARTMENT_ID     AS c010,
        UNIT_ID           AS c011,
        SIGNRIGHT_ID      AS c012
      FROM TMP_SIGNRIGHTS',
    p_generate_md5 => 'YES'
  );

  -- –í–∏–≤—ñ–¥ —Å—Ç–∞—Ç—É—Å—É (JSON)
  APEX_JSON.OPEN_OBJECT;
  APEX_JSON.WRITE('status', 'ok');
  APEX_JSON.CLOSE_OBJECT;
END;
```

---

## ‚úÖ **3. JavaScript-—Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–ª–∏–∫—É**

–£–≤—ñ–º–∫–Ω–∏ **"Page Items to Submit"** (—è–∫—â–æ —Ç—Ä–µ–±–∞) –∞–±–æ –ø–µ—Ä–µ–¥–∞–≤–∞–π –∑–Ω–∞—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ `x01`, `x02`.

### üîπ –î–æ–¥–∞–π —É JS (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ —É Dynamic Action ‚Üí JS Code):

```javascript
function loadConfirmCollection(taskId, substageId) {
  apex.server.process("LOAD_CONFIRM_COLLECTION", {
    x01: taskId,
    x02: substageId
  }, {
    dataType: "json",
    success: function (pData) {
      if (pData.status === "ok") {
        console.log("–ö–æ–ª–µ–∫—Ü—ñ—é —Å—Ç–≤–æ—Ä–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ");
        // –¢—É—Ç –º–æ–∂–Ω–∞ –æ–Ω–æ–≤–∏—Ç–∏ —Ä–µ–≥—ñ–æ–Ω, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ü—é –∫–æ–ª–µ–∫—Ü—ñ—é
        apex.region("confirm_region_" + substageId).refresh();
      }
    },
    error: function (jqXHR, textStatus, errorThrown) {
      console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó", textStatus);
    }
  });
}
```

---

## üß© **4. –í–∏–∫–ª–∏–∫ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∞–±–æ –ø–æ–¥—ñ—ó**

–ù–∞–ø—Ä–∏–∫–ª–∞–¥:

```javascript
loadConfirmCollection($v('P6_TASK_ID'), 101); // 101 ‚Äî —Ü–µ STAGE_ID
```

---

## üìå –ü—ñ–¥—Å—É–º–æ–∫:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç                 | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è                                   |
| ------------------------- | --------------------------------------------- |
| `TMP_SIGNRIGHTS`          | –¢–∏–º—á–∞—Å–æ–≤–µ —Å—Ö–æ–≤–∏—â–µ –¥–ª—è –¥–∞–Ω–∏—Ö                   |
| `LOAD_CONFIRM_COLLECTION` | AJAX-–ø—Ä–æ—Ü–µ—Å –≤—Å—Ç–∞–≤–∫–∏ —ñ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó      |
| `apex.server.process`     | JS-–º–µ—Ç–æ–¥ –≤–∏–∫–ª–∏–∫—É –ø—Ä–æ—Ü–µ—Å—É —ñ –æ–±—Ä–æ–±–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É |
| `region().refresh()`      | –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–µ–≥—ñ–æ–Ω—É –∑ —Ü—ñ—î—é –∫–æ–ª–µ–∫—Ü—ñ—î—é            |

---

üîî –Ø–∫—â–æ —Ç–≤—ñ–π —Ä–µ–≥—ñ–æ–Ω –ø—Ä–∏–≤'—è–∑–∞–Ω–∏–π –¥–æ `CONFIRM_CART_{STAGE_ID}`, –ø—Ä–æ—Å—Ç–æ —Ñ–æ—Ä–º—É–π –π–æ–≥–æ –Ω–∞–∑–≤—É –¥–∏–Ω–∞–º—ñ—á–Ω–æ —ñ –≤–∏–∫–ª–∏–∫–∞–π `apex.region(...).refresh()` –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è.

–•–æ—á–µ—à ‚Äî —è –º–æ–∂—É –∑—Ä–æ–±–∏—Ç–∏ –ø–æ–≤–Ω–∏–π —à–∞–±–ª–æ–Ω (–≤–∫–ª—é—á–∞—é—á–∏ DA, refresh, –∑–≤'—è–∑–æ–∫ —ñ–∑ —Ä–µ–≥—ñ–æ–Ω–æ–º).
