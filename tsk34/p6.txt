–¢–≤—ñ–π –∑–∞–ø–∏—Ç —Å–ø—Ä–∞–≤–¥—ñ –¥–æ—Å–∏—Ç—å —Å–∫–ª–∞–¥–Ω–∏–π —ñ –≥–ª–∏–±–æ–∫–æ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∏–π. –¶–µ –º–æ–∂–µ —Å—É—Ç—Ç—î–≤–æ –≤–ø–ª–∏–≤–∞—Ç–∏ –Ω–∞ **—à–≤–∏–¥–∫—ñ—Å—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –≤ APEX**, –æ—Å–æ–±–ª–∏–≤–æ –≤ —Ç–∞–∫–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö:

---

## üîç –ü—Ä–∏—á–∏–Ω–∏ –º–æ–∂–ª–∏–≤–æ—ó –ø–æ–≤—ñ–ª—å–Ω–æ—Å—Ç—ñ:

| –ü—Ä–∏—á–∏–Ω–∞                                        | –î–µ—Ç–∞–ª—ñ                                                                                                      |
| ---------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| üîÅ **–†–µ–∫—É—Ä—Å–∏–≤–Ω–∏–π CTE** (`WITH subtask_tree`)   | –ü—Ä–∏ –≤–µ–ª–∏–∫—ñ–π –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å —ñ–∑ –≤–∫–ª–∞–¥–µ–Ω—ñ—Å—Ç—é (–æ—Å–æ–±–ª–∏–≤–æ 3+ —Ä—ñ–≤–Ω—ñ–≤), —Ä–µ–∫—É—Ä—Å—ñ—è –≤–∏—Ç—Ä–∞—á–∞—î –±–∞–≥–∞—Ç–æ —Ä–µ—Å—É—Ä—Å—ñ–≤     |
| üì¶ **APEX\_COLLECTION**                        | –î–∞–Ω—ñ –∑ –∫–æ–ª–µ–∫—Ü—ñ–π –Ω–µ –º–∞—é—Ç—å —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—ó ‚Äî —Ü–µ **–ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ**, –Ω—ñ–∂ –∑–≤–∏—á–∞–π–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ, –æ—Å–æ–±–ª–∏–≤–æ –ø—Ä–∏ `JOIN`          |
| üåê **Remote JOIN** (—á–µ—Ä–µ–∑ `@TO_TASKTRACKER10`) | –ó'—î–¥–Ω–∞–Ω–Ω—è –∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ–º DB link ‚Äî **–≤–µ–ª–∏–∫–µ –¥–∂–µ—Ä–µ–ª–æ –∑–∞—Ç—Ä–∏–º–æ–∫**                                                 |
| üìä **ROWNUM/ROW\_NUMBER()** –≤ —Ä–µ–∫—É—Ä—Å—ñ—ó         | –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —à–ª—è—Ö—ñ–≤ —ñ –Ω–æ–º–µ—Ä—ñ–≤ –ø–æ—Ä—è–¥–∫—É –≤ –∫–æ–∂–Ω—ñ–π —ñ—Ç–µ—Ä–∞—Ü—ñ—ó —Ç–µ–∂ –Ω–∞–≤–∞–Ω—Ç–∞–∂—É—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è                               |
| ‚õì **LEFT JOIN signaturehistory**               | –¶–µ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –∑–∞–ø–∏—Ç –¥–æ –≤–µ–ª–∏–∫–æ—ó —Ç–∞–±–ª–∏—Ü—ñ, –æ—Å–æ–±–ª–∏–≤–æ –∑ `FETCH FIRST ROW` –∞–±–æ `JOIN` –±–µ–∑ —ñ–Ω–¥–µ–∫—Å—É –Ω–∞ `subtask_id` |

---

## üìå –©–æ –≥—ñ—Ä—à–µ: `RETURN FUNCTION` —á–∏ `SQL Query`?

–£ **–ø–æ—Ç–æ—á–Ω–æ–º—É APEX Interactive Grid**:

* `RETURN FUNCTION BODY SQL` –∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è **–¥–∏–Ω–∞–º—ñ—á–Ω–æ**, **–∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É** –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ ‚Üí —Ü–µ **—Å–ø–æ–≤—ñ–ª—å–Ω—é—î**
* `SQL Query` (—è–∫—â–æ –∑–∞–ø–∏—Å–∞–Ω–∏–π –Ω–∞–ø—Ä—è–º—É –≤ IG) **–∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è –∑–∞–∑–¥–∞–ª–µ–≥—ñ–¥—å** ‚Üí **—à–≤–∏–¥—à–µ**
* –ê–ª–µ: —è–∫—â–æ —Ç–æ–±—ñ –ø–æ—Ç—Ä—ñ–±–Ω–∞ **–≥–Ω—É—á–∫—ñ—Å—Ç—å** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —É–º–æ–≤–∏ `WHERE` —ñ–∑ `:P_ITEM`), —Ç–æ `Function Body` –≤—Å–µ —â–µ –º–∞—î —Å–µ–Ω—Å

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó: —â–æ –∑—Ä–æ–±–∏—Ç–∏

### üîπ 1. **–ü–µ—Ä–µ–Ω–µ—Å–∏ –∑–∞–ø–∏—Ç –≤ SQL Query**, —è–∫—â–æ –≤—ñ–Ω –Ω–µ –≤–∏–º–∞–≥–∞—î –¥–∏–Ω–∞–º—ñ—á–Ω–∏—Ö –∑–º—ñ–Ω –∑ PL/SQL:

```sql
-- –ë–µ–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è RETURN FUNCTION BODY
-- –í—Å—Ç–∞–≤ —É SQL Query —Ä–µ–≥—ñ–æ–Ω—É (Interactive Grid)
```

### üîπ 2. **–°—Ç–≤–æ—Ä–∏ view –∞–±–æ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—É view**, —è–∫—â–æ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –Ω–µ –∑–º—ñ–Ω—é—é—Ç—å—Å—è —â–æ—Ö–≤–∏–ª–∏–Ω–∏

```sql
CREATE OR REPLACE VIEW v_subtask_tree AS
<–ø–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ –∑ WITH subtask_tree>

-- –î–∞–ª—ñ –≤ APEX: SELECT * FROM v_subtask_tree WHERE TASK_ID = :P6_TASK_ID
```

> ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è View –¥–æ–∑–≤–æ–ª—è—î APEX –∑–∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏ –ø–ª–∞–Ω –∑–∞–ø–∏—Ç—É —ñ –∫–µ—à—É–≤–∞—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É

---

### üîπ 3. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Ç–∞–π–º–µ—Ä–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ–π**, –∞ –Ω–µ –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –∑–∞—Ö–æ–¥—ñ

* –ö–æ–ª–µ–∫—Ü—ñ—è –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏:

  * —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ
  * —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—ñ
* –ê –ø—Ä–∏ –ø–µ—Ä–µ–≥–ª—è–¥—ñ ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ —Å—Ç–≤–æ—Ä–µ–Ω—É

---

### üîπ 4. **–í–∏–Ω–µ—Å–∏ JOIN –∑ Remote DB –≤ –æ–∫—Ä–µ–º—É —á–∞—Å—Ç–∏–Ω—É**

```sql
-- –∞–±–æ:
LEFT JOIN (
  SELECT subtask_id, MIN(signright_id) AS sign_id
  FROM TaskTracker.signaturerights@TO_TASKTRACKER10
  GROUP BY subtask_id
) sr ON sr.subtask_id = st.sbtsk_id

LEFT JOIN TaskTracker.signaturehistory@TO_TASKTRACKER10 sh
ON sh.signright_id = sr.sign_id
```

> –¶–µ –∑–º–µ–Ω—à—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ–±—Ä–æ–±–ª–µ–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤

---

### üîπ 5. **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π APEX\_COLLECTION.CREATE\_COLLECTION\_FROM\_QUERY** –¥–ª—è —Å–∫–ª–∞–¥–Ω–æ—ó –ª–æ–≥—ñ–∫–∏

```plsql
APEX_COLLECTION.CREATE_COLLECTION_FROM_QUERY (
  p_collection_name => 'TASK_SUBTASKS_COLLECTION',
  p_query => 'SELECT ... (—Ç–≤–æ—è –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ –≤–µ—Ä—Å—ñ—è –∑ JOIN)'
);
```

* –Ü –ø–æ—Ç—ñ–º IG –ø—Ä–∞—Ü—é—î –≤–∂–µ –∑ –ø—Ä–æ—Å—Ç–∏–º:

```sql
SELECT * FROM apex_collections WHERE collection_name = 'TASK_SUBTASKS_COLLECTION'
```

---

## üß† –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –ø—ñ–¥—Ö—ñ–¥:

1. **–°—Ç–≤–æ—Ä–∏—Ç–∏ SQL View** —ñ–∑ —Ç–≤–æ—ó–º —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∏–º –∑–∞–ø–∏—Ç–æ–º
2. –£ –ø—Ä–æ—Ü–µ—Å—ñ `BEFORE HEADER` –≤–∏–∫–ª–∏–∫–∞—Ç–∏:

```plsql
APEX_COLLECTION.CREATE_COLLECTION_FROM_QUERY(
  p_collection_name => 'TASK_SUBTASKS_COLLECTION',
  p_query => 'SELECT * FROM v_subtask_tree WHERE TASK_ID = :P6_TASK_ID'
);
```

3. –ê –≤ IG –≤–∫–∞–∑–∞—Ç–∏ –∑–≤–∏—á–∞–π–Ω–∏–π `SELECT * FROM apex_collections ...`

---

## üìà –í–∏—Å–Ω–æ–≤–æ–∫:

| –í–∞—Ä—ñ–∞–Ω—Ç                        | –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å | –ì–Ω—É—á–∫—ñ—Å—Ç—å   | –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ           |
| ------------------------------ | -------------- | ----------- | ----------------------- |
| `RETURN FUNCTION BODY SQL`     | ‚ùå –ü–æ–≤—ñ–ª—å–Ω–æ     | ‚úÖ –¢–∞–∫       | üîª –ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è    |
| –ü—Ä—è–º–∏–π `SQL Query`             | ‚úÖ –®–≤–∏–¥–∫–æ       | üî∏ –û–±–º–µ–∂–µ–Ω–æ | ‚úÖ –¢–∞–∫                   |
| `View + Collection from query` | ‚úÖ –®–≤–∏–¥–∫–æ       | ‚úÖ –¢–∞–∫       | ‚≠ê –ù–∞–π–∫—Ä–∞—â–µ              |
| `–ü—Ä—è–º–∞ –∫–æ–ª–µ–∫—Ü—ñ—è (–±–µ–∑ JOIN)`    | ‚úÖ              | üî∏          | –Ø–∫—â–æ –±–µ–∑ —Å–∫–ª–∞–¥–Ω–∏—Ö –ø–æ–ª—ñ–≤ |

---

üîî –ì–æ—Ç–æ–≤–∏–π –¥–æ–ø–æ–º–æ–≥—Ç–∏ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ –∑–∞–ø–∏—Ç —É –≤–∏–≥–ª—è–¥—ñ View —á–∏ –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑ `CREATE_COLLECTION_FROM_QUERY` ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏.
