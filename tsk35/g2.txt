–û—Å—å –æ–Ω–æ–≤–ª–µ–Ω–∏–π PL/SQL –∫–æ–¥, —è–∫–∏–π —Ä–µ–∞–ª—ñ–∑—É—î —Ç–≤–æ—é –ª–æ–≥—ñ–∫—É –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –ø–æ–ª—ñ–≤ `MARK_BY_CHIEF` —ñ `CHIEF_POSITION` —É —Ç–∞–±–ª–∏—Ü—ñ `SIGNATUREHISTORY`. –£ —Ä–∞–∑—ñ, —è–∫—â–æ –≤–æ–Ω–∏ –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ ‚Äî –≤–∏–≤–æ–¥–∏—Ç—å—Å—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –æ—Å–æ–±—É, —è–∫–∞ –ø—ñ–¥–ø–∏—Å–∞–ª–∞ "–≤—ñ–¥ —ñ–º–µ–Ω—ñ", —ñ –ø—Ä–æ —Ç–æ–≥–æ, –≤—ñ–¥ —ñ–º–µ–Ω—ñ –∫–æ–≥–æ —Ü–µ –∑—Ä–æ–±–ª–µ–Ω–æ. –Ø–∫—â–æ –Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ ‚Äî –ø—Ä–∞—Ü—é—î —Å—Ç–∞—Ä–∞ –ª–æ–≥—ñ–∫–∞:

---

### ‚úÖ **–û–Ω–æ–≤–ª–µ–Ω–∏–π PL/SQL –∫–æ–¥** (–æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ —Ç–∞ –¥–æ–ø–æ–≤–Ω–µ–Ω–æ):

```plsql
-- –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–Ω–∞—á–µ–Ω–Ω—è –¥–∞—Ç–∏ –∑ —Ç–∞–±–ª–∏—Ü—ñ SIGNATUREHISTORY –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É
BEGIN
  SELECT t.SIGNER_DATE INTO l_check_signer_date
  FROM TaskTracker.SIGNATUREHISTORY@TO_TASKTRACKER10 t
  WHERE t.SIGNRIGHT_ID = l_signature_id;
EXCEPTION
  WHEN NO_DATA_FOUND THEN
    l_check_signer_date := NULL;
END;

-- –Ø–∫—â–æ –¥–∞—Ç–∞ —ñ—Å–Ω—É—î ‚Äî –≤–∏–≤–æ–¥–∏–º–æ —ñ—Å—Ç–æ—Ä—ñ—é –ø—ñ–¥–ø–∏—Å—É
IF l_check_signer_date IS NOT NULL THEN

  OPEN sign_history FOR
    SELECT
      TO_CHAR(sh.SDATE, 'dd.mm.yyyy') AS SDATEV,
      TO_CHAR(sh.SDATE, 'hh24:mi') AS STIMEV,
      p.FAMILIA || ' ' || SUBSTR(p.IMYA, 1, 1) || '.' || SUBSTR(p.OTCHESTVO, 1, 1) || '.' AS SIGNER_BY,
      ps.short AS posada,
      p.TSEH_SHORT AS depart,
      sh.NOTE,
      sh.NEW_STATUS_ID,
      -- –î–æ–¥–∞–Ω–æ –¥–ª—è mark_by_chief
      chief.FAMILIA || ' ' || SUBSTR(chief.IMYA, 1, 1) || '.' || SUBSTR(chief.OTCHESTVO, 1, 1) || '.' AS CHIEF_PIB,
      chief_ps.short AS chief_posada,
      chief.TSEH_SHORT AS chief_depart
    FROM TaskTracker.signaturehistory@TO_TASKTRACKER10 sh
    LEFT JOIN TaskTracker.signaturerights@TO_TASKTRACKER10 sr
      ON sr.id = sh.signright_id
    LEFT JOIN TaskTracker.dict_app_confirm_list@TO_TASKTRACKER10 cl
      ON cl.id = sr.stages_id
    LEFT JOIN kbs.persona1@TO_TASKTRACKER10 p
      ON p.tab_no = sh.signer_by AND p.priznak IS NULL
    LEFT JOIN TaskTracker.dict_posada_short_v@TO_TASKTRACKER10 ps
      ON ps.kod = p.dolznost
    -- –î–æ–¥–∞–Ω–æ –¥–ª—è mark_by_chief
    LEFT JOIN kbs.persona1@TO_TASKTRACKER10 chief
      ON chief.tab_no = sh.mark_by_chief AND chief.priznak IS NULL
    LEFT JOIN TaskTracker.dict_posada_short_v@TO_TASKTRACKER10 chief_ps
      ON chief_ps.kod = sh.chief_position
    WHERE sh.signright_id = l_signature_id
    ORDER BY sr.stages_id;

  LOOP
    FETCH sign_history INTO l_signer_date, l_signer_time, l_signed_by, l_posada, l_department,
      l_note, l_status_history, l_chief_pib, l_chief_posada, l_chief_department;
    EXIT WHEN sign_history%NOTFOUND;

    -- –í–∏–≤—ñ–¥ –¥–∞—Ç–∏ —ñ —á–∞—Å—É –ø—ñ–¥–ø–∏—Å—É
    HTP.P('<div class="c-cart-date-time">');
    IF l_signer_date IS NOT NULL THEN
      HTP.P('<span class="confirm-sign-attributes_date">' || l_signer_date || '<br />' || l_signer_time || '</span>');
    END IF;
    HTP.P('</div>');

    -- –í–∏–≤—ñ–¥ –ü–Ü–ë
    HTP.P('<div class="c-cart-pib">');
    IF l_chief_pib IS NOT NULL AND l_chief_posada IS NOT NULL THEN
      -- –ü—ñ–¥–ø–∏—Å "–≤—ñ–¥ —ñ–º–µ–Ω—ñ"
      HTP.P('<span class="confirm-sign-attributes_by">–í–∏–∫–æ–Ω–∞–Ω–æ: ' || l_chief_pib || ', ' || l_chief_posada || ', ' || l_chief_department || '</span>');
      HTP.P('<br /><span class="confirm-sign-attributes_by">–í—ñ–¥ —ñ–º–µ–Ω—ñ: ' || l_signed_by || ', ' || l_posada || ', ' || l_department || '</span>');
    ELSE
      -- –ó–≤–∏—á–∞–π–Ω–∏–π –ø—ñ–¥–ø–∏—Å
      IF l_signed_by IS NOT NULL THEN
        HTP.P('<span class="confirm-sign-attributes_by">' || l_signed_by || '</span>');
      END IF;
      IF l_posada IS NOT NULL THEN
        HTP.P('<span class="confirm-sign-attributes_posada">' || l_posada || '</span>');
      END IF;
    END IF;
    HTP.P('</div>');

    -- –ö–æ–º–µ–Ω—Ç–∞—Ä
    IF l_note IS NOT NULL THEN
      HTP.P('<div class="c-cart-signer-comment">' || l_note || '</div>');
    END IF;

    -- –°—Ç–∞—Ç—É—Å –ø—ñ–¥–ø–∏—Å—É
    IF l_status_history = 11 THEN
      HTP.P('<div class="c-cart-signer-mark c-cart-signer-mark_canceled">–ê–Ω—É–ª—å–æ–≤–∞–Ω–æ</div>');
    ELSE
      HTP.P('<div class="c-cart-signer-mark c-cart-signer-mark_success">' || l_substage_after_text || '</div>');
    END IF;

  END LOOP;
  CLOSE sign_history;

ELSE
  -- –ù–µ–º–∞—î –ø—ñ–¥–ø–∏—Å—É, –ø—É—Å—Ç–∏–π –±–ª–æ–∫
  HTP.P('<div class="c-cart-date-time"></div>');
  HTP.P('<div class="c-cart-pib"></div>');
  HTP.P('<div class="c-cart-signer-comment"></div>');
END IF;
```

---

### üìù –ü–æ—è—Å–Ω–µ–Ω–Ω—è:

* –î–æ–¥–∞–Ω–æ `chief` (–æ—Å–æ–±–∞, —è–∫–∞ –ø—ñ–¥–ø–∏—Å–∞–ª–∞ –≤—ñ–¥ —ñ–º–µ–Ω—ñ) —Ç–∞ `chief_posada`.
* –£ `IF l_chief_pib IS NOT NULL` –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è, —á–∏ –±—É–≤ –ø—ñ–¥–ø–∏—Å ¬´–≤—ñ–¥ —ñ–º–µ–Ω—ñ¬ª.
* HTML-–∫–ª–∞—Å–∏ –∑–∞–ª–∏—à–µ–Ω—ñ –±–µ–∑ –∑–º—ñ–Ω, –∞–ª–µ –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ –º–æ–∂–Ω–∞ —Å—Ç–∏–ª—ñ–∑—É–≤–∞—Ç–∏ –ø—ñ–¥ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–≤–æ—Ö —Ä—è–¥–∫—ñ–≤: ¬´–í–∏–∫–æ–Ω–∞–Ω–æ¬ª —ñ ¬´–í—ñ–¥ —ñ–º–µ–Ω—ñ¬ª.

---

üîî –Ø–∫—â–æ —Ö–æ—á–µ—à, —è –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∏–Ω–µ—Å—Ç–∏ —Ü—é –ª–æ–≥—ñ–∫—É –≤ –æ–∫—Ä–µ–º—É PL/SQL —Ñ—É–Ω–∫—Ü—ñ—é –∞–±–æ —Å–ø—Ä–æ—Å—Ç–∏—Ç–∏ —â–µ –±—ñ–ª—å—à–µ.
