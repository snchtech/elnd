–î—è–∫—É—é! –î–∞–≤–∞–π—Ç–µ –ø–æ–µ—Ç–∞–ø–Ω–æ –ø–µ—Ä–µ—Ä–æ–±–∏–º–æ –≤–∞—à—É `VIEW V_TASKS_REPORT` –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º:

---

## ‚úÖ –ù–û–í–ê –°–¢–†–£–ö–¢–£–†–ê –ö–û–õ–û–ù–û–ö:
1. `DATE_CREATE`  
2. `UNIT`  
3. `TASK_CONTENT`  
4. `CREATOR`  
5. `EXECUTORS`  
6. `PLANNING_DATE_END`  
7. `ACTUAL_DATE_END` ‚Üê (—ñ–∑ `SIGNATUREHISTORY` –¥–ª—è `STAGES_ID = 3`)  
8. `STATUS`  
9. `DEPARTMENT`  
10. `NOTE` ‚Üê –±–µ—Ä–µ–º–æ –∑ `SIGNATUREHISTORY.NOTE`, `STAGES_ID = 3`  
11. `VIEWED` ‚Üê –∑ `TASK_VIEWED`

---

## üî® –û–°–ù–û–í–ù–Ü –ó–ú–Ü–ù–ò:
- –í–∏–¥–∞–ª—è—î–º–æ `RESPONSIBLES`.
- –î–æ–¥–∞—î–º–æ –ø—ñ–¥–∑–∞–ø–∏—Ç –¥–ª—è `ACTUAL_DATE_END`, `NOTE` –∑—ñ `STAGES_ID = 3`.
- –ö–æ–ª–æ–Ω–∫–∞ `VIEWED`: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–µ—Ä–µ–≥–ª—è–Ω—É–≤ —Ü–µ –∑–∞–≤–¥–∞–Ω–Ω—è –≤ –º–µ–∂–∞—Ö –∑–º—ñ–Ω–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 09:00‚Äì17:00).
- `CREATOR` —ñ `EXECUTORS` –∑–∞–ª–∏—à–∞—î–º–æ, –∞–ª–µ –ø–æ–∫–∞–∑—É—î–º–æ:  
  - –Ø–∫—â–æ —î –∑–∞–ø–∏—Å —É `SIGNATUREHISTORY`, –¥–æ–¥–∞—î–º–æ `SIGNER_BY`, `SIGNER_DATE`, `NOTE`.

---

## üÜï –û–ù–û–í–õ–ï–ù–ê VIEW:

```sql
CREATE OR REPLACE VIEW V_TASKS_REPORT AS
WITH CREATOR_INFO AS (
    SELECT 
        sr.SOURCE_ID,
        COALESCE(sh.SIGNER_BY, sr.USER_ID) AS CREATOR_ID,
        COALESCE(sh.SIGNER_DATE, NULL) AS DATE_CREATED,
        COALESCE(sh.NOTE, NULL) AS CREATOR_NOTE,
        NVL(sr.POSITION_ID, '–ù–µ –≤–∫–∞–∑–∞–Ω–æ') AS CREATOR_POSITION,
        NVL(sr.DEPARTMENT_ID, '–ù–µ –≤–∫–∞–∑–∞–Ω–æ') AS CREATOR_DEPARTMENT,
        NVL(sr.UNIT_ID, '–ù–µ –≤–∫–∞–∑–∞–Ω–æ') AS CREATOR_UNIT
    FROM SIGNATURERIGHTS sr
    LEFT JOIN SIGNATUREHISTORY sh 
        ON sr.ID = sh.SIGNRIGHT_ID AND sr.STAGES_ID = 1
    WHERE sr.STAGES_ID = 1
), 
EXECUTORS AS (
    SELECT 
        sr.SOURCE_ID,
        LISTAGG(
            COALESCE(sh.SIGNER_BY, sr.USER_ID) || 
            ' (' || NVL(sr.POSITION_ID, '–ù–µ –≤–∫–∞–∑–∞–Ω–æ') || ', ' || 
            NVL(sr.DEPARTMENT_ID, '–ù–µ –≤–∫–∞–∑–∞–Ω–æ') || ', ' || 
            NVL(sr.UNIT_ID, '–ù–µ –≤–∫–∞–∑–∞–Ω–æ') || ')' || 
            CASE 
                WHEN sh.SIGNER_DATE IS NOT NULL THEN 
                    ' ‚úÖ ' || TO_CHAR(sh.SIGNER_DATE, 'DD.MM.YYYY HH24:MI') || 
                    ' ‚Äì ' || NVL(sh.NOTE, '–ë–µ–∑ –∫–æ–º–µ–Ω—Ç–∞—Ä—è') 
                ELSE '' 
            END,
            '<br> '
        ) WITHIN GROUP (ORDER BY COALESCE(sh.SIGNER_DATE, SYSDATE)) AS EXECUTORS
    FROM SIGNATURERIGHTS sr
    LEFT JOIN SIGNATUREHISTORY sh 
        ON sr.ID = sh.SIGNRIGHT_ID AND sr.STAGES_ID = 2
    WHERE sr.STAGES_ID = 2
    GROUP BY sr.SOURCE_ID
), 
ACTUALS AS (
    SELECT 
        sr.SOURCE_ID,
        MAX(sh.SIGNER_DATE) AS ACTUAL_DATE_END,
        MAX(sh.NOTE) AS ACTUAL_NOTE
    FROM SIGNATURERIGHTS sr
    JOIN SIGNATUREHISTORY sh ON sr.ID = sh.SIGNRIGHT_ID
    WHERE sr.STAGES_ID = 3
    GROUP BY sr.SOURCE_ID
), 
VIEWED_STATUS AS (
    SELECT 
        tv.TASK_ID,
        MAX(tv.DATE_VIEWED) AS VIEWED_DATE
    FROM TASK_VIEWED tv
    WHERE tv.DATE_VIEWED BETWEEN TRUNC(SYSDATE) + INTERVAL '09:00' HOUR TO MINUTE 
                            AND TRUNC(SYSDATE) + INTERVAL '17:00' HOUR TO MINUTE
      AND tv.USER_ID = NVL(sys_context('APEX$SESSION','APP_USER'), USER)
    GROUP BY tv.TASK_ID
)
SELECT 
    t.ID AS TASK_ID,
    t.DATE_CREATE,
    COALESCE(t.TASK_CONTENT, 
        (SELECT LISTAGG(sub.SUBTASK_CONTENT, ', ') WITHIN GROUP (ORDER BY sub.ID) 
         FROM TASK_SUBTASKS sub 
         WHERE sub.TASK_ID = t.ID)) AS TASK_CONTENT,
    
    -- –°—Ç–≤–æ—Ä—é–≤–∞—á
    CASE 
        WHEN ci.CREATOR_ID IS NOT NULL THEN 
            ci.CREATOR_ID || ' (' || ci.CREATOR_POSITION || ', ' || ci.CREATOR_DEPARTMENT || ', ' || ci.CREATOR_UNIT || ') - ' || NVL(ci.CREATOR_NOTE, '–ë–µ–∑ –∫–æ–º–µ–Ω—Ç–∞—Ä—è')
        ELSE NULL 
    END AS CREATOR,

    -- –í–∏–∫–æ–Ω–∞–≤—Ü—ñ
    e.EXECUTORS,

    -- –î–∞—Ç–∞ –ø–ª–∞–Ω–æ–≤–æ–≥–æ —Ç–∞ —Ñ–∞–∫—Ç–∏—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
    t.PLANNING_DATE_END,
    a.ACTUAL_DATE_END,

    -- –°—Ç–∞—Ç—É—Å, –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª, —é–Ω—ñ—Ç
    ds.NAME AS STATUS,
    dc.NAME AS DEPARTMENT,
    uc.NAME AS UNIT,

    -- –ü—Ä–∏–º—ñ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è (—ñ–∑ signaturehistory.stage=3)
    a.ACTUAL_NOTE AS NOTE,

    -- –û–∑–Ω–∞–π–æ–º–ª–µ–Ω–Ω—è
    CASE 
        WHEN v.VIEWED_DATE IS NOT NULL THEN 
            '‚úÖ ' || TO_CHAR(v.VIEWED_DATE, 'DD.MM.YYYY HH24:MI')
        ELSE 
            '‚ùå –ù–µ –æ–∑–Ω–∞–π–æ–º–ª–µ–Ω–æ'
    END AS VIEWED

FROM TASKS t
LEFT JOIN CREATOR_INFO ci ON ci.SOURCE_ID = t.ID
LEFT JOIN EXECUTORS e ON e.SOURCE_ID = t.ID
LEFT JOIN ACTUALS a ON a.SOURCE_ID = t.ID
LEFT JOIN VIEWED_STATUS v ON v.TASK_ID = t.ID
LEFT JOIN DICT_STATUS ds ON ds.ID = t.STATUS
LEFT JOIN DEPART_CONFIRMLIST_V dc ON dc.ID = t.DEPARTMENT
LEFT JOIN UNIT_FOR_CONFIRMLIST_V uc ON uc.ID = t.UNIT;
```

---

## üß† –ü—Ä–∏–º—ñ—Ç–∫–∏:
- `SIGNATUREHISTORY.STAGES_ID = 3` ‚Äî —Ü–µ –¥–ª—è —Ñ–∞–∫—Ç–∏—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è.
- `SIGNATUREHISTORY.STAGES_ID = 1/2` ‚Äî –¥–ª—è —Å—Ç–≤–æ—Ä—é–≤–∞—á–∞ / –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤.
- `TASK_VIEWED` ‚Äî –¥–∞—î info, —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á **–æ–∑–Ω–∞–π–æ–º–ª–µ–Ω–∏–π –Ω–∞ –ø–æ—Ç–æ—á–Ω—ñ–π –∑–º—ñ–Ω—ñ**.
- `APP_USER` –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `sys_context`, —â–æ–± –ø—Ä–∞—Ü—é–≤–∞–ª–æ —É View (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ `:APP_USER` –≤ SQL).

---

üîß –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ, –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏:
- —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è `TASK_VIEWED` –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –∫–∞—Ä—Ç–∫–∏;
- –¥–æ–¥–∞—Ç–∏ –∫–æ–ª–æ–Ω–∫—É –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –ø–æ —Ç–∏–ø—É –∑–º—ñ–Ω (—Ä–∞–Ω—ñ—à–Ω—è, –¥–µ–Ω–Ω–∞, –Ω—ñ—á–Ω–∞);
- –ø–æ–∫—Ä–∞—â–∏—Ç–∏ —à–∞–±–ª–æ–Ω –≤–∏–≤–æ–¥—É (HTML escaping –∞–±–æ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è).

–•–æ—á–µ—à –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ —Ü–µ —É —Ç–≤—ñ–π –∑–≤—ñ—Ç –≤ APEX?