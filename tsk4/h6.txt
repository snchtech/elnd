–û–∫–µ–π! üëá –û—Å—å –ø–æ–≤–Ω—ñ—Å—Ç—é –≥–æ—Ç–æ–≤—ñ **–∫–∞—Å—Ç–æ–º–Ω—ñ SQL/PLSQL-—Å–∫—Ä–∏–ø—Ç–∏ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—ñ–≤**:

---

## üü¢ 1. **INSERT-–ø—Ä–æ—Ü–µ—Å** ‚Äî —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è + –ø—Ä–∏–≤'—è–∑–∫–∞ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å

```plsql
DECLARE
  v_task_id TASKS.ID%TYPE;
BEGIN
  -- –°—Ç–≤–æ—Ä—é—î–º–æ –∑–∞–≤–¥–∞–Ω–Ω—è
  INSERT INTO TASKS (
    DATE_CREATE,
    TASK_CONTENT,
    CREATOR_ID,
    PLANNING_DATE_START,
    PLANNING_DATE_END,
    STATUS_ID,
    DEPARTMENT_ID,
    UNIT_ID,
    TYPE_ID,
    IS_PERIODIC,
    PERIOD_INTERVAL,
    PERIOD_TIME,
    NEXT_RUN_DATE,
    IS_GENERATED,
    GENERATED_DATE,
    TEMPLATE_ID
  ) VALUES (
    SYSDATE,
    :PXX_TASK_CONTENT,
    :APP_USER_ID, -- –∞–±–æ –∑–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ :APP_USER –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ –≤ APEX
    :PXX_PLANNING_DATE_START,
    :PXX_PLANNING_DATE_END,
    1, -- –°—Ç–∞—Ç—É—Å "–Ω–æ–≤–∏–π" (–º–æ–∂–Ω–∞ –∑–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –∞–±–æ select —ñ–∑ main_status)
    :PXX_DEPARTMENT_ID,
    :PXX_UNIT_ID,
    :PXX_TYPE_ID,
    :PXX_IS_PERIODIC,
    :PXX_PERIOD_INTERVAL,
    :PXX_PERIOD_TIME,
    :PXX_NEXT_RUN_DATE,
    'N',
    NULL,
    NULL
  )
  RETURNING ID INTO v_task_id;

  -- –ü—Ä–∏–≤'—è–∑—É—î–º–æ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –¥–æ task_id
  UPDATE TASK_SUBTASKS
  SET TASK_ID = v_task_id,
      DRAFT_ID = NULL
  WHERE DRAFT_ID = :PXX_DRAFT_ID;

  -- –ó–±–µ—Ä—ñ–≥–∞—î–º–æ task_id –¥–ª—è –ø–æ–¥–∞–ª—å—à–∏—Ö –¥—ñ–π (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ä–µ–¥–∏—Ä–µ–∫—Ç)
  :PXX_CREATED_TASK_ID := v_task_id;
END;
```

> üîÅ `:PXX_*` ‚Äî —Ü–µ APEX page items (–∑–∞–º—ñ–Ω–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ —Ç–≤–æ—ó—Ö –Ω–∞–∑–≤ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤).

---

## üü° 2. **UPDATE-–ø—Ä–æ—Ü–µ—Å** ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ—Å–Ω—É—é—á–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è + –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å

```plsql
BEGIN
  -- –û–Ω–æ–≤–ª—é—î–º–æ –∑–∞–≤–¥–∞–Ω–Ω—è
  UPDATE TASKS
  SET
    TASK_CONTENT        = :PXX_TASK_CONTENT,
    PLANNING_DATE_START = :PXX_PLANNING_DATE_START,
    PLANNING_DATE_END   = :PXX_PLANNING_DATE_END,
    DEPARTMENT_ID       = :PXX_DEPARTMENT_ID,
    UNIT_ID             = :PXX_UNIT_ID,
    TYPE_ID             = :PXX_TYPE_ID,
    IS_PERIODIC         = :PXX_IS_PERIODIC,
    PERIOD_INTERVAL     = :PXX_PERIOD_INTERVAL,
    PERIOD_TIME         = :PXX_PERIOD_TIME,
    NEXT_RUN_DATE       = :PXX_NEXT_RUN_DATE
  WHERE ID = :PXX_TASK_ID;

  -- –ü—Ä–∏–≤‚Äô—è–∑—É—î–º–æ –Ω–æ–≤—ñ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –∑ DRAFT_ID, —è–∫—â–æ –≤–æ–Ω–∏ –±—É–ª–∏ –¥–æ–¥–∞–Ω—ñ
  UPDATE TASK_SUBTASKS
  SET TASK_ID = :PXX_TASK_ID,
      DRAFT_ID = NULL
  WHERE DRAFT_ID = :PXX_DRAFT_ID;
END;
```

---

## üîí –î–æ–¥–∞—Ç–∫–æ–≤–æ: –ó–∞—Ö–∏—Å—Ç —ñ –æ—á–∏—â–µ–Ω–Ω—è
–Ø–∫—â–æ —Ö–æ—á–µ—à —á–∏—Å—Ç–∏—Ç–∏ —á–µ—Ä–Ω–µ—Ç–∫–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–π—à–æ–≤ –∑—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏):

```plsql
DELETE FROM TASK_SUBTASKS
WHERE TASK_ID IS NULL AND DRAFT_ID = :PXX_DRAFT_ID;
```

–ú–æ–∂–µ—à –∑–∞–ø—É—Å–∫–∞—Ç–∏ —Ü–µ —É:
- APEX Cleanup Process
- –∞–±–æ `WHEN-CANCEL` –∫–ª—ñ–∫ –Ω–∞ –∫–Ω–æ–ø—Ü—ñ ¬´–°–∫–∞—Å—É–≤–∞—Ç–∏¬ª

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:
| –§—É–Ω–∫—Ü—ñ—è | –ü—Ä–∞—Ü—é—î? |
|---------|---------|
| –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è + –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å –¥–æ –Ω—å–æ–≥–æ | ‚úÖ |
| –ü—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —â–µ –¥–æ task_id | ‚úÖ |
| –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è | ‚úÖ |
| –†–æ–±–æ—Ç–∞ —á–µ—Ä–µ–∑ –∫–∞—Å—Ç–æ–º–Ω–∏–π INSERT/UPDATE | ‚úÖ |

---

üîß –•–æ—á–µ—à ‚Äî —è –º–æ–∂—É:
- –î–æ–ø–æ–º–æ–≥—Ç–∏ —Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—É –¥–ª—è –ø–∞–∫–µ—Ç–∞,
- –°—Ç–≤–æ—Ä–∏—Ç–∏ reusable APEX process,
- –ê–±–æ –¥–æ–ø–æ–º–æ–≥—Ç–∏ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –∑ —Ñ–æ—Ä–º–æ—é –∑–∞–≤–¥–∞–Ω–Ω—è.

–¢—Ä–µ–±–∞ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —â–µ SQL-–ø–∞–∫–µ—Ç –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è?