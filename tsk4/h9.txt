–ß—É–¥–æ–≤–æ! –¢–µ–ø–µ—Ä –¥–∞–≤–∞–π –∑—ñ–±‚Äô—î–º–æ **—Ñ—ñ–Ω–∞–ª—å–Ω–∏–π PL/SQL –∫–æ–¥ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è –∑ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è–º–∏**, –∫–æ–ª–∏:

- –ü—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –¥–æ —Ç–æ–≥–æ, —è–∫ –∑'—è–≤–∏—Ç—å—Å—è `TASK_ID`;
- –í–æ–Ω–∏ –∑–≤'—è–∑–∞–Ω—ñ —á–µ—Ä–µ–∑ `DRAFT_ID` (`TASK_SUBTASKS.DRAFT_ID`);
- –ü—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è ‚Äî `TASK_ID` –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è;
- –Ü –≤—Å—ñ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è: `SET TASK_ID = :NEW_TASK_ID`.

---

## ‚úÖ –ì–æ—Ç–æ–≤–∏–π PL/SQL –ø—Ä–æ—Ü–µ—Å –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è + –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å

```plsql
DECLARE
  v_task_id TASKS.ID%TYPE;
BEGIN
  -- 1. –°—Ç–≤–æ—Ä—é—î–º–æ –æ—Å–Ω–æ–≤–Ω–∏–π –∑–∞–ø–∏—Å —É TASKS
  INSERT INTO TASKS (
    DATE_CREATE,
    TASK_CONTENT,
    CREATOR_ID,
    PLANNING_DATE_START,
    PLANNING_DATE_END,
    STATUS_ID,
    DEPARTMENT_ID,
    UNIT_ID,
    TYPE_ID,
    IS_PERIODIC,
    PERIOD_INTERVAL,
    PERIOD_TIME,
    NEXT_RUN_DATE,
    IS_GENERATED,
    GENERATED_DATE,
    TEMPLATE_ID
  )
  VALUES (
    SYSDATE,
    :PXX_TASK_CONTENT,
    :APP_USER_ID,  -- –∞–±–æ –∑–∞–º—ñ–Ω–∏ –Ω–∞ :APP_USER —è–∫—â–æ –±–µ—Ä–µ—à –Ω–∞–ø—Ä—è–º—É
    :PXX_PLANNING_DATE_START,
    :PXX_PLANNING_DATE_END,
    1,  -- —Å—Ç–∞—Ç—É—Å "–Ω–æ–≤–∏–π" (–∑–∞–º—ñ–Ω–∏ –∑–∞ –ø–æ—Ç—Ä–µ–±–∏)
    :PXX_DEPARTMENT_ID,
    :PXX_UNIT_ID,
    :PXX_TYPE_ID,
    :PXX_IS_PERIODIC,
    :PXX_PERIOD_INTERVAL,
    :PXX_PERIOD_TIME,
    :PXX_NEXT_RUN_DATE,
    'N',     -- —Ü–µ –Ω–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è
    NULL,
    NULL
  )
  RETURNING ID INTO v_task_id;

  -- 2. –û–Ω–æ–≤–ª—é—î–º–æ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è, –ø—Ä–∏–≤‚Äô—è–∑—É—î–º–æ –¥–æ task_id
  UPDATE TASK_SUBTASKS
  SET TASK_ID = v_task_id,
      DRAFT_ID = NULL
  WHERE DRAFT_ID = :PXX_DRAFT_ID;

  -- 3. (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ task_id –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
  :PXX_CREATED_TASK_ID := v_task_id;
END;
```

---

## üß© –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ –¥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤:

| –ü–∞—Ä–∞–º–µ—Ç—Ä             | –î–∂–µ—Ä–µ–ª–æ / Item                    |
|----------------------|-----------------------------------|
| `:PXX_TASK_CONTENT`  | Textarea –∞–±–æ `COALESCE` –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å |
| `:PXX_DRAFT_ID`      | –ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –ø–µ—Ä–µ–¥ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è–º —Ñ–æ—Ä–º–∏ |
| `:APP_USER_ID`       | –ú–æ–∂–µ—à –≤–∏–∑–Ω–∞—á–∏—Ç–∏ —á–µ—Ä–µ–∑ `APEX_UTIL.GET_USER_ID()` –∞–±–æ item |
| `:PXX_TYPE_ID`, `:PXX_UNIT_ID`, ... | Select List'–∏ –Ω–∞ —Ñ–æ—Ä–º—ñ |

---

## üîí –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –ø—ñ—Å–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:
- –û—á–∏—â–∞—Ç–∏ `DRAFT_ID`, —è–∫—â–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–Ω–æ–≤—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è.
- –í–∏–¥–∞–ª—è—Ç–∏ `TASK_SUBTASKS` –±–µ–∑ `TASK_ID` —á–µ—Ä–µ–∑ cleanup –∞–±–æ —á–µ—Ä–µ–∑ `ON_CANCEL`.

---

## ‚ùó –ü–∞–º‚Äô—è—Ç–∞–π:

- –£—Å—ñ –Ω–æ–≤—ñ —Ä—è–¥–∫–∏ –≤ `IG` –º—É—Å—è—Ç—å –º–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π `DRAFT_ID` = `:PXX_DRAFT_ID`.
- –£ `IG` –Ω–∞–ª–∞—à—Ç—É–π `DRAFT_ID` —è–∫:
  - Hidden,
  - Default ‚Üí `&PXX_DRAFT_ID.`

---

üîß –•–æ—á–µ—à ‚Äî –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑ –ø—Ä–æ—Ü–µ–¥—É—Ä–æ—é –≤ –ø–∞–∫–µ—Ç—ñ –∞–±–æ –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º Dynamic Action –Ω–∞ –∫–Ω–æ–ø–∫—É "–ó–±–µ—Ä–µ–≥—Ç–∏".

–ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–±–æ –æ—á–∏—â–µ–Ω–Ω—è —á–µ—Ä–Ω–µ—Ç–æ–∫?