–û–∫–µ–π, —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—é **–ø–æ–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è –∑ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è–º–∏** –≤ Oracle APEX, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `DRAFT_ID`, `TEMP_ROW_ID`, —ñ APEX –º–µ—Ö–∞–Ω—ñ–∑–º–∏ (items, dynamic actions, processes).

---

## ‚úÖ **1. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è `:P50_DRAFT_ID` –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏**

### üì¶ –©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ:

- –°—Ç–≤–æ—Ä–∏—Ç–∏ `Hidden` item: `P50_DRAFT_ID`
- –î–æ–¥–∞—Ç–∏ `Dynamic Action` (DA):  
  - **Name**: `Set Draft ID on Load`
  - **Event**: `Page Load`
  - **True Action**: `Set Value`
    - **Set Type**: `PL/SQL Expression`
    - **PL/SQL**:
      ```plsql
      SYS_GUID()
      ```
    - Affected Item: `P50_DRAFT_ID`

> –¶–µ –∑–≥–µ–Ω–µ—Ä—É—î —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π `RAW(16)` —è–∫ `VARCHAR2`, —â–æ –±—É–¥–µ –∫–ª—é—á–µ–º —á–µ—Ä–Ω–µ—Ç–∫–∏ –¥–ª—è –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å.

---

## ‚úÖ **2. IG —Å—Ç–≤–æ—Ä—é—î –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –∑ `DRAFT_ID` + `TEMP_ROW_ID`**

### üì¶ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è IG (–Ω–∞–ø—Ä—è–º—É –Ω–∞ —Ç–∞–±–ª–∏—Ü—é `TASK_SUBTASKS`):

#### –î–æ–¥–∞–π –∫–æ–ª–æ–Ω–∫–∏ –≤ IG:
- `DRAFT_ID` ‚Äî `Hidden`, Default: `:P50_DRAFT_ID`
- `TEMP_ROW_ID` ‚Äî `Hidden`, –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞–¥–∞—î–º–æ —á–µ—Ä–µ–∑ JavaScript
- `PARENT_TEMP_ID` ‚Äî `Visible` –∞–±–æ `Hidden`, Select List –ø–æ `TEMP_ROW_ID` —ñ–Ω—à–∏—Ö –∑–∞–ø–∏—Å—ñ–≤

#### JS: –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è `TEMP_ROW_ID` –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –Ω–æ–≤–æ–≥–æ —Ä—è–¥–∫–∞

**–£ –∫–Ω–æ–ø—Ü—ñ ‚Äú–î–æ–¥–∞—Ç–∏ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è‚Äù:**

```js
var ig$ = apex.region("subtask_ig").call("getViews", "grid");
var model = ig$.model;
var newRec = model.createRecord();

// –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–∏–º—á–∞—Å–æ–≤–æ–≥–æ ID
var tempId = "tmp_" + new Date().getTime();
model.setValue(newRec, "TEMP_ROW_ID", tempId);
model.setValue(newRec, "DRAFT_ID", $v("P50_DRAFT_ID"));

model.addRecord(newRec);
```

---

## ‚úÖ **3. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î "–ó–±–µ—Ä–µ–≥—Ç–∏" ‚Üí IG –∑–±–µ—Ä—ñ–≥–∞—î –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è**

> –¶–µ –≤–∂–µ –ø—Ä–∞—Ü—é—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ, —è–∫—â–æ:
- IG –º–∞—î `Automatic Row Processing (DML)`
- –¢–∞–±–ª–∏—Ü—è ‚Äî `TASK_SUBTASKS`
- –ü–æ–ª—è `TEMP_ROW_ID`, `DRAFT_ID`, `PARENT_TEMP_ID` –∑–±–µ—Ä–µ–∂—É—Ç—å—Å—è —Ä–∞–∑–æ–º —ñ–∑ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è–º

üîî **–ù–µ –∑–∞–±—É–¥—å –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ Required: No** –¥–ª—è `TASK_ID`, –±–æ –≤–æ–Ω–æ –ø–æ–∫–∏ —â–æ `NULL`.

---

## ‚úÖ **4. –ü—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è TASK ‚Üí –æ–Ω–æ–≤–ª–µ–Ω–Ω—è TASK_ID —Ç–∞ PARENT_ID**

### üì¶ APEX Processes (After Submit), –∫–æ–ª–∏ –Ω–∞—Ç–∏—Å–∫–∞—î—Ç—å—Å—è "–°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è"

#### ‚úÖ 4.1: Process `Insert New Task` (—Ç–∏–ø: PL/SQL Code)
```plsql
DECLARE
  v_id NUMBER;
BEGIN
  INSERT INTO TASKS (
    DATE_CREATE,
    TASK_CONTENT,
    CREATOR_ID,
    PLANNING_DATE_START,
    PLANNING_DATE_END,
    STATUS_ID,
    DEPARTMENT_ID,
    UNIT_ID,
    TYPE_ID,
    PAGE_LIST_ID,
    IS_GENERATED,
    GENERATED_DATE,
    TEMPLATE_ID,
    NOTE
  ) VALUES (
    SYSDATE,
    :P50_TASK_CONTENT,
    :G_USER_ID,
    :P50_PLANNING_DATE_START,
    :P50_PLANNING_DATE_END,
    1,
    :G_DEPARTMENT_ID,
    :G_UNIT_ID,
    :P50_TASK_TYPE,
    :G_PAGE_LIST_ID,
    :P50_IS_GENERATED,
    :P50_GENERATED_DATE,
    :P50_TEMPLATE_ID,
    :P50_NOTE
  )
  RETURNING ID INTO v_id;

  -- –ó–±–µ—Ä–µ–≥—Ç–∏ –≤ item –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤
  :P50_TASK_ID := v_id;
END;
```

---

#### ‚úÖ 4.2: Process `Update TASK_ID in TASK_SUBTASKS`
```plsql
UPDATE TASK_SUBTASKS
SET TASK_ID = :P50_TASK_ID
WHERE DRAFT_ID = :P50_DRAFT_ID
  AND TASK_ID IS NULL;
```

---

#### ‚úÖ 4.3: Process `Update PARENT_ID in TASK_SUBTASKS`
```plsql
MERGE INTO TASK_SUBTASKS dst
USING (
  SELECT s1.ID AS CHILD_ID,
         s2.ID AS REAL_PARENT_ID
  FROM TASK_SUBTASKS s1
  JOIN TASK_SUBTASKS s2
    ON s1.DRAFT_ID = s2.DRAFT_ID
   AND s1.PARENT_TEMP_ID = s2.TEMP_ROW_ID
  WHERE s1.DRAFT_ID = :P50_DRAFT_ID
) mapping
ON (dst.ID = mapping.CHILD_ID)
WHEN MATCHED THEN
  UPDATE SET dst.PARENT_ID = mapping.REAL_PARENT_ID;
```

---

## üßº (–û–ø—Ü—ñ–π–Ω–æ) –û—á–∏—Å—Ç–∫–∞ —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö –ø–æ–ª—ñ–≤ –ø—ñ—Å–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è

```plsql
UPDATE TASK_SUBTASKS
SET DRAFT_ID = NULL,
    TEMP_ROW_ID = NULL,
    PARENT_TEMP_ID = NULL
WHERE TASK_ID = :P50_TASK_ID;
```

---

## üìå –ü–æ—Ä—è–¥–æ–∫ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç        | –Ü–º‚Äô—è / –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è                    |
|------------------|----------------------------------------|
| `P50_DRAFT_ID`   | Hidden item (–≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏) |
| `P50_TASK_ID`    | Hidden item (–∑–∞–ø–∏—Å—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏ TASK) |
| IG `subtask_ig`  | Data Source: `TASK_SUBTASKS`           |

---

üîÅ –Ø–∫—â–æ —Ö–æ—á–µ—à ‚Äî –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏:
- —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ LOV –¥–ª—è `PARENT_TEMP_ID`,
- –∞–±–æ —à–∞–±–ª–æ–Ω –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –¥—ñ–∞–ª–æ–≥—É –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è `SUBTASK_CONTENT`.

–•–æ—á–µ—à –¥–æ–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —Ü—ñ –ø—É–Ω–∫—Ç–∏?