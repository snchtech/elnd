–ü—Ä–µ–∫—Ä–∞—Å–Ω–æ, —Ç–∏ –≤–∂–µ –º–∞—î—à –ø–æ—Ç—É–∂–Ω—É –±–∞–∑—É ‚Äî —Ç–µ–ø–µ—Ä —Ä–æ–∑—à–∏—Ä–∏–º–æ –ª–æ–≥—ñ–∫—É, —â–æ–± **–æ–¥–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ —Å—Ç–≤–æ—Ä—é–≤–∞–ª–∞ —è–∫ –∑–∞–≤–¥–∞–Ω–Ω—è, —Ç–∞–∫ —ñ —à–∞–±–ª–æ–Ω–∏**, –∑ –æ–±—Ä–æ–±–∫–æ—é –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—å.

---

## ‚úÖ **1. –û—Å–Ω–æ–≤–Ω–∞ –∑–º—ñ–Ω–Ω–∞-–ø–µ—Ä–µ–º–∏–∫–∞—á: `P50_IS_TEMPLATE`**

### –¢–∏–ø: `Switch`  
- –ó–Ω–∞—á–µ–Ω–Ω—è:
  - `'N'` ‚Äì **–ó–∞–≤–¥–∞–Ω–Ω—è**
  - `'Y'` ‚Äì **–®–∞–±–ª–æ–Ω**

–¶–µ –±—É–¥–µ –∫–ª—é—á–æ–≤–∏–º —É–º–æ–≤–Ω–∏–º —Ñ—ñ–ª—å—Ç—Ä–æ–º –¥–ª—è –≤—Å—ñ—Ö –¥—ñ–π.

---

## ‚úÖ **2. –†–æ–∑—à–∏—Ä—é—î–º–æ –ª–æ–≥—ñ–∫—É –ø–æ 4 –æ—Å–Ω–æ–≤–Ω–∏–º –Ω–∞–ø—Ä—è–º–∫–∞—Ö**

| –ï—Ç–∞–ø                      | –Ø–∫—â–æ –∑–∞–≤–¥–∞–Ω–Ω—è                  | –Ø–∫—â–æ —à–∞–±–ª–æ–Ω                          |
|---------------------------|--------------------------------|--------------------------------------|
| –¢–∞–±–ª–∏—Ü—è (–≥–æ–ª–æ–≤–Ω–∞)         | `TASKS`                        | `TASK_TEMPLATES`                     |
| –¢–∞–±–ª–∏—Ü—è (–ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è)     | `TASK_SUBTASKS`                | `TASK_TEMPLATE_SUBTASKS`             |
| –ü—Ä–æ—Ü–µ—Å–∏ INSERT/UPDATE     | —É `TASKS`                      | —É `TASK_TEMPLATES`                   |
| –ü—Ä–æ—Ü–µ—Å–∏ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å        | –æ–Ω–æ–≤–ª–µ–Ω–Ω—è `TASK_ID` / `PARENT_ID` | –æ–Ω–æ–≤–ª–µ–Ω–Ω—è `TEMPLATE_ID` / `PARENT_ID` |

---

## ‚úÖ **3. –©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ –¥–æ —ñ—Å–Ω—É—é—á–æ—ó –ª–æ–≥—ñ–∫–∏**

### üüß A. Item `P50_IS_TEMPLATE`
- –í–∂–µ —î (—Ç–∏–ø switch)
- –ú–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è `'N'` –∞–±–æ `'Y'`

---

### üü© B. **–ü—Ä–æ—Ü–µ—Å–∏ INSERT/UPDATE –¥–ª—è –®–ê–ë–õ–û–ù–£**

#### üÜï Process `Insert Task Template`
**Condition**:
```plsql
:REQUEST = 'CREATE_TASK'
AND :P50_IS_TEMPLATE = 'Y'
```

**PL/SQL Code**:
```plsql
DECLARE
  v_id NUMBER;
BEGIN
  INSERT INTO TASK_TEMPLATES (
    DATE_CREATE,
    TASK_CONTENT,
    CREATOR_ID,
    STATUS_ID,
    DEPARTMENT_ID,
    UNIT_ID,
    TYPE_ID,
    PAGE_LIST_ID,
    PERIOD_MODE,
    PERIOD_INTERVAL,
    PERIOD_TIME,
    HOURLY_TIME,
    NEXT_RUN_DATE
  ) VALUES (
    SYSDATE,
    :P50_TASK_CONTENT,
    :G_USER_ID,
    1,
    :G_DEPARTMENT_ID,
    :G_UNIT_ID,
    :P50_TASK_TYPE,
    :G_PAGE_LIST_ID,
    :P50_PERIOD_MODE,
    :P50_PERIOD_INTERVAL,
    :P50_PERIOD_TIME,
    :P50_HOURLY_TIME,
    :P50_NEXT_RUN_DATE
  )
  RETURNING ID INTO :P50_TASK_ID;
END;
```

> –¢–æ–π —Å–∞–º–∏–π `P50_TASK_ID` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —è–∫ `TEMPLATE_ID` —É –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è—Ö —à–∞–±–ª–æ–Ω—É

---

#### üÜï Process `Update Task Template`
**Condition**:
```plsql
:REQUEST = 'UPDATE_TASK'
AND :P50_IS_TEMPLATE = 'Y'
```

---

### üü© C. **–ó–º—ñ–Ω–∞ Data Source —É Interactive Grid –¥–∏–Ω–∞–º—ñ—á–Ω–æ**

–û—Å–∫—ñ–ª—å–∫–∏ IG –Ω–µ –º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏ –¥–∂–µ—Ä–µ–ª–æ —Ç–∞–±–ª–∏—Ü—ñ –Ω–∞ –ª—å–æ—Ç—É ‚Äî —Ç–∏ –º–æ–∂–µ—à:
1. –î–æ–¥–∞—Ç–∏ –¥–≤–∞ IG:
   - `IG_TASK_SUBTASKS` (TASK_SUBTASKS)
   - `IG_TEMPLATE_SUBTASKS` (TASK_TEMPLATE_SUBTASKS)

2. –í—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏ –ª–∏—à–µ –æ–¥–∏–Ω –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ `P50_IS_TEMPLATE`:
   - –ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `Server-side Condition`:
     - `:P50_IS_TEMPLATE = 'N'` ‚Üí –¥–ª—è `IG_TASK_SUBTASKS`
     - `:P50_IS_TEMPLATE = 'Y'` ‚Üí –¥–ª—è `IG_TEMPLATE_SUBTASKS`

3. –£—Å—ñ –ø—Ä–æ—Ü–µ—Å–∏ –≤—Å—Ç–∞–≤–∫–∏/–æ–Ω–æ–≤–ª–µ–Ω–Ω—è `TASK_ID`/`TEMPLATE_ID`, `PARENT_ID` ‚Äî –¥—É–±–ª—é—é—Ç—å—Å—è —É –¥–≤–æ—Ö –≤–∞—Ä—ñ–∞–Ω—Ç–∞—Ö, –∞–ª–µ –∑ —Ä—ñ–∑–Ω–∏–º–∏ —Ç–∞–±–ª–∏—Ü—è–º–∏.

---

### üü© D. **–ü—Ä–æ—Ü–µ—Å–∏ –¥–ª—è –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å —à–∞–±–ª–æ–Ω—É**

#### `Update TEMPLATE_ID`:

```plsql
UPDATE TASK_TEMPLATE_SUBTASKS
SET TEMPLATE_ID = :P50_TASK_ID
WHERE DRAFT_ID = :P50_DRAFT_ID
  AND TEMPLATE_ID IS NULL;
```

#### `Update PARENT_ID` (—à–∞–±–ª–æ–Ω–∏):

```plsql
MERGE INTO TASK_TEMPLATE_SUBTASKS dst
USING (
  SELECT s1.ID AS CHILD_ID,
         s2.ID AS REAL_PARENT_ID
  FROM TASK_TEMPLATE_SUBTASKS s1
  JOIN TASK_TEMPLATE_SUBTASKS s2
    ON s1.DRAFT_ID = s2.DRAFT_ID
   AND s1.PARENT_TEMP_ID = s2.TEMP_ROW_ID
  WHERE s1.DRAFT_ID = :P50_DRAFT_ID
) mapping
ON (dst.ID = mapping.CHILD_ID)
WHEN MATCHED THEN
  UPDATE SET dst.PARENT_ID = mapping.REAL_PARENT_ID;
```

---

## üîÄ –ó–≤–µ–¥–µ–Ω–∞ —É–º–æ–≤–∞ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ Process:

| –ü—Ä–æ—Ü–µ—Å                      | –£–º–æ–≤–∞ `Server-side Condition`                                |
|-----------------------------|---------------------------------------------------------------|
| Insert Task                 | `:REQUEST = 'CREATE_TASK' AND :P50_IS_TEMPLATE = 'N'`         |
| Update Task                 | `:REQUEST = 'UPDATE_TASK' AND :P50_IS_TEMPLATE = 'N'`         |
| Insert Task Template        | `:REQUEST = 'CREATE_TASK' AND :P50_IS_TEMPLATE = 'Y'`         |
| Update Task Template        | `:REQUEST = 'UPDATE_TASK' AND :P50_IS_TEMPLATE = 'Y'`         |
| Update TASK_ID in subtasks  | `:P50_IS_TEMPLATE = 'N' AND :P50_TASK_ID IS NOT NULL`         |
| Update TEMPLATE_ID          | `:P50_IS_TEMPLATE = 'Y' AND :P50_TASK_ID IS NOT NULL`         |
| Update PARENT_ID (task)     | `:P50_IS_TEMPLATE = 'N' AND :P50_TASK_ID IS NOT NULL`         |
| Update PARENT_ID (template) | `:P50_IS_TEMPLATE = 'Y' AND :P50_TASK_ID IS NOT NULL`         |

---

## üß© –ö–µ—Ä—É–≤–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏ —Å—Ç–æ—Ä—ñ–Ω–∫–∏

–ú–æ–∂–µ—à –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `P50_IS_TEMPLATE` –¥–ª—è:
- –∫–µ—Ä—É–≤–∞–Ω–Ω—è –≤–∏–¥–∏–º—ñ—Å—Ç—é –±–ª–æ–∫—ñ–≤
- –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ (`PERIOD_MODE`, `PERIOD_INTERVAL` —Ç—ñ–ª—å–∫–∏ –¥–ª—è —à–∞–±–ª–æ–Ω—É)

–ù–∞–ø—Ä–∏–∫–ª–∞–¥:
- `P50_PERIOD_MODE` ‚Üí Server-side Condition:
  ```plsql
  :P50_IS_TEMPLATE = 'Y'
  ```

---

‚úÖ –¢–µ–ø–µ—Ä —Ç–≤–æ—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –ø—ñ–¥—Ç—Ä–∏–º—É—î **—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —è–∫ –∑–∞–≤–¥–∞–Ω—å, —Ç–∞–∫ —ñ —à–∞–±–ª–æ–Ω—ñ–≤**, –∑ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∏–º –∫–µ—Ä—É–≤–∞–Ω–Ω—è–º —Ñ–æ—Ä–º–æ—é, –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è–º–∏ —ñ –æ–±—Ä–æ–±–∫–æ—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.

üîÅ –•–æ—á–µ—à ‚Äî –¥–æ–ø–æ–º–æ–∂—É —Å—Ç–≤–æ—Ä–∏—Ç–∏ `Unified View` –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –∑–º—ñ—à–∞–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ –∑–∞–≤–¥–∞–Ω—å + —à–∞–±–ª–æ–Ω—ñ–≤ –∞–±–æ –¥–æ–¥–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–∞–≤–¥–∞–Ω–Ω—è –∑ —à–∞–±–ª–æ–Ω—É.