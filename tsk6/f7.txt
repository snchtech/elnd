–¢–∞–∫, –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–æ–ª—è `DRAFT_ID` –∞–±–æ –ø–æ–¥—ñ–±–Ω–æ–≥–æ —Ç–∏–º—á–∞—Å–æ–≤–æ–≥–æ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞ **–ø–µ—Ä–µ–¥ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è–º `TASK_ID`** ‚Äî —Ü–µ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞. –¶–µ —ñ–¥–µ–∞–ª—å–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è —ñ –¥–ª—è `PARENT_ID` –≤ —ñ—î—Ä–∞—Ä—Ö—ñ—ó –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å, —Ç—ñ–ª—å–∫–∏ –∑ –Ω–µ–≤–µ–ª–∏–∫–∏–º —É—Ç–æ—á–Ω–µ–Ω–Ω—è–º.

---

## ‚úÖ –Ü–¥–µ—è

- **`DRAFT_ID`** ‚Äî —Ü–µ —Ç–∏–º—á–∞—Å–æ–≤–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä "—á–µ—Ä–Ω–µ—Ç–∫–∏" –∑–∞–≤–¥–∞–Ω–Ω—è, —è–∫–∏–π –≤–∂–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π —â–µ –¥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–ø—Ä–∞–≤–∂–Ω—å–æ–≥–æ `TASK_ID`.
- –î–ª—è —ñ—î—Ä–∞—Ä—Ö—ñ—ó –≤ `TASK_SUBTASKS`:
  - —Ç–∏ —Å—Ç–≤–æ—Ä—é—î—à –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –∑ –ø–æ–ª–µ–º `PARENT_TEMP_ID` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `VARCHAR2`)
  - –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ:
    - –≤—Å—ñ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –∑ –æ–¥–Ω–∞–∫–æ–≤–∏–º `DRAFT_ID` –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è,
    - –ø—ñ—Å–ª—è —á–æ–≥–æ —Ç–∏ **–æ–Ω–æ–≤–ª—é—î—à `PARENT_ID`** –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ `TEMP_ROW_ID ‚Üí ID`.

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª—ñ–≤

–í —Ç–∞–±–ª–∏—Ü—ñ `TASK_SUBTASKS`:

| –ü–æ–ª–µ             | –û–ø–∏—Å                                                   |
|------------------|--------------------------------------------------------|
| `ID`             | –°–ø—Ä–∞–≤–∂–Ω—ñ–π ID                                            |
| `TASK_ID`        | –ó‚Äô—è–≤–∏—Ç—å—Å—è –ø—ñ—Å–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è TASK                         |
| `DRAFT_ID`       | –¢–∏–º—á–∞—Å–æ–≤–∏–π ID (–ø—Ä–∏–≤'—è–∑–∫–∞ –¥–æ —â–µ –Ω–µ—Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ TASK)      |
| `TEMP_ROW_ID`    | –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Ä—è–¥–∫–∞ –Ω–∞ –∫–ª—ñ—î–Ω—Ç—ñ              |
| `PARENT_TEMP_ID` | –í–∫–∞–∑—É—î –Ω–∞ `TEMP_ROW_ID` —ñ–Ω—à–æ–≥–æ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è             |
| `PARENT_ID`      | –°–ø—Ä–∞–≤–∂–Ω—ñ–π –∑–≤‚Äô—è–∑–æ–∫, –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ –ë–î      |

---

## üõ†Ô∏è –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–æ–±–æ—Ç–∏

1. –ö–æ–ª–∏ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–æ–≤–µ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –≤ IG:
   - —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–æ–≤–∏–π –∑–∞–ø–∏—Å –∑:
     - `DRAFT_ID` = `:P50_DRAFT_ID`
     - `TEMP_ROW_ID` = `temp_...`
     - `PARENT_TEMP_ID` ‚Äî —è–∫—â–æ —î –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å
     - `PARENT_ID` ‚Äî –ø–æ–∫–∏ `NULL`

2. –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ "–ó–±–µ—Ä–µ–≥—Ç–∏":
   - –≤—Å—ñ –∑–∞–ø–∏—Å–∏ –∑ `DRAFT_ID = :P50_DRAFT_ID` –≤—Å—Ç–∞–≤–ª—è—é—Ç—å—Å—è –≤ –ë–î
   - `ID` –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
   - `TEMP_ROW_ID` ‚Üí –Ω–æ–≤–∏–π `ID` –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ

3. **–û—Å—Ç–∞–Ω–Ω—ñ–π –∫—Ä–æ–∫** ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è `PARENT_ID`:

```sql
MERGE INTO TASK_SUBTASKS dst
USING (
  SELECT s1.ID AS CHILD_ID, s2.ID AS PARENT_ID
  FROM TASK_SUBTASKS s1
  JOIN TASK_SUBTASKS s2
    ON s1.DRAFT_ID = s2.DRAFT_ID
   AND s1.PARENT_TEMP_ID = s2.TEMP_ROW_ID
  WHERE s1.DRAFT_ID = :P50_DRAFT_ID
) mapping
ON (dst.ID = mapping.CHILD_ID)
WHEN MATCHED THEN
  UPDATE SET dst.PARENT_ID = mapping.PARENT_ID;
```

---

## üìå –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:

- –¶–µ–π –ø—ñ–¥—Ö—ñ–¥ **—ñ–∑–æ–ª—å–æ–≤–∞–Ω–∏–π –≤—ñ–¥ —Å–ø—Ä–∞–≤–∂–Ω—ñ—Ö ID**, –ø—Ä–∞—Ü—é—î –Ω–∞ `TEMP_ROW_ID`, —ñ –ø–æ–≤–Ω—ñ—Å—Ç—é –±–µ–∑–ø–µ—á–Ω–∏–π –¥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è `TASK`.
- –ü—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–∞–º–æ–≥–æ `TASK`, –≤–∏–∫–æ–Ω–∞–π –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π `UPDATE`:
```sql
UPDATE TASK_SUBTASKS
SET TASK_ID = :P50_TASK_ID
WHERE DRAFT_ID = :P50_DRAFT_ID;
```

---

## ‚ú® –ü–µ—Ä–µ–≤–∞–≥–∏ –ø—ñ–¥—Ö–æ–¥—É –∑ `DRAFT_ID`:
- –ü—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –¥–æ —Å–∞–º–æ–≥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è `TASK`.
- –ü—Ä–∞—Ü—é—î –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ –≤–∫–ª–∞–¥–µ–Ω–∏—Ö —ñ—î—Ä–∞—Ä—Ö—ñ—è—Ö.
- –í—Å—è –ª–æ–≥—ñ–∫–∞ –ª–µ–≥–∫–æ —Ç–µ—Å—Ç—É—î—Ç—å—Å—è, –Ω–µ –≤–∏–º–∞–≥–∞—î –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö ID.
- –ó–∞–ª–∏—à–∞—î—Ç—å—Å—è —ñ—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω —É —Ç–∞–±–ª–∏—Ü—ñ.

---

üîÅ –Ø–∫—â–æ —Ö–æ—á–µ—à, —è –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ –Ω–∞–ø–∏—Å–∞—Ç–∏:
- –ø–æ–≤–Ω—É PL/SQL –ø—Ä–æ—Ü–µ–¥—É—Ä—É –∑ –≤—Å—Ç–∞–≤–∫–æ—é —ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º PARENT_ID
- SQL –¥–ª—è APEX Process —Ç–∏–ø—É `Execute Code`

–ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –∫–æ–¥—É –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è?