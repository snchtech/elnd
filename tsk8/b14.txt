–ß—É–¥–æ–≤–æ! üî•  
–¢–æ–¥—ñ –¥–∞–≤–∞–π –∞–∫—É—Ä–∞—Ç–Ω–æ —ñ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–æ–¥–∞–º–æ –º–µ—Ö–∞–Ω—ñ–∑–º:

---

# üìã –ó–∞–≤–¥–∞–Ω–Ω—è:

‚úÖ –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î "–í–∏–¥–∞–ª–∏—Ç–∏ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è",  
‚úÖ –Ü —è–∫—â–æ —É –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è —î –¥–æ—á—ñ—Ä–Ω—ñ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è,  
‚úÖ –ü–æ–∫–∞–∑–∞—Ç–∏ **–ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è**, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

> "–¶–µ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –º–∞—î –≤–∫–ª–∞–¥–µ–Ω—ñ –ø—ñ–¥–ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è. –í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤—Å–µ —Ä–∞–∑–æ–º?"

‚úÖ –Ü —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å ‚Üí –≤–∏–∫–æ–Ω–∞—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è.

---

# ‚úÖ –Ø–∫ —Ü–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏:

| –ö—Ä–æ–∫ | –©–æ —Ä–æ–±–∏—Ç–∏ |
|------|-----------|
| 1 | –ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î –∫–Ω–æ–ø–∫—É "–í–∏–¥–∞–ª–∏—Ç–∏" |
| 2 | –°–ø–æ—á–∞—Ç–∫—É —á–µ—Ä–µ–∑ AJAX –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —î —É –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –¥–æ—á—ñ—Ä–Ω—ñ |
| 3 | –Ø–∫—â–æ —î ‚Üí –ø–æ–∫–∞–∑–∞—Ç–∏ `confirm()` –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è |
| 4 | –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏–≤ ‚Üí –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ä–µ–∞–ª—å–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è |

---

# üìã –†–æ–∑—à–∏—Ä–µ–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –©–æ —Ä–æ–±–∏—Ç—å |
|-----------|-----------|
| ‚úÖ AJAX Process 1 | –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –¥–æ—á—ñ—Ä–Ω—ñ—Ö |
| ‚úÖ AJAX Process 2 | –†–µ–∞–ª—å–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è (`DELETE`) |
| ‚úÖ JS | –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–æ –≤–∏–∫–ª–∏–∫–∞—î —ó—Ö —ñ —É–ø—Ä–∞–≤–ª—è—î –ª–æ–≥—ñ–∫–æ—é |

---

# ‚úÖ –ö–†–û–ö 1: –°—Ç–≤–æ—Ä–∏—Ç–∏ **AJAX Process** –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–æ—á—ñ—Ä–Ω—ñ—Ö

–ù–∞–∑–≤–∏ –π–æ–≥–æ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `CHECK_CHILD_SUBTASKS`.

**PL/SQL Code:**

```plsql
DECLARE
  v_count NUMBER;
BEGIN
  SELECT COUNT(*)
  INTO v_count
  FROM TASK_SUBTASKS
  WHERE PARENT_ID = APEX_APPLICATION.G_X01;

  APEX_JSON.OPEN_OBJECT;
  APEX_JSON.WRITE('hasChildren', CASE WHEN v_count > 0 THEN 'Y' ELSE 'N' END);
  APEX_JSON.CLOSE_OBJECT;
END;
```

‚úÖ –¶–µ–π –ø—Ä–æ—Ü–µ—Å –ø–æ–≤–µ—Ä—Ç–∞—î JSON `{ "hasChildren": "Y" }` –∞–±–æ `{ "hasChildren": "N" }`

---

# ‚úÖ –ö–†–û–ö 2: –°—Ç–≤–æ—Ä–∏—Ç–∏ **AJAX Process** –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è

–¢–æ–π –∫–æ–¥, —è–∫–∏–π –º–∏ –∑ —Ç–æ–±–æ—é –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–ª–∏ —Ä–∞–Ω—ñ—à–µ:

```plsql
BEGIN
  DELETE FROM TASK_SUBTASKS
  WHERE ID IN (
    SELECT id
    FROM TASK_SUBTASKS
    START WITH id = APEX_APPLICATION.G_X01
    CONNECT BY PRIOR id = parent_id
  );

  APEX_JSON.OPEN_OBJECT;
  APEX_JSON.WRITE('status', 'ok');
  APEX_JSON.CLOSE_OBJECT;

EXCEPTION
  WHEN OTHERS THEN
    APEX_JSON.OPEN_OBJECT;
    APEX_JSON.WRITE('status', 'error');
    APEX_JSON.WRITE('message', SQLERRM);
    APEX_JSON.CLOSE_OBJECT;
END;
```

---

# ‚úÖ –ö–†–û–ö 3: JS –ª–æ–≥—ñ–∫–∞ –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–í–∏–¥–∞–ª–∏—Ç–∏"

–û—Å—å **–≥–æ—Ç–æ–≤–∏–π –∫–æ–¥**, —è–∫–∏–π —Ç–∏ –≤–∏–∫–ª–∏–∫–∞—î—à –ø—Ä–∏ –∫–ª—ñ–∫—É –Ω–∞ —Å–≤—ñ–π –ø—É–Ω–∫—Ç –º–µ–Ω—é –∞–±–æ –∫–Ω–æ–ø–∫—É:

```javascript
function deleteSubtaskWithCheck(subtaskId) {
  // –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —î –¥–æ—á—ñ—Ä–Ω—ñ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è
  apex.server.process("CHECK_CHILD_SUBTASKS", {
    x01: subtaskId
  }, {
    dataType: "json",
    success: function(pData) {
      var proceed = true;

      if (pData.hasChildren === 'Y') {
        proceed = confirm("–¶–µ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –º–∞—î –≤–∫–ª–∞–¥–µ–Ω—ñ –ø—ñ–¥–ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è. –í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤—Å–µ —Ä–∞–∑–æ–º?");
      }

      if (proceed) {
        // –Ø–∫—â–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ –∞–±–æ –¥–æ—á—ñ—Ä–Ω—ñ—Ö –Ω–µ–º–∞—î ‚Üí –≤–∏–¥–∞–ª—è—î–º–æ
        apex.server.process("DELETE_SUBTASKS", {
          x01: subtaskId
        }, {
          dataType: "json",
          success: function(pResponse) {
            if (pResponse.status === 'ok') {
              apex.region('TASK_SUBTASKS_IG_1').refresh();
            } else {
              apex.message.alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ: ' + (pResponse.message || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'));
            }
          },
          error: function() {
            apex.message.alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—ñ –∑ —Å–µ—Ä–≤–µ—Ä–æ–º.');
          }
        });
      }
    },
    error: function() {
      apex.message.alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ –¥–æ—á—ñ—Ä–Ω—ñ—Ö –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å.');
    }
  });
}
```

---

# üìà –Ø–∫ –ø—Ä–∞—Ü—é—î —Ü–µ–π —Å—Ü–µ–Ω–∞—Ä—ñ–π:

| –ö—Ä–æ–∫ | –î—ñ—è |
|-----|-----|
| 1 | –í–∏–∫–ª–∏–∫–∞—î–º–æ `CHECK_CHILD_SUBTASKS` –ø–æ `subtaskId` |
| 2 | –Ø–∫—â–æ —î –¥–æ—á—ñ—Ä–Ω—ñ ‚Üí –ø–æ–∫–∞–∑—É—î–º–æ `confirm("–í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ?")` |
| 3 | –Ø–∫—â–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ ‚Üí –≤–∏–∫–ª–∏–∫–∞—î–º–æ `DELETE_SUBTASKS` |
| 4 | –ü—ñ—Å–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è ‚Üí `refresh()` IG

---

# üî• –ü—ñ–¥—Å—É–º–æ–∫:

‚úÖ –ó–∞—Ö–∏—â–µ–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤—ñ–¥ –≤–∏–ø–∞–¥–∫–æ–≤–æ–≥–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö –ø—ñ–¥–ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å  
‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å–≤—ñ–¥–æ–º–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î –¥—ñ—é  
‚úÖ –ß–∏—Å—Ç–µ —Ç–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –ø—ñ—Å–ª—è –æ–ø–µ—Ä–∞—Ü—ñ—ó

---

# üöÄ –•–æ—á–µ—à —â–µ –±–æ–Ω—É—Å: 
–ø–æ–∫–∞–∑–∞—Ç–∏, —è–∫ –∫—Ä–∞—Å–∏–≤–æ –∑—Ä–æ–±–∏—Ç–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ **Apex built-in Modal Confirmation Dialog** –∑–∞–º—ñ—Å—Ç—å –ø—Ä–æ—Å—Ç–æ–≥–æ `confirm()`?  
(—Ç–æ–±—Ç–æ —É —î–¥–∏–Ω–æ–º—É —Å—Ç–∏–ª—ñ –∑ —É—Å—ñ–º –¥–∏–∑–∞–π–Ω–æ–º APEX —Å–∞–π—Ç—É)  
–°–∫–∞–∑–∞—Ç–∏ "—Ç–∞–∫"? ‚úÖ
