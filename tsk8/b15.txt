–ß—É–¥–æ–≤–∞ –∑–∞–¥–∞—á–∞! üî•  
–¢–∏ –¥—É–∂–µ –¥–µ—Ç–∞–ª—å–Ω–æ –ø–æ—è—Å–Ω–∏–≤ —â–æ —Å–∞–º–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—Ä–æ–±–∏—Ç–∏ ‚Äî —Ü–µ –¥–æ–∑–≤–æ–ª—è—î –º–µ–Ω—ñ –æ–¥—Ä–∞–∑—É –∑–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ **—Å—Ç–∞–±—ñ–ª—å–Ω–µ —ñ —á–∏—Å—Ç–µ —Ä—ñ—à–µ–Ω–Ω—è**.

---

# üìã –ü—ñ–¥—Å—É–º—É—î–º–æ —Ç–≤–æ—î –∑–∞–≤–¥–∞–Ω–Ω—è:

‚úÖ –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ `Duplicate`:  
- –Ø–∫—â–æ `P5_SWITCH = 0` ‚Üí –∫–æ–ø—ñ—é—î–º–æ –∑–∞–≤–¥–∞–Ω–Ω—è (TASKS + TASK_SUBTASKS)  
- –Ø–∫—â–æ `P5_SWITCH = 1` ‚Üí –∫–æ–ø—ñ—é—î–º–æ —à–∞–±–ª–æ–Ω (TASK_TEMPLATES + TASK_TEMPLATE_SUBTASKS)

‚úÖ –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –∑–∞–ø–∏—Å —É TASKS –∞–±–æ TASK_TEMPLATES —ñ–∑ –Ω–æ–≤–∏–º ID.

‚úÖ –¢–∞–∫–æ–∂ –∫–æ–ø—ñ—é—î–º–æ –≤—Å—ñ –ø–æ–≤'—è–∑–∞–Ω—ñ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è/–ø—ñ–¥–ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è (`TASK_SUBTASKS` –∞–±–æ `TASK_TEMPLATE_SUBTASKS`).

‚úÖ –ü–æ–ª–µ `PLANNING_DATE_START` —Å—Ç–∞–≤–∏–º–æ `SYSDATE`.

‚úÖ –ù–æ–≤–∏–π –∑–∞–ø–∏—Å –ø–æ–≤–∏–Ω–µ–Ω –∑'—è–≤–∏—Ç–∏—Å—å –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –ø—ñ—Å–ª—è —Å–∞–±–º—ñ—Ç—É.

---

# ‚úÖ –Ø–∫ –º–∏ —Ü–µ —Ä–µ–∞–ª—ñ–∑—É—î–º–æ:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å |
|-----------|------|
| 1. –ö–Ω–æ–ø–∫–∞ `Duplicate` | –ö–Ω–æ–ø–∫–∞ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ 5 |
| 2. AJAX Process | –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π PL/SQL –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –¥–ª—è –¥—É–±–ª—é–≤–∞–Ω–Ω—è |
| 3. JS –≤–∏–∫–ª–∏–∫ | –í–∏–∫–ª–∏–∫ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É —á–µ—Ä–µ–∑ `apex.server.process` |
| 4. –ü—ñ—Å–ª—è –¥—É–±–ª—é–≤–∞–Ω–Ω—è | –†–µ–¥–∏—Ä–µ–∫—Ç –∞–±–æ Refresh

---

# üìã –ü–µ—Ä—à–∏–π –ö—Ä–æ–∫: —Å—Ç–≤–æ—Ä–∏—Ç–∏ **AJAX Process** –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `DUPLICATE_TASK_OR_TEMPLATE`

**PL/SQL Code:**

```plsql
DECLARE
  v_new_task_id TASKS.ID%TYPE;
  v_new_template_id TASK_TEMPLATES.ID%TYPE;
BEGIN
  IF :P5_SWITCH = 0 THEN
    -- –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è TASK
    INSERT INTO TASKS (
      ID, DATE_CREATE, TASK_CONTENT, CREATOR_ID, PLANNING_DATE_START,
      PLANNING_DATE_END, STATUS_ID, DEPARTMENT_ID, UNIT_ID, TYPE_ID,
      PAGE_LIST_ID, IS_GENERATED, GENERATED_DATE, TEMPLATE_ID, NOTE
    )
    SELECT
      TASKS_SEQ.NEXTVAL, -- –ù–û–í–ò–ô ID
      SYSDATE, -- –¥–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
      TASK_CONTENT,
      CREATOR_ID,
      SYSDATE, -- –Ω–æ–≤–∞ –¥–∞—Ç–∞ —Å—Ç–∞—Ä—Ç—É
      PLANNING_DATE_END,
      STATUS_ID,
      DEPARTMENT_ID,
      UNIT_ID,
      TYPE_ID,
      PAGE_LIST_ID,
      IS_GENERATED,
      GENERATED_DATE,
      TEMPLATE_ID,
      NOTE
    FROM TASKS
    WHERE ID = :P5_TASK_ID
    RETURNING ID INTO v_new_task_id;

    -- –ö–æ–ø—ñ—é—î–º–æ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è
    INSERT INTO TASK_SUBTASKS (
      ID, TASK_ID, SUBTASK_CONTENT, STATUS_ID,
      PLANNING_DATE_END, PARENT_ID, SUBTASK_ORDER, TEMPLATE_SUBTASK_ID
    )
    SELECT
      TASK_SUBTASKS_SEQ.NEXTVAL,
      v_new_task_id, -- –Ω–æ–≤–∏–π TASK_ID
      SUBTASK_CONTENT,
      STATUS_ID,
      PLANNING_DATE_END,
      PARENT_ID, -- –∑–∞–ª–∏—à–∞—î–º–æ –ø—Ä–∏–≤'—è–∑–∫—É —è–∫ —î
      SUBTASK_ORDER,
      TEMPLATE_SUBTASK_ID
    FROM TASK_SUBTASKS
    WHERE TASK_ID = :P5_TASK_ID;

  ELSE
    -- –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è TEMPLATE
    INSERT INTO TASK_TEMPLATES (
      ID, DATE_CREATE, TASK_CONTENT, CREATOR_ID, STATUS_ID,
      DEPARTMENT_ID, UNIT_ID, TYPE_ID, PAGE_LIST_ID, 
      PERIOD_MODE, PERIOD_INTERVAL, PERIOD_TIME,
      HOURLY_TIMES, NEXT_RUN_DATE, DATE_END
    )
    SELECT
      TASK_TEMPLATE_SEQ.NEXTVAL,
      SYSDATE,
      TASK_CONTENT,
      CREATOR_ID,
      STATUS_ID,
      DEPARTMENT_ID,
      UNIT_ID,
      TYPE_ID,
      PAGE_LIST_ID,
      PERIOD_MODE,
      PERIOD_INTERVAL,
      PERIOD_TIME,
      HOURLY_TIMES,
      NEXT_RUN_DATE,
      DATE_END
    FROM TASK_TEMPLATES
    WHERE ID = :P5_TASK_ID
    RETURNING ID INTO v_new_template_id;

    -- –ö–æ–ø—ñ—é—î–º–æ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è —à–∞–±–ª–æ–Ω—É
    INSERT INTO TASK_TEMPLATE_SUBTASKS (
      ID, TEMPLATE_ID, SUBTASK_CONTENT, STATUS_ID,
      PARENT_ID, SUBTASK_ORDER
    )
    SELECT
      TASK_TEMPLATE_SUBTASKS_SEQ.NEXTVAL,
      v_new_template_id, -- –Ω–æ–≤–∏–π TEMPLATE_ID
      SUBTASK_CONTENT,
      STATUS_ID,
      PARENT_ID,
      SUBTASK_ORDER
    FROM TASK_TEMPLATE_SUBTASKS
    WHERE TEMPLATE_ID = :P5_TASK_ID;

  END IF;

  APEX_JSON.OPEN_OBJECT;
  APEX_JSON.WRITE('status', 'ok');
  IF :P5_SWITCH = 0 THEN
    APEX_JSON.WRITE('newId', v_new_task_id);
  ELSE
    APEX_JSON.WRITE('newId', v_new_template_id);
  END IF;
  APEX_JSON.CLOSE_OBJECT;
  
EXCEPTION
  WHEN OTHERS THEN
    APEX_JSON.OPEN_OBJECT;
    APEX_JSON.WRITE('status', 'error');
    APEX_JSON.WRITE('message', SQLERRM);
    APEX_JSON.CLOSE_OBJECT;
END;
```

---

# üìã –î—Ä—É–≥–∏–π –ö—Ä–æ–∫: JavaScript –∫–æ–¥ –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ Duplicate

–£ —Ç–≤–æ—ó–π –∫–Ω–æ–ø—Ü—ñ `Duplicate` (Dynamic Action ‚Üí Click ‚Üí Execute JavaScript Code):

```javascript
apex.server.process("DUPLICATE_TASK_OR_TEMPLATE", {
  pageItems: "#P5_TASK_ID, #P5_SWITCH"
}, {
  dataType: "json",
  success: function(pData) {
    if (pData.status === 'ok') {
      apex.message.alert("–£—Å–ø—ñ—à–Ω–æ –ø—Ä–æ–¥—É–±–ª—å–æ–≤–∞–Ω–æ!");

      // –Ø–∫—â–æ —Ö–æ—á–µ—à –æ–¥—Ä–∞–∑—É —Ä–µ–¥–∏—Ä–µ–∫—Ç–Ω—É—Ç–∏ –Ω–∞ –Ω–æ–≤–∏–π –∑–∞–ø–∏—Å:
      // –ú–æ–∂–Ω–∞ –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ –æ–Ω–æ–≤–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É –∑ –Ω–æ–≤–∏–º ID
      // window.location.href = "f?p=" + $v('pFlowId') + ":5:" + $v('pInstance') + "::NO::P5_TASK_ID:" + pData.newId;
      
      // –∞–±–æ –ø—Ä–æ—Å—Ç–æ refresh, —â–æ–± –æ–Ω–æ–≤–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É
      apex.region('TASK_SUBTASKS_IG_1').refresh();
    } else {
      apex.message.alert("–ü–æ–º–∏–ª–∫–∞ –¥—É–±–ª—é–≤–∞–Ω–Ω—è: " + pData.message);
    }
  },
  error: function() {
    apex.message.alert("–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—ñ.");
  }
});
```

---

# üìà –©–æ –±—É–¥–µ:

| –ö—Ä–æ–∫ | –î—ñ—è |
|------|-----|
| 1 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î –∫–Ω–æ–ø–∫—É Duplicate |
| 2 | –í –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ P5_SWITCH –¥—É–±–ª—é—î—Ç—å—Å—è TASK –∞–±–æ TEMPLATE |
| 3 | –ö–æ–ø—ñ—é—é—Ç—å—Å—è —Ç–∞–∫–æ–∂ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è |
| 4 | –ü–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –Ω–æ–≤–∏–π ID |
| 5 | –ü–æ–∫–∞–∑—É—î—Ç—å—Å—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–±–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

---

# üõ† –î—Ä—ñ–±–Ω—ñ –Ω—é–∞–Ω—Å–∏:

- –ü—Ä–∏ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—ñ `PARENT_ID` —É –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è –ø–æ–∫–∏ —â–æ –Ω–µ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è ‚Äî —Ü–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ —è–∫—â–æ —Ç–æ–±—ñ –Ω–µ —Ç—Ä–µ–±–∞ –º—ñ–Ω—è—Ç–∏ –≤–∫–ª–∞–¥–µ–Ω—ñ—Å—Ç—å (–≤–æ–Ω–∞ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è).
- –Ø–∫—â–æ —Ç—Ä–µ–±–∞ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ `PARENT_ID` —â–æ–± –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ –Ω–æ–≤—ñ ID –¥–æ—á—ñ—Ä–Ω—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ ‚Äî —Ç–æ–¥—ñ —Ç—Ä–µ–±–∞ —Ä–æ–±–∏—Ç–∏ —Å–∫–ª–∞–¥–Ω—ñ—à–µ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –∑ –º–∞–ø–ø—ñ–Ω–≥–æ–º —Å—Ç–∞—Ä–∏—Ö‚Üí–Ω–æ–≤–∏—Ö ID. (–ø–æ—è—Å–Ω—é –æ–∫—Ä–µ–º–æ –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ)

---

# üöÄ –•–æ—á–µ—à —â–µ –±–æ–Ω—É—Å:  
–ø–æ–∫–∞–∑–∞—Ç–∏ —è–∫ –≤ —ñ–¥–µ–∞–ª—ñ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–æ–±–∏—Ç–∏ –≤–∫–ª–∞–¥–µ–Ω—ñ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω–Ω—è —Ç–∞–∫, —â–æ–± –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—ñ –∑–º—ñ–Ω—é–≤–∞–ª–∏—Å—å `PARENT_ID` –Ω–∞ –Ω–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è (—Ç–æ–±—Ç–æ –∑–±–µ—Ä—ñ–≥–∞–ª–∞—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–≤–Ω—ñ—Å—Ç—é, –±–µ–∑ –ø—Ä–∏–≤'—è–∑–∫–∏ –¥–æ —Å—Ç–∞—Ä–∏—Ö ID)?  
–°–∫–∞–∑–∞—Ç–∏ "—Ç–∞–∫"? ‚úÖ  
–¢–æ–º—É —â–æ –∑–∞—Ä–∞–∑ `PARENT_ID` –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —Å—Ç–∞—Ä–∏–π, –ø—Ä–∏–≤'—è–∑–∞–Ω–∏–π –¥–æ —Å—Ç–∞—Ä–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è. üöÄ