–ß—É–¥–æ–≤–æ! üî•  
–¢–æ–¥—ñ –ø–æ–∫–∞–∑—É—é **—è–∫ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏** —Ç–≤—ñ–π `Before Header` –ø—Ä–æ—Ü–µ—Å —Ç–∞–∫, —â–æ–±:

- –º–µ–Ω—à–µ –¥—É–±–ª—é–≤–∞—Ç–∏ –∫–æ–¥
- –º–∞—Ç–∏ —á–∏—Å—Ç—ñ—à—É —ñ –∫–æ–º–ø–∞–∫—Ç–Ω—ñ—à—É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é
- –ª–µ–≥–∫–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —É –º–∞–π–±—É—Ç–Ω—å–æ–º—É

---

# üìã –Ü–¥–µ—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó

- –ó–∞–º—ñ—Å—Ç—å –¥–≤–æ—Ö –æ–∫—Ä–µ–º–∏—Ö `SELECT ... INTO` –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **–¥–∏–Ω–∞–º—ñ—á–Ω–∏–π SQL** (`EXECUTE IMMEDIATE`).
- –ú–∏ –±—É–¥–µ–º–æ **—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –Ω–∞–∑–≤—É —Ç–∞–±–ª–∏—Ü—ñ** (`TASKS` –∞–±–æ `TASK_TEMPLATES`) –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ `P5_SWITCH`.
- –ê –ø–æ—Ç—ñ–º —á–µ—Ä–µ–∑ `EXECUTE IMMEDIATE` –≤–∏—Ç—è–≥—É–≤–∞—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –ø–æ–ª—è –≤ –∑–∞–≥–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ.

---

# ‚úÖ –û—Å—å —è–∫ –≤–∏–≥–ª—è–¥–∞—Ç–∏–º–µ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –∫–æ–¥

```plsql
DECLARE
  -- –ó–∞–≥–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
  v_date_create           DATE;
  v_task_content          VARCHAR2(4000);
  v_creator_id            NUMBER;
  v_planning_date_start   DATE;
  v_planning_date_end     DATE;
  v_status_id             NUMBER;
  v_department_id         NUMBER;
  v_unit_id               NUMBER;
  v_type_id               NUMBER;
  v_page_list_id          NUMBER;
  v_is_generated          NUMBER;
  v_generated_date        DATE;
  v_template_id           NUMBER;
  v_note                  VARCHAR2(4000);
  
  -- –î–æ–¥–∞—Ç–∫–æ–≤—ñ –¥–ª—è —à–∞–±–ª–æ–Ω—ñ–≤
  v_period_mode           NUMBER;
  v_period_interval       NUMBER;
  v_period_time           VARCHAR2(50);
  v_hourly_times          VARCHAR2(4000);
  v_next_run_date         DATE;
  v_date_end              DATE;

  -- –¢–µ—Ö–Ω—ñ—á–Ω—ñ
  v_sql_stmt              VARCHAR2(4000);
BEGIN
  IF :P5_TASK_ACTION_MODE IN (0, 2) THEN
  
    IF :P5_SWITCH = 0 THEN
      -- –§–æ—Ä–º—É—î–º–æ –∑–∞–ø–∏—Ç –¥–ª—è TASKS
      v_sql_stmt := '
        SELECT 
          DATE_CREATE,
          TASK_CONTENT,
          CREATOR_ID,
          PLANNING_DATE_START,
          PLANNING_DATE_END,
          STATUS_ID,
          DEPARTMENT_ID,
          UNIT_ID,
          TYPE_ID,
          PAGE_LIST_ID,
          IS_GENERATED,
          GENERATED_DATE,
          TEMPLATE_ID,
          NOTE,
          NULL, NULL, NULL, NULL, NULL, NULL -- –∑–∞–ø–æ–≤–Ω—é—î–º–æ —à–∞–±–ª–æ–Ω–Ω—ñ –ø–æ–ª—è NULL
        FROM TASKS
        WHERE ID = :id';
    
    ELSIF :P5_SWITCH = 1 THEN
      -- –§–æ—Ä–º—É—î–º–æ –∑–∞–ø–∏—Ç –¥–ª—è TASK_TEMPLATES
      v_sql_stmt := '
        SELECT 
          DATE_CREATE,
          TASK_CONTENT,
          CREATOR_ID,
          NULL, NULL, -- PLANNING_DATE_START, PLANNING_DATE_END –¥–ª—è —à–∞–±–ª–æ–Ω—ñ–≤ –Ω–µ–º–∞—î
          STATUS_ID,
          DEPARTMENT_ID,
          UNIT_ID,
          TYPE_ID,
          PAGE_LIST_ID,
          NULL, NULL, NULL, NULL, -- IS_GENERATED, GENERATED_DATE, TEMPLATE_ID, NOTE
          PERIOD_MODE,
          PERIOD_INTERVAL,
          PERIOD_TIME,
          HOURLY_TIMES,
          NEXT_RUN_DATE,
          DATE_END
        FROM TASK_TEMPLATES
        WHERE ID = :id';
    END IF;
    
    -- –í–∏–∫–æ–Ω—É—î–º–æ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π –∑–∞–ø–∏—Ç
    EXECUTE IMMEDIATE v_sql_stmt
      INTO
        v_date_create,
        v_task_content,
        v_creator_id,
        v_planning_date_start,
        v_planning_date_end,
        v_status_id,
        v_department_id,
        v_unit_id,
        v_type_id,
        v_page_list_id,
        v_is_generated,
        v_generated_date,
        v_template_id,
        v_note,
        v_period_mode,
        v_period_interval,
        v_period_time,
        v_hourly_times,
        v_next_run_date,
        v_date_end
      USING :P5_TASK_ID;
      
    -- –ü—Ä–∏—Å–≤–æ—é—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è —É Page Items
    :P5_DATE_CREATE           := v_date_create;
    :P5_TASK_CONTENT          := v_task_content;
    :P5_CREATOR_ID            := v_creator_id;
    :P5_PLANNING_DATE_START   := v_planning_date_start;
    :P5_PLANNING_DATE_END     := v_planning_date_end;
    :P5_STATUS_ID             := v_status_id;
    :P5_DEPARTMENT_ID         := v_department_id;
    :P5_UNIT_ID               := v_unit_id;
    :P5_TYPE_ID               := v_type_id;
    :P5_PAGE_LIST_ID          := v_page_list_id;
    :P5_IS_GENERATED          := v_is_generated;
    :P5_GENERATED_DATE        := v_generated_date;
    :P5_TEMPLATE_ID           := v_template_id;
    :P5_NOTE                  := v_note;
    :P5_PERIOD_MODE           := v_period_mode;
    :P5_PERIOD_INTERVAL       := v_period_interval;
    :P5_PERIOD_TIME           := v_period_time;
    :P5_HOURLY_TIMES          := v_hourly_times;
    :P5_NEXT_RUN_DATE         := v_next_run_date;
    :P5_DATE_END              := v_date_end;

  END IF;
END;
```

---

# üìà –©–æ –º–∏ –≤–∏–≥—Ä–∞–ª–∏:

| –ë—É–ª–æ | –°—Ç–∞–ª–æ |
|------|-------|
| 2 –æ–∫—Ä–µ–º—ñ SELECT | 1 –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π SELECT |
| 2 –Ω–∞–±–æ—Ä–∏ –ø—Ä–∏—Å–≤–æ—î–Ω—å | 1 –Ω–∞–±—ñ—Ä –ø—Ä–∏—Å–≤–æ—î–Ω—å |
| –í–µ–ª–∏–∫–∞ –¥—É–±–ª—é—é—á–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è | –ß–∏—Å—Ç–∏–π —ñ –∫–æ–º–ø–∞–∫—Ç–Ω–∏–π –∫–æ–¥ |

---

# ‚ö° –Ø–∫ –ø—Ä–∞—Ü—é—î:

- –Ø–∫—â–æ `P5_SWITCH = 0` ‚Äî –≤–∏–±–∏—Ä–∞—î–º–æ –≤—Å—ñ —Ä–µ–∞–ª—å–Ω—ñ –ø–æ–ª—è –∑ `TASKS`, –∞ —à–∞–±–ª–æ–Ω–Ω—ñ –ø–æ–ª—è (`PERIOD_MODE`, `PERIOD_INTERVAL` —ñ —Ç.–¥.) —Å—Ç–∞–≤–∏–º–æ `NULL`.
- –Ø–∫—â–æ `P5_SWITCH = 1` ‚Äî –≤–∏–±–∏—Ä–∞—î–º–æ –≤—Å—ñ —Ä–µ–∞–ª—å–Ω—ñ –ø–æ–ª—è –∑ `TASK_TEMPLATES`, –∞ —Ç—ñ, —è–∫–∏—Ö –Ω–µ–º–∞—î –≤ —à–∞–±–ª–æ–Ω–∞—Ö (`PLANNING_DATE_START`, `PLANNING_DATE_END`, —Ç–æ—â–æ) ‚Äî —Ç–∞–∫–æ–∂ `NULL`.
- –ü—ñ—Å–ª—è `EXECUTE IMMEDIATE` –∑–Ω–∞—á–µ–Ω–Ω—è –æ–¥—Ä–∞–∑—É –ø–æ—Ç—Ä–∞–ø–ª—è—é—Ç—å –≤ –∑–º—ñ–Ω–Ω—ñ, —è–∫—ñ –º–∏ –ø—Ä–∏—Å–≤–æ—é—î–º–æ –¥–æ —Å—Ç–æ—Ä—ñ–Ω–∫–æ–≤–∏—Ö Item.

---

# üìã –î—Ä—ñ–±–Ω—ñ –Ω–æ—Ç–∞—Ç–∫–∏:

- –Ø–∫—â–æ –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É –¥–æ–¥–∞–≤–∞—Ç–∏–º–µ—à –ø–æ–ª—è —É TASKS –∞–±–æ TASK_TEMPLATES ‚Äî –ø—Ä–æ—Å—Ç–æ –æ–Ω–æ–≤–∏—à —Ç—É—Ç `v_sql_stmt`.
- –Ø–∫—â–æ –ø–æ–ª—è –∑ —Ä—ñ–∑–Ω–∏–º–∏ –Ω–∞–∑–≤–∞–º–∏ ‚Äî —Ç—Ä–µ–±–∞ –±—É–¥–µ –ø–∏—Å–∞—Ç–∏ —â–µ –æ–∫—Ä–µ–º–∏–π –∫–æ–¥, –∞ –∑–∞—Ä–∞–∑ –≤—Å–µ —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–æ.
- –Ø–∫—â–æ —Ç—Ä–µ–±–∞ –±—É–¥–µ –æ–±—Ä–æ–±–∏—Ç–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π –∑–∞–ø–∏—Å (`NO_DATA_FOUND`) ‚Äî –º–æ–∂–Ω–∞ –ª–µ–≥–∫–æ –¥–æ–¥–∞—Ç–∏ –æ–±—Ä–æ–±–∫—É –≤ `EXCEPTION`.

---

# üöÄ –•–æ—á–µ—à ‚Äî —â–µ –º–æ–∂—É –ø–æ–∫–∞–∑–∞—Ç–∏, —è–∫ –∑—Ä–æ–±–∏—Ç–∏ —á–µ—Ä–µ–∑ APEX Collections –¥–ª—è –¥—É–∂–µ —Å–∫–ª–∞–¥–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∫–æ–ª–∏ –¥–∞–Ω–∏—Ö –±–∞–≥–∞—Ç–æ —ñ —Ñ–æ—Ä–º–∞ –≤–µ–ª–∏–∫–∞)? üî•  
–°–∫–∞–∑–∞—Ç–∏ "—Ç–∞–∫"? ‚úÖ
