–ß—É–¥–æ–≤–æ –ø–æ—è—Å–Ω–∏–≤ —Å–∏—Ç—É–∞—Ü—ñ—é! üî•  
–Ø –±–∞—á—É —á—ñ—Ç–∫–æ –¥–µ –º–æ–∂–µ –±—É—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∞.  
–î–∞–≤–∞–π —É–≤–∞–∂–Ω–æ —Ä–æ–∑–±–µ—Ä–µ–º–æ:

---

# üìã –ö–æ—Ä–æ—Ç–∫–æ —â–æ —Ç–∏ –º–∞—î—à –∑–∞—Ä–∞–∑:

- `CHECK_CHILD_SUBTASKS` –ø—Ä–æ—Ü–µ—Å –ø—Ä–∞—Ü—é—î –æ–∫ (–ø–æ–≤–µ—Ä—Ç–∞—î —á–∏ —î –¥–æ—á—ñ—Ä–Ω—ñ)
- `DELETE_SUBTASKS` —Å–µ—Ä–≤–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å –æ—Å—å —Ç–∞–∫–∏–π:

```plsql
BEGIN
  DELETE FROM TASK_SUBTASKS
  WHERE ID IN (
    SELECT id
    FROM TASK_SUBTASKS
    START WITH id = APEX_APPLICATION.G_X01
    CONNECT BY PRIOR id = parent_id
  );

  APEX_JSON.OPEN_OBJECT;
  APEX_JSON.WRITE('status', 'ok');
  APEX_JSON.CLOSE_OBJECT;

EXCEPTION
  WHEN OTHERS THEN
    APEX_JSON.OPEN_OBJECT;
    APEX_JSON.WRITE('status', 'error');
    APEX_JSON.WRITE('message', SQLERRM);
    APEX_JSON.CLOSE_OBJECT;
END;
```

‚úÖ –õ–æ–≥—ñ–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞!  
‚ùå –ê–ª–µ —î –ø—Ä–æ–±–ª–µ–º–∞ —Å–∞–º–µ —á–µ—Ä–µ–∑ **`APEX_APPLICATION.G_X01`**:  
**–ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ `CONNECT BY` —É SQL —É —Ç—ñ–ª—ñ DELETE –Ω–∞–ø—Ä—è–º—É** —Ç—Ä–µ–±–∞ –¥—É–∂–µ —É–≤–∞–∂–Ω–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º APEX `G_X01`.

---

# üìã –û—Å–Ω–æ–≤–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞:

- `APEX_APPLICATION.G_X01` —ñ—Å–Ω—É—î —Ç—ñ–ª—å–∫–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ PL/SQL.
- –ê–ª–µ –∫–æ–ª–∏ —Ç–∏ –ø–∏—à–µ—à `DELETE ... WHERE ID IN (SELECT ... START WITH id = APEX_APPLICATION.G_X01)`, —Ç–æ Oracle **–Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ G_X01 –≤ —á–∏—Å—Ç–æ–º—É SQL**, –¥–µ G_X01 **–º–æ–∂–µ –±—É—Ç–∏ NULL –∞–±–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–º**.
- –Ü –≤–∏—Ö–æ–¥–∏—Ç—å SQL Error ‚Üí –±—Ä–∞—É–∑–µ—Ä –±–∞—á–∏—Ç—å –ø–æ–º–∏–ª–∫—É –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è.

**–¢–æ–±—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞ —Ä—ñ–≤–Ω—ñ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è `DELETE` –∑ `CONNECT BY PRIOR`, –∞ –Ω–µ –Ω–∞ —Ä—ñ–≤–Ω—ñ subtaskId.**

---

# ‚úÖ –Ø–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏, —â–æ–± –ø—Ä–∞—Ü—é–≤–∞–ª–æ –∑–∞–≤–∂–¥–∏:

üëâ –¢—Ä–µ–±–∞ **—Å–ø–æ—á–∞—Ç–∫—É –∑—á–∏—Ç–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è G_X01 —É –ª–æ–∫–∞–ª—å–Ω—É –∑–º—ñ–Ω–Ω—É**, –∞ –≤–∂–µ –ø–æ—Ç—ñ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –π–æ–≥–æ —É SQL-–∑–∞–ø–∏—Ç—ñ.

---

# üìã –û—Å—å –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ä–æ–±–æ—á–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –ø—Ä–æ—Ü–µ—Å—É `DELETE_SUBTASKS`:

```plsql
DECLARE
  v_subtask_id TASK_SUBTASKS.ID%TYPE;
BEGIN
  -- –ß–∏—Ç–∞—î–º–æ –≤ –∑–º—ñ–Ω–Ω—É (–í–ê–ñ–õ–ò–í–û)
  v_subtask_id := APEX_APPLICATION.G_X01;

  DELETE FROM TASK_SUBTASKS
  WHERE ID IN (
    SELECT id
    FROM TASK_SUBTASKS
    START WITH id = v_subtask_id
    CONNECT BY PRIOR id = parent_id
  );

  -- –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —É—Å–ø—ñ—Ö
  APEX_JSON.OPEN_OBJECT;
  APEX_JSON.WRITE('status', 'ok');
  APEX_JSON.CLOSE_OBJECT;

EXCEPTION
  WHEN OTHERS THEN
    -- –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –ø–æ–º–∏–ª–∫—É
    APEX_JSON.OPEN_OBJECT;
    APEX_JSON.WRITE('status', 'error');
    APEX_JSON.WRITE('message', SQLERRM);
    APEX_JSON.CLOSE_OBJECT;
END;
```

---

# üìà –ß–æ–º—É —Ü–µ –≤–∏—Ä—ñ—à—É—î –ø—Ä–æ–±–ª–µ–º—É:

| –ü—Ä–æ–±–ª–µ–º–∞ | –†—ñ—à–µ–Ω–Ω—è |
|----------|---------|
| G_X01 –ø—Ä—è–º–æ –≤ SQL –Ω–µ –∑–∞–≤–∂–¥–∏ –≤–∏–¥–Ω–æ | –ú–∏ –∑—á–∏—Ç–∞–ª–∏ G_X01 –≤ –∑–º—ñ–Ω–Ω—É `v_subtask_id` |
| CONNECT BY –ø—Ä–∞—Ü—é—î –Ω–∞ —á–∏—Å—Ç–æ–º—É –∑–Ω–∞—á–µ–Ω–Ω—ñ | Oracle –ø—Ä–∞–≤–∏–ª—å–Ω–æ –±–∞—á–∏—Ç—å v_subtask_id |

‚úÖ –Ü —Ç–µ–ø–µ—Ä `DELETE` –ø—Ä–∞—Ü—é—î –±–µ–∑ –∑–±–æ—ó–≤ —ñ –±–µ–∑ "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—ñ –∑ —Å–µ—Ä–≤–µ—Ä–æ–º".

---

# üõ† –©–æ —â–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏:

- –£ –ø—Ä–æ—Ü–µ—Å—ñ `DELETE_SUBTASKS`:
  - Type: **PL/SQL Code**
  - AJAX Callback: —Ç–∞–∫, –¥–ª—è `apex.server.process`
- –ü–∞—Ä–∞–º–µ—Ç—Ä–∏: **–Ω–µ–º–∞—î –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—ñ–ª—å—à–µ –Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞—Ç–∏**, –≤—Å–µ –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ `x01`.

---

# üìã –î–æ–¥–∞—Ç–∫–æ–≤–æ:

| –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ | –ü–æ—è—Å–Ω–µ–Ω–Ω—è |
|---------------|-----------|
| –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ —Å–∫—ñ–ª—å–∫–∏ –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å –≤–∏–¥–∞–ª–µ–Ω–æ | –ú–æ–∂—É –¥–æ–¥–∞—Ç–∏ RETURN –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —á–µ—Ä–µ–∑ `SQL%ROWCOUNT` |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è IG –ø—ñ—Å–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è | –£ —Ç–µ–±–µ –≤–∂–µ –∑—Ä–æ–±–ª–µ–Ω–æ —á–µ—Ä–µ–∑ `apex.region('TASK_SUBTASKS_IG_1').refresh();` |

---

# üöÄ –•–æ—á–µ—à —è —â–µ –ø–æ–∫–∞–∂—É:
–Ø–∫ –ø—Ä–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—ñ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø–∏—Å–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ç–∏–ø—É:
> "–ë—É–¥–µ –≤–∏–¥–∞–ª–µ–Ω–æ 5 –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å. –ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –≤–∏–¥–∞–ª–µ–Ω–Ω—è."

(—Ç–æ–±—Ç–æ –ø–µ—Ä–µ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è–º —Ä–∞—Ö—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥–æ—á—ñ—Ä–Ω—ñ—Ö —Ä—è–¥–∫—ñ–≤ üî•)

–°–∫–∞–∑–∞—Ç–∏ "—Ç–∞–∫"? ‚úÖ
(–Ü —è –æ–¥—Ä–∞–∑—É –Ω–∞–ø–∏—à—É –≥–æ—Ç–æ–≤–∏–π –ø—Ä–∏–∫–ª–∞–¥!) üöÄ
