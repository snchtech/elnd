–ß—É–¥–æ–≤–æ! üî•  
–¢–æ–¥—ñ —è –ø–æ–∫–∞–∂—É —Ç–æ–±—ñ **–æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –æ–Ω–æ–≤–ª–µ–Ω–Ω—è PARENT_ID** –ø—ñ—Å–ª—è –¥—É–±–ª—é–≤–∞–Ω–Ω—è –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å –∞–±–æ –ø—ñ–¥—à–∞–±–ª–æ–Ω—ñ–≤.

---

# üìã –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É –≤–∞—Ä—ñ–∞–Ω—Ç—ñ:

–ó–∞—Ä–∞–∑ –º–∏ –ø—Ä–æ—Ö–æ–¥–∏–º–æ **–∫—É—Ä—Å–æ—Ä–æ–º** –ø–æ –≤—Å—ñ—Ö –∑–∞–ø–∏—Å–∞—Ö —ñ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –≤–∏–∫–æ–Ω—É—î–º–æ –æ–∫—Ä–µ–º–∏–π `UPDATE`, —Ç–æ–±—Ç–æ:

| –ë—É–ª–æ | –ü—Ä–æ–±–ª–µ–º–∞ |
|-----|----------|
| `FOR old_id IN (SELECT...) LOOP UPDATE ... END LOOP` | –î—É–∂–µ –±–∞–≥–∞—Ç–æ –º–∞–ª–µ–Ω—å–∫–∏—Ö UPDATE-–∑–∞–ø–∏—Ç—ñ–≤ |

‚úÖ –¶–µ –ø—Ä–∞—Ü—é—î,  
‚ùå –ê–ª–µ **–ø–æ–≤—ñ–ª—å–Ω–æ**, –æ—Å–æ–±–ª–∏–≤–æ —è–∫—â–æ –±–∞–≥–∞—Ç–æ –∑–∞–ø–∏—Å—ñ–≤.

---

# ‚úÖ –Ü–¥–µ—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:

- –ó–∞–º—ñ—Å—Ç—å –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –∫–æ–∂–µ–Ω —Ä—è–¥–æ–∫ –æ–∫—Ä–µ–º–æ
- –ó—Ä–æ–±–∏—Ç–∏ **–æ–¥–∏–Ω –º–∞—Å–æ–≤–∏–π UPDATE —á–µ—Ä–µ–∑ MERGE** –∞–±–æ —á–µ—Ä–µ–∑ **IN-MEMORY SELECT**

---

# üìà –Ø–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è `PARENT_ID` –∑–∞ –æ–¥–∏–Ω —Ä–∞–∑:

## 1Ô∏è‚É£ –ü–µ—Ä–µ–¥ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º —Ç—Ä–µ–±–∞ –º–∞—Ç–∏ —Ç–∏–º—á–∞—Å–æ–≤—É —Ç–∞–±–ª–∏—Ü—é –∞–±–æ –≥–ª–æ–±–∞–ª—å–Ω—É –º–∞–ø—É.
–ê–ª–µ —É –Ω–∞—Å —î `l_id_map` —É PL/SQL ‚Äî –π–æ–≥–æ –Ω–µ –º–æ–∂–Ω–∞ –Ω–∞–ø—Ä—è–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –≤ SQL.

–¢–æ–º—É –∫—Ä–∞—â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ **COLLECTION** –≤ APEX –∞–±–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∏–º—á–∞—Å–æ–≤—É —Ç–∞–±–ª–∏—Ü—é.

---

## 2Ô∏è‚É£ –Ø–∫—â–æ –±–µ–∑ —Ç–∏–º—á–∞—Å–æ–≤–æ—ó —Ç–∞–±–ª–∏—Ü—ñ ‚Äî –æ—Å—å –∫—Ä–∞—Å–∏–≤–∞ —Ä–æ–±–æ—á–∞ —ñ–¥–µ—è:

üîµ –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Å—Ç–∞—Ä—ñ ID ‚Üí –Ω–æ–≤—ñ ID —É –∫–æ–ª–µ–∫—Ü—ñ—é `APEX_COLLECTION`  
üîµ –†–æ–±–∏–º–æ UPDATE —á–µ—Ä–µ–∑ JOIN

---

# üìã –ü–ª–∞–Ω:

| –ö—Ä–æ–∫ | –î—ñ—è |
|------|-----|
| 1 | –°—Ç–≤–æ—Ä–∏—Ç–∏ APEX_COLLECTION –¥–ª—è –º–∞–ø–∏ |
| 2 | –í—Å—Ç–∞–≤–∏—Ç–∏ —Ç—É–¥–∏ —Å—Ç–∞—Ä—ñ/–Ω–æ–≤—ñ ID |
| 3 | –ó—Ä–æ–±–∏—Ç–∏ –æ–¥–∏–Ω UPDATE —á–µ—Ä–µ–∑ JOIN –ø—ñ–¥–∑–∞–≤–¥–∞–Ω—å —ñ –∫–æ–ª–µ–∫—Ü—ñ—ó |

---

# üìã –ü—Ä–∏–∫–ª–∞–¥ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥—É –¥–ª—è TASK_SUBTASKS:

## –ü—ñ—Å–ª—è –¥—É–±–ª—é–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –∑–∞–ø–∏—Å—ñ–≤:

```plsql
-- 1. –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–ª–µ–∫—Ü—ñ—é
APEX_COLLECTION.CREATE_OR_TRUNCATE_COLLECTION(p_collection_name => 'SUBTASK_PARENT_MAP');

-- 2. –í—Å—Ç–∞–≤–ª—è—î–º–æ —Å—Ç–∞—Ä—ñ —Ç–∞ –Ω–æ–≤—ñ ID —É –∫–æ–ª–µ–∫—Ü—ñ—é
FOR idx IN l_id_map.FIRST .. l_id_map.LAST LOOP
  APEX_COLLECTION.ADD_MEMBER(
    p_collection_name => 'SUBTASK_PARENT_MAP',
    p_c001 => idx, -- —Å—Ç–∞—Ä–∏–π ID
    p_c002 => l_id_map(idx) -- –Ω–æ–≤–∏–π ID
  );
END LOOP;

-- 3. –û–Ω–æ–≤–ª—é—î–º–æ –º–∞—Å–æ–≤–æ —á–µ—Ä–µ–∑ –∫–æ–ª–µ–∫—Ü—ñ—é
UPDATE TASK_SUBTASKS t
SET PARENT_ID = (
  SELECT c.p_c002
  FROM APEX_COLLECTIONS c
  WHERE c.collection_name = 'SUBTASK_PARENT_MAP'
    AND c.p_c001 = t.PARENT_ID
)
WHERE TASK_ID = v_new_task_id
  AND PARENT_ID IS NOT NULL;
```

---

# üìà –©–æ —Ç—É—Ç –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:

| –ö—Ä–æ–∫ | –ü–æ—è—Å–Ω–µ–Ω–Ω—è |
|------|-----------|
| –°—Ç–≤–æ—Ä—é—î–º–æ –∞–±–æ –æ—á–∏—â–∞—î–º–æ –∫–æ–ª–µ–∫—Ü—ñ—é APEX | `SUBTASK_PARENT_MAP` |
| –î–æ–¥–∞—î–º–æ —Å—Ç–∞—Ä–∏–π ID —Ç–∞ –Ω–æ–≤–∏–π ID —É –ø–æ–ª—è `c001`, `c002` |
| –†–æ–±–∏–º–æ –æ–¥–∏–Ω UPDATE –≤—Å—ñ—Ö —Ä—è–¥–∫—ñ–≤, –ø—ñ–¥—Å—Ç–∞–≤–ª—è—é—á–∏ –Ω–æ–≤–∏–π `PARENT_ID` |

‚úÖ –í–µ—Å—å –∞–ø–¥–µ–π—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –≤ 1 SQL –æ–ø–µ—Ä–∞—Ç–æ—Ä—ñ.

---

# üìã –î–ª—è —à–∞–±–ª–æ–Ω—ñ–≤ (`TASK_TEMPLATE_SUBTASKS`) –±—É–¥–µ –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–æ, —Ç—ñ–ª—å–∫–∏ —ñ–Ω—à–∞ —É–º–æ–≤–∞ `WHERE TEMPLATE_ID = v_new_template_id`

---

# üöÄ –ü–µ—Ä–µ–≤–∞–≥–∏ —Ç–∞–∫–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É:

| –ü–µ—Ä–µ–≤–∞–≥–∞ | –ß–æ–º—É —Ü–µ –∫—Ä—É—Ç–æ |
|----------|---------------|
| üî• –®–≤–∏–¥—à–µ | –ë–æ 1 SQL –∑–∞–ø–∏—Ç –∑–∞–º—ñ—Å—Ç—å N |
| üî• –ú–µ–Ω—à–µ –±–ª–æ–∫—É–≤–∞–Ω—å | –ú–µ–Ω—à–µ –ª–æ–∫–∞—Ü—ñ–π —Ä—è–¥–∫—ñ–≤ |
| üî• –ß–∏—Å—Ç–æ –≤–∏–≥–ª—è–¥–∞—î | –ö–æ–¥ –∞–∫—É—Ä–∞—Ç–Ω–∏–π —ñ –∑—Ä–æ–∑—É–º—ñ–ª–∏–π |

---

# üõ† –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ, —è –º–æ–∂—É —Å–∫–ª–∞—Å—Ç–∏ —Ç–æ–±—ñ –≤–∂–µ –ø–æ–≤–Ω—ñ—Å—Ç—é –æ–Ω–æ–≤–ª–µ–Ω—É –≤–µ—Ä—Å—ñ—é –≤—Å—å–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É –∑ —Ü—ñ—î—é –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—î—é.

–°–∫–∞–∑–∞—Ç–∏ "—Ç–∞–∫"? ‚úÖ  
(–Ü —è –¥–∞–º –ø–æ–≤–Ω–∏–π –æ–Ω–æ–≤–ª–µ–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –¥–ª—è `DUPLICATE_TASK_OR_TEMPLATE`!) üöÄ
